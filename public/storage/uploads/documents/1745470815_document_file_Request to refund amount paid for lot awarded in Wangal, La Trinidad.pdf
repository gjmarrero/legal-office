d",e.IsPageValidError="IsPageValidError",e.NoPinterestDeals="NoPinterestDeals",e.PinterestDeals="PinterestDeals",e.NoSocialCoupons="NoSocialCoupons",e.NoSelectors="NoSelectors",e.FallbackValidation="FallbackValidation",e.FallbackError="FallbackError",e.NoCoupons="NoCoupons",e.AllCouponsBlocked="AllCouponsBlocked",e.PageBecameValid="PageBecameValid",e.CheckingOtherSellers="CheckingOtherSellers",e.TrendingDealsChina="TrendingDealsChina",e.SuggestedCouponsOnlyPage="SuggestedCouponsOnlyPage",e.AbandonedCart="AbandonedCart",e.ProductTracking="ProductTracking",e.AutoOpenControllerActive="AutoOpenControllerActive",e.DisabledCheckoutPageData="DisabledCheckoutPageData",e.AAConsent="AAConsent",e.EndofScript_ProductPage="EndofScript_ProductPage",e.EndofScript_CheckoutPage="EndofScript_CheckoutPage",e.EndofScript_HomePage="EndofScript_HomePage",e.EndofScript_SearchPage="EndofScript_SearchPage",e.SponsoredPromotions="SponsoredPromotions",e.EnablePersonalization="EnablePersonalization",e.InvalidCartTotal="InvalidCartTotal",e}({});t.Z=class{constructor(){(0,a.Z)(this,"domain",void 0),(0,a.Z)(this,"validationReason",void 0),(0,a.Z)(this,"time",void 0),(0,a.Z)(this,"initializeTime",void 0),(0,a.Z)(this,"preValidationTime",void 0),(0,a.Z)(this,"path",void 0),(0,a.Z)(this,"pageStatus",void 0),(0,a.Z)(this,"scriptRunNum",void 0),(0,a.Z)(this,"validationMsgNum",void 0)}}},4802:function(e,t,o){var a=o(2370);class i{constructor(){(0,a.Z)(this,"domain",void 0),(0,a.Z)(this,"pageType",void 0),(0,a.Z)(this,"pageUrl",void 0),(0,a.Z)(this,"orderId",void 0),(0,a.Z)(this,"orderIdFromUrl",void 0),(0,a.Z)(this,"orderTotal",void 0),(0,a.Z)(this,"orderSubtotal",void 0),(0,a.Z)(this,"productName",void 0),(0,a.Z)(this,"productItemPrice",void 0),(0,a.Z)(this,"productTotalPrice",void 0),(0,a.Z)(this,"productQuantity",void 0),(0,a.Z)(this,"productId",void 0),(0,a.Z)(this,"currency",void 0),(0,a.Z)(this,"productPrice",void 0),(0,a.Z)(this,"productNameFromImg",void 0),(0,a.Z)(this,"randomId",void 0),(0,a.Z)(this,"pageUrlFields",void 0)}static Create(e){const t=new i;return t.domain=e.domain,t.pageType=e.pageType,t.pageUrl=e.pageUrl,t.currency=e.currency,t.orderId=e.orderId,t.orderIdFromUrl=e.orderIdFromUrl,t.orderSubtotal=e.orderSubtotal,t.orderTotal=e.orderTotal,t.productName=e.productName,t.productItemPrice=e.productItemPrice,t.productTotalPrice=e.productTotalPrice,t.productQuantity=e.productQuantity,t.productId=e.productId,t.productPrice=e.productPrice,t.productNameFromImg=e.productNameFromImg,t.randomId=e.randomId,t}}t.Z=i},978:function(e,t,o){o.d(t,{JR:function(){return r},Vj:function(){return i}});var a=o(2370);const i="PersonalizedPromotionsRawData";class r{constructor(){(0,a.Z)(this,"Domain",void 0),(0,a.Z)(this,"PageType",void 0),(0,a.Z)(this,"PageUrl",void 0),(0,a.Z)(this,"OrderId",void 0),(0,a.Z)(this,"OrderIdFromUrl",void 0),(0,a.Z)(this,"OrderTotal",void 0),(0,a.Z)(this,"OrderSubtotal",void 0),(0,a.Z)(this,"ProductName",void 0),(0,a.Z)(this,"ProductItemPrice",void 0),(0,a.Z)(this,"ProductTotalPrice",void 0),(0,a.Z)(this,"ProductPrice",void 0),(0,a.Z)(this,"ProductNameFromImg",void 0),(0,a.Z)(this,"RandomId",void 0),(0,a.Z)(this,"ProductQuantity",void 0),(0,a.Z)(this,"ProductId",void 0),(0,a.Z)(this,"Currency",void 0),(0,a.Z)(this,"ExtractionId",void 0),(0,a.Z)(this,"CartDataCreationTime",void 0)}}},4440:function(e,t,o){var a=o(2370);class i{static Create(e){const t=new i;return t.productTitle=e.productTitle??"",t.productPrice=e.productPrice??0,t.productUrl=e.productUrl??"",t.productImg=e.productImg??"",t.productQuantity=e.productQuantity??0,t.productSeller=e.productSeller??"",t.buyNowItem=e.buyNowItem,t.productBrand=e.productBrand??"",t}constructor(){(0,a.Z)(this,"productTitle",void 0),(0,a.Z)(this,"productPrice",void 0),(0,a.Z)(this,"productUrl",void 0),(0,a.Z)(this,"productImg",void 0),(0,a.Z)(this,"productQuantity",void 0),(0,a.Z)(this,"productSeller",void 0),(0,a.Z)(this,"foundInWebAssist",void 0),(0,a.Z)(this,"webAssistTitle",void 0),(0,a.Z)(this,"webAssistPrice",void 0),(0,a.Z)(this,"webAssistImg",void 0),(0,a.Z)(this,"buyNowItem",void 0),(0,a.Z)(this,"productBrand",void 0),(0,a.Z)(this,"productCurrency",void 0),this.foundInWebAssist=!1}}t.Z=i},650:function(e,t,o){o.d(t,{lD:function(){return a},si:function(){return i}});const a=["confirmation number","confirmation email","thank you for your order","order placed","order was placed","track your order"],i=["cvv"];t.ZP=class{static PageIncludesPaymentKeyWords(e,t){if(e)for(const o of t)if(e.includes(o))return!0;return!1}}},7869:function(e,t,o){o.d(t,{L:function(){return r},c:function(){return i}});var a=o(2370);let i=function(e){return e.finalCheckoutButtonVisible="finalCheckoutButtonVisible",e.successfulPaymentKeywordsFound="successfulPaymentKeywordsFound",e.failurePaymentKeywordsFound="failurePaymentKeywordsFound",e.inputFieldsFound="inputFieldsFound",e}({});class r{constructor(){(0,a.Z)(this,"purchaseFailed",void 0),(0,a.Z)(this,"indicators",void 0)}}},4801:function(e,t,o){o.d(t,{Z:function(){return g}});var a=o(2370);class i{constructor(){(0,a.Z)(this,"hasLink",void 0),(0,a.Z)(this,"couponCodeElement",void 0),(0,a.Z)(this,"couponCodeHash",void 0),(0,a.Z)(this,"retailerElement",void 0),(0,a.Z)(this,"retailerHash",void 0),(0,a.Z)(this,"channelId",void 0),(0,a.Z)(this,"username",void 0)}static Create(e){const t=new i;return t.hasLink=e.hasLink,t.couponCodeElement=e.couponCodeElement,t.couponCodeHash=e.couponCodeHash,t.retailerElement=e.retailerElement,t.retailerHash=e.retailerHash,t.channelId=e.channelId,t.username=e.username,t}}var r=i,n=o(9247),s=o(6577),c=o(5794),l=o(1094),d=o(5477),u=o(2820),m=o(5144),h=o(2800);class p{constructor(){(0,a.Z)(this,"invalidCouponMessages",void 0),(0,a.Z)(this,"checkoutPageRegex",void 0),(0,a.Z)(this,"platform",void 0),(0,a.Z)(this,"domainName",void 0),(0,a.Z)(this,"orderConfirmationPageUrl",void 0),(0,a.Z)(this,"searchQueryUrlRegex",void 0),(0,a.Z)(this,"allCheckoutPages",void 0),(0,a.Z)(this,"isTravelDomain",void 0),(0,a.Z)(this,"travelConfirmationPageTelemetry",void 0),(0,a.Z)(this,"allFinalCheckoutPages",void 0),(0,a.Z)(this,"checkoutPageKey",void 0),(0,a.Z)(this,"isCheckoutPageSelectorsPresent",void 0),(0,a.Z)(this,"finalCheckoutPageKey",void 0),(0,a.Z)(this,"productPageKey",void 0),(0,a.Z)(this,"exclusiveMarket",void 0),(0,a.Z)(this,"multiMsgValidationEnabled",void 0),(0,a.Z)(this,"youtubeTemplates",void 0),(0,a.Z)(this,"allProductPages",void 0),(0,a.Z)(this,"exactCheckoutPageUrl",void 0),(0,a.Z)(this,"productOutOfStockSelector",void 0),(0,a.Z)(this,"productNameSelector",void 0),(0,a.Z)(this,"productPriceSelector",void 0),(0,a.Z)(this,"productPageUrl",void 0),(0,a.Z)(this,"productImageSelector",void 0),(0,a.Z)(this,"aaConsentEnabled",void 0),(0,a.Z)(this,"isStorewideCashbackEstimationEnabled",void 0),(0,a.Z)(this,"storeCartInEdgeStorage",void 0),(0,a.Z)(this,"cartMonitorUrl",void 0),(0,a.Z)(this,"travelCheckoutPageKey",void 0),(0,a.Z)(this,"checkoutPageUrl",void 0),(0,a.Z)(this,"confirmationPageTelemetry",void 0),(0,a.Z)(this,"isAOCFragmentCollectionEnabled",void 0),(0,a.Z)(this,"aOCFragmentCollectionRate",void 0),(0,a.Z)(this,"addressBarExpansionEnabled",void 0),(0,a.Z)(this,"retailerTrivia",void 0),(0,a.Z)(this,"disabledPopupOriginationList",void 0),(0,a.Z)(this,"allAutomatedSelectors",void 0),(0,a.Z)(this,"automatedSelectorsKey",void 0),(0,a.Z)(this,"isAddressBarCashbackEnabled",void 0),(0,a.Z)(this,"isCompositeNotificationPhCExcludedRetailer",void 0),(0,a.Z)(this,"isCompositeNotificationPhCTopRetailer",void 0),(0,a.Z)(this,"productPageUrlRegex",void 0),(0,a.Z)(this,"settings",void 0),(0,a.Z)(this,"edgeFeatureFlag",void 0),(0,a.Z)(this,"isEligibleForRewards",void 0),(0,a.Z)(this,"dataMaskRules",[]),(0,a.Z)(this,"tTAAHoldoutClassification",void 0)}static Create(e){const t=new p;return e&&(t.domainName=e.domainName,t.orderConfirmationPageUrl=e.orderConfirmationPageUrl,t.exclusiveMarket=e.exclusiveMarket,t.multiMsgValidationEnabled=e.multiMsgValidationEnabled,t.exactCheckoutPageUrl=e.exactCheckoutPageUrl,t.productOutOfStockSelector=e.productOutOfStockSelector,t.productNameSelector=e.productNameSelector,t.productPriceSelector=e.productPriceSelector,t.productImageSelector=e.productImageSelector,t.aaConsentEnabled=e.aaConsentEnabled,t.storeCartInEdgeStorage=e.storeCartInEdgeStorage,t.cartMonitorUrl=e.cartMonitorUrl,t.checkoutPageUrl=e.checkoutPageUrl,t.isTravelDomain=e.isTravelDomain,t.isStorewideCashbackEstimationEnabled=e.isStorewideCashbackEstimationEnabled,t.createCheckoutPageList(e),t.createFinalCheckoutPageList(e),t.createYoutubeTemplateList(e),t.createProductPagesList(e),t.confirmationPageTelemetry=e.confirmationPageTelemetry,t.isAOCFragmentCollectionEnabled=e.isAOCFragmentCollectionEnabled,t.productPageUrl=e.productPageUrl,t.aOCFragmentCollectionRate=e.aOCFragmentCollectionRate,t.disabledPopupOriginationList=e.disabledPopupOriginationList,t.addressBarExpansionEnabled=e.addressBarExpansionEnabled,t.createTriviaData(e),t.createAutomatedSelectorsPageList(e),t.isAddressBarCashbackEnabled=e.isAddressBarCashbackEnabled,t.isCompositeNotificationPhCExcludedRetailer=e.isCompositeNotificationPhCExcludedRetailer,t.isCompositeNotificationPhCTopRetailer=e.isCompositeNotificationPhCTopRetailer,t.productPageUrlRegex=e.productPageUrlRegex,t.searchQueryUrlRegex=e.searchQueryUrlRegex,t.settings=e.settings,t.edgeFeatureFlag=e.edgeFeatureFlag,t.isEligibleForRewards=e.isEligibleForRewards,t.platform=e.platform,t.checkoutPageKey=e.checkoutPageKey,t.allCheckoutPages=e.allCheckoutPages??[],t.finalCheckoutPageKey=e.finalCheckoutPageKey,t.allFinalCheckoutPages=e.allFinalCheckoutPages??[],t.checkoutPageRegex=e.checkoutPageRegex,t.dataMaskRules=e.dataMaskRules??[],t.travelConfirmationPageTelemetry=e.travelConfirmationPageTelemetry,t.invalidCouponMessages=e.invalidCouponMessages,t.tTAAHoldoutClassification=e.tTAAHoldoutClassification),t}updateCurrentCheckoutPage(e){return this.checkoutPageKey=this.findCurrentPage(e,this.allCheckoutPages),this.isCheckoutPageSelectorsPresent=null,(0,h.a)(),-1!==this.checkoutPageKey}getCurrentCheckoutPage(e){return null!==this.checkoutPageKey&&-1!==this.checkoutPageKey&&void 0!==this.checkoutPageKey||-1!==this.checkoutPageKey&&e&&(this.updateCurrentCheckoutPage(e),null!==this.checkoutPageKey&&-1!==this.checkoutPageKey&&void 0!==this.checkoutPageKey)?this.allCheckoutPages[this.checkoutPageKey]:void 0}updateCurrentFinalCheckoutPage(e){const t=this.findCurrentPage(e,this.allFinalCheckoutPages);return-1!==t?(this.finalCheckoutPageKey=t,!0):(this.finalCheckoutPageKey=null,!1)}getCurrentFinalCheckoutPage(){if(null!=this.finalCheckoutPageKey)return this.allFinalCheckoutPages[this.finalCheckoutPageKey]}getCurrentProductPage(e){if(null!=this.productPageKey)return this.allProductPages[this.productPageKey];{const t=this.findCurrentProductPage(e,this.allProductPages);if(-1!==t)return this.productPageKey=t,this.allProductPages[this.productPageKey];{const t=this.findCurrentProductPageUsingRegex(e);return-1!==t?(this.productPageKey=t,this.allProductPages[this.productPageKey]):void(this.productPageKey=null)}}}getCurrentAutomatedSelectorsPage(e){return null!==this.automatedSelectorsKey&&void 0!==this.automatedSelectorsKey&&this.automatedSelectorsKey<this.allAutomatedSelectors.length||e&&(this.updateCurrentAutomatedSelectorsPage(e),null!==this.automatedSelectorsKey&&-1!==this.automatedSelectorsKey&&void 0!==this.automatedSelectorsKey)?this.allAutomatedSelectors[this.automatedSelectorsKey]:void 0}getAutomatedSelectorsPageByRegex(e){for(let t=0;t<this.allAutomatedSelectors.length;t++){const o=this.allAutomatedSelectors[t];if(new RegExp(o.urlRegex).test(e))return this.automatedSelectorsKey=t,o}this.automatedSelectorsKey=-1}isConfirmationPage(e){return new RegExp(this.orderConfirmationPageUrl).test(e)}async getIsCheckoutPageSelectorsPresent(){return null==this.isCheckoutPageSelectorsPresent&&await this.updateIsCheckoutPageSelectorsPresent(),this.isCheckoutPageSelectorsPresent??!1}setIsCheckoutPageSelectorsPresent(e){this.isCheckoutPageSelectorsPresent=e}async updateIsCheckoutPageSelectorsPresent(){if(-1===this.checkoutPageKey)return void(this.isCheckoutPageSelectorsPresent=!1);const e=l.Z.GetInitialFieldsByCurrentCheckoutPageData(this.getCurrentCheckoutPage());if(0===e.length)return void(this.isCheckoutPageSelectorsPresent=!1);const t=u.Z.GetValidatorModule();this.isCheckoutPageSelectorsPresent=await(0,n.w)((()=>t.IsPageValid(e)),5e3).then((async e=>Promise.resolve(e))).catch((e=>Promise.reject(e)))}updateCurrentAutomatedSelectorsPage(e){const t=this.findCurrentAutomatedSelectorsPage(e,this.allAutomatedSelectors);return-1!==t?(this.automatedSelectorsKey=t,!0):(this.automatedSelectorsKey=null,!1)}createCheckoutPageList(e){if(this.allCheckoutPages=[],e.allCheckoutPages&&e.allCheckoutPages.length>0)for(const t of e.allCheckoutPages)this.allCheckoutPages.push(c.Z.Create(t))}createFinalCheckoutPageList(e){if(this.allFinalCheckoutPages=[],e.allFinalCheckoutPages&&e.allFinalCheckoutPages.length>0)for(const t of e.allFinalCheckoutPages)this.allFinalCheckoutPages.push(c.Z.Create(t))}createAutomatedSelectorsPageList(e){if(this.allAutomatedSelectors=[],e.allAutomatedSelectors&&e.allAutomatedSelectors.length>0)for(const t of e.allAutomatedSelectors)this.allAutomatedSelectors.push(n.ZP.DeepAssign(new s.ZP,t))}createProductPagesList(e){if(this.allProductPages=[],e.allProductPages&&e.allProductPages.length>0)for(const t of e.allProductPages)this.allProductPages.push(d.Z.Create(t))}createYoutubeTemplateList(e){if(this.youtubeTemplates=[],e.youtubeTemplates&&e.youtubeTemplates.length>0)for(const t of e.youtubeTemplates)this.youtubeTemplates.push(r.Create(t))}findCurrentPage(e,t){for(let o=0;t&&o<t.length;o++)if(n.ZP.IsPageMatch(t[o].checkoutPageUrl,t[o].pageUrlRegex,e))return t[o].disabled?-1:o;return-1}findCurrentProductPage(e,t){for(let o=0;o<t.length;o++)if(n.ZP.IsOnPage(t[o].productPageUrl,e))return o;return-1}findCurrentProductPageUsingRegex(e){let t=-1;for(let o=0;o<this.allProductPages.length;o++){const a=this.allProductPages[o];try{if(new RegExp(a.productPageUrl).test(e)){t=o;break}}catch(e){}}return t}findCurrentAutomatedSelectorsPage(e,t){for(let o=0;o<t.length;o++)if(n.ZP.IsPageRegexMatch(t[o].urlRegex,e))return o;return-1}createTriviaData(e){this.retailerTrivia={successRate:e?.retailerTrivia?.successRate??null}}isProductPage(e){return null!=this.productPageUrlRegex&&n.ZP.IsPageRegexMatch(this.productPageUrlRegex,e)||null!=this.productPageUrl&&n.ZP.IsPageRegexMatch(this.productPageUrl,e)}getCurrentPageType(){const e=this.getCurrentCheckoutPage()?.pageType??m.GV.UnknownPage;return e!==m.GV.UnknownPage?e:this.isProductPage(location.href)?m.GV.ProductPage:m.GV.UnknownPage}}var g=p},7778:function(e,t,o){o.d(t,{Z:function(){return p}});var a=o(2370),i=class{constructor(){(0,a.Z)(this,"timeStamp",void 0),(0,a.Z)(this,"allowed",void 0)}static GetAAConsentStorageKey(e){return"AAConsentData_"+e}},r=o(3078),n=o(3557),s=o(1495),c=o(1897),l=class{constructor(){(0,a.Z)(this,"BgaaResultAvailable",void 0)}},d=o(2056),u=o(2820),m=o(2714);class h extends m.Z{constructor(...e){super(...e),(0,a.Z)(this,"localDataService",void 0),(0,a.Z)(this,"aaConsentEnabled",void 0),(0,a.Z)(this,"aaConsentData",void 0)}async Init(){if(this.localDataService=u.Z.GetLocalDataService(),this.aaConsentEnabled=this.localDataService.GetCheckoutPageData().retailerData?.aaConsentEnabled??!1,!this.aaConsentEnabled)return;const e=this.getAAConsentStr(s.Q.rawStorageObj,this.localDataService.GetDomainName());this.aaConsentData=this.getAAConsentData(e)}GetPopupOriginationList(){return[n.sR.AA_CONSENT]}isAutoTriggeredAAAllowed(){if(!this.aaConsentEnabled||!this.aaConsentData?.allowed)return!1;const e=(0,c.r2)(this.aaConsentData.timeStamp);return e>=0&&e<1}AutoTriggerAutoApply(e){if(!this.aaConsentData)return;this.aaConsentData.allowed=!1;const t=i.GetAAConsentStorageKey(this.localDataService.GetDomainName());d.Z.SendStorageMessage(t,JSON.stringify({value:JSON.stringify(this.aaConsentData)}));const o=new l;o.BgaaResultAvailable=e,d.Z.StartEdgeDriver("",JSON.stringify({action:r.v.PDPconsentAA,data:o}))}getAAConsentStr(e,t){const o=i.GetAAConsentStorageKey(t);return"string"==typeof e[o]?e[o]:e[o]?.value??""}getAAConsentData(e){try{if(!e)return;return JSON.parse(e)}catch(e){return}}}var p=h},9518:function(e,t,o){var a=o(2370),i=o(5144),r=o(7778),n=o(2315),s=o(9247),c=o(4922),l=o(1094),d=o(9645),u=o(3557),m=o(4872),h=o(2714),p=o(5590),g=o(2056),S=o(2820),C=o(8025),f=o(1656),A=o(3634),P=o(1495),b=o(6854),v=o(7459),O=o(2800),E=o(3608),T=o(6493),y=o(4718),I=o(9567);class _ extends h.Z{constructor(...e){super(...e),(0,a.Z)(this,"checkoutPageUrlData",void 0),(0,a.Z)(this,"apiResponse",void 0),(0,a.Z)(this,"domainName",void 0),(0,a.Z)(this,"isPageValid",void 0),(0,a.Z)(this,"aaValidationReason",void 0),(0,a.Z)(this,"cartModelRunDebugInfo",void 0),(0,a.Z)(this,"couponEligibilities",void 0),(0,a.Z)(this,"localDataService",void 0),(0,a.Z)(this,"validator",void 0),(0,a.Z)(this,"bgaaService",void 0),(0,a.Z)(this,"cartProcessingClient",void 0),(0,a.Z)(this,"cartExtractionComplete",void 0),(0,a.Z)(this,"autoApplyInitialOrderTotalWaitTime",1e3),(0,a.Z)(this,"autoApplyOrderTotalWaitTime",3e4)}GetPopupOriginationList(){return[u.sR.AUTO_SHOW_COUPONS_CHECKOUT]}async UpdateAutoOpenData(e,t){if(this.classifiedAsNonCheckoutPage())return;if(t.extractedData.checkoutOrderTotal=await this.GetTotalPrice(),t.extractedData.aaValidationReason=await this.IsAAValid(t.extractedData.checkoutOrderTotal),f.R.isExperimentActive(m.H.autoApplyEdgeEnabledNotification)){const e=this.checkoutPageUrlData?.disableCouponNotification??!1;t.extractedData.aaValidationReason===c.S.PageIsValid&&e&&(t.extractedData.aaValidationReason=c.S.PageIsValidNotificationDisabled)}this.aaValidationReason=t.extractedData.aaValidationReason,this.isPageValid=t.extractedData.aaValidationReason===c.S.PageIsValid||f.R.isExperimentActive(m.H.autoApplyEdgeEnabledNotification)&&t.extractedData.aaValidationReason===c.S.PageIsValidNotificationDisabled;const o=this.localDataService.IsExpressCheckoutPage(),a={auto_apply_status:this.isPageValid,express_checkout_status:o,open_micro_notifcation:!1,page_validations:[],page_validations_auto_open:[],auto_open_reasons:[]};if(t.extractedData.aaValidationReason===c.S.PageIsInvalid&&this.apiResponse.retailerData?.multiMsgValidationEnabled)if(f.R.isExperimentActive(m.H.cashbackActivationOmnibar))(0,O.W)(this.apiResponse).setAutoApplyCallback((()=>{if(this.validator.SendValidationMessage(!0,c.S.PageBecameValid,this.domainName,void 0,!1,!1,a),!f.R.isExperimentActive(m.H.autoApplyEdgeEnabledNotification)||!this.checkoutPageUrlData?.disableCouponNotification){const e=new CustomEvent(A.T2,{detail:{popupOrigination:u.sR.AUTO_SHOW_COUPONS_CHECKOUT}});window.dispatchEvent(e)}}));else{const e=l.Z.GetInitialFields(this.apiResponse);(0,s.IM)((()=>this.validator.IsPageValid(e)),(()=>{if(this.validator.SendValidationMessage(!0,c.S.PageBecameValid,this.domainName,void 0,!1,!1,a),!f.R.isExperimentActive(m.H.autoApplyEdgeEnabledNotification)||!this.checkoutPageUrlData?.disableCouponNotification){const e=new CustomEvent(A.T2,{detail:{popupOrigination:u.sR.AUTO_SHOW_COUPONS_CHECKOUT}});window.dispatchEvent(e)}}))}if(!this.isPageValid)return this.validator.SendValidationMessage(this.isPageValid,t.extractedData.aaValidationReason,this.domainName,void 0,!1,!1,a),void(this.ShouldWaitForValidOrderTotal()&&this.WaitForValidOrderTotal(t,a));await this.GetAndUpdateBgaaResult(t),void 0!==t.localData.bgaaResult&&null!==t.localData.bgaaResult&&t.localData.bgaaResult===i.ps.Positive&&t.extractedData.aaValidationReason===c.S.PageIsValidNotificationDisabled&&(t.extractedData.aaValidationReason=c.S.PageIsValid),await this.SendValidationMessage(t,a)}async CanAutoOpenForFeature(e,t){let o=t.extractedData.aaValidationReason===c.S.PageIsValid&&!t.localData.automaticAutoApplyAllowed&&!this.checkoutPageUrlData?.disableCouponNotification;const a=o;let r=a;const n=(0,b.rV)();if(n&&o&&(t.localData.bgaaResult===i.ps.Positive&&t.localData.bgaaApplyButtonClicked==="true_"+this.domainName||t.localData.bgaaResult===i.ps.Negative)&&(o=!1,r=!1,g.Z.SendStringStorageMessage(p.Q.BGAAApplyButtonClicked,"false_"+this.domainName)),n){const e=new d.Z(i.xu.SuppressAutoApply);e.Domain=this.domainName,e.Metadata=JSON.stringify({bgaaApplyButtonClicked:t.localData.bgaaApplyButtonClicked,bgaaResult:t.localData.bgaaResult,canOpenInitial:a,canOpenWithBGAA:r,canOpen:o}),g.Z.SendLogEvent(this.apiResponse.impressionId,"BGAA checkout page - canOpen status for AUTO_SHOW_COUPONS_CHECKOUT","",void 0,void 0,i.R.EdgeFlyoutStatus,e,this.domainName)}return Promise.resolve(o)}async Init(){return this.apiResponse=n.Z.getApiResponse(),this.apiResponse.retailerData.updateCurrentCheckoutPage(l.Z.GetCurrentPathName()),this.checkoutPageUrlData=this.apiResponse.retailerData.getCurrentCheckoutPage(),this.domainName=this.apiResponse.retailerData.domainName,this.localDataService=S.Z.GetLocalDataService(),this.validator=S.Z.GetValidatorModule(),this.bgaaService=S.Z.GetBackgroundAAService(),this.cartProcessingClient=S.Z.GetCartProcessingClient(),this.cartExtractionComplete=!1,y.Z.OnCartCompletion((e=>{this.cartExtractionComplete||(this.cartExtractionComplete=!0,I.Z.SetBlockedCouponsRequestPending(!0),this.cartProcessingClient.CheckAndSendCartProcessingRequest(this.checkoutPageUrlData,e.cartData,void 0,this.domainName).then((()=>I.Z.SetBlockedCouponsRequestPending(!1))).catch((t=>{const o={domain:this.domainName,cartUrl:location.pathname,cartId:e.cartData?.CartId,extractionId:e.cartData?.ExtractionId};I.Z.LogCartProcessingError(o,"Error during cart processing request after successful extraction: "+t?.message,this.apiResponse.impressionId,e.cartData?.ExtractionId,this.localDataService.GetUserInfo()?.isPersonalizationDataConsentEnabled),I.Z.SetBlockedCouponsRequestPending(!1)})))})),this.WaitForCartExtraction(I.Z.CartExtractionWaitTime),Promise.resolve()}PostValidation(){return this.classifiedAsNonCheckoutPage()||l.Z.GetAndSendOrderTotal(this.localDataService.GetMarket(),this.isPageValid,this.aaValidationReason,{CouponsEligibilityCheck:this.couponEligibilities,CartModelRunDebugInfo:this.cartModelRunDebugInfo}),Promise.resolve()}classifiedAsNonCheckoutPage(){return(this.checkoutPageUrlData?.pageType??i.GV.CheckoutPage)!==i.GV.CheckoutPage}async GetTotalPrice(){if(this.checkoutPageUrlData&&!this.checkoutPageUrlData.supportedNoOrderTotal&&this.checkoutPageUrlData?.orderTotalDataElementSelector){let e="";return await(0,s.dz)((async()=>{if(this.checkoutPageUrlData){const t=g.Z.GetOrderTotalString(this.checkoutPageUrlData.orderTotalDataElementSelector);if(t)return e=t,!0}return!1}),this.autoApplyInitialOrderTotalWaitTime),e}return""}SetTotalPrice(e){this.checkoutPageUrlData?.supportedNoOrderTotal||(g.Z.SendStorageMessage("price"+this.domainName,JSON.stringify({value:e})),C.Q.setTotalPrice(e))}async HasEligibleCoupons(){try{const e=S.Z.GetSuggestedCouponService().GetSuggestedCoupons(),t=await S.Z.GetCartProcessingClient().WaitForCartExtractionAndBlockedCouponsThenGetCartData();this.cartModelRunDebugInfo={BlockedCoupons:t?.BlockedCouponsData?.BlockedCoupons,OriginalCoupons:t?.BlockedCouponsData?.OriginalCoupons,CartCouponsRanking:t?.CartCouponsRanking,OriginalCartExtractionId:t?.ExtractionId,OriginalCartId:t?.CartId};const o=t?.BlockedCouponsData?.BlockedCoupons,a=v.Z.GetAutoApplyCoupons(this.apiResponse.coupons,e,o??[],t?.CartCouponsRanking);return this.couponEligibilities=a.map((e=>({Code:e.couponCode,BlockReason:(e.isLowSuccessRateCoupon?i.HC.LowSuccess:null)||(e.isBlockedByCart?i.HC.BlockedByCart:null),SuggestedCouponType:e.suggestedCouponType??E.d.NotSuggestedCoupon}))),this.couponEligibilities.filter((e=>!e.BlockReason)).length>0}catch(e){return!0}}async GetBGAAResultIfValid(e){const t=g.Z.ParseBackgroundAutoApplyStateData(P.Q.rawStorageObj);return t&&this.checkoutPageUrlData?await this.bgaaService.TryValidateBackgroundAutoApplyState(t,this.localDataService.GetMarket(),this.checkoutPageUrlData):null}async GetAndUpdateBgaaResult(e){await this.GetBGAAResultIfValid(e).then((t=>{t?(e.localData.bgaaResult=t,e.localData.bgaaApplyButtonClicked=P.Q.BGAAApplyButtonClicked):(e.localData.bgaaResult=null,e.localData.bgaaApplyButtonClicked=null)})).catch((t=>{e.localData.bgaaResult=null,e.localData.bgaaApplyButtonClicked=null}))}async SendValidationMessage(e,t){await this.GetAndUpdateBgaaResult(e),e.extractedData.checkoutOrderTotal&&this.SetTotalPrice(e.extractedData.checkoutOrderTotal);const o=new r.Z;o.Init(),e.localData.automaticAutoApplyAllowed=o.isAutoTriggeredAAAllowed(),e.localData.automaticAutoApplyAllowed?(t?.auto_open_reasons.push("Auto Triggered AA Allowed"),this.validator.SendValidationMessage(this.isPageValid,e.extractedData.aaValidationReason,this.domainName,void 0,!1,!1,t),o.AutoTriggerAutoApply(null!=e.localData.bgaaResult)):(t?.auto_open_reasons.push("AOC is active, deferred to AOC"),this.validator.SendValidationMessage(this.isPageValid,e.extractedData.aaValidationReason,this.domainName,void 0,!1,!1,t))}ShouldWaitForValidOrderTotal(){return this.aaValidationReason===c.S.InvalidCartTotal}async WaitForValidOrderTotal(e,t){if(this.checkoutPageUrlData?.orderTotalDataElementSelector&&!this.checkoutPageUrlData.supportedNoOrderTotal){let o="";if(await(0,s.dz)((async()=>{if(this.checkoutPageUrlData?.orderTotalDataElementSelector){o=g.Z.GetOrderTotalString(this.checkoutPageUrlData.orderTotalDataElementSelector);const e=o?(0,T.K)(o):0;if(e&&e>0)return!0}return!1}),this.autoApplyOrderTotalWaitTime),await this.IsAAValid(o)===c.S.PageIsValid&&(e.extractedData.checkoutOrderTotal=o,e.extractedData.aaValidationReason=c.S.PageIsValid,this.checkoutPageUrlData?.disableCouponNotification&&(e.extractedData.aaValidationReason=c.S.PageIsValidNotificationDisabled),t.auto_apply_status=!0,this.isPageValid=!0,this.aaValidationReason=e.extractedData.aaValidationReason,await this.SendValidationMessage(e,t),await this.CanAutoOpenForFeature(u.sR.AUTO_SHOW_COUPONS_CHECKOUT,e)&&(!f.R.isExperimentActive(m.H.autoApplyEdgeEnabledNotification)||!this.checkoutPageUrlData?.disableCouponNotification))){await this.PostValidation();const e=new CustomEvent(A.T2,{detail:{popupOrigination:u.sR.AUTO_SHOW_COUPONS_CHECKOUT}});window.dispatchEvent(e)}}}async WaitForCartExtraction(e){if(await(0,s._R)(e),!this.cartExtractionComplete){this.cartExtractionComplete=!0,I.Z.SetBlockedCouponsRequestPending(!0);const e=g.Z.GetOrderTotalString(this.checkoutPageUrlData?.orderTotalDataElementSelector??""),t=(0,T.K)(e)??void 0;this.cartProcessingClient.CheckAndSendCartProcessingRequest(this.checkoutPageUrlData,void 0,t,this.domainName).then((()=>I.Z.SetBlockedCouponsRequestPending(!1))).catch((e=>{const o={domain:this.domainName,cartUrl:location.pathname,startingPrice:t};I.Z.LogCartProcessingError(o,"Error during cart processing request after extraction timeout: "+e?.message,this.apiResponse.impressionId,void 0,this.localDataService.GetUserInfo()?.isPersonalizationDataConsentEnabled),I.Z.SetBlockedCouponsRequestPending(!1)}))}}async IsAAValid(e){if(!this.checkoutPageUrlData)return c.S.IsPageValidError;if(!this.IsAutoApplyEnabled())return c.S.DisabledCheckoutPageData;const t=l.Z.GetInitialFields(this.apiResponse);if(0===t.length)return c.S.NoSelectors;if(this.apiResponse.coupons?.length>0==0)return c.S.NoCoupons;if(!this.checkoutPageUrlData.supportedNoOrderTotal)try{const t=e?(0,T.K)(e):0;if(!t||t<=0)return c.S.InvalidCartTotal}catch{return c.S.InvalidCartTotal}if(f.R.isExperimentActive(m.H.onlyShowAANotificationWithEligibleCoupons)||f.R.isExperimentActive(m.H.delayForAAEligibleCouponsCheck))try{const e=this.HasEligibleCoupons();let o;o=f.R.isExperimentActive(m.H.cashbackActivationOmnibar)?this.apiResponse.retailerData.getIsCheckoutPageSelectorsPresent():s.ZP.WaitForCondition((async()=>this.validator.IsPageValid(t)),5e3);const a=await e;return f.R.isExperimentActive(m.H.onlyShowAANotificationWithEligibleCoupons)&&!a?c.S.AllCouponsBlocked:await o?c.S.PageIsValid:c.S.PageIsInvalid}catch(e){return this.validator.sendErrorMessage(this.apiResponse.impressionId,e?.message??"checkoutpage error."),c.S.IsPageValidError}if(f.R.isExperimentActive(m.H.cashbackActivationOmnibar))try{return await this.apiResponse.retailerData.getIsCheckoutPageSelectorsPresent()?c.S.PageIsValid:c.S.PageIsInvalid}catch(e){return this.validator.sendErrorMessage(this.apiResponse.impressionId,e?.message??"checkoutpage error."),c.S.IsPageValidError}return await s.ZP.WaitForCondition((async()=>this.validator.IsPageValid(t)),5e3).then((async e=>e?c.S.PageIsValid:c.S.PageIsInvalid)).catch((e=>(this.validator.sendErrorMessage(this.apiResponse.impressionId,e?.message??"checkoutpage error."),c.S.IsPageValidError)))}IsAutoApplyEnabled(){return!0===this.checkoutPageUrlData?.edgeEnabled}}t.Z=_},6161:function(e,t,o){o.d(t,{m:function(){return a},y:function(){return i}});const a={extractedData:{},localData:{},apiData:{}};function i(){a.extractedData={},a.localData={},a.apiData={}}},2714:function(e,t,o){o.d(t,{Z:function(){return n}});var a=o(4872),i=o(1656),r=o(5386);class n{async Init(){}async UpdateAutoOpenData(e,t){}async TryLateAutoOpenForFeature(e,t){}async PostTriggerDecision(e,t){}async PostValidation(){}GetAutoOpenParams(){return i.R.isExperimentActive(a.H.disableIconWhenNoRetailerData)?JSON.stringify({defaultParams:!0}):void 0}GetNotificationHost(){return i.R.isExperimentActive(a.H.disableIconWhenNoRetailerData)?r.f.SHOPPING_ICON:void 0}}},8574:function(e,t,o){var a=o(2370),i=o(5144),r=o(3557),n=o(1495),s=o(2315),c=o(2056),l=o(1849),d=o(2820),u=o(2714),m=o(1024),h=o(7778),p=o(4922),g=o(7689),S=o(3491),C=o(3634),f=o(6854);class A extends u.Z{constructor(...e){super(...e),(0,a.Z)(this,"apiResponse",void 0),(0,a.Z)(this,"domainName",void 0),(0,a.Z)(this,"canOpen",void 0),(0,a.Z)(this,"localDataService",void 0),(0,a.Z)(this,"validator",void 0),(0,a.Z)(this,"BestCouponConsentData",void 0),(0,a.Z)(this,"checkoutPageUrlData",void 0)}Init(){return this.apiResponse=s.Z.getApiResponse(),this.domainName=this.apiResponse.retailerData.domainName,this.localDataService=d.Z.GetLocalDataService(),this.validator=d.Z.GetValidatorModule(),this.BestCouponConsentData=(0,g.BQ)(n.Q.ProductBestCouponConsent),this.checkoutPageUrlData=this.apiResponse.retailerData.getCurrentCheckoutPage(),this.MaybeCleanupBgAAStateAtInitialization(),Promise.resolve()}GetPopupOriginationList(){return[r.sR.AUTO_SHOW_COUPONS_BACKGROUND_AUTO_APPLY]}GetAutoOpenParams(){return JSON.stringify({bestCouponConsentData:this.BestCouponConsentData})}async CanAutoOpenForFeature(e,t){if(!(0,f.wR)())return Promise.resolve(!1);const o=(0,S.WN)("isBgaaComplete");if(this.isCheckoutPage()||!1===o)return Promise.resolve(!1);const a=await this.ValidatePersistedBGAAState();if(this.canOpen=await this.shouldAutoOpenForBGAA(),this.canOpen&&a&&a===i.ps.Positive&&o){const e=new CustomEvent(C.T2,{detail:{popupOrigination:r.sR.AUTO_SHOW_COUPONS_BACKGROUND_AUTO_APPLY}});window.dispatchEvent(e)}else this.canOpen=!1;return(new h.Z).Init(),this.canOpen&&o&&this.validator.SendValidationMessage(!0,p.S.PageIsValid,this.domainName,void 0,!1,!1,void 0),(0,S.Ev)("isBgaaComplete",!1),Promise.resolve(this.canOpen)}async ValidatePersistedBGAAState(){const e=c.Z.ParseBackgroundAutoApplyStateData(n.Q.rawStorageObj),t=e?.BackgroundAAStatus.domainName===this.domainName;let o=null;return e&&t&&(o=await this.TryValidateBackgroundAutoApplyState(e,this.localDataService.GetMarket())),o}async TryValidateBackgroundAutoApplyState(e,t,o){try{return await this.ValidateBackgroundAutoApplyState(e,t,o)}catch(e){}return null}async ValidateBackgroundAutoApplyState(e,t,o){const a=m.Z.GetBackgroundAAKeyName();if(this.IsBGAADataExpired(e))return this.validator.DeleteKeyFromPersistentStorage(a),null;const i=m.Z.CanCurrentDomainDeleteBgaaState(e.BackgroundAAStatus.domainName);if(!i&&e.BackgroundAAStatus.expiredState)return null;const r=e.BackgroundAAStatus.result,n=m.Z.CanCurrentPageDeleteBgaaState(e.BackgroundAAStatus.pageUrl);if(!n&&e.BackgroundAAStatus.expiredState)return null;if(n&&o){const t=await this.IsBGAADataValidBasedOnCartValue(e);if(null!==t)return!0===t?this.GetBgaaResult(e,r):(n?this.validator.DeleteKeyFromPersistentStorage(a):(e.BackgroundAAStatus.expiredState=!0,this.validator.SendStorageMessage(a,JSON.stringify({value:e.ToString()}))),null)}else if(i)return this.GetBgaaResult(e,r);return null}IsBGAADataExpired(e){return Date.now()-e.StartTime>864e5}async IsBGAADataValidBasedOnCartValue(e){if(this.checkoutPageUrlData||await this.Init(),m.Z.CanCurrentPageDeleteBgaaState(e.BackgroundAAStatus.pageUrl)&&this.checkoutPageUrlData){const t=await l.Z.WaitAndGetCartValue(this.checkoutPageUrlData.orderTotalDataElementSelector,this.localDataService.GetMarket()),o=await l.Z.WaitAndGetCartValue(this.checkoutPageUrlData.orderSubTotalElementSelector,this.localDataService.GetMarket(),1e3);return m.Z.ValidateBgAAState(e,t.OrderTotal,o.OrderTotal)}return null}MaybeCleanupBgAAStateAtInitialization(){const e=c.Z.ParseBackgroundAutoApplyStateData(n.Q.rawStorageObj);e&&this.IsBGAADataExpired(e)&&this.validator.DeleteKeyFromPersistentStorage(m.Z.GetBackgroundAAKeyName())}GetBgaaResult(e,t){const o=Math.round(100*e.MaxDiscount)/100;return(t===i.ps.InProgress||t===i.ps.Cancelled)&&o>0&&(t=i.ps.Positive),t}isCheckoutPage(){return!!this.checkoutPageUrlData&&this.checkoutPageUrlData.pageType!==i.GV.ProductPage&&!(!this.checkoutPageUrlData.checkoutPageUrl||"/"===this.checkoutPageUrlData.checkoutPageUrl)}async shouldAutoOpenForBGAA(){return!!(0,f.rV)()}}t.Z=A},529:function(e,t,o){o.d(t,{Z:function(){return C}});var a=o(2370),i=o(4872),r=o(1656),n=o(7594),s=o(9645),c=o(8767),l=o(3557);let d=function(e){return e.variation1="variation1",e.variation2="variation2",e.variation3="variation3",e.variation4="variation4",e.variation5="variation5",e.variation6="variation6",e.variation7="variation7",e.variation8="variation8",e.variation9="variation9",e.autoActivationVariation="autoActivationVariation",e.pdpExactMatch="pdpExactMatch",e.spbCartPageAutoActivationVariation="spbCartPageAutoActivationVariation",e.spbAADLinkingNotification="spbAADLinkingNotification",e}({});var u=o(5144),m=o(2315),h=o(2056),p=o(2820),g=o(2714);class S extends g.Z{constructor(...e){super(...e),(0,a.Z)(this,"apiResponse",void 0),(0,a.Z)(this,"hasSpbExpiryNotifyVariation",!1),(0,a.Z)(this,"hasSpbAddToCartNotifyVariation",!1),(0,a.Z)(this,"autoActivationOnCartPage",!1),(0,a.Z)(this,"domainName",void 0),(0,a.Z)(this,"cartExtractionService",void 0),(0,a.Z)(this,"icValidatorServiceCanOpen",new Map)}Init(){this.apiResponse=m.Z.getApiResponse();const e=this.apiResponse?.itemLevelCashBack?.variations?new Map(Object.entries(this.apiResponse?.itemLevelCashBack?.variations)):new Map;this.hasSpbExpiryNotifyVariation=e?.get("spbExpiryNotifyVariation")===d.variation1;const t=r.R.getServiceExperimentValue(i.H.spbAddToCart);if(this.hasSpbAddToCartNotifyVariation="variation1"===t,this.autoActivationOnCartPage=r.R.isTestFlagActive(n.t.msShoppingTestExp10)||r.R.isExperimentActive(i.H.spbCheckoutAutoActivation)||r.R.isExperimentActive(i.H.qtCartPageAutoActivation),this.domainName=this.apiResponse.retailerData.domainName,this.autoActivationOnCartPage){try{if("amazon.com"===this.domainName||"target.com"===this.domainName||"walmart.com"===this.domainName){const e=p.Z.GetLocalDataService(),t=(e?.GetCheckoutPageData()||this.apiResponse).retailerData.getCurrentCheckoutPage(location.pathname);if(t?.pageType===u.GV.CheckoutPage){let e;const t=new Promise((t=>setTimeout(e=t,2e3)));return this.cartExtractionService=p.Z.GetCartExtractionService(),this.cartExtractionService.subscribe(e),this.cartExtractionService.Init(),t}}}catch(e){const t=new s.Z(u.xu.CartPageCashbackNotification);t.Metadata=JSON.stringify({}),t.Domain=this.domainName,h.Z.SendLogEventMessage(t,u.R.EdgeFlyoutStatus,this.apiResponse.impressionId,e.message,u.in.Error)}this.autoActivationOnCartPage=!1}return Promise.resolve()}async UpdateAutoOpenData(e,t){const o=p.Z.GetICValidatorService();o.GetPopupOriginationList().includes(e)&&(await o.Init(),this.icValidatorServiceCanOpen[e]=await o.CanAutoOpen(e))}GetPopupOriginationList(){return[l.sR.AUTO_SHOW_SPB_CASHBACK_LANDING,l.sR.AUTO_SHOW_GROCERY_ITEMIZED_CASHBACK,l.sR.AUTO_SHOW_GROCERY_ITEMIZED_CASHBACK_LANDING,l.sR.AUTO_SHOW_SPB_CHECK_OUT_PAGE_NOTIFICATION]}static GetSpbOffer(e){const t=(e?.value||[]).find((e=>e.position===c.zE.SPB_OFFERS));if(t&&t.offer&&t.promotionInformation)return t}}var C=S},3873:function(e,t,o){o.d(t,{Z:function(){return k}});var a=o(2370),i=o(4865),r=o(4872),n=o(1656),s=o(9308);class c{constructor(){(0,a.Z)(this,"heading",void 0),(0,a.Z)(this,"price",void 0),(0,a.Z)(this,"delivery",void 0),(0,a.Z)(this,"soldBy",void 0),(0,a.Z)(this,"rating",void 0),(0,a.Z)(this,"sellerUrl",void 0),(0,a.Z)(this,"index",void 0),(0,a.Z)(this,"totalPrice",void 0),(0,a.Z)(this,"currency",void 0),(0,a.Z)(this,"addedToCart",void 0)}static Create(e){const t=new c;return t.heading=e.heading,t.price=e.price,t.soldBy=e.soldBy,t.delivery=e.delivery,t.rating=e.rating,t.sellerUrl=e.sellerUrl,t.currency=e.currency,t.addedToCart=e.addedToCart,t}}var l=c;class d{constructor(){(0,a.Z)(this,"otherSellers",void 0),(0,a.Z)(this,"productImage",void 0),(0,a.Z)(this,"productPrice",void 0),(0,a.Z)(this,"currency",void 0),(0,a.Z)(this,"productUrl",void 0),(0,a.Z)(this,"dataCreationTime",void 0)}static Create(e){const t=new d;return t.productImage=e.productImage,t.productPrice=e.productPrice,t.productUrl=e.productUrl,t.currency=e.currency,t.otherSellers=new Array,e.otherSellers.forEach((e=>{t.otherSellers.push(e)})),t}}var u=d,m=o(5144),h=o(3190),p=o(9088),g=o(3557),S=o(9247),C=o(6493),f=o(1495),A=o(7689),P=o(66),b=o(1094);class v{constructor(){(0,a.Z)(this,"ProductAddedNotification",void 0),(0,a.Z)(this,"Url",void 0)}static Create(e){const t=new v;return t.ProductAddedNotification=e.ProductAddedNotification,t.Url=e.Url,t}}var O=v,E=o(4922),T=o(2056),y=o(2820),I=o(2714);class _ extends I.Z{constructor(...e){super(...e),(0,a.Z)(this,"localDataService",void 0),(0,a.Z)(this,"validatorModule",void 0),(0,a.Z)(this,"isConfirmationScenario",void 0),(0,a.Z)(this,"domainName",void 0),(0,a.Z)(this,"checkoutPageUrlData",void 0)}async Init(){try{if(this.localDataService=y.Z.GetLocalDataService(),this.validatorModule=y.Z.GetValidatorModule(),this.domainName=this.localDataService.GetDomainName(),this.checkoutPageUrlData=this.localDataService.GetCheckoutPageData().retailerData.getCurrentCheckoutPage(b.Z.GetCurrentPathName()),!this.checkoutPageUrlData||!this.ShouldTriggerOtherSellers(this.checkoutPageUrlData))return;this.ManageOtherSellersData(b.Z.GetCurrentPathName(),f.Q.storageObjStr,f.Q.rawStorageObj);const e=this.GetOtherSellersNotificationData(b.Z.GetCurrentPathName(),f.Q.rawStorageObj);this.isConfirmationScenario=this.ValidateOtherSellerConfirmationScenario(this.domainName,this.checkoutPageUrlData,e)}catch(e){}}GetPopupOriginationList(){return[g.sR.AUTO_SHOW_OTHER_SELLERS]}async UpdateAutoOpenData(e,t){this.checkoutPageUrlData&&this.ShouldTriggerOtherSellers(this.checkoutPageUrlData)&&(n.R.getServiceExperimentValue(r.H.disableNotificationForSimilarSellers)?this.UpdateOtherSellers(this.domainName,this.checkoutPageUrlData,this.localDataService.GetMarket(),this.isConfirmationScenario):(this.validatorModule.SendValidationMessage(!1,E.S.CheckingOtherSellers,this.domainName),t.extractedData.otherSellersData=await this.UpdateOtherSellers(this.domainName,this.checkoutPageUrlData,this.localDataService.GetMarket(),this.isConfirmationScenario)))}async CanAutoOpenForFeature(e,t){const o=t.extractedData.otherSellersData,a=null!=o;if(!a)return!1;let i=!0;if("amazon.com"===this.domainName&&o&&o.otherSellers?.length>0){const e=o.otherSellers[0].heading?.toLowerCase()??"";i=e.includes("new")&&!e.includes("like")}return!(!a||!i)}async PostTriggerDecision(e,t){t===g.sR.AUTO_SHOW_OTHER_SELLERS&&this.validatorModule.SendValidationMessage(!1,E.S.OtherSellers,this.domainName,[h.p.OTHER_SELLERS],!1,!1)}ShouldTriggerOtherSellers(e){return void 0!==e.otherSellerSelectors&&this.IsVersionAllowed(p.W1,e.otherSellerSelectors.jSVersionThreshold)}isOtherSellersScenario(e){const t=e?.otherSellerSelectors?.otherSellersOverlayLinkSelector;return!(!t||(0,i.TF)(t))&&P.Z.HasVisibleElement(t)}CheckOtherSellersAutoOpen(e){const t=e.otherSellerSelectors.otherSellerLowestPriceSelector,o=P.Z.GetFirstVisibleElement(t);if(o&&o.innerText){const o=T.Z.GetOrderTotalString(e.orderTotalDataElementSelector),a=new l;if(a.price=T.Z.GetOrderTotalString(t),a.delivery="",!this.OtherSellerHasLowerPrice("amazon",o,a,""))return!1}return!0}async StoreOtherSellersInfo(e,t,o){if(!t)return null;if(!this.ValidateDataFields(e,t))return null;const a="OtherSellersData_"+b.Z.GetCurrentPathName(),i="OtherSellersIframe";try{const r=t.otherSellerSelectors.otherSellersOverlayLinkSelector,n=P.Z.GetFirstVisibleElement(r);if(n){const c=n.getAttribute("href");if(c&&e.includes("amazon")){const r=this.CreateIframe(i,c);document.body.insertBefore(r,document.body.children[0]);const n=await this.CollectOtherSellersInfo(e,t,i,o);try{this.RankOtherSellers(n)}catch(t){const o="Error while ranking other sellers. "+t,a=new s.Z;a.SetResultData(e,0,(0,C.K)(n?.productPrice??""),"",n?.currency??"$","Error"),T.Z.SendLogEventMessage(a,m.R.OtherSellers,this.validatorModule.impressionId,o,m.in.Information)}if(n&&n.otherSellers?.length>0)return T.Z.SendStorageMessage(a,JSON.stringify({value:JSON.stringify(n)})),n}else if("walmart.com"===e){const n=this.CreateIframe(i,b.Z.GetCurrentPathName());document.body.appendChild(n),await S.ZP.WaitForCondition((async()=>{const e=document.querySelectorAll("#"+i)[0],t=e?.contentDocument?.body,o=t?.querySelector(r);return void 0!==o?.innerText}),13e4);const s=document.querySelectorAll("#"+i)[0],c=s?.contentDocument?.body,l=c?.querySelector(r);l&&(l.click(),await setTimeout((()=>{l.click()}),3e3));const d=await this.CollectOtherSellersInfo(e,t,i,o);if(d&&d.otherSellers?.length>0)return T.Z.SendStorageMessage(a,JSON.stringify({value:JSON.stringify(d)})),d}}}catch(t){const o="Error while getting collecting other sellers data. "+t,a=new s.Z;a.SetResultData(e,0,0,"","","Error"),T.Z.SendLogEventMessage(a,m.R.OtherSellers,this.validatorModule.impressionId,o,m.in.Information)}return null}ResetOtherSellersNotificationFlag(){T.Z.SendStorageMessage("OtherSellersNotificationData_"+b.Z.GetCurrentPathName(),JSON.stringify({value:null}))}ValidateOtherSellerConfirmationScenario(e,t,o){return!(!this.ShouldTriggerOtherSellers(t)||!this.isOtherSellersConfirmationScenario(o)||(this.ResetOtherSellersNotificationFlag(),0))}IsVersionAllowed(e,t){if((0,i.TF)(t))return!0;try{return parseFloat(e)>=parseFloat(t)}catch(e){}return!1}isOtherSellersConfirmationScenario(e){if(e?.ProductAddedNotification){if(e?.Url===b.Z.GetCurrentPathName())return!0;this.ResetOtherSellersNotificationFlag()}return!1}ManageOtherSellersData(e,t,o){const a="OtherSellersData_"+e;!(0,i.TF)(o[a])&&T.Z.DeleteKeyFromPersistentStorage(a);const r=t.replace(/[,{]"OtherSellersData_[^\s{]*":null/g,"").replace(/[,{]"OtherSellersConfirmationData_[^\s{]*":null/g,"").match(/[,{]"OtherSellersData_[^\s{]*":|[,{]"OtherSellersConfirmationData_[^\s{]*":/g);r&&r.length>20&&this.ClearOtherSellersStorage(r,o)}ClearOtherSellersStorage(e,t){if(null!==e&&null!=t)for(const o of e){const e=o.slice(2,-2);if((0,i.TF)(t[e])){const e="Tried to delete key that doesn't exist from persistent storage",t=new s.Z;t.SetResultData((0,A.S8)(),0,0,"","","Error"),T.Z.SendLogEventMessage(t,m.R.OtherSellers,this.validatorModule.impressionId,e,m.in.Information)}else T.Z.DeleteKeyFromPersistentStorage(e)}}GetOtherSellersNotificationData(e,t){const o="OtherSellersNotificationData_"+e;return(0,i.TF)(t[o])?new O:O.Create((0,A.BQ)(t[o]))}async UpdateOtherSellers(e,t,o,a){return this.isOtherSellersScenario(t)?a?(this.StoreOtherSellersInfo(e,t,o),null):this.ShouldAutoShowForOtherSellers(e,f.Q.OtherSellersAutoShowCount??0,f.Q.OtherSellersLastAutoShowTime)?e.includes("amazon")&&!this.CheckOtherSellersAutoOpen(t)?(this.StoreOtherSellersInfo(e,t,o),null):await this.StoreOtherSellersInfo(e,t,o):(this.StoreOtherSellersInfo(e,t,o),null):null}ShouldAutoShowForOtherSellers(e,t,o){if((0,i.TF)(o)||t<2)return!0;const a=this.ParseLastAutoShowTime(e,o);return a<=0||Date.now()-a>72e5&&(T.Z.SendStorageMessage("OtherSellersAutoShowCount",JSON.stringify({value:null})),T.Z.SendStorageMessage("OtherSellersLastAutoShowTime",JSON.stringify({value:null})),!0)}ParseLastAutoShowTime(e,t){try{return Date.parse(t)}catch(t){const o="Error while parsing other sellers autoshow date. "+t,a=new s.Z;return a.SetResultData(e,0,0,"","","Error"),T.Z.SendLogEventMessage(a,m.R.OtherSellers,this.validatorModule.impressionId,o,m.in.Information),0}}OtherSellerHasLowerPrice(e,t,o,a,i,r){try{const n=(0,C.K)(t);let s=(0,C.K)(o.price);const c=this.GetDeliveryRegex(e,a,r??"");let l=0;const d=o.delivery.trim().match(c);d&&d.length>0&&(l=(0,C.K)(d[0])),l>0&&(s+=l),o.totalPrice=s;const u=n-s;if(n&&s&&u>=(i??.6)&&u/n>=.01)return!0}catch(e){}return!1}GetDeliveryRegex(e,t,o){if("walmart.com"===e)return/\$[0-9.,]+/;try{const e=(0,C.Cl)(t,o),a="^"+(0,C.So)(e)+"\\s*[0-9.,]+",i="[0-9.,]+\\s*"+(0,C.So)(e);return new RegExp(a+"|"+i)}catch(t){switch(e){case"amazon.com":return/^\$[0-9.,]+/;case"amazon.co.uk":return/^£[0-9.,]+/;default:return/\$[0-9.,]+/}}}async CollectOtherSellersInfo(e,t,o,a){const r=new u;r.otherSellers=[];const n=t.otherSellerSelectors;await S.ZP.WaitForCondition((async()=>{const e=document.querySelectorAll("#"+o)[0],t=e?.contentDocument?.body,a=t?.querySelector(n.otherSellerOfferElementSelector);return void 0!==a?.innerText}),13e4);const s=document.querySelectorAll("#"+o)[0],c=s?.contentDocument?.body,d=c?.querySelectorAll(n.otherSellerOfferElementSelector);if(!d)return r;let m=T.Z.GetOrderTotalString(t.orderTotalDataElementSelector);m?.includes("(")&&m?.includes(")")&&(m=m.slice(0,m.indexOf("("))),r.productPrice=m,r.currency=(0,C.cU)(m);let h=0;for(const t of d){if(0===h&&"walmart.com"===e){h+=1;continue}const o=new l,i=t.querySelector(n.otherSellerPriceSelector);o.price=i?.innerText??"",o.currency=(0,C.cU)(i?.innerText??"");const s=t.querySelector(n.otherSellerDeliverySelector);if(o.delivery=s?.innerText??"","walmart.com"===e){const e=i?.innerText?.split("\n");if(e&&(o.price=e[0],o.currency="$",e.length>1)){const t=e[1];!t.toLowerCase().includes("free")&&o.delivery&&(o.delivery+=t)}}if(!this.OtherSellerHasLowerPrice(e,m,o,o.currency,void 0,a))break;const c=t.querySelector(n.otherSellerHeadingSelector),d=t.querySelector(n.otherSellerNameSelector),u=t.querySelector(n.otherSellerRatingSelector),p=/a-star-mini-([0-9\-]+)/.test(u?.className)?RegExp.$1:"-1";o.heading=c?.innerText,o.soldBy=d?.innerText,o.sellerUrl=d?.getAttribute("href")??"","-1"!==p&&(o.rating=parseFloat(p.replace("-","."))),o.index=h,r.otherSellers.push(o),h+=1}const p=c?.querySelector(n.productImageSelector);return p&&!(0,i.TF)(p.src)&&(r.productImage=p.src),r.productUrl=b.Z.GetCurrentPathName(),r.dataCreationTime=Date.now(),r}ValidateDataFields(e,t){const o=t.otherSellerSelectors;if(void 0===o)return!1;const a=S.ZP.IsValidDataField(o.otherSellersOverlayLinkSelector)&&S.ZP.IsValidDataField(o.otherSellerOfferElementSelector)&&S.ZP.IsValidDataField(o.otherSellerHeadingSelector)&&S.ZP.IsValidDataField(o.otherSellerPriceSelector)&&S.ZP.IsValidDataField(o.otherSellerDeliverySelector)&&S.ZP.IsValidDataField(o.productImageSelector)&&S.ZP.IsValidDataField(o.otherSellerNameSelector)&&S.ZP.IsValidDataField(o.otherSellerAddButtonSelector)&&S.ZP.IsValidDataField(o.otherSellerAddedConfirmationSelector),i=S.ZP.IsValidDataField(o.otherSellerRatingSelector),r=S.ZP.IsValidDataField(t.errorMessageSelector);if(e.includes("amazon"))return a&&i;if("walmart.com"===e)return a&&r;{const t="Other sellers scenario for wrong domain: "+e,o=new s.Z;return o.SetResultData(e,0,0,"","","Error"),T.Z.SendLogEventMessage(o,m.R.OtherSellers,this.validatorModule.impressionId,t,m.in.Information),!1}}CreateIframe(e,t){const o=document.createElement("iframe");return o.id=e,o.src=t,o.style.position="absolute",o.style.width="0",o.style.height="0",o.style.border="none",o.style.visibility="hidden",o.style.left="0",o.style.top="0",o.hidden=!0,o.tabIndex=-1,o.title="empty",o.style.display="none",o}RankOtherSellers(e){const t=[],o=[];for(const a of e.otherSellers){let i=!1;if(a.heading?.toLowerCase().includes("new")){const t=a.totalPrice,o=(0,C.K)(e.productPrice);let r=1;a.heading?.toLowerCase().includes("like new")&&(r=3),o-t>=r&&(i=!0)}i?t.push(a):o.push(a)}return e.otherSellers=t.concat(o),e}}var k=_},7664:function(e,t,o){o.d(t,{X:function(){return Z}});var a=o(2370),i=o(7900),r=o(5144);const n="TravelDataStorageInfo";class s{constructor(){(0,a.Z)(this,"Price",void 0),(0,a.Z)(this,"TravelDataCreationTime",void 0),(0,a.Z)(this,"CheckoutId",void 0),(0,a.Z)(this,"StartDate",void 0),(0,a.Z)(this,"EndDate",void 0),(0,a.Z)(this,"Currency",void 0),(0,a.Z)(this,"Name",void 0),(0,a.Z)(this,"DomainType",void 0),(0,a.Z)(this,"flightLegs",void 0),(0,a.Z)(this,"isRoundTrip",void 0),(0,a.Z)(this,"PageUrl",void 0)}}var c=o(3491),l=o(9247),d=o(3686),u=o(8435),m=o(4872);class h{constructor(){(0,a.Z)(this,"name",void 0),(0,a.Z)(this,"startDate",void 0),(0,a.Z)(this,"endDate",void 0)}static Create(e){const t=new h;return t.name=e.name,t.startDate=e.startDate,t.endDate=e.endDate,t}}var p=h,g=o(2960),S=o(3634),C=o(66),f=o(5590),A=o(6493),P=o(4440);class b{}(0,a.Z)(b,"ProductIdsGetter",{"amazon.com":e=>{const t=document.querySelectorAll(e);if(t){let e="";return t.forEach((t=>{const o=t.defaultValue.split("|")[0];e+=o+b.sep})),e}return null},"walmart.com":e=>{const t=document.querySelector(e);if(t){const e=t?.src,o=/item_ids=([^&]*)/,a=e?.match(o);let i="";return a&&a.length>=2&&a[1].split("%2C").forEach((e=>{i+=e+b.sep})),i}return null},"jcpenney.com":e=>{const t=document.querySelectorAll(e);if(t){let e="";return t.forEach((t=>{const o=t.dataset.ppid;e+=o+b.sep})),e}return null}}),(0,a.Z)(b,"sep","<SEP>");var v=b;class O{constructor(){(0,a.Z)(this,"checkoutUrl",void 0),(0,a.Z)(this,"domain",void 0),(0,a.Z)(this,"domainType",void 0),(0,a.Z)(this,"checkoutId",void 0),(0,a.Z)(this,"startDate",void 0),(0,a.Z)(this,"endDate",void 0),(0,a.Z)(this,"name",void 0),(0,a.Z)(this,"currency",void 0),(0,a.Z)(this,"price",void 0),(0,a.Z)(this,"flightLegs",void 0),(0,a.Z)(this,"isRoundTrip",void 0)}static Create(e){const t=new O;return t.domain=e.domain,t.price=e.price,t.currency=e.currency,t.checkoutUrl=e.checkoutUrl,t.domainType=e.domainType,t.startDate=e.startDate,t.endDate=e.endDate,e.flightLegs?.forEach((e=>{t.flightLegs.push(p.Create(e))})),t}}var E=O,T=o(7689),y=o(1849),I=o(2056),_=o(2820),k=o(25),R=o(1656),D=o(4865),N=o(1495),w=o(9368),x=o(9875),U=o(8025);function B(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function L(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?B(Object(o),!0).forEach((function(t){(0,a.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):B(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}class F{constructor(){(0,a.Z)(this,"cartExtractionSuccessful",void 0),(0,a.Z)(this,"mutationObserver",void 0),(0,a.Z)(this,"isPersonalizationDataConsentEnabled",void 0),(0,a.Z)(this,"onCartExtractionCallback",void 0),(0,a.Z)(this,"retailerData",void 0)}subscribe(e){this.onCartExtractionCallback=e}async Init(){const e=_.Z.GetLocalDataService(),t=e.GetCheckoutPageData();if(this.isPersonalizationDataConsentEnabled=t.userInfo?.isPersonalizationDataConsentEnabled??e.IsP13nEnabled()??!1,!t.retailerData)return;this.retailerData=t.retailerData,this.logInfo("Starting cart collection",t.retailerData.domainName??"","","",!1);const o=e.GetIsFinalCheckoutPage(),a=(0,T.uf)(t?.market,t.retailerData?.exclusiveMarket),i=e.GetImpressionId(),n=e.GetDomainName(),s=t?.retailerData?.cartMonitorUrl,c=t.retailerData.getCurrentFinalCheckoutPage(),l=t?.retailerData?.storeCartInEdgeStorage||!1,d=t.retailerData.getCurrentAutomatedSelectorsPage(location.href);if(o){const e=g.Z.uuidv4();this.logInfo("Attempting cart extraction from final checkout page",n,i,e,!1),this.TryCheckAndCollectCartInformation(n,i,c,a,d,!1,t.isCashbackEstimationSupportedForDomain,l,s,void 0,e)}const u=this.ShouldAddCartButtonListener(t.retailerData.getCurrentCheckoutPage(),n);if(u.shouldAddListener&&u.cartButtonSelector){const e=g.Z.uuidv4();this.AddCartButtonListener(u.cartButtonSelector,location.pathname,t,n,i,a,t,l,s,d,e)}const m=t.retailerData?.getCurrentCheckoutPage(location.pathname);if(!m)return;const h=m.pageType??r.GV.CheckoutPage;if(h===r.GV.CheckoutPage||h===r.GV.NoInputCheckoutPage)if(o){const e=g.Z.uuidv4();this.TryShouldAttemptCartCollectionAgain(n,i,m,a,d,m?.automatedCartExtractionEnabled,t.isCashbackEstimationSupportedForDomain,l,void 0,e)}else{const e=g.Z.uuidv4();this.logInfo("Attempting cart extraction from not final checkout page",n,i,e,!1),this.TryCheckAndCollectCartInformation(n,i,m,a,d,m?.automatedCartExtractionEnabled,t.isCashbackEstimationSupportedForDomain,l,s,void 0,e)}if(h===r.GV.ProductPage){const e=g.Z.uuidv4();this.logInfo("Attempting cart extraction from product page",n,i,e,!1),this.CollectCartInfoFromProductPage(n,t,i,a,d,l,s,e)}}async PostValidation(){}async TryShouldAttemptCartCollectionAgain(e,t,o,a,i,n,s,c,l,d){this.ShouldAttemptCartCollectionAgain(o,n).then((r=>{r&&this.TryCheckAndCollectCartInformation(e,t,o,a,i,n,s,c,l,void 0,d)})).catch((o=>{const a={domain:e,cartUrl:location.pathname};this.LogCartExtractionEvent(a,r.R.CartExtractionError,o?.message,r.in.Error,t,d)}))}async ShouldAttemptCartCollectionAgain(e,t){return e&&(e?.cartSelectors||!0===t||e?.travelCheckoutSelectors)?(await l.ZP.WaitForCondition((async()=>void 0!==this.cartExtractionSuccessful),3e4),!0!==this.cartExtractionSuccessful):(this.notifyCartDataListeners(),!1)}async TryCheckAndCollectCartInformation(e,t,o,a,i,n,s,c,l,d,u){o?.travelCheckoutSelectors?this.CheckAndCollectTravelCheckoutInformation(e,t,o.travelCheckoutSelectors,a,c).catch((o=>{const a={domain:e,cartUrl:location.pathname,isTravel:!0};this.LogCartExtractionEvent(a,r.R.CartExtractionError,"Error during travel checkout extraction: "+o?.message,r.in.Error,t,u)})):this.CheckAndCollectCartInformation(e,t,o,a,i,n,s,c,l,d,o?.getProductNamesFromImg,u).catch((o=>{const a={domain:e,cartUrl:location.pathname};this.LogCartExtractionEvent(a,r.R.CartExtractionError,o?.message,r.in.Error,t,u)}))}GetLastTravelData(){const e=(0,c.Mw)(n);return e&&!(0,D.TF)(e)?JSON.parse(e):null}GetLastCartExtractionId(){const e=this.GetLastCartData();if(e&&e?.ExtractionId?.length>0)return e.ExtractionId}GetLastCartData(){const e=(0,c.Mw)(i.OY);return e&&!(0,D.TF)(e)?JSON.parse(e):null}GetFastCart(){try{const e=(0,c.Mw)(i.hm);if(e&&!(0,D.TF)(e))return JSON.parse(e)}catch(e){}return null}GetAvailableCartData(){const e=this.GetLastCartData(),t=(0,c.Mw)(i.hm);let o=null;t&&!(0,D.TF)(t)&&(o=JSON.parse(t));const a=o?.CartDataCreationTime??0;return e?.CartDataCreationTime&&e?.CartDataCreationTime>a?e:o}async CheckAndCollectCartInformation(e,t,o,a,i,n,s,c,d,u,m,h){if(!o||!o?.cartSelectors&&!0!==n&&!i?.details?.productName){this.cartExtractionSuccessful=!1;const o="Unable to get cart data: No Selectors",a={cartId:"",cartUrl:location.pathname,domain:e};return"rei.com"===e&&(a.cartUrl=location.pathname+location.hash),void this.LogCartExtractionEvent(a,r.R.CartExtractionError,o,r.in.Error,t,h)}const p=o?.pageType===r.GV.ProductPage,g=this.GetLastCartData(),S=performance.now(),f=o.orderTotalDataElementSelector;let P={OrderTotal:-1,Currency:(0,A.N6)(a)??"",PageCurrency:""};l.ZP.IsValidDataField(f)&&(P=await l.ZP.WaitForCondition((async()=>C.Z.RunQuerySelectorAll(f)?.length>0),5e3).then((async()=>await y.Z.WaitAndGetCartValue(f,a))).catch((o=>{const a={cartId:g?.CartId??"",cartUrl:location.pathname,domain:e};return this.LogCartExtractionEvent(a,r.R.CartExtractionError,o?.message,r.in.Error,t,h),P}))),P.OrderTotal>0||(P=await y.Z.WaitAndGetCartValue2(f,a));const b=performance.now(),v=this.GetTimeDiff(S,b);this.logInfo(`Cart value extracted. timeToExtract: ${v} ms, extracted total: ${P?.OrderTotal}`,e,t,h,!1);try{const r=new URL(window.location.href);d&&this.MonitorCart(e,t,r,o,a,i,n,s,c,d,h)}catch(o){const a={cartId:g?.CartId??"",cartUrl:location.pathname,domain:e};this.LogCartExtractionEvent(a,r.R.CartExtractionError,"error adding cart monitor: "+o?.message,r.in.Error,t,h)}if(g&&!this.ShouldCollectStorageData(P,g,o?.cartSelectors?.productSellerSelector))return this.notifyCartDataListeners(),void this.logInfo("Stopping cart extraction: cart hasn't changed",e,t,h);if(!o?.cartSelectors&&!i?.details?.productName)return this.logInfo("Extracting cart from automatedSelectorsData",e,t,h),void _.Z.GetAutomaticCartExtractionService().TryCollectCartInformation(e,P,a,t,k.ZP.traceId,g?.CartId);const O=o.cartSelectors;try{await this.CollectCartInformation(e,P,O,t,o,a,i,g?.CartId,c,p,u,m,h)}catch(o){const a={cartId:g?.CartId??"",cartUrl:location.pathname,domain:e};"rei.com"===e&&(a.cartUrl=location.pathname+location.hash),this.LogCartExtractionEvent(a,r.R.CartExtractionError,o?.message,r.in.Error,t,h)}const E=performance.now(),T=this.GetTimeDiff(S,E);this.logInfo(`Cart extraction finished. Total time: ${T} ms`,e,t,h,!1)}async TryCheckAndCollectTravelCheckoutInformation(e,t,o,a){this.CheckAndCollectTravelCheckoutInformation(e,t,o,a).catch((e=>{}))}async CheckAndCollectTravelCheckoutInformation(e,t,o,a,i){if(!o){const o={cartId:"",cartUrl:location.pathname,domain:e};return void this.LogCartExtractionEvent(o,r.R.CartExtractionError,"unable to get travel checkout data: no selectors",r.in.Error,t)}const n=this.GetLastTravelData(),s=o.priceSelector;let c={OrderTotal:-1,Currency:"$",PageCurrency:""};if(l.ZP.IsValidDataField(s)&&(c=await l.ZP.WaitForCondition((async()=>C.Z.RunQuerySelectorAll(s)?.length>0),5e3).then((async()=>await y.Z.WaitAndGetCartValue2(s,a))).catch((o=>{const a={cartId:n?.CheckoutId??"",cartUrl:location.pathname,domain:e};return this.LogCartExtractionEvent(a,r.R.CartExtractionError,"Couldn't get cart value: "+o?.message,r.in.Error,t),c}))),!n||this.ShouldCollectTravelStorageData(c,n))try{await this.CollectTravelCheckoutInformation(e,t,o,n?.CheckoutId,i)}catch(o){const a={cartId:n?.CheckoutId??"",cartUrl:location.pathname,domain:e};return this.LogCartExtractionEvent(a,r.R.CartExtractionError,"Error during travel checkout collection: "+o?.message,r.in.Error,t),c}else{const o={cartId:n?.CheckoutId??"",cartUrl:location.pathname,domain:e};this.LogCartExtractionEvent(o,r.R.CartExtractionError,"Stopping travel checkout extraction: cart hasn't changed",r.in.Error,t)}}ShouldCollectTravelStorageData(e,t){return!(t&&t.Price===e.OrderTotal&&-1!==e.OrderTotal&&!(0,D.TF)(t.CheckoutId)&&Date.now()-t.TravelDataCreationTime<=432e5)}async CollectTravelCheckoutInformation(e,t,o,a,i){const d=new E;let u;if(d.domain=e,d.domainType=o.domainType,d.checkoutId=a??g.Z.uuidv4(),d.checkoutUrl=location.pathname,await l.ZP.WaitForCondition((async()=>(u=C.Z.GetFirstVisibleElement(o.startDateSelector),void 0!==u)),5e3),void 0===u){const o={cartId:"",cartUrl:location.pathname,domain:e};this.LogCartExtractionEvent(o,r.R.CartExtractionError,"Unable to find start date of travel checkout page",r.in.Error,t)}d.flightLegs=[];const m=C.Z.GetAllVisibleElements(o.startDateSelector),h=C.Z.GetAllVisibleElements(o.endDateSelector),S=C.Z.GetAllVisibleElements(o.nameSelector);if(m?.length>1)for(let e=0;e<m.length;e++){const t=new p;t.startDate=m[e].innerText?.trim()??"",e<h.length&&(t.endDate=h[e].innerText?.trim()??""),e<S.length&&(t.name=S[e].innerText?.trim()??""),d.flightLegs.push(t)}d.startDate=u?.innerText?.trim()??"";const f=C.Z.GetFirstVisibleElement(o.endDateSelector),P=C.Z.GetFirstVisibleElement(o.nameSelector);d.endDate=f?.innerText?.trim()??"",d.name=P?.innerText?.trim()??"",(0,w.kO)(d.startDate,d.endDate,o.dateSeparationRegex)&&([d.startDate,d.endDate]=(0,w.Ox)(d.startDate,d.endDate,o.dateSeparationRegex)),d.startDate=(0,w.Pf)(d.startDate,o.dateCleaningRegex),d.endDate=(0,w.Pf)(d.endDate,o.dateCleaningRegex);const b=I.Z.GetOrderTotalString(o.priceSelector),v=(0,A.cU)(b),O=(0,A.K)(b,v);d.price=O,0!==O&&(d.currency=v),this.LogCartExtractionEvent(d,r.R.TravelCheckoutExtraction,"Successfully extracted Travel Checkout Information",r.in.Information,t);const T=new s;T.Price=d.price,T.CheckoutId=d.checkoutId,T.StartDate=d.startDate,T.EndDate=d.endDate,T.Name=d.name,T.DomainType=d.domainType,T.Currency=d.currency,T.TravelDataCreationTime=Date.now(),T.PageUrl=location.pathname,(0,c.Xo)(n,JSON.stringify(T)),i&&this.SendPersistentTravelCheckoutMessage(e,T,t)}async MonitorCart(e,t,o,a,i,r,n,s,c,d,u){if(d===o.pathname||s){const n={attributes:!0,characterData:!0,childList:!0,subtree:!0};this.mutationObserver||(this.mutationObserver=new MutationObserver((async o=>{this.CheckAndCollectCartInformation(e,t,a,i,r,a?.automatedCartExtractionEnabled,s,c,d,void 0,a?.getProductNamesFromImg,u),window.dispatchEvent(new Event("CartUpdate"))})));const m=a?.orderTotalDataElementSelector,h=a?.orderTotalDataContainerElementSelector;if(m){await l.ZP.WaitForCondition((async()=>{const e=C.Z.GetFirstVisibleElement(m);return void 0!==e?.innerText}),5e3);const e=C.Z.GetFirstVisibleElement(m);if(e&&(this.mutationObserver?.disconnect(),this.mutationObserver?.observe(e,n),h)){const e=C.Z.GetFirstVisibleElement(h);e&&this.mutationObserver?.observe(e,n)}}if("kohls.com"===e&&"/checkout/shopping_cart.jsp"===o.pathname){const e="shoppingBagHook",t=document.getElementById(e);t&&this.mutationObserver?.observe(t,n)}else if("bedbathandbeyond.com"===e&&"/store/checkout"===o.pathname){const e="ul[class*='ProgressBar']",t=C.Z.GetFirstVisibleElement(e);t&&(this.mutationObserver?.disconnect(),this.mutationObserver?.observe(t,n))}else if("macys.com"===e&&o.pathname===d){const e="bag-summary",t=document.getElementById(e);t&&this.mutationObserver?.observe(t,n)}else if("rei.com"===e&&o.pathname===d){const e=C.Z.GetFirstVisibleElement("section-navigation");e&&this.mutationObserver?.observe(e,n)}}else this.mutationObserver?.disconnect()}ShouldCollectStorageData(e,t,o){if(t&&t.OrderTotal===e.OrderTotal&&-1!==e.OrderTotal&&!(0,D.TF)(t.CartId)){if(R.R.isExperimentActive(m.H.fixCartUpdate)&&t.Products?.length>0&&o&&!Boolean(t?.Products[0].productSeller))return!0;if(Date.now()-t.CartDataCreationTime<=i.l$)return this.cartExtractionSuccessful=!0,!1}return!0}async GetProductNamesDirectly(e,t,o,a,i,n,s,c,d,u,m){let h;if(await l.ZP.WaitForCondition((async()=>(h=this.QueryAllWithAutomatedFallback(document,o?.productTitleSelector,s?.details?.productName,t,a,!1),void 0!==h&&h.length>0)),5e3),h=this.QueryAllWithAutomatedFallback(document,o?.productTitleSelector,s?.details?.productName,t,a,!0),h&&h.length>0){for(const t of h){const o=new P.Z;o.productTitle=t?.textContent?.trim()??"",e.products.push(o)}this.logInfo("Log cart from product names directly",t,a,m),this.LogCartInfo(e,t,a,i,n,c,d,u,void 0,m)}else{const t="No cart selector provided, unable to find products with product title selector.";this.LogCartExtractionEvent(e,r.R.CartExtractionError,t,r.in.Error,a,m)}}QueryWithAutomatedFallback(e,t,o,a,i){const r=this.QueryAllWithAutomatedFallback(e,t,o,a,i,e===document);return r&&r.length>0?r[0]:void 0}QueryAllWithAutomatedFallback(e,t,o,a,i,n,s){const c=t?e.querySelectorAll(t):void 0,l=o?e.querySelectorAll(o):void 0;if(n&&t&&o){const e={Domain:a,PageUrl:location.href,ManualSelector:t,AutomatedSelector:o,ManualMatchCount:c?.length??0,AutomatedMatchCount:l?.length??0},n="QueryAll with automated fallback";this.LogCartExtractionEvent(e,r.R.AutomatedSelectorsDiagnostic,n,r.in.Information,i,s,!0)}return c??l}isEmptyCart(e){try{const t=document?.body?.innerText?.toLocaleLowerCase()??"",o="",a=e?.emptyCartText?.toLocaleLowerCase()??"";if(o&&t.includes(o))return!0;if(!(0,D.TF)(a)&&t.includes(a))return!0}catch(e){}return!1}async CollectCartInformation(e,t,o,a,i,n,s,c,u,m,h,p,S){const f=new d.Z;if(f.domain=e,f.cartValue=t.OrderTotal,f.currency=t.Currency,f.cartUrl=location.pathname,f.cartId=c??g.Z.uuidv4(),f.products=[],"rei.com"===e&&(f.cartUrl=location.pathname+location.hash),!o||"amazon.com"!==e&&"walmart.com"!==e&&"jcpenney.com"!==e||(f.productIds=v.ProductIdsGetter[e](o.productIdSkuSelector)),!(o?.cartSelector||(0,D.TF)(o?.productTitleSelector??"")&&(0,D.TF)(s?.details?.productName??""))){const t="no cart selector provided but has product title selector.";return f.cartUrl=location.pathname,this.LogCartExtractionEvent(f,r.R.CartExtractionError,t,r.in.Error,a,S),this.GetProductNamesDirectly(f,e,o,a,i,n,s,u,m,h,S),void this.notifyCartDataListeners()}if(!o||!o.cartSelector||!o.productSelector){const e="Unable to find cart, no cartSelector and no title/name selector provided.";return f.cartUrl=location.pathname,void this.LogCartExtractionEvent(f,r.R.CartExtractionError,e,r.in.Error,a,S)}const A=performance.now();let b;await l.ZP.WaitForCondition((async()=>(b=C.Z.GetFirstVisibleElement(o.cartSelector),void 0!==b)),5e3);const O=performance.now();let E;if(this.GetTimeDiff(A,O),void 0===b){if(this.isEmptyCart(o))return this.logInfo("Empty cart",e,a,S),void this.handleSuccessfulCartExtraction(f,e,a,i,n,u,m,h,!0);const t="Unable to find cart";return void this.LogCartExtractionEvent(f,r.R.CartExtractionError,t,r.in.Error,a,S)}if(await l.ZP.WaitForCondition((async()=>(E=b?.querySelectorAll(o.productSelector),void 0!==E&&E.length>0)),"bedbathandbeyond.com"===e?1e4:5e3),"bedbathandbeyond.com"===e||"target.com"===e||"cvs.com"===e){let e;await l.ZP.WaitForCondition((async()=>(e=b?.querySelectorAll(o.productTitleSelector),void 0!==e&&e.length>0&&e.length===E?.length)),1e4),E=b?.querySelectorAll(o.productSelector)}if("walmart.com"===e){const e=this.CollectProductInformationFromCollapsedCart(i,b);f.products.push(...e)}const T=this.GetLastCartData(),y=void 0!==T?.Products?.find((e=>!e.productTitle||""===e.productTitle));if("walmart.com"===e&&(void 0===E||E.length<=0)&&(null==T||null!=T&&y)){const e=b?.querySelectorAll(o.productImageSelector);if(void 0!==e&&e.length>0)for(const t of e){const e=t.getAttribute("alt");if(e){const o=new P.Z;o.productTitle=e.trim(),o.productImg=t?.src??"",f.products.push(o)}}else if(f.products.length<=0){const e="Unable to find products in cart by product image";return void this.LogCartExtractionEvent(f,r.R.CartExtractionError,e,r.in.Error,a,S)}}else if((void 0===E||E.length<=0)&&f.products.length<=0){const e="Unable to find products in cart";return void this.LogCartExtractionEvent(f,r.R.CartExtractionError,e,r.in.Error,a,S)}if(E&&E.length>0)for(const t of E){const n=await this.CollectProductInfo(t,o,s,e,a,p,i.priceDivideByQuantity);if(null!=n)m&&!h&&(n.buyNowItem=!0),f.products.push(n);else{const e="Could not extract product info";this.LogCartExtractionEvent(f,r.R.CartExtractionError,e,r.in.Error,a,S)}}if(this.IsNewCart(f,T))this.handleSuccessfulCartExtraction(f,e,a,i,n,u,m,h,!1,S);else{const e="Unneccessary Cart Extraction: Cart is the same as the last cart, not collecting again";this.LogCartExtractionEvent(f,r.R.CartExtractionError,e,r.in.Error,a,S)}}async handleSuccessfulCartExtraction(e,t,o,a,i,r,n,s,c,l){this.saveNonAugmentedCart(e);const d=performance.now();try{const o=_.Z.GetAutomaticCartExtractionService();await o.augmentWithWebAssist(e.products,t,k.ZP.traceId)}catch(e){this.logInfo("Error augmenting cart with WebAssist",t,o,l)}const u=performance.now(),m=`Time to augment with WebAssist:, ${this.GetTimeDiff(d,u)} ms`;this.logInfo(`Log cart from handleSuccessfulCartExtraction. ${m}`,t,o,l,!1),this.LogCartInfo(e,t,o,a,i,r,n,s,c),this.SendWAPICartEvent(e,t,c)}SendWAPICartEvent(e,t,o){const a=new x.d;a.IsCartEmpty=o??!1,a.Domain=t||e.domain,a.PageURL=location.pathname,a.CartValue=e.cartValue,a.FCurrency=e.currency,a.Products=e.products.map((e=>{const t=new x.H;return t.ProductTitle=e.productTitle,t.ProductPrice=e.productPrice,t.ProductQuantity=e.productQuantity,t.ProductUrl=e.productUrl,t})),U.Q.sendWAPICartData(a)}async saveNonAugmentedCart(e){const t=new i.Vr;t.OrderTotal=e.cartValue,t.CartDataCreationTime=Date.now(),t.CartId=e.cartId,t.ProductIds=e.productIds,t.Products=e.products,t.url=location.pathname,(0,c.Xo)(i.hm,JSON.stringify(t)),this.notifyCartDataListeners()}CartProductNameResolution(e,t,o){try{let a=!1;for(const e of t.products)if(void 0===e.productTitle||""===e.productTitle){a=!0;break}if(!a)return{cartInfo:t,message:"products from current cart used"};if(o?.Products){a=!1;for(const e of o.Products)if(void 0===e.productTitle||""===e.productTitle){a=!0;break}if(!a)return t.products=o.Products,{cartInfo:t,message:"products from last cached cart used"}}const i=N.Q?.PersistentCartData,r=((0,T.BQ)(i)??{})[e]??{},n=r?.cartDataStorageInfo??{};if(n?.Products){a=!1;for(const e of n.Products)if(void 0===e.productTitle||""===e.productTitle){a=!0;break}if(!a)return t.products=n.Products,{cartInfo:t,message:"products from persistent cart used"}}for(const e of t.products)if(void 0===e.productTitle||""===e.productTitle){let t=this.FindProductByUrl(e.productUrl,e.productImg,o);null==t&&(t=this.FindProductByUrl(e.productUrl,e.productImg,n)),t&&(e.productTitle=t.productTitle,void 0===e.productQuantity&&(e.productQuantity=t.productQuantity))}}catch(e){return{cartInfo:t,message:"error getting products from cache or persistent cart: "+e}}return{cartInfo:t,message:"could not get products from cache or persistent cart"}}FindProductByUrl(e,t,o){if(!o?.Products)return null;for(const a of o.Products)if((a.productUrl===e||a.productImg===t)&&a.productTitle&&""!==a.productTitle)return a;return null}CollectProductInfo(e,t,o,a,r,n,s){const d=this.QueryWithAutomatedFallback(e,t.productTitleSelector,o?.details?.productName,a,r),m=e.querySelector(t.productUrlSelector),h=e.querySelector(t.productImageSelector),p=e.querySelector(t.productSellerSelector)||C.Z.GetFirstVisibleElement(t.productSellerSelector);let g=d?.innerText?.trim()||d?.textContent?.trim()||"";const S=I.Z.GetOrderTotalString(t.productPriceSelector,e),f=(0,A.K)(S)??-1,b=(0,A.cU)(S,!0),v=u.Z.getQuantity(t.productQuantitySelector,e);let O=p?.innerText?.trim()||p?.textContent?.trim()||"";const E=h?.src??"",T=m?.getAttribute("href")??"";if(O&&l.ZP.IsValidDataField(t.productSellerRegex)&&(O=O.replace(t.productSellerRegex,"")),("walmart.com"===a||"target.com"===a||"jcpenney.com"===a||"bodegaaurrera.com.mx"===a||"kroger.com"===a||n)&&(0,D.TF)(g)){const e=h?.getAttribute("alt");e&&(g=e.trim())}if((0,D.TF)(g)&&(0,D.TF)(T)&&(0,D.TF)(E))return null;let y="";try{let e=JSON.parse((0,c.Mw)(i.D8)||"[]");for(const t of e)if(g.includes(t?.ProductName)){y=t?.ProductBrandName??"",O=O||t?.ProductSellerName||"";break}}catch(e){}const _=new P.Z;return _.productTitle=g,_.productBrand=y,_.productPrice=f,_.productUrl=T,_.productImg=E,_.productQuantity=v,_.productSeller=O,_.productCurrency=b,s&&v>1&&(_.productPrice=Number((f/v).toFixed(2))),_}IsNewCart(e,t){if(null==e?.products||0===e.products.length)return!1;if(null==t?.Products||0===t.Products.length)return!0;if(e.products.length!==t.Products.length)return!0;let o=!0,a=!1;for(let i=0;i<e.products.length;i++){const r=e.products[i];if(-1===t.Products.findIndex((e=>e.productTitle===r.productTitle)))return!0;o=o&&Boolean(r.productUrl),a=a||Boolean(r.productSeller)}let i=!0,r=!0;t.Products.forEach((e=>{i=i&&Boolean(e.productUrl),r=r&&Boolean(e.productSeller)}));const n=a&&!r,s=o&&!i;return!(!R.R.isExperimentActive(m.H.fixCartUpdate)||!n)||s}LogCartInfo(e,t,o,a,n,s,l,d,u,h){let p={OrderTotal:-1,Currency:(0,A.N6)(n)??"",PageCurrency:""};p=y.Z.GetCartValue(a.orderTotalDataElementSelector,n),p.OrderTotal>0||(p=y.Z.TrySimpleGetCartValue(a.orderTotalDataElementSelector,n)),e.cartValue=p.OrderTotal,e.currency=p.Currency;const C=this.GetLastCartData(),P=R.R.isExperimentActive(m.H.fixCartUpdate);if((0,D.TF)(a.orderSubTotalElementSelector)||(e.subTotal=I.Z.GetOrderTotalString(a.orderSubTotalElementSelector)),u||e.products?.length>0){const n=performance.now();let m=u?"Empty Cart Extraction":"Successfully extracted Cart Information",p={cartInfo:e,message:""},b=!1;("walmart.com"===t&&"/checkout/review-order"===e.cartUrl||"kohls.com"===t&&"/checkout/shopping_cart.jsp"!==e.cartUrl)&&(p=this.CartProductNameResolution(t,e,C),m+="; "+p.message+"; "+JSON.stringify(p.cartInfo),b=!0);const v=g.Z.uuidv4();if(this.LogCartExtractionEvent(e,r.R.CartExtraction,m,r.in.Information,o,`${v}_${h}`),P&&!this.IsNewCart(e,C))return void this.logInfo("No cart log. fixCartUpdate and not new cart",t,o,h);const O=new i.Vr;if(O.OrderTotal=e.cartValue,O.CartDataCreationTime=Date.now(),O.CartId=e.cartId,O.ProductIds=e.productIds,O.Products=b?p.cartInfo.products:e.products,O.Currency=e.currency??"",e.subTotal&&(O.OrderSubTotal=(0,A.K)(e.subTotal)??-1),(0,c.NN)()||this.LogCartExtractionEvent(e,r.R.CartExtractionError,"No access to local storage",r.in.Error,o,h),l&&void 0!==C?.Products){const t=e.products[0],o=location.pathname;if(!(0,D.TF)(t.productTitle)){let e=!1;for(const a of C.Products)if(a.productQuantity>0&&(0===a.productUrl.indexOf(o)||a.productTitle===t.productTitle)){t.productQuantity&&!isNaN(t.productQuantity)?a.productQuantity=a.productQuantity+t.productQuantity:a.productQuantity=a.productQuantity+1,a.buyNowItem=!d,e=!0;break}if(!e){const e=C.Products;t.buyNowItem=!d,e.push(t),O.Products=e}}}const E=this.CollectGroceryInfo(a);O.CartPreTax=E.preTaxTotal,O.CartEstimatedTax=E.estimatedTax,O.ShipmentDate=E.shipmentDate,O.ExtractionId=v,O.url=location.pathname,(0,c.Xo)(i.OY,JSON.stringify(O));const T=performance.now();this.logInfo(`Writing to local storage, timeTook:  ${this.GetTimeDiff(n,T)}, total: ${O.OrderTotal}`,t,o,h,!1),(0,c.TJ)(i.hm);const y=S.PK[t]?.useCartAtPathname;y&&location.pathname.toLocaleLowerCase().includes(y)&&I.Z.SendStorageMessage(f.Q.PostPurchasePathnameProducts,JSON.stringify({value:O.Products})),s&&this.SendPersistentCartMessage(t,O,o,h)}else{const t="Unable to get enough info about products in cart";this.LogCartExtractionEvent(e,r.R.CartExtractionError,t,r.in.Error,o,h)}}CollectGroceryInfo(e){const t=e.shipmentSelector,o=e.preTaxSelector,a=e.estimatedTaxSelector;let i,r,n;if(l.ZP.IsValidDataField(t)&&l.ZP.IsValidDataField(o)&&l.ZP.IsValidDataField(a))try{i=this.GetShipmentDate(t);const e=I.Z.GetOrderTotalString(o);r=(0,A.K)(e)??-1;const s=I.Z.GetOrderTotalString(a);n=(0,A.K)(s)??-1}catch(e){}return{shipmentDate:i,preTaxTotal:r,estimatedTax:n}}GetShipmentDate(e,t){const o=e.split(","),a=I.Z.GetOrderTotalString(o[0]);if(a)try{const e=I.Z.parseDate(a);return"Invalid Date"===e.toString()?"":e}catch(e){}else if(4===o.length){const e=I.Z.GetOrderTotalString(o[1])?.trim(),t=I.Z.GetOrderTotalString(o[2])?.trim(),a=I.Z.GetOrderTotalString(o[3])?.trim();return new Date(`${e} ${t} ${a}`)}return""}SendPersistentCartMessage(e,t,o,a){try{const o=N.Q?.PersistentCartData??"",a=(0,T.BQ)(o)??{};a[e]={cartDataStorageInfo:t,timestamp:new Date};const i=JSON.stringify({value:JSON.stringify(a)});I.Z.SendStorageMessage("PersistentCartData",i)}catch(e){this.LogCartExtractionEvent(t,r.R.CartExtractionError,"Could not send cart data to storage:  "+e?.message,r.in.Error,o,a)}}SendPersistentTravelCheckoutMessage(e,t,o,a){try{const o=N.Q?.PersistentTravelData??"",a=(0,T.BQ)(o)??{};a[e]={travelDataStorageInfo:t,timestamp:new Date};const i=JSON.stringify({value:JSON.stringify(a)});I.Z.SendStorageMessage("PersistentTravelData",i)}catch(e){this.LogCartExtractionEvent(t,r.R.CartExtractionError,"Could not send travel data to storage:  "+e?.message,r.in.Error,o,a)}}ShouldSendTelemetryData(e){return this.isPersonalizationDataConsentEnabled||e!==r.R.CartExtraction&&e!==r.R.TravelCheckoutExtraction}LogCartExtractionEvent(e,t,o,a,i,n,s){let c={};if(this.ShouldSendTelemetryData(t)&&(c=e),!s){void 0===this.cartExtractionSuccessful&&(t===r.R.CartExtraction?this.cartExtractionSuccessful=!0:this.cartExtractionSuccessful=!1);const e=_.Z.GetLocalDataService(),o=e.GetSessionIds()?.retailerSessionId??"",a=e.GetSessionIds()?.pageVisitId??"";c=L(L({},c),{},{isPersonalizationDataConsentEnabled:this.isPersonalizationDataConsentEnabled,extractionId:n??null,PageVisitId:a,RetailerSessionId:o})}I.Z.SendLogEventMessage(c,t,i,o,a)}logInfo(e,t,o,a,i=!0){try{if(!this.isPersonalizationDataConsentEnabled)return;if(!i&&"True"!==this?.retailerData?.settings?.other?.enableAllCartLogs&&"true"!==this?.retailerData?.settings?.other?.enableAllCartLogs)return;const n=_.Z?.GetLocalDataService(),s=n?.GetSessionIds()?.retailerSessionId??"",c=n?.GetSessionIds()?.pageVisitId??"",l={domain:t||location.hostname,cartUrl:location.pathname,isPersonalizationDataConsentEnabled:this.isPersonalizationDataConsentEnabled,extractionId:a??null,PageVisitId:c,RetailerSessionId:s};I.Z.SendLogEventMessage(l,r.R.CartExtractionError,o,e,r.in.Information)}catch(e){}}CollectProductInformationFromCollapsedCart(e,t){let o;const a=[];o=e.cartSelectors.collapsedCartProductImageSelector?e.cartSelectors.collapsedCartProductImageSelector:"[aria-label='collapsed item list'] img";const i=t?.querySelectorAll(o);if(void 0!==i&&i.length>0)for(const e of i){const t=e.getAttribute("alt");if(t){let o,i;const r=t.match(" quantity \\d+$");r&&r.length>0?(o=t.replace(r[0],""),i=parseInt(r[0].split(" quantity ")[1],10)):(o=t,i=1);const n=new P.Z;n.productTitle=o.trim(),n.productQuantity=i,n.productImg=e?.src??"",a.push(n)}}return a}ShouldAddCartButtonListener(e,t){let o=e?.clickForCartSelector;return o||"walmart.com"!==t||(o="#cart-button-header"),o&&C.Z.GetAllVisibleElements(o).length>0?{shouldAddListener:!0,cartButtonSelector:o}:{shouldAddListener:!1,cartButtonSelector:""}}AddCartButtonListener(e,t,o,a,i,r,n,s,c,d,u){const m=C.Z.GetFirstVisibleElement(e);m?.addEventListener("click",(async()=>{l.ZP.WaitForCondition((async()=>{const e=this.GetCartCheckoutPage(o.retailerData.allCheckoutPages);if(e&&e.checkoutPageUrl!==t)return!1;o.retailerData.updateCurrentCheckoutPage(t);const a=o.retailerData.getCurrentCheckoutPage();return!!a?.cartSelectors?.cartSelector&&C.Z.HasVisibleElement(a?.cartSelectors?.cartSelector)}),1e3).then((e=>{if(e){o.retailerData.updateCurrentCheckoutPage(t);const e=o.retailerData.getCurrentCheckoutPage();this.TryCheckAndCollectCartInformation(a,i,e,r,d,e?.automatedCartExtractionEnabled,n.isCashbackEstimationSupportedForDomain,s,c,void 0,u)}}))}))}GetTimeDiff(e,t){return(t-e).toFixed(1)}GetCartCheckoutPage(e){const t=e.filter((e=>e.pageType&&e.pageType===r.GV.CheckoutPage||e.pageType===r.GV.NoInputCheckoutPage));return t.length>0?t[0]:null}async CollectCartInfoFromProductPage(e,t,o,a,i,r,n,s){const c=t.retailerData.getCurrentCheckoutPage();if(c)if(c.addToCartOverlaySelector&&c.cartSelectors){let l=!1;const d={attributes:!0,characterData:!0,childList:!0,subtree:!0};new MutationObserver((async d=>{if(!C.Z.GetFirstVisibleElement(c.addToCartOverlaySelector))return void(l=!1);if(l)return;l=!0;const u=t.retailerData.getCurrentCheckoutPage();this.TryCheckAndCollectCartInformation(e,o,u,a,i,u?.automatedCartExtractionEnabled,t.isCashbackEstimationSupportedForDomain,r,n,!0,s)})).observe(document.body,d)}else if(c?.buyNowSelector&&c?.cartSelectors){const d=c.buyNowSelector,u=await l.ZP.WaitForCondition((async()=>C.Z.HasVisibleElement(d)),5e3).then((async()=>C.Z.GetFirstVisibleElement(d)));u?.addEventListener("click",(async()=>{const c=t.retailerData.getCurrentCheckoutPage();this.TryCheckAndCollectCartInformation(e,o,c,a,i,c?.automatedCartExtractionEnabled,t.isCashbackEstimationSupportedForDomain,r,n,void 0,s)}))}}notifyCartDataListeners(){try{this.onCartExtractionCallback&&this.onCartExtractionCallback()}catch(e){}}}let M;function Z(){return M||(M=new F),M}},4993:function(e,t,o){o.d(t,{Z:function(){return D}});var a=o(2370),i=o(3491),r=o(5457),n=o(4872),s=o(1656),c=o(5144),l=o(9247),d=o(6493),u=o(7689);new Set,new Set(["en-us"]),new Set,new Set,new Set([]),new Set(["da-dk","de-de","de-at","de-ch","en-us","en-au","en-ca","en-es","en-gb","en-id","en-ie","en-in","en-my","en-nz","en-ph","en-sg","en-th","en-vn","es-mx","es-ar","es-cl","es-co","es-pe","es-us","es-ve","fi-fi","fr-fr","fr-be","fr-ca","fr-ch","it-it","nl-nl","nl-be","no-no","pt-br","sv-se","zh-hk","zh-tw"]);const m=new Set(["da-dk","de-de","en-us","en-au","en-ca","en-es","en-gb","en-in","en-nz","en-sg","es-mx","es-us","fr-fr","fr-be","fr-ca","ja-jp","it-it","pt-br"]);new Set(["en-us","en-in","en-au","en-ca","es-mx","en-my","en-za","es-ar","zh-hk","zh-tw","en-sg","en-ph","en-nz","es-pe","es-ve","es-cl","en-ae"]),new Set(["en-us","en-gb","en-in","en-au","en-ca","ja-jp","fr-fr","de-de","es-es","it-it","nl-nl","fr-be","de-at","de-ch","nb-no","sv-se","en-ie"]),new Set(["en-us","en-au","en-ca","en-in"]);var h=o(1310),p=o(66),g=o(2315),S=o(8025),C=o(1094);class f{constructor(){(0,a.Z)(this,"Domain",void 0),(0,a.Z)(this,"ProductName",void 0),(0,a.Z)(this,"ProductSellerName",void 0),(0,a.Z)(this,"ProductBrandName",void 0),(0,a.Z)(this,"ProductCategory",void 0),(0,a.Z)(this,"Url",void 0),(0,a.Z)(this,"PageUrl",void 0),(0,a.Z)(this,"Price",void 0),(0,a.Z)(this,"ImageUrl",void 0),(0,a.Z)(this,"ProductUpc",void 0),(0,a.Z)(this,"ProductAsin",void 0),(0,a.Z)(this,"Currency",void 0),(0,a.Z)(this,"Market",void 0),(0,a.Z)(this,"ProductVariant",void 0),(0,a.Z)(this,"Badges",void 0),(0,a.Z)(this,"OutOfStock",void 0)}static Create(e){const t=new f;return t.ProductName=e.ProductName,t.Url=e.Url,t.Price=e.Price,t.ImageUrl=e.ImageUrl,t}}var A=f;class P{constructor(){(0,a.Z)(this,"ProductName",void 0),(0,a.Z)(this,"Url",void 0),(0,a.Z)(this,"AggregateRating",void 0),(0,a.Z)(this,"AggregateRatingCount",void 0)}static Create(e){const t=new P;return t.ProductName=e.ProductName,t.Url=e.Url,t.AggregateRating=e.AggregateRating,t.AggregateRatingCount=e.AggregateRatingCount,t}}var b=P;class v{constructor(){(0,a.Z)(this,"ProductName",void 0),(0,a.Z)(this,"Url",void 0),(0,a.Z)(this,"Reviews",void 0)}static Create(e){const t=new v;return t.ProductName=e.ProductName,t.Url=e.Url,t.Reviews=e.Reviews,t}}var O=v,E=o(2056),T=o(2820),y=o(25),I=class{constructor(){(0,a.Z)(this,"pdpUrl","pdp_url"),(0,a.Z)(this,"imageUrl","image_icon_url"),(0,a.Z)(this,"asin","asin"),(0,a.Z)(this,"productVariant","product_variant")}ExtractVariants(){let e="{product_variant: {",t="";const o={};for(let e=0;e<25;e++){t="#color_name_"+e;if(null==p.Z.GetFirstMatchingElement(t))break;const a=this.ExtractVariantUrl(t);if(null===a)continue;const i=this.ExtractVariantImageUrl(t);if(null===i)continue;const r=this.ExtractVariantAsin(t);if(null===r)continue;const n=this.ExtractVariantAttribute(t),s={};s[this.pdpUrl]=a,s[this.imageUrl]=i,s[this.asin]=r,"none"!==n[0]&&(s[n[0]]=n[1]),o["variant_"+(e+1)]=s}const a={};return a[this.productVariant]=o,e=JSON.stringify(a),e}ExtractVariantUrl(e){const t=p.Z.GetFirstMatchingElement(e);let o="default-data-url";const a=t?.getAttribute("data-dp-url");return""!==a&&null!=a&&(o=a),"default-data-url"===o||null==o?null:o}ExtractVariantImageUrl(e){const t=e+" .a-button",o=p.Z.GetFirstMatchingElement(t),a=o?.getAttribute("id");if(null==a)return null;const i="#"+a+"-announce > div > div > img",r=p.Z.GetFirstMatchingElement(i),n=r?.src??"";return null==n?null:n}ExtractVariantAsin(e){const t=p.Z.GetFirstMatchingElement(e),o=t?.getAttribute("data-defaultasin");return o}ExtractVariantAttribute(e){const t=p.Z.GetFirstMatchingElement("#variation_color_name > div > label")?.innerText,o=p.Z.GetFirstMatchingElement("#variation_color_name > div > span")?.innerText;return void 0!==t&&void 0!==o&&null!==t&&null!==o?[t,o]:["none","none"]}},_=class{ExtractVariants(){return""}},k=class{static CreateVariant(e){return"amazon.com"===e.toLowerCase()?new I:new _}},R=o(7900),D=class{constructor(){(0,a.Z)(this,"currentPageUrl",void 0),(0,a.Z)(this,"cashBackResponseStr",void 0)}SetServiceUrl(e){this.currentPageUrl=e}SetCashbackResponseStr(e){this.cashBackResponseStr=e}async Init(){this.SetServiceUrl(new URL(window.location.href));const e=T.Z.GetLocalDataService(),t=e.GetCheckoutPageData(),o=e.GetItemLevelCashbackData();t.retailerData.updateCurrentCheckoutPage(C.Z.GetCurrentPathName());const a=t.retailerData.getCurrentCheckoutPage(),i=a?.catalogSelectors,l=t.retailerData.domainName,d=t.impressionId;if(a?.pageType===c.GV.ProductPage){let e=i?.productPriceSelector,o=i?.productImageSelector,a=i?.productTitleSelector,r=i?.productOutOfStockSelector;s.R.isExperimentActive.bind(n.H.pdpSelectorExtraction)&&(e=e??t?.retailerData?.productPriceSelector,o=o??t?.retailerData?.productImageSelector,a=a??t?.retailerData?.productNameSelector,r=r??t?.retailerData?.productOutOfStockSelector),this.ExtractReviews(l,d,i?.reviewSelector,i?.reviewRatingSelector,i?.reviewDateSelector,i?.reviewerNameSelector,i?.productTitleSelector).catch((e=>{})),this.ExtractRatings(l,d,i?.aggregateRatingSelector,i?.aggregateRatingNumberOfRatingsSelector,i?.productTitleSelector).catch((e=>{}));const u=(new Date).getTime();this.ExtractPDPOffer(l,d,e,o,a,i?.productSellerSelector,i?.productBrandSelector,i?.productUPCSelector,i?.productASIN,r,i?.productCategoryListSelector,i?.productBrandRegex,i?.productCategoryRegex).catch((e=>{const t=(new Date).getTime();this.LogCatalogExtractionEvent({},c.R.CatalogExtractionPDPOffer,JSON.stringify({extractionTime:t-u}),c.in.Information,d),s.R.isExperimentActive(n.H.pdpSelectorExtraction)&&S.Q.sendMessage(y.EI.DataExtracted,[g.Z.getApiResponse().traceId,"{}"])})).then((e=>{this.CachePdpOffer(e);const t=(new Date).getTime();this.LogCatalogExtractionEvent(e??{},c.R.CatalogExtractionPDPOffer,JSON.stringify({extractionTime:t-u}),c.in.Information,d),s.R.isExperimentActive(n.H.pdpSelectorExtraction)&&S.Q.sendMessage(y.EI.DataExtracted,[g.Z.getApiResponse().traceId,JSON.stringify(e)])}))}else if(a?.pageType===c.GV.SearchPage&&o?.domainData){const e=r.Z.Create(o.domainData),t=h.Z.IsSearchPage(this.currentPageUrl,e);t?.searchKey&&this.ExtractSearchProduct(l,d,i?.productTitleSelector,i?.productPriceSelector,t.searchKey)}}async CachePdpOffer(e){try{let t=JSON.parse((0,i.Mw)(R.D8)||"[]");t=t.filter((t=>t.ProductName!==e.ProductName)),e?.ProductName&&t.push(e),t.length>R.xD&&t.shift(),(0,i.Xo)(R.D8,JSON.stringify(t))}catch(e){}}async PostValidation(){}async ExtractReviews(e,t,o,a,i,r,n){if(o){await l.ZP.WaitForCondition((async()=>{if(void 0===o)return!1;const e=p.Z.RunQuerySelectorAll(o);return void 0!==e&&e.length>0}),5e3);try{const s=o?p.Z.RunQuerySelectorAll(o):[],l=a?p.Z.RunQuerySelectorAll(a):[],d=i?p.Z.RunQuerySelectorAll(i):[],u=r?p.Z.RunQuerySelectorAll(r):[],m=n?p.Z.GetFirstVisibleElement(n)?.innerText:"",h=new URL(window.location.href),g=Array.from(s).flatMap((e=>e.innerText)),S=Array.from(l).flatMap((t=>this.GetReviewRating(t,e))),C=Array.from(d).flatMap((e=>e.innerText)),f=Array.from(u).flatMap((e=>e.innerText)),A=new O;A.Reviews=JSON.stringify([g,S,C,f,[this.currentPageUrl.toString().split("?")[0]]]),A.Url=h.toString().split("?")[0],void 0!==m&&(A.ProductName=m),this.LogCatalogExtractionEvent(A,c.R.CatalogExtractionReviews,"",c.in.Information,t)}catch(e){}}}async ExtractRatings(e,t,o,a,i){if(o&&a){await l.ZP.WaitForCondition((async()=>void 0!==o&&void 0!==p.Z.GetFirstVisibleElement(o)),5e3);try{const r=new URL(window.location.href),n=p.Z.GetFirstVisibleElement(o)??void 0,s=p.Z.GetFirstVisibleElement(a)?.innerText,l=i?p.Z.GetFirstVisibleElement(i)?.innerText:"";if(void 0!==n&&void 0!==s){const o=new b;o.AggregateRating=this.GetAggregateRating(n,e),o.AggregateRatingCount=s,o.Url=r.toString().split("?")[0],o.ProductName=l??"",this.LogCatalogExtractionEvent(o,c.R.CatalogExtractionRating,"",c.in.Information,t)}}catch(e){}}}async ExtractPDPOffer(e,t,o,a,i,r,n,s,c,m,h,g,S){const C=new A;if(!o||!a||!i)return C;await l.ZP.WaitForCondition((async()=>{if(void 0===i)return!1;const e=p.Z.GetFirstVisibleElement(i),t=p.Z.GetFirstVisibleElement(o);return void 0!==e&&(!o||void 0!==t)}),5e3);try{const t=new URL(window.location.href),l=p.Z.GetFirstVisibleElement(i)?.innerText,f=p.Z.GetFirstMatchingElement(a),A=f?.src??"",P=p.Z.GetFirstVisibleElement(o)?.innerText;let b="$",v=0,O="",E="USD";const T=(0,u.S8)(),y=k.CreateVariant(T);let I="";const _=y.ExtractVariants();if(null!==_&&(I=_),P&&P.length){b=(0,d.cU)(P),v=(0,d.K)(P);const e=(0,d.Vv)(b);void 0!==e&&(E=e),O=v.toString()}let R,D,N,w,x,U;r&&(R=p.Z.GetFirstVisibleElement(r)?.innerText),n&&(D=p.Z.GetFirstVisibleElement(n)?.innerText),h&&(N=p.Z.GetFirstVisibleElement(h)?.innerText),s&&(w=p.Z.GetFirstVisibleElement(s)?.innerText),c&&(x=p.Z.GetFirstVisibleElement(c)?.innerText),m&&(U=p.Z.GetFirstVisibleElement(m)?.innerText),C.Domain=e,C.Price=O,C.ProductVariant=I,C.ImageUrl=A,C.Url=t.toString().split("?")[0],C.PageUrl=t.toString(),C.ProductName=l??"",C.ProductSellerName=R,C.ProductBrandName=this.applyRegexSelectorToString(g,D)??"",C.ProductCategory=this.applyRegexSelectorToString(S,N)??"",C.ProductAsin=x,C.ProductUpc=w,C.Currency=E,C.OutOfStock=U;const B=[navigator.language],L=this.GetMarket(B,this.GetSupportedMarkets());let F="en-us";if(void 0!==L&&(F=L,"USD"===E)){const e=(0,d.N6)(F);if(void 0!==e){const t=(0,d.Vv)(e);C.Currency=t}}return C.Market=F,C}catch(e){return C}}applyRegexSelectorToString(e,t){if(!e||!t)return t;const o=e?.split(","),a=o?.map((e=>new RegExp(e,"g")));let i=t;return a&&a.forEach((e=>{const o=new RegExp(e,"g");let a;for(;null!==(a=o.exec(t))&&a?.length>1;)i=a[1]})),i}async ExtractSearchProduct(e,t,o,a,i){if(!a||!o||!this.cashBackResponseStr)return;const r=JSON.parse(this.cashBackResponseStr);let n,s;r?.itemizedCashBackResponse?.offers?.length>0&&(n=r?.itemizedCashBackResponse?.offers[0]?.adsOffer?.name,s=r?.itemizedCashBackResponse?.offers[0]?.adsOffer?.price),await l.ZP.WaitForCondition((async()=>void 0!==o&&void 0!==p.Z.GetFirstVisibleElement(o)),5e3);try{const r=p.Z.GetAllVisibleElements(o),l=p.Z.GetAllVisibleElements(a),u=[];if(r&&l){for(let e=0;e<10;e++)if(e<r.length&&e<l.length){const t={ProductTitle:r[e]?.innerText,ProductPrice:(0,d.K)(l[e]?.innerText)??-1};u.push(t)}if(u.length>0&&n&&s){const o={Domain:e,products:u,QueryKeyword:i,currentPageUrl:this.currentPageUrl,spbTitle:n,spbPrice:s};this.LogCatalogExtractionEvent(o,c.R.CatalogExtractionSearchOffers,"",c.in.Information,t)}}}catch(e){}}LogCatalogExtractionEvent(e,t,o,a,i){E.Z.SendLogEventMessage(e,t,i,o,a)}GetReviewRating(e,t){return t.match("ebay.")||t.match("lowes.")||t.match("macys.")||t.match("thriftbooks.")||t.match("manomano.")||t.match("hsn.")||t.match("casasbahia.")||t.match("webstaurantstore.")?e.getAttribute("aria-label")??"":"overstock.com"===t?e.getAttribute("data-rating")??"":"quill.com"===t?e.getAttribute("rating")??"":"etsy.com"===t?e.getAttribute("value")??"":"otto.de"===t?e.getAttribute("content")??"":"onbuy.com"===t||"lightinthebox.com"===t?e.getAttribute("title")??"":e.innerText}GetAggregateRating(e,t){return void 0===e?"":t.match("onbuy.")?e.getAttribute("title")??"":e.innerText}GetSupportedMarkets(){return m}GetMarket(e,t){if(!e||0===e.length)return"en-us";let o;for(const t of e){if(t.indexOf("-")>=0)return t.toLowerCase();o||(o=t.toLowerCase())}for(const e of t)if(e.startsWith(`${o}-`))return e}}},7944:function(e,t,o){var a=o(2370),i=o(5144),r=o(9247),n=o(1094),s=o(3209),c=o(2953),l=o(7605),d=o(2388),u=o(4901),m=o(66),h=o(8219),p=o(7689),g=o(1849),S=o(2056),C=o(2820),f=o(4445),A=o(4865),P=o(9091);t.Z=class{constructor(){(0,a.Z)(this,"divIDOverlay","#divOverlayWrapper"),(0,a.Z)(this,"localDataService",void 0),(0,a.Z)(this,"isCashbackDomain",void 0),(0,a.Z)(this,"checkoutPageUrlData",void 0),(0,a.Z)(this,"exclusiveMarket",void 0),(0,a.Z)(this,"impressionId",void 0),(0,a.Z)(this,"coupons",void 0),(0,a.Z)(this,"fromPlatformDetection",void 0),(0,a.Z)(this,"applyButtonAvailable",!1),(0,a.Z)(this,"textInput",void 0),(0,a.Z)(this,"cartValue",void 0),(0,a.Z)(this,"startTime",void 0),(0,a.Z)(this,"statusMessageListener",void 0),(0,a.Z)(this,"statusMessage",void 0),(0,a.Z)(this,"InputHandler",(()=>{const e=m.Z.GetFirstVisibleElement(this.checkoutPageUrlData.inputBoxSelector);if(e&&e.value&&(this.textInput=e.value,this.startTime=(new Date).getTime(),!this.cartValue)){if(this.cartValue=this.GetCartValue(),this.applyButtonAvailable)return;this.WaitForCondition((async()=>this.GetCartValue().OrderTotal!==this.cartValue?.OrderTotal),1e4).then((async e=>{e?await this.GetCouponAndDiscount(!1):this.Reset()}))}})),(0,a.Z)(this,"ApplyHandler",(async()=>{await this.GetCouponAndDiscount(!0)}))}async Init(){this.localDataService=C.Z.GetLocalDataService();const e=this.localDataService.GetCheckoutPageData(),t=e?.cashback;this.isCashbackDomain=t&&(t.isRebatesSupportedDomain??!0);const o=e?.retailerData?.getCurrentCheckoutPage(n.Z.GetCurrentPathName());o?.manualCouponApplyTrackingEnabled&&this.TryListenForCoupon(o,e.coupons,this.localDataService.GetMarket(),this.localDataService.GetImpressionId())}async PostValidation(){}async TryListenForCoupon(e,t,o,a,i){try{r.ZP.IsValidDataField(e.inputBoxSelector)&&r.ZP.IsValidDataField(e.orderTotalDataElementSelector)&&(this.checkoutPageUrlData=e,this.coupons=t??[],this.exclusiveMarket=o,this.impressionId=a,this.fromPlatformDetection=i??!1,this.TrySetUpCouponListener(!1,!1,!0))}catch(e){this.LogError(e?.message)}}async TrySetUpCouponListener(e,t,o){let a=!1;if(a=e?await r.ZP.WaitUntilCondition((async()=>await this.SetUpCouponListener(e)),5e3):await this.SetUpCouponListener(e,t),!a){let e="Unable to add coupon savings listener";o||(e+=" No longer listening"),this.LogError(e)}}async SetUpCouponListener(e,t){return await this.isInputBoxAvailable(e?1:5)?this.ListenForCoupon():await this.CheckRemoveAndClickBeforeStartButtons(t)}async ListenForCoupon(){const e=m.Z.GetFirstVisibleElement(this.checkoutPageUrlData.inputBoxSelector);if(!e)return this.LogError("Called ListenForCoupon without input box available"),!1;this.SetUpStatusMessageListener(e);const t=m.Z.GetFirstVisibleElement(this.checkoutPageUrlData.applyButtonSelector);return t&&(this.applyButtonAvailable=!0,t.addEventListener("click",this.ApplyHandler)),e.addEventListener("keyup",this.InputHandler),!0}SetUpStatusMessageListener(e){if(null!==e&&(window.MutationObserver||window.WebKitMutationObserver)){let t=m.Z.GetFirstVisibleElement(this.checkoutPageUrlData.orderTotalDataElementSelector);const o=[];for(;t;t=t.parentElement)o.push(t);let a=e;for(;a;a=a.parentElement){const e=o.find((e=>e===a?e:null));if(e){const t=MutationObserver||window.WebKitMutationObserver,o=m.Z.GetFirstVisibleElement(this.checkoutPageUrlData.orderTotalDataElementSelector),a=m.Z.GetFirstVisibleElement(this.checkoutPageUrlData.applyButtonSelector);this.statusMessageListener=new t((t=>{if(t)for(const i of t)for(const t of i.addedNodes)for(const i of P.od){const r=this.ElementIsChildOf(t,o,e[0]);if(!this.ElementIsChildOf(t,a,e[0])&&!r&&t.textContent&&t.textContent.toLowerCase().includes(i))return void this.HandleStatusMessage(t)}})),this.statusMessageListener.observe(e,{childList:!0,subtree:!0});break}}}}HandleStatusMessage(e){const t=e.parentElement;e instanceof HTMLElement&&(this.statusMessage={Message:e?.textContent??"",ClassName:e?.className?e?.className:t?.className,Id:e?.id?e?.id:t?.id,Tag:e?.tagName?e?.tagName:t?.tagName}),this.statusMessageListener&&this.statusMessageListener.disconnect()}ElementIsChildOf(e,t,o){let a=e;for(;null!==a;){if(a.isSameNode(t))return!0;if(o&&a.isSameNode(o))return!1;a=a.parentElement}return!1}async WaitForCondition(e,t){if(!this.startTime)return!1;for(;!await e()&&this.startTime+t>(new Date).getTime();)await r.ZP.Sleep(100);return this.startTime=null,await e()}getCouponAppliedMessage(){const e=m.Z.GetFirstVisibleElement(this.checkoutPageUrlData.errorMessageSelector??"");if(e){const t=e.firstElementChild?.firstElementChild?.firstElementChild,o=/rgb\((\d+),\s*(\d+),\s*(\d+)\)/i,a=window.getComputedStyle(t||e).color.match(o);if(a)return parseInt(a[1],10)<parseInt(a[2],10)?"Positive":"Negative"}return""}async GetCouponAndDiscount(e){e&&await r.ZP.Sleep(this.checkoutPageUrlData.waitAfterApplyingCurrentCoupon??2e3);const t=this.textInput;if(t){let o=this.GetCartValue();o.OrderTotal===this.cartValue?.OrderTotal&&e&&(await r.ZP.Sleep(2e3),o=this.GetCartValue());let a=-1,i="";this.cartValue?.OrderTotal&&o.OrderTotal&&(a=this.cartValue.OrderTotal-o.OrderTotal,i=a>0?"Positive":"Negative"),"amazon"==(0,p.S8)().substring(0,6)&&(0,A.TF)(i)&&(i=this.getCouponAppliedMessage()),this.isAutoApplyOn()||(0,A.TF)(i)||this.LogCouponSavings(t,i,a,this.cartValue?.OrderTotal??-1,o.OrderTotal,o.Currency,o.PageCurrency)}this.Reset(),await this.TrySetUpCouponListener(!0)}Reset(){this.textInput="",this.cartValue=null,this.startTime=null,this.statusMessage=void 0,this.statusMessageListener&&this.statusMessageListener.disconnect()}async isInputBoxAvailable(e){return!!await r.ZP.WaitForCondition((async()=>m.Z.HasVisibleElement(this.checkoutPageUrlData.inputBoxSelector)),1e3*e)}CheckRemoveAndClickBeforeStartButtons(e){const t=m.Z.HasVisibleElement(this.checkoutPageUrlData.clickBeforeStartSelector);return!(e||!t||!this.AddClickBeforeStartListener())||!!m.Z.HasVisibleElement(this.checkoutPageUrlData.removeCouponButtonSelector)&&this.AddRemoveButtonListener()}AddClickBeforeStartListener(){const e=m.Z.GetFirstVisibleElement(this.checkoutPageUrlData.clickBeforeStartSelector);return!!e&&(e.addEventListener("click",(async()=>{await this.TrySetUpCouponListener(!1,!0)})),!0)}AddRemoveButtonListener(){const e=m.Z.GetFirstVisibleElement(this.checkoutPageUrlData.removeCouponButtonSelector);return!!e&&(e.addEventListener("click",(async()=>{await this.TrySetUpCouponListener(!1,!1)})),!0)}GetCartValue(){let e={OrderTotal:-1,Currency:"$",PageCurrency:""};try{e=g.Z.GetCartValue(this.checkoutPageUrlData.orderTotalDataElementSelector,this.exclusiveMarket)}catch(e){this.LogError(e?.message)}return e}IsCouponInOurCorpus(e){return this.coupons.find((t=>t.couponCode.toLowerCase().trim()===e.toLowerCase().trim()))}isAutoApplyOn(){return m.Z.HasVisibleElement(this.divIDOverlay)}LogCouponSavings(e,t,o,a,r,n,s){const d=this.IsCouponInOurCorpus(e),m=(0,p.S8)();let h=e;try{h=d?e:btoa(e)}catch(e){h="USERCOUPON"}const g=this.TryGetCouponStatusMessages();let C=g.statusMessage,f=!1;!C&&this.statusMessage&&this.statusMessage.Message&&(C=this.statusMessage.Message,f=!0);const P={CouponCode:h,Currency:n,Discount:o,Domain:(0,p.S8)(),FinalPrice:r,PageCurrency:s,PageUrl:(0,p.Ek)(),Result:t,StartingPrice:a,DOMStatusMessage:this.statusMessage,StatusMessageFromDOM:f,StatusMessage:g.statusMessage,SuccessMessages:g.successMessages,FailureMessages:g.failureMessages,ProviderId:d?.providerId??"",IsPrivateCoupon:d?.isPrivateCoupon??!1,CartExtractionId:this.GetLastCartExtractionId(),CouponType:d?.couponType??""},b=this.fromPlatformDetection?"User applied a coupon from platform detection":"User applied a coupon";if(d)(0,A.TF)(d.offerUrl)||this.isCashbackDomain||S.Z.SendNavigateToUrlMessage(d.offerUrl),S.Z.SendLogEventMessage(P,i.R.ManualCouponApplication,this.impressionId,b,i.in.Information);else{const e=new c.Z(h,m,i.M_.ManuallyAppliedCouponNotInOurCorpus,location.pathname,JSON.stringify(P));S.Z.SendLogEventMessage(e,i.R.CollectedCoupons,this.impressionId,b,i.in.Information)}(o>0||d)&&this.SendEngagementTelemetry(i.$S.ManuallyAppliedCoupon,l.bS.COUPONS_COPIED,u.FV.COUPONS_COPIED)}GetLastCartExtractionId(){return C.Z.GetCartProcessingClient().GetLastCartId()}TryGetCouponStatusMessages(){try{return h.Z.GetCouponStatusMessages(this.checkoutPageUrlData?.errorMessageSelector,this.checkoutPageUrlData?.couponAcceptedMessageElementSelector,this.checkoutPageUrlData?.couponSuccessMessageSelectors,this.checkoutPageUrlData?.couponFailureMessageSelectors)}catch(e){this.LogError("Error extracting coupon status messages")}return{statusMessage:"",acceptedMessage:"",successMessages:[],failureMessages:[]}}async SendEngagementTelemetry(e,t,o){const a=new s.Z(e,d.r.COUPONS_AVAILABLE,(0,p.S8)());S.Z.SendLogEventMessage(a,i.R.ButtonClick,this.impressionId,"User applied a coupon manually",i.in.Information),f.a.postMessageToHost("recordAsUserAction",[t]),f.a.postMessageToHost("recordAsUserEngagement",[o])}LogError(e){const t={Domain:(0,p.S8)(),PageUrl:(0,p.Ek)(),Status:"Error"};S.Z.SendLogEventMessage(t,i.R.ManualCouponApplication,this.impressionId,e??"Error getting coupon savings",i.in.Information)}}},3274:function(e,t,o){function a(e,t,o,a){if("ExtractCheckoutPageGMV"===t)try{window.GetAndSnedExpressCheckoutGMV(e[0]??null)}catch(e){}else if("GetCashBackResponse"===t)try{window.ProcessCashBackResponse(e[0])}catch(e){}else if("WebAssistQueryResults"===t)window.ProcessWebAssistResponse(e[1]);else if("PdpValidation"===t)try{window.ProcessPdpCashBackResponse(e[0])}catch(e){}else"SharePriceComparisonData"===t||"ShareCompleteExtractionData"===t?i(e,!0,a):"OnGenericDealsServiceResponse"===t?window.ProcessClientRequestResponse(e):("BackgroundAutoApplyComplete"===t||"PostPurchaseRewardsNotify"===t||"ShouldAnimateOmniboxText"===t||"CurrentAnimatingButtonText"==t)&&i(e,!1,a,t);return o}function i(e,t,o,a){try{if(window.AOCInitializeExposedMethods(),"interactive"===document.readyState||"complete"===document.readyState){const i=performance.now();"BackgroundAutoApplyComplete"===a?window.CanAutoOpenAfterBGAAComplete(o,i,a):"PostPurchaseRewardsNotify"===a?window.CanAutoOpenAfterPostPurchaseRewards(e):"ShouldAnimateOmniboxText"===a?window.CheckAndAnimateTextOnOmnibox(e):"CurrentAnimatingButtonText"===a?window.HandleOmniboxAnimatedTextClick(e):t?window.CanAutoOpenAfterPDPData(e):window.CanAutoOpen(e,o,i)}else window.addEventListener&&window.addEventListener("DOMContentLoaded",(i=>{"ShouldAnimateOmniboxText"===a?window.CheckAndAnimateTextOnOmnibox(e):"CurrentAnimatingButtonText"===a?window.HandleOmniboxAnimatedTextClick(e):t?window.CheckAndCanAutoOpenAfterPDPData(e):window.CheckAndCanAutoOpen(e,o)}))}catch(e){return!1}}o.d(t,{U:function(){return a},g:function(){return i}})},4683:function(e,t,o){o.d(t,{m:function(){return l}});var a=o(2370),i=o(5590),r=o(1495),n=o(7689),s=o(2315),c=o(8025);const l=new class{constructor(){(0,a.Z)(this,"omniboxEngagementMap",void 0)}Initialize(){const e=(0,n.BQ)(r.Q.OmniboxEngagement,!0);this.omniboxEngagementMap=e||{}}GetOmniboxEngagement(){return this.omniboxEngagementMap}UpdateOmniboxEngagement(){this.omniboxEngagementMap?.global?.engagementTimestamps?.length>0?(this.omniboxEngagementMap.global.engagementTimestamps.push((new Date).getTime()),this.omniboxEngagementMap.global.engagementTimestamps=this.omniboxEngagementMap.global.engagementTimestamps.slice(-2)):this.omniboxEngagementMap.global={engagementTimestamps:[(new Date).getTime()]};const e=s.Z.getApiResponse();c.Q.sendLogEvent(e?.impressionId,"Updated omnibox engagement map","UpdateOmniboxEngagement",void 0,this.omniboxEngagementMap);const t=JSON.stringify({value:this.omniboxEngagementMap});r.Q.OmniboxEngagement=t,c.Q.sendControllerStorageMessage(i.Q.OmniboxEngagement,t)}}},9591:function(e,t,o){o.d(t,{Z:function(){return ge}});var a=o(2370);const i={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){console&&console[e]}};class r{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.init(e,t)}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||i,this.options=t,this.debug=t.debug}log(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return this.forward(t,"log","",!0)}warn(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return this.forward(t,"warn","",!0)}error(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return this.forward(t,"error","")}deprecate(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(e,t,o,a){return a&&!this.debug?null:("string"==typeof e[0]&&(e[0]=`${o}${this.prefix} ${e[0]}`),this.logger[t](e))}create(e){return new r(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return(e=e||this.options).prefix=e.prefix||this.prefix,new r(this.logger,e)}}var n=new r;class s{constructor(){this.observers={}}on(e,t){return e.split(" ").forEach((e=>{this.observers[e]||(this.observers[e]=new Map);const o=this.observers[e].get(t)||0;this.observers[e].set(t,o+1)})),this}off(e,t){this.observers[e]&&(t?this.observers[e].delete(t):delete this.observers[e])}emit(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),a=1;a<t;a++)o[a-1]=arguments[a];this.observers[e]&&Array.from(this.observers[e].entries()).forEach((e=>{let[t,a]=e;for(let e=0;e<a;e++)t(...o)})),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach((t=>{let[a,i]=t;for(let t=0;t<i;t++)a.apply(a,[e,...o])}))}}function c(){let e,t;const o=new Promise(((o,a)=>{e=o,t=a}));return o.resolve=e,o.reject=t,o}function l(e){return null==e?"":""+e}const d=/###/g;function u(e,t,o){function a(e){return e&&e.indexOf("###")>-1?e.replace(d,"."):e}function i(){return!e||"string"==typeof e}const r="string"!=typeof t?t:t.split(".");let n=0;for(;n<r.length-1;){if(i())return{};const t=a(r[n]);!e[t]&&o&&(e[t]=new o),e=Object.prototype.hasOwnProperty.call(e,t)?e[t]:{},++n}return i()?{}:{obj:e,k:a(r[n])}}function m(e,t,o){const{obj:a,k:i}=u(e,t,Object);if(void 0!==a||1===t.length)return void(a[i]=o);let r=t[t.length-1],n=t.slice(0,t.length-1),s=u(e,n,Object);for(;void 0===s.obj&&n.length;)r=`${n[n.length-1]}.${r}`,n=n.slice(0,n.length-1),s=u(e,n,Object),s&&s.obj&&void 0!==s.obj[`${s.k}.${r}`]&&(s.obj=void 0);s.obj[`${s.k}.${r}`]=o}function h(e,t){const{obj:o,k:a}=u(e,t);if(o)return o[a]}function p(e,t,o){for(const a in t)"__proto__"!==a&&"constructor"!==a&&(a in e?"string"==typeof e[a]||e[a]instanceof String||"string"==typeof t[a]||t[a]instanceof String?o&&(e[a]=t[a]):p(e[a],t[a],o):e[a]=t[a]);return e}function g(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var S={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function C(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,(e=>S[e])):e}const f=[" ",",","?","!",";"],A=new class{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const t=this.regExpMap.get(e);if(void 0!==t)return t;const o=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,o),this.regExpQueue.push(e),o}}(20);function P(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(!e)return;if(e[t])return e[t];const a=t.split(o);let i=e;for(let e=0;e<a.length;){if(!i||"object"!=typeof i)return;let t,r="";for(let n=e;n<a.length;++n)if(n!==e&&(r+=o),r+=a[n],t=i[r],void 0!==t){if(["string","number","boolean"].indexOf(typeof t)>-1&&n<a.length-1)continue;e+=n-e+1;break}i=t}return i}function b(e){return e&&e.indexOf("_")>0?e.replace("_","-"):e}class v extends s{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),void 0===this.options.ignoreJSONStructure&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}getResource(e,t,o){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=void 0!==a.keySeparator?a.keySeparator:this.options.keySeparator,r=void 0!==a.ignoreJSONStructure?a.ignoreJSONStructure:this.options.ignoreJSONStructure;let n;e.indexOf(".")>-1?n=e.split("."):(n=[e,t],o&&(Array.isArray(o)?n.push(...o):"string"==typeof o&&i?n.push(...o.split(i)):n.push(o)));const s=h(this.data,n);return!s&&!t&&!o&&e.indexOf(".")>-1&&(e=n[0],t=n[1],o=n.slice(2).join(".")),s||!r||"string"!=typeof o?s:P(this.data&&this.data[e]&&this.data[e][t],o,i)}addResource(e,t,o,a){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1};const r=void 0!==i.keySeparator?i.keySeparator:this.options.keySeparator;let n=[e,t];o&&(n=n.concat(r?o.split(r):o)),e.indexOf(".")>-1&&(n=e.split("."),a=t,t=n[1]),this.addNamespaces(t),m(this.data,n,a),i.silent||this.emit("added",e,t,o,a)}addResources(e,t,o){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(const a in o)("string"==typeof o[a]||Array.isArray(o[a]))&&this.addResource(e,t,a,o[a],{silent:!0});a.silent||this.emit("added",e,t,o)}addResourceBundle(e,t,o,a,i){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1,skipCopy:!1},n=[e,t];e.indexOf(".")>-1&&(n=e.split("."),a=o,o=t,t=n[1]),this.addNamespaces(t);let s=h(this.data,n)||{};r.skipCopy||(o=JSON.parse(JSON.stringify(o))),a?p(s,o,i):s={...s,...o},m(this.data,n,s),r.silent||this.emit("added",e,t,o)}removeResourceBundle(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}hasResourceBundle(e,t){return void 0!==this.getResource(e,t)}getResourceBundle(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?{...this.getResource(e,t)}:this.getResource(e,t)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find((e=>t[e]&&Object.keys(t[e]).length>0))}toJSON(){return this.data}}var O={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,o,a,i){return e.forEach((e=>{this.processors[e]&&(t=this.processors[e].process(t,o,a,i))})),t}};const E={};class T extends s{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var o,a;super(),o=e,a=this,["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"].forEach((e=>{o[e]&&(a[e]=o[e])})),this.options=t,void 0===this.options.keySeparator&&(this.options.keySeparator="."),this.logger=n.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==e)return!1;const o=this.resolve(e,t);return o&&void 0!==o.res}extractFromKey(e,t){let o=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===o&&(o=":");const a=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator;let i=t.ns||this.options.defaultNS||[];const r=o&&e.indexOf(o)>-1,n=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||function(e,t,o){t=t||"",o=o||"";const a=f.filter((e=>t.indexOf(e)<0&&o.indexOf(e)<0));if(0===a.length)return!0;const i=A.getRegExp(`(${a.map((e=>"?"===e?"\\?":e)).join("|")})`);let r=!i.test(e);if(!r){const t=e.indexOf(o);t>0&&!i.test(e.substring(0,t))&&(r=!0)}return r}(e,o,a));if(r&&!n){const t=e.match(this.interpolator.nestingRegexp);if(t&&t.length>0)return{key:e,namespaces:i};const r=e.split(o);(o!==a||o===a&&this.options.ns.indexOf(r[0])>-1)&&(i=r.shift()),e=r.join(a)}return"string"==typeof i&&(i=[i]),{key:e,namespaces:i}}translate(e,t,o){if("object"!=typeof t&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),"object"==typeof t&&(t={...t}),t||(t={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);const a=void 0!==t.returnDetails?t.returnDetails:this.options.returnDetails,i=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,{key:r,namespaces:n}=this.extractFromKey(e[e.length-1],t),s=n[n.length-1],c=t.lng||this.language,l=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(c&&"cimode"===c.toLowerCase()){if(l){const e=t.nsSeparator||this.options.nsSeparator;return a?{res:`${s}${e}${r}`,usedKey:r,exactUsedKey:r,usedLng:c,usedNS:s,usedParams:this.getUsedParamsDetails(t)}:`${s}${e}${r}`}return a?{res:r,usedKey:r,exactUsedKey:r,usedLng:c,usedNS:s,usedParams:this.getUsedParamsDetails(t)}:r}const d=this.resolve(e,t);let u=d&&d.res;const m=d&&d.usedKey||r,h=d&&d.exactUsedKey||r,p=Object.prototype.toString.apply(u),g=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays,S=!this.i18nFormat||this.i18nFormat.handleAsObject;if(S&&u&&"string"!=typeof u&&"boolean"!=typeof u&&"number"!=typeof u&&["[object Number]","[object Function]","[object RegExp]"].indexOf(p)<0&&("string"!=typeof g||!Array.isArray(u))){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const e=this.options.returnedObjectHandler?this.options.returnedObjectHandler(m,u,{...t,ns:n}):`key '${r} (${this.language})' returned an object instead of string.`;return a?(d.res=e,d.usedParams=this.getUsedParamsDetails(t),d):e}if(i){const e=Array.isArray(u),o=e?[]:{},a=e?h:m;for(const e in u)if(Object.prototype.hasOwnProperty.call(u,e)){const r=`${a}${i}${e}`;o[e]=this.translate(r,{...t,joinArrays:!1,ns:n}),o[e]===r&&(o[e]=u[e])}u=o}}else if(S&&"string"==typeof g&&Array.isArray(u))u=u.join(g),u&&(u=this.extendTranslation(u,e,t,o));else{let a=!1,n=!1;const l=void 0!==t.count&&"string"!=typeof t.count,m=T.hasDefaultValue(t),h=l?this.pluralResolver.getSuffix(c,t.count,t):"",p=t.ordinal&&l?this.pluralResolver.getSuffix(c,t.count,{ordinal:!1}):"",g=l&&!t.ordinal&&0===t.count&&this.pluralResolver.shouldUseIntlApi(),S=g&&t[`defaultValue${this.options.pluralSeparator}zero`]||t[`defaultValue${h}`]||t[`defaultValue${p}`]||t.defaultValue;!this.isValidLookup(u)&&m&&(a=!0,u=S),this.isValidLookup(u)||(n=!0,u=r);const C=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&n?void 0:u,f=m&&S!==u&&this.options.updateMissing;if(n||a||f){if(this.logger.log(f?"updateKey":"missingKey",c,s,r,f?S:u),i){const e=this.resolve(r,{...t,keySeparator:!1});e&&e.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let e=[];const o=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if("fallback"===this.options.saveMissingTo&&o&&o[0])for(let t=0;t<o.length;t++)e.push(o[t]);else"all"===this.options.saveMissingTo?e=this.languageUtils.toResolveHierarchy(t.lng||this.language):e.push(t.lng||this.language);const a=(e,o,a)=>{const i=m&&a!==u?a:C;this.options.missingKeyHandler?this.options.missingKeyHandler(e,s,o,i,f,t):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing(e,s,o,i,f,t),this.emit("missingKey",e,s,o,u)};this.options.saveMissing&&(this.options.saveMissingPlurals&&l?e.forEach((e=>{const o=this.pluralResolver.getSuffixes(e,t);g&&t[`defaultValue${this.options.pluralSeparator}zero`]&&o.indexOf(`${this.options.pluralSeparator}zero`)<0&&o.push(`${this.options.pluralSeparator}zero`),o.forEach((o=>{a([e],r+o,t[`defaultValue${o}`]||S)}))})):a(e,r,S))}u=this.extendTranslation(u,e,t,d,o),n&&u===r&&this.options.appendNamespaceToMissingKey&&(u=`${s}:${r}`),(n||a)&&this.options.parseMissingKeyHandler&&(u="v1"!==this.options.compatibilityAPI?this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${s}:${r}`:r,a?u:void 0):this.options.parseMissingKeyHandler(u))}return a?(d.res=u,d.usedParams=this.getUsedParamsDetails(t),d):u}extendTranslation(e,t,o,a,i){var r=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...o},o.lng||this.language||a.usedLng,a.usedNS,a.usedKey,{resolved:a});else if(!o.skipInterpolation){o.interpolation&&this.interpolator.init({...o,interpolation:{...this.options.interpolation,...o.interpolation}});const n="string"==typeof e&&(o&&o.interpolation&&void 0!==o.interpolation.skipOnVariables?o.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let s;if(n){const t=e.match(this.interpolator.nestingRegexp);s=t&&t.length}let c=o.replace&&"string"!=typeof o.replace?o.replace:o;if(this.options.interpolation.defaultVariables&&(c={...this.options.interpolation.defaultVariables,...c}),e=this.interpolator.interpolate(e,c,o.lng||this.language||a.usedLng,o),n){const t=e.match(this.interpolator.nestingRegexp);s<(t&&t.length)&&(o.nest=!1)}!o.lng&&"v1"!==this.options.compatibilityAPI&&a&&a.res&&(o.lng=this.language||a.usedLng),!1!==o.nest&&(e=this.interpolator.nest(e,(function(){for(var e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];return i&&i[0]===a[0]&&!o.context?(r.logger.warn(`It seems you are nesting recursively key: ${a[0]} in key: ${t[0]}`),null):r.translate(...a,t)}),o)),o.interpolation&&this.interpolator.reset()}const n=o.postProcess||this.options.postProcess,s="string"==typeof n?[n]:n;return null!=e&&s&&s.length&&!1!==o.applyPostProcessor&&(e=O.handle(s,e,t,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...a,usedParams:this.getUsedParamsDetails(o)},...o}:o,this)),e}resolve(e){let t,o,a,i,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=[e]),e.forEach((e=>{if(this.isValidLookup(t))return;const s=this.extractFromKey(e,n),c=s.key;o=c;let l=s.namespaces;this.options.fallbackNS&&(l=l.concat(this.options.fallbackNS));const d=void 0!==n.count&&"string"!=typeof n.count,u=d&&!n.ordinal&&0===n.count&&this.pluralResolver.shouldUseIntlApi(),m=void 0!==n.context&&("string"==typeof n.context||"number"==typeof n.context)&&""!==n.context,h=n.lngs?n.lngs:this.languageUtils.toResolveHierarchy(n.lng||this.language,n.fallbackLng);l.forEach((e=>{this.isValidLookup(t)||(r=e,!E[`${h[0]}-${e}`]&&this.utils&&this.utils.hasLoadedNamespace&&!this.utils.hasLoadedNamespace(r)&&(E[`${h[0]}-${e}`]=!0,this.logger.warn(`key "${o}" for languages "${h.join(", ")}" won't get resolved as namespace "${r}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),h.forEach((o=>{if(this.isValidLookup(t))return;i=o;const r=[c];if(this.i18nFormat&&this.i18nFormat.addLookupKeys)this.i18nFormat.addLookupKeys(r,c,o,e,n);else{let e;d&&(e=this.pluralResolver.getSuffix(o,n.count,n));const t=`${this.options.pluralSeparator}zero`,a=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(d&&(r.push(c+e),n.ordinal&&0===e.indexOf(a)&&r.push(c+e.replace(a,this.options.pluralSeparator)),u&&r.push(c+t)),m){const o=`${c}${this.options.contextSeparator}${n.context}`;r.push(o),d&&(r.push(o+e),n.ordinal&&0===e.indexOf(a)&&r.push(o+e.replace(a,this.options.pluralSeparator)),u&&r.push(o+t))}}let s;for(;s=r.pop();)this.isValidLookup(t)||(a=s,t=this.getResource(o,e,s,n))})))}))})),{res:t,usedKey:o,exactUsedKey:a,usedLng:i,usedNS:r}}isValidLookup(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}getResource(e,t,o){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,o,a):this.resourceStore.getResource(e,t,o,a)}getUsedParamsDetails(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],o=e.replace&&"string"!=typeof e.replace;let a=o?e.replace:e;if(o&&void 0!==e.count&&(a.count=e.count),this.options.interpolation.defaultVariables&&(a={...this.options.interpolation.defaultVariables,...a}),!o){a={...a};for(const e of t)delete a[e]}return a}static hasDefaultValue(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&"defaultValue"===t.substring(0,12)&&void 0!==e[t])return!0;return!1}}function y(e){return e.charAt(0).toUpperCase()+e.slice(1)}class I{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=n.create("languageUtils")}getScriptPartFromCode(e){if(!(e=b(e))||e.indexOf("-")<0)return null;const t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}getLanguagePartFromCode(e){if(!(e=b(e))||e.indexOf("-")<0)return e;const t=e.split("-");return this.formatLanguageCode(t[0])}formatLanguageCode(e){if("string"==typeof e&&e.indexOf("-")>-1){const t=["hans","hant","latn","cyrl","cans","mong","arab"];let o=e.split("-");return this.options.lowerCaseLng?o=o.map((e=>e.toLowerCase())):2===o.length?(o[0]=o[0].toLowerCase(),o[1]=o[1].toUpperCase(),t.indexOf(o[1].toLowerCase())>-1&&(o[1]=y(o[1].toLowerCase()))):3===o.length&&(o[0]=o[0].toLowerCase(),2===o[1].length&&(o[1]=o[1].toUpperCase()),"sgn"!==o[0]&&2===o[2].length&&(o[2]=o[2].toUpperCase()),t.indexOf(o[1].toLowerCase())>-1&&(o[1]=y(o[1].toLowerCase())),t.indexOf(o[2].toLowerCase())>-1&&(o[2]=y(o[2].toLowerCase()))),o.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let t;return e.forEach((e=>{if(t)return;const o=this.formatLanguageCode(e);this.options.supportedLngs&&!this.isSupportedCode(o)||(t=o)})),!t&&this.options.supportedLngs&&e.forEach((e=>{if(t)return;const o=this.getLanguagePartFromCode(e);if(this.isSupportedCode(o))return t=o;t=this.options.supportedLngs.find((e=>e===o?e:e.indexOf("-")<0&&o.indexOf("-")<0?void 0:e.indexOf("-")>0&&o.indexOf("-")<0&&e.substring(0,e.indexOf("-"))===o||0===e.indexOf(o)&&o.length>1?e:void 0))})),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t}getFallbackCodes(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),"string"==typeof e&&(e=[e]),Array.isArray(e))return e;if(!t)return e.default||[];let o=e[t];return o||(o=e[this.getScriptPartFromCode(t)]),o||(o=e[this.formatLanguageCode(t)]),o||(o=e[this.getLanguagePartFromCode(t)]),o||(o=e.default),o||[]}toResolveHierarchy(e,t){const o=this.getFallbackCodes(t||this.options.fallbackLng||[],e),a=[],i=e=>{e&&(this.isSupportedCode(e)?a.push(e):this.logger.warn(`rejecting language code not found in supportedLngs: ${e}`))};return"string"==typeof e&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?("languageOnly"!==this.options.load&&i(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&i(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&i(this.getLanguagePartFromCode(e))):"string"==typeof e&&i(this.formatLanguageCode(e)),o.forEach((e=>{a.indexOf(e)<0&&i(this.formatLanguageCode(e))})),a}}let _=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],k={1:function(e){return Number(e>1)},2:function(e){return Number(1!=e)},3:function(e){return 0},4:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},5:function(e){return Number(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},6:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)},7:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},8:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},9:function(e){return Number(e>=2)},10:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},11:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},12:function(e){return Number(e%10!=1||e%100==11)},13:function(e){return Number(0!==e)},14:function(e){return Number(1==e?0:2==e?1:3==e?2:3)},15:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},16:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)},17:function(e){return Number(1==e||e%10==1&&e%100!=11?0:1)},18:function(e){return Number(0==e?0:1==e?1:2)},19:function(e){return Number(1==e?0:0==e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},20:function(e){return Number(1==e?0:0==e||e%100>0&&e%100<20?1:2)},21:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},22:function(e){return Number(1==e?0:2==e?1:(e<0||e>10)&&e%10==0?2:3)}};const R=["v1","v2","v3"],D=["v4"],N={zero:0,one:1,two:2,few:3,many:4,other:5};class w{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.languageUtils=e,this.options=t,this.logger=n.create("pluralResolver"),this.options.compatibilityJSON&&!D.includes(this.options.compatibilityJSON)||"undefined"!=typeof Intl&&Intl.PluralRules||(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=function(){const e={};return _.forEach((t=>{t.lngs.forEach((o=>{e[o]={numbers:t.nr,plurals:k[t.fc]}}))})),e}()}addRule(e,t){this.rules[e]=t}getRule(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.shouldUseIntlApi())try{return new Intl.PluralRules(b("dev"===e?"en":e),{type:t.ordinal?"ordinal":"cardinal"})}catch(e){return}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}needsPlural(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=this.getRule(e,t);return this.shouldUseIntlApi()?o&&o.resolvedOptions().pluralCategories.length>1:o&&o.numbers.length>1}getPluralFormsOfKey(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(e,o).map((e=>`${t}${e}`))}getSuffixes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=this.getRule(e,t);return o?this.shouldUseIntlApi()?o.resolvedOptions().pluralCategories.sort(((e,t)=>N[e]-N[t])).map((e=>`${this.options.prepend}${t.ordinal?`ordinal${this.options.prepend}`:""}${e}`)):o.numbers.map((o=>this.getSuffix(e,o,t))):[]}getSuffix(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=this.getRule(e,o);return a?this.shouldUseIntlApi()?`${this.options.prepend}${o.ordinal?`ordinal${this.options.prepend}`:""}${a.select(t)}`:this.getSuffixRetroCompatible(a,t):(this.logger.warn(`no plural rule found for: ${e}`),"")}getSuffixRetroCompatible(e,t){const o=e.noAbs?e.plurals(t):e.plurals(Math.abs(t));let a=e.numbers[o];this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]&&(2===a?a="plural":1===a&&(a=""));const i=()=>this.options.prepend&&a.toString()?this.options.prepend+a.toString():a.toString();return"v1"===this.options.compatibilityJSON?1===a?"":"number"==typeof a?`_plural_${a.toString()}`:i():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]?i():this.options.prepend&&o.toString()?this.options.prepend+o.toString():o.toString()}shouldUseIntlApi(){return!R.includes(this.options.compatibilityJSON)}}function x(e,t,o){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:".",i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=function(e,t,o){const a=h(e,o);return void 0!==a?a:h(t,o)}(e,t,o);return!r&&i&&"string"==typeof o&&(r=P(e,o,a),void 0===r&&(r=P(t,o,a))),r}class U{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=n.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||(e=>e),this.init(e)}init(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:t,escapeValue:o,useRawValueToEscape:a,prefix:i,prefixEscaped:r,suffix:n,suffixEscaped:s,formatSeparator:c,unescapeSuffix:l,unescapePrefix:d,nestingPrefix:u,nestingPrefixEscaped:m,nestingSuffix:h,nestingSuffixEscaped:p,nestingOptionsSeparator:S,maxReplaces:f,alwaysFormat:A}=e.interpolation;this.escape=void 0!==t?t:C,this.escapeValue=void 0===o||o,this.useRawValueToEscape=void 0!==a&&a,this.prefix=i?g(i):r||"{{",this.suffix=n?g(n):s||"}}",this.formatSeparator=c||",",this.unescapePrefix=l?"":d||"-",this.unescapeSuffix=this.unescapePrefix?"":l||"",this.nestingPrefix=u?g(u):m||g("$t("),this.nestingSuffix=h?g(h):p||g(")"),this.nestingOptionsSeparator=S||",",this.maxReplaces=f||1e3,this.alwaysFormat=void 0!==A&&A,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(e,t)=>e&&e.source===t?(e.lastIndex=0,e):new RegExp(t,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,t,o,a){let i,r,n;const s=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function c(e){return e.replace(/\$/g,"$$$$")}const d=e=>{if(e.indexOf(this.formatSeparator)<0){const i=x(t,s,e,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(i,void 0,o,{...a,...t,interpolationkey:e}):i}const i=e.split(this.formatSeparator),r=i.shift().trim(),n=i.join(this.formatSeparator).trim();return this.format(x(t,s,r,this.options.keySeparator,this.options.ignoreJSONStructure),n,o,{...a,...t,interpolationkey:r})};this.resetRegExp();const u=a&&a.missingInterpolationHandler||this.options.missingInterpolationHandler,m=a&&a.interpolation&&void 0!==a.interpolation.skipOnVariables?a.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:e=>c(e)},{regex:this.regexp,safeValue:e=>this.escapeValue?c(this.escape(e)):c(e)}].forEach((t=>{for(n=0;i=t.regex.exec(e);){const o=i[1].trim();if(r=d(o),void 0===r)if("function"==typeof u){const t=u(e,i,a);r="string"==typeof t?t:""}else if(a&&Object.prototype.hasOwnProperty.call(a,o))r="";else{if(m){r=i[0];continue}this.logger.warn(`missed to pass in variable ${o} for interpolating ${e}`),r=""}else"string"==typeof r||this.useRawValueToEscape||(r=l(r));const s=t.safeValue(r);if(e=e.replace(i[0],s),m?(t.regex.lastIndex+=r.length,t.regex.lastIndex-=i[0].length):t.regex.lastIndex=0,n++,n>=this.maxReplaces)break}})),e}nest(e,t){let o,a,i,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};function n(e,t){const o=this.nestingOptionsSeparator;if(e.indexOf(o)<0)return e;const a=e.split(new RegExp(`${o}[ ]*{`));let r=`{${a[1]}`;e=a[0],r=this.interpolate(r,i);const n=r.match(/'/g),s=r.match(/"/g);(n&&n.length%2==0&&!s||s.length%2!=0)&&(r=r.replace(/'/g,'"'));try{i=JSON.parse(r),t&&(i={...t,...i})}catch(t){return this.logger.warn(`failed parsing options string in nesting for key ${e}`,t),`${e}${o}${r}`}return i.defaultValue&&i.defaultValue.indexOf(this.prefix)>-1&&delete i.defaultValue,e}for(;o=this.nestingRegexp.exec(e);){let s=[];i={...r},i=i.replace&&"string"!=typeof i.replace?i.replace:i,i.applyPostProcessor=!1,delete i.defaultValue;let c=!1;if(-1!==o[0].indexOf(this.formatSeparator)&&!/{.*}/.test(o[1])){const e=o[1].split(this.formatSeparator).map((e=>e.trim()));o[1]=e.shift(),s=e,c=!0}if(a=t(n.call(this,o[1].trim(),i),i),a&&o[0]===e&&"string"!=typeof a)return a;"string"!=typeof a&&(a=l(a)),a||(this.logger.warn(`missed to resolve ${o[1]} for nesting ${e}`),a=""),c&&(a=s.reduce(((e,t)=>this.format(e,t,r.lng,{...r,interpolationkey:o[1].trim()})),a.trim())),e=e.replace(o[0],a),this.regexp.lastIndex=0}return e}}function B(e){const t={};return function(o,a,i){const r=a+JSON.stringify(i);let n=t[r];return n||(n=e(b(a),i),t[r]=n),n(o)}}class L{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.logger=n.create("formatter"),this.options=e,this.formats={number:B(((e,t)=>{const o=new Intl.NumberFormat(e,{...t});return e=>o.format(e)})),currency:B(((e,t)=>{const o=new Intl.NumberFormat(e,{...t,style:"currency"});return e=>o.format(e)})),datetime:B(((e,t)=>{const o=new Intl.DateTimeFormat(e,{...t});return e=>o.format(e)})),relativetime:B(((e,t)=>{const o=new Intl.RelativeTimeFormat(e,{...t});return e=>o.format(e,t.range||"day")})),list:B(((e,t)=>{const o=new Intl.ListFormat(e,{...t});return e=>o.format(e)}))},this.init(e)}init(e){const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}}).interpolation;this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||","}add(e,t){this.formats[e.toLowerCase().trim()]=t}addCached(e,t){this.formats[e.toLowerCase().trim()]=B(t)}format(e,t,o){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return t.split(this.formatSeparator).reduce(((e,t)=>{const{formatName:i,formatOptions:r}=function(e){let t=e.toLowerCase().trim();const o={};if(e.indexOf("(")>-1){const a=e.split("(");t=a[0].toLowerCase().trim();const i=a[1].substring(0,a[1].length-1);"currency"===t&&i.indexOf(":")<0?o.currency||(o.currency=i.trim()):"relativetime"===t&&i.indexOf(":")<0?o.range||(o.range=i.trim()):i.split(";").forEach((e=>{if(e){const[t,...a]=e.split(":"),i=a.join(":").trim().replace(/^'+|'+$/g,""),r=t.trim();o[r]||(o[r]=i),"false"===i&&(o[r]=!1),"true"===i&&(o[r]=!0),isNaN(i)||(o[r]=parseInt(i,10))}}))}return{formatName:t,formatOptions:o}}(t);if(this.formats[i]){let t=e;try{const n=a&&a.formatParams&&a.formatParams[a.interpolationkey]||{},s=n.locale||n.lng||a.locale||a.lng||o;t=this.formats[i](e,s,{...r,...a,...n})}catch(e){this.logger.warn(e)}return t}return this.logger.warn(`there was no format function for ${i}`),e}),e)}}class F extends s{constructor(e,t,o){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(),this.backend=e,this.store=t,this.services=o,this.languageUtils=o.languageUtils,this.options=a,this.logger=n.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=a.maxParallelReads||10,this.readingCalls=0,this.maxRetries=a.maxRetries>=0?a.maxRetries:5,this.retryTimeout=a.retryTimeout>=1?a.retryTimeout:350,this.state={},this.queue=[],this.backend&&this.backend.init&&this.backend.init(o,a.backend,a)}queueLoad(e,t,o,a){const i={},r={},n={},s={};return e.forEach((e=>{let a=!0;t.forEach((t=>{const n=`${e}|${t}`;!o.reload&&this.store.hasResourceBundle(e,t)?this.state[n]=2:this.state[n]<0||(1===this.state[n]?void 0===r[n]&&(r[n]=!0):(this.state[n]=1,a=!1,void 0===r[n]&&(r[n]=!0),void 0===i[n]&&(i[n]=!0),void 0===s[t]&&(s[t]=!0)))})),a||(n[e]=!0)})),(Object.keys(i).length||Object.keys(r).length)&&this.queue.push({pending:r,pendingCount:Object.keys(r).length,loaded:{},errors:[],callback:a}),{toLoad:Object.keys(i),pending:Object.keys(r),toLoadLanguages:Object.keys(n),toLoadNamespaces:Object.keys(s)}}loaded(e,t,o){const a=e.split("|"),i=a[0],r=a[1];t&&this.emit("failedLoading",i,r,t),o&&this.store.addResourceBundle(i,r,o,void 0,void 0,{skipCopy:!0}),this.state[e]=t?-1:2;const n={};this.queue.forEach((o=>{!function(e,t,o){const{obj:a,k:i}=u(e,t,Object);a[i]=a[i]||[],a[i].push(o)}(o.loaded,[i],r),function(e,t){void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)}(o,e),t&&o.errors.push(t),0!==o.pendingCount||o.done||(Object.keys(o.loaded).forEach((e=>{n[e]||(n[e]={});const t=o.loaded[e];t.length&&t.forEach((t=>{void 0===n[e][t]&&(n[e][t]=!0)}))})),o.done=!0,o.errors.length?o.callback(o.errors):o.callback())})),this.emit("loaded",n),this.queue=this.queue.filter((e=>!e.done))}read(e,t,o){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.retryTimeout,r=arguments.length>5?arguments[5]:void 0;if(!e.length)return r(null,{});if(this.readingCalls>=this.maxParallelReads)return void this.waitingReads.push({lng:e,ns:t,fcName:o,tried:a,wait:i,callback:r});this.readingCalls++;const n=(n,s)=>{if(this.readingCalls--,this.waitingReads.length>0){const e=this.waitingReads.shift();this.read(e.lng,e.ns,e.fcName,e.tried,e.wait,e.callback)}n&&s&&a<this.maxRetries?setTimeout((()=>{this.read.call(this,e,t,o,a+1,2*i,r)}),i):r(n,s)},s=this.backend[o].bind(this.backend);if(2!==s.length)return s(e,t,n);try{const o=s(e,t);o&&"function"==typeof o.then?o.then((e=>n(null,e))).catch(n):n(null,o)}catch(e){n(e)}}prepareLoading(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),a&&a();"string"==typeof e&&(e=this.languageUtils.toResolveHierarchy(e)),"string"==typeof t&&(t=[t]);const i=this.queueLoad(e,t,o,a);if(!i.toLoad.length)return i.pending.length||a(),null;i.toLoad.forEach((e=>{this.loadOne(e)}))}load(e,t,o){this.prepareLoading(e,t,{},o)}reload(e,t,o){this.prepareLoading(e,t,{reload:!0},o)}loadOne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const o=e.split("|"),a=o[0],i=o[1];this.read(a,i,"read",void 0,void 0,((o,r)=>{o&&this.logger.warn(`${t}loading namespace ${i} for language ${a} failed`,o),!o&&r&&this.logger.log(`${t}loaded namespace ${i} for language ${a}`,r),this.loaded(e,o,r)}))}saveMissing(e,t,o,a,i){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:()=>{};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t))this.logger.warn(`did not save key "${o}" as the namespace "${t}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");else if(null!=o&&""!==o){if(this.backend&&this.backend.create){const s={...r,isUpdate:i},c=this.backend.create.bind(this.backend);if(c.length<6)try{let i;i=5===c.length?c(e,t,o,a,s):c(e,t,o,a),i&&"function"==typeof i.then?i.then((e=>n(null,e))).catch(n):n(null,i)}catch(e){n(e)}else c(e,t,o,a,n,s)}e&&e[0]&&this.store.addResource(e[0],t,o,a)}}}function M(){return{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev000 n
0000123662 00000 n
0000123943 00000 n
0000123963 00000 n
0000124210 00000 n
0000124230 00000 n
0000124478 00000 n
0000124498 00000 n
0000124804 00000 n
0000124824 00000 n
0000125077 00000 n
0000125097 00000 n
0000125395 00000 n
0000125415 00000 n
0000125665 00000 n
0000125685 00000 n
0000125934 00000 n
0000125954 00000 n
0000126206 00000 n
0000126226 00000 n
0000126480 00000 n
0000126500 00000 n
0000126751 00000 n
0000126771 00000 n
0000127024 00000 n
0000127044 00000 n
0000127426 00000 n
0000127447 00000 n
0000127704 00000 n
0000127724 00000 n
0000127971 00000 n
0000127991 00000 n
0000128237 00000 n
0000128257 00000 n
0000128506 00000 n
0000128526 00000 n
0000128776 00000 n
0000128796 00000 n
0000129510 00000 n
0000129531 00000 n
0000130089 00000 n
0000131003 00000 n
0000131975 00000 n
0000135782 00000 n
0000135804 00000 n
0000135942 00000 n
trailer
<</Size 206
/Info 204 0 R
/Root 205 0 R
>>
startxref
136038
%%EOF