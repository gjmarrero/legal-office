f defined(AMBIENT) && AMBIENTDIRECTUV == 0\nvarying vec2 vAmbientUV;\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nvarying vec2 vOpacityUV;\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nvarying vec2 vEmissiveUV;\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nvarying vec2 vLightmapUV;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nvarying vec2 vSpecularUV;\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nvarying vec2 vBumpUV;\n#endif\n\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)\n\nvCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);\n#endif\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));\nvNormalW=normalize(normalWorld*vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_WORLDPOS\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR == 0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\nvPositionW=vec3(worldPos);\n#include<prePassVertex>\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n\n#ifndef UV1\nvec2 uvUpdated=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uvUpdated;\n#endif\n#ifdef MAINUV2\nvMainUV2=uv2;\n#endif\n#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0\nif (vDiffuseInfos.x == 0.)\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(DETAIL) && DETAILDIRECTUV == 0\nif (vDetailInfos.x == 0.)\n{\nvDetailUV=vec2(detailMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvDetailUV=vec2(detailMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(AMBIENT) && AMBIENTDIRECTUV == 0\nif (vAmbientInfos.x == 0.)\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(OPACITY) && OPACITYDIRECTUV == 0\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0\nif (vEmissiveInfos.x == 0.)\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0\nif (vLightmapInfos.x == 0.)\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0\nif (vSpecularInfos.x == 0.)\n{\nvSpecularUV=vec2(specularMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#if defined(BUMP) && BUMPDIRECTUV == 0\nif (vBumpInfos.x == 0.)\n{\nvBumpUV=vec2(bumpMatrix*vec4(uvUpdated,1.0,0.0));\n}\nelse\n{\nvBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n#include<pointCloudVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}\n";var Ji=function(){function e(e){this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=Vt.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=e}return e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},e.prototype.isReadyForSubMesh=function(e,t){var i=t.getEngine();return!(e._areTexturesDirty&&t.texturesEnabled&&i.getCaps().standardDerivatives&&this._texture&&Qi.DetailTextureEnabled&&!this._texture.isReady())},e.prototype.prepareDefines=function(e,t){if(this._isEnabled){e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;var i=t.getEngine();e._areTexturesDirty&&(i.getCaps().standardDerivatives&&this._texture&&Qi.DetailTextureEnabled&&this._isEnabled?(Xi.PrepareDefinesForMergedUV(this._texture,e,"DETAIL"),e.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):e.DETAIL=!1)}else e.DETAIL=!1},e.prototype.bindForSubMesh=function(e,t,i){this._isEnabled&&(e.useUbo&&i&&e.isSync||this._texture&&Qi.DetailTextureEnabled&&(e.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),Xi.BindTextureMatrix(this._texture,e,"detail")),t.texturesEnabled&&this._texture&&Qi.DetailTextureEnabled&&e.setTexture("detailSampler",this._texture))},e.prototype.hasTexture=function(e){return this._texture===e},e.prototype.getActiveTextures=function(e){this._texture&&e.push(this._texture)},e.prototype.getAnimatables=function(e){this._texture&&this._texture.animations&&this._texture.animations.length>0&&e.push(this._texture)},e.prototype.dispose=function(e){var t;e&&(null===(t=this._texture)||void 0===t||t.dispose())},e.prototype.getClassName=function(){return"DetailMap"},e.AddUniforms=function(e){e.push("vDetailInfos")},e.AddSamplers=function(e){e.push("detailSampler")},e.PrepareUniformBuffer=function(e){e.addUniform("vDetailInfos",4),e.addUniform("detailMatrix",16)},e.prototype.copyTo=function(e){N.Clone((function(){return e}),this)},e.prototype.serialize=function(){return N.Serialize(this)},e.prototype.parse=function(e,t,i){var r=this;N.Parse((function(){return r}),e,t,i)},r([R("detailTexture"),I("_markAllSubMeshesAsTexturesDirty")],e.prototype,"texture",void 0),r([O()],e.prototype,"diffuseBlendLevel",void 0),r([O()],e.prototype,"roughnessBlendLevel",void 0),r([O()],e.prototype,"bumpLevel",void 0),r([O(),I("_markAllSubMeshesAsTexturesDirty")],e.prototype,"normalBlendMethod",void 0),r([O(),I("_markAllSubMeshesAsTexturesDirty")],e.prototype,"isEnabled",void 0),e}(),$i={effect:null,subMesh:null},er=function(e){function i(){var t=e.call(this)||this;return t.MAINUV1=!1,t.MAINUV2=!1,t.DIFFUSE=!1,t.DIFFUSEDIRECTUV=0,t.DETAIL=!1,t.DETAILDIRECTUV=0,t.DETAIL_NORMALBLENDMETHOD=0,t.AMBIENT=!1,t.AMBIENTDIRECTUV=0,t.OPACITY=!1,t.OPACITYDIRECTUV=0,t.OPACITYRGB=!1,t.REFLECTION=!1,t.EMISSIVE=!1,t.EMISSIVEDIRECTUV=0,t.SPECULAR=!1,t.SPECULARDIRECTUV=0,t.BUMP=!1,t.BUMPDIRECTUV=0,t.PARALLAX=!1,t.PARALLAXOCCLUSION=!1,t.SPECULAROVERALPHA=!1,t.CLIPPLANE=!1,t.CLIPPLANE2=!1,t.CLIPPLANE3=!1,t.CLIPPLANE4=!1,t.CLIPPLANE5=!1,t.CLIPPLANE6=!1,t.ALPHATEST=!1,t.DEPTHPREPASS=!1,t.ALPHAFROMDIFFUSE=!1,t.POINTSIZE=!1,t.FOG=!1,t.SPECULARTERM=!1,t.DIFFUSEFRESNEL=!1,t.OPACITYFRESNEL=!1,t.REFLECTIONFRESNEL=!1,t.REFRACTIONFRESNEL=!1,t.EMISSIVEFRESNEL=!1,t.FRESNEL=!1,t.NORMAL=!1,t.UV1=!1,t.UV2=!1,t.VERTEXCOLOR=!1,t.VERTEXALPHA=!1,t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,t.BONETEXTURE=!1,t.BONES_VELOCITY_ENABLED=!1,t.INSTANCES=!1,t.THIN_INSTANCES=!1,t.GLOSSINESS=!1,t.ROUGHNESS=!1,t.EMISSIVEASILLUMINATION=!1,t.LINKEMISSIVEWITHDIFFUSE=!1,t.REFLECTIONFRESNELFROMSPECULAR=!1,t.LIGHTMAP=!1,t.LIGHTMAPDIRECTUV=0,t.OBJECTSPACE_NORMALMAP=!1,t.USELIGHTMAPASSHADOWMAP=!1,t.REFLECTIONMAP_3D=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_CUBIC=!1,t.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,t.INVERTCUBICMAP=!1,t.LOGARITHMICDEPTH=!1,t.REFRACTION=!1,t.REFRACTIONMAP_3D=!1,t.REFLECTIONOVERALPHA=!1,t.TWOSIDEDLIGHTING=!1,t.SHADOWFLOAT=!1,t.MORPHTARGETS=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS_TANGENT=!1,t.MORPHTARGETS_UV=!1,t.NUM_MORPH_INFLUENCERS=0,t.NONUNIFORMSCALING=!1,t.PREMULTIPLYALPHA=!1,t.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,t.ALPHABLEND=!0,t.PREPASS=!1,t.PREPASS_IRRADIANCE=!1,t.PREPASS_IRRADIANCE_INDEX=-1,t.PREPASS_ALBEDO=!1,t.PREPASS_ALBEDO_INDEX=-1,t.PREPASS_DEPTHNORMAL=!1,t.PREPASS_DEPTHNORMAL_INDEX=-1,t.PREPASS_POSITION=!1,t.PREPASS_POSITION_INDEX=-1,t.PREPASS_VELOCITY=!1,t.PREPASS_VELOCITY_INDEX=-1,t.PREPASS_REFLECTIVITY=!1,t.PREPASS_REFLECTIVITY_INDEX=-1,t.SCENE_MRT_COUNT=0,t.RGBDLIGHTMAP=!1,t.RGBDREFLECTION=!1,t.RGBDREFRACTION=!1,t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.MULTIVIEW=!1,t.IS_REFLECTION_LINEAR=!1,t.IS_REFRACTION_LINEAR=!1,t.EXPOSURE=!1,t.rebuild(),t}return t(i,e),i.prototype.setReflectionMode=function(e){for(var t=0,i=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];t<i.length;t++){var r=i[t];this[r]=r===e}},i}(Ri),tr=function(e){function i(t,r){var n=e.call(this,t,r)||this;return n._diffuseTexture=null,n._ambientTexture=null,n._opacityTexture=null,n._reflectionTexture=null,n._emissiveTexture=null,n._specularTexture=null,n._bumpTexture=null,n._lightmapTexture=null,n._refractionTexture=null,n.ambientColor=new T(0,0,0),n.diffuseColor=new T(1,1,1),n.specularColor=new T(1,1,1),n.emissiveColor=new T(0,0,0),n.specularPower=64,n._useAlphaFromDiffuseTexture=!1,n._useEmissiveAsIllumination=!1,n._linkEmissiveWithDiffuse=!1,n._useSpecularOverAlpha=!1,n._useReflectionOverAlpha=!1,n._disableLighting=!1,n._useObjectSpaceNormalMap=!1,n._useParallax=!1,n._useParallaxOcclusion=!1,n.parallaxScaleBias=.05,n._roughness=0,n.indexOfRefraction=.98,n.invertRefractionY=!0,n.alphaCutOff=.4,n._useLightmapAsShadowmap=!1,n._useReflectionFresnelFromSpecular=!1,n._useGlossinessFromSpecularMapAlpha=!1,n._maxSimultaneousLights=4,n._invertNormalMapX=!1,n._invertNormalMapY=!1,n._twoSidedLighting=!1,n.detailMap=new Ji(n._markAllSubMeshesAsTexturesDirty.bind(n)),n._renderTargets=new di(16),n._worldViewProjectionMatrix=m.Zero(),n._globalAmbientColor=new T(0,0,0),n._rebuildInParallel=!1,n._attachImageProcessingConfiguration(null),n.prePassConfiguration=new qi,n.getRenderTargetTextures=function(){return n._renderTargets.reset(),i.ReflectionTextureEnabled&&n._reflectionTexture&&n._reflectionTexture.isRenderTarget&&n._renderTargets.push(n._reflectionTexture),i.RefractionTextureEnabled&&n._refractionTexture&&n._refractionTexture.isRenderTarget&&n._renderTargets.push(n._refractionTexture),n._renderTargets},n}return t(i,e),Object.defineProperty(i.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(e){this._attachImageProcessingConfiguration(e),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),i.prototype._attachImageProcessingConfiguration=function(e){var t=this;e!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=e||this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((function(){t._markAllSubMeshesAsImageProcessingDirty()}))))},Object.defineProperty(i.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(e){this.imageProcessingConfiguration.colorCurvesEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(e){this.imageProcessingConfiguration.colorGradingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(e){this._imageProcessingConfiguration.toneMappingEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(e){this._imageProcessingConfiguration.exposure=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(e){this._imageProcessingConfiguration.contrast=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(e){this._imageProcessingConfiguration.colorGradingTexture=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(e){this._imageProcessingConfiguration.colorCurves=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"canRenderToMRT",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"hasRenderTargetTextures",{get:function(){return!!(i.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||!!(i.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},enumerable:!1,configurable:!0}),i.prototype.getClassName=function(){return"StandardMaterial"},Object.defineProperty(i.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(e){this._useLogarithmicDepth=e&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!1,configurable:!0}),i.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)},i.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===Vt.MATERIAL_ALPHATEST)},i.prototype._shouldUseAlphaFromDiffuseTexture=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==Vt.MATERIAL_OPAQUE},i.prototype._hasAlphaChannel=function(){return null!=this._diffuseTexture&&this._diffuseTexture.hasAlpha||null!=this._opacityTexture},i.prototype.getAlphaTestTexture=function(){return this._diffuseTexture},i.prototype.isReadyForSubMesh=function(e,t,r){if(void 0===r&&(r=!1),t.effect&&this.isFrozen&&t.effect._wasPreviouslyReady)return!0;t._materialDefines||(t._materialDefines=new er);var n=this.getScene(),o=t._materialDefines;if(this._isReadyForSubMesh(t))return!0;var s=n.getEngine();if(o._needNormals=Xi.PrepareDefinesForLights(n,e,o,!0,this._maxSimultaneousLights,this._disableLighting),Xi.PrepareDefinesForMultiview(n,o),Xi.PrepareDefinesForPrePass(n,o,this.canRenderToMRT),o._areTexturesDirty){if(o._needUVs=!1,o.MAINUV1=!1,o.MAINUV2=!1,n.texturesEnabled){if(this._diffuseTexture&&i.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;Xi.PrepareDefinesForMergedUV(this._diffuseTexture,o,"DIFFUSE")}else o.DIFFUSE=!1;if(this._ambientTexture&&i.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;Xi.PrepareDefinesForMergedUV(this._ambientTexture,o,"AMBIENT")}else o.AMBIENT=!1;if(this._opacityTexture&&i.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;Xi.PrepareDefinesForMergedUV(this._opacityTexture,o,"OPACITY"),o.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else o.OPACITY=!1;if(this._reflectionTexture&&i.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(o._needNormals=!0,o.REFLECTION=!0,o.ROUGHNESS=this._roughness>0,o.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,o.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===Re.INVCUBIC_MODE,o.REFLECTIONMAP_3D=this._reflectionTexture.isCube,o.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case Re.EXPLICIT_MODE:o.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case Re.PLANAR_MODE:o.setReflectionMode("REFLECTIONMAP_PLANAR");break;case Re.PROJECTION_MODE:o.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case Re.SKYBOX_MODE:o.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case Re.SPHERICAL_MODE:o.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case Re.EQUIRECTANGULAR_MODE:o.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case Re.FIXED_EQUIRECTANGULAR_MODE:o.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case Re.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:o.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case Re.CUBIC_MODE:case Re.INVCUBIC_MODE:default:o.setReflectionMode("REFLECTIONMAP_CUBIC")}o.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else o.REFLECTION=!1;if(this._emissiveTexture&&i.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;Xi.PrepareDefinesForMergedUV(this._emissiveTexture,o,"EMISSIVE")}else o.EMISSIVE=!1;if(this._lightmapTexture&&i.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;Xi.PrepareDefinesForMergedUV(this._lightmapTexture,o,"LIGHTMAP"),o.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,o.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else o.LIGHTMAP=!1;if(this._specularTexture&&i.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;Xi.PrepareDefinesForMergedUV(this._specularTexture,o,"SPECULAR"),o.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else o.SPECULAR=!1;if(n.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&i.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;Xi.PrepareDefinesForMergedUV(this._bumpTexture,o,"BUMP"),o.PARALLAX=this._useParallax,o.PARALLAXOCCLUSION=this._useParallaxOcclusion,o.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else o.BUMP=!1;if(this._refractionTexture&&i.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;o._needUVs=!0,o.REFRACTION=!0,o.REFRACTIONMAP_3D=this._refractionTexture.isCube,o.RGBDREFRACTION=this._refractionTexture.isRGBD}else o.REFRACTION=!1;o.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else o.DIFFUSE=!1,o.AMBIENT=!1,o.OPACITY=!1,o.REFLECTION=!1,o.EMISSIVE=!1,o.LIGHTMAP=!1,o.BUMP=!1,o.REFRACTION=!1;o.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),o.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,o.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,o.SPECULAROVERALPHA=this._useSpecularOverAlpha,o.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,o.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,o.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(e)}if(!this.detailMap.isReadyForSubMesh(o,n))return!1;if(o._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(o),o.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,o.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(o._areFresnelDirty&&(i.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(o.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,o.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,o.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,o.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,o.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,o.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,o._needNormals=!0,o.FRESNEL=!0):o.FRESNEL=!1),Xi.PrepareDefinesForMisc(e,n,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(e)||this._forceAlphaTest,o),Xi.PrepareDefinesForAttributes(e,o,!0,!0,!0),Xi.PrepareDefinesForFrameBoundValues(n,s,o,r,null,t.getRenderingMesh().hasThinInstances),this.detailMap.prepareDefines(o,n),o.isDirty){var a=o._areLightsDisposed;o.markAsProcessed();var h=new ji;o.REFLECTION&&h.addFallback(0,"REFLECTION"),o.SPECULAR&&h.addFallback(0,"SPECULAR"),o.BUMP&&h.addFallback(0,"BUMP"),o.PARALLAX&&h.addFallback(1,"PARALLAX"),o.PARALLAXOCCLUSION&&h.addFallback(0,"PARALLAXOCCLUSION"),o.SPECULAROVERALPHA&&h.addFallback(0,"SPECULAROVERALPHA"),o.FOG&&h.addFallback(1,"FOG"),o.POINTSIZE&&h.addFallback(0,"POINTSIZE"),o.LOGARITHMICDEPTH&&h.addFallback(0,"LOGARITHMICDEPTH"),Xi.HandleFallbacksForShadows(o,h,this._maxSimultaneousLights),o.SPECULARTERM&&h.addFallback(0,"SPECULARTERM"),o.DIFFUSEFRESNEL&&h.addFallback(1,"DIFFUSEFRESNEL"),o.OPACITYFRESNEL&&h.addFallback(2,"OPACITYFRESNEL"),o.REFLECTIONFRESNEL&&h.addFallback(3,"REFLECTIONFRESNEL"),o.EMISSIVEFRESNEL&&h.addFallback(4,"EMISSIVEFRESNEL"),o.FRESNEL&&h.addFallback(4,"FRESNEL"),o.MULTIVIEW&&h.addFallback(0,"MULTIVIEW");var u=[ft.PositionKind];o.NORMAL&&u.push(ft.NormalKind),o.UV1&&u.push(ft.UVKind),o.UV2&&u.push(ft.UV2Kind),o.VERTEXCOLOR&&u.push(ft.ColorKind),Xi.PrepareAttributesForBones(u,e,o,h),Xi.PrepareAttributesForInstances(u,o),Xi.PrepareAttributesForMorphTargets(u,e,o);var l="default",c=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth"],f=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler"],d=["Material","Scene"];Ji.AddUniforms(c),Ji.AddSamplers(f),qi.AddUniforms(c),qi.AddSamplers(c),wi&&(wi.PrepareUniforms(c,o),wi.PrepareSamplers(f,o)),Xi.PrepareUniformsAndSamplersList({uniformsNames:c,uniformBuffersNames:d,samplers:f,defines:o,maxSimultaneousLights:this._maxSimultaneousLights});var p={};this.customShaderNameResolve&&(l=this.customShaderNameResolve(l,c,d,f,o,u,p));var _=o.toString(),g=t.effect,m=n.getEngine().createEffect(l,{attributes:u,uniformsNames:c,uniformBuffersNames:d,samplers:f,defines:_,fallbacks:h,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:o.NUM_MORPH_INFLUENCERS},processFinalCode:p.processFinalCode,multiTarget:o.PREPASS},s);if(m)if(this._onEffectCreatedObservable&&($i.effect=m,$i.subMesh=t,this._onEffectCreatedObservable.notifyObservers($i)),this.allowShaderHotSwapping&&g&&!m.isReady()){if(m=g,this._rebuildInParallel=!0,o.markAsUnprocessed(),a)return o._areLightsDisposed=!0,!1}else this._rebuildInParallel=!1,n.resetCachedMaterial(),t.setEffect(m,o),this.buildUniformLayout()}return!(!t.effect||!t.effect.isReady())&&(o._renderId=n.getRenderId(),t.effect._wasPreviouslyReady=!0,!0)},i.prototype.buildUniformLayout=function(){var e=this._uniformBuffer;e.addUniform("diffuseLeftColor",4),e.addUniform("diffuseRightColor",4),e.addUniform("opacityParts",4),e.addUniform("reflectionLeftColor",4),e.addUniform("reflectionRightColor",4),e.addUniform("refractionLeftColor",4),e.addUniform("refractionRightColor",4),e.addUniform("emissiveLeftColor",4),e.addUniform("emissiveRightColor",4),e.addUniform("vDiffuseInfos",2),e.addUniform("vAmbientInfos",2),e.addUniform("vOpacityInfos",2),e.addUniform("vReflectionInfos",2),e.addUniform("vReflectionPosition",3),e.addUniform("vReflectionSize",3),e.addUniform("vEmissiveInfos",2),e.addUniform("vLightmapInfos",2),e.addUniform("vSpecularInfos",2),e.addUniform("vBumpInfos",3),e.addUniform("diffuseMatrix",16),e.addUniform("ambientMatrix",16),e.addUniform("opacityMatrix",16),e.addUniform("reflectionMatrix",16),e.addUniform("emissiveMatrix",16),e.addUniform("lightmapMatrix",16),e.addUniform("specularMatrix",16),e.addUniform("bumpMatrix",16),e.addUniform("vTangentSpaceParams",2),e.addUniform("pointSize",1),e.addUniform("refractionMatrix",16),e.addUniform("vRefractionInfos",4),e.addUniform("vSpecularColor",4),e.addUniform("vEmissiveColor",3),e.addUniform("visibility",1),e.addUniform("vDiffuseColor",4),Ji.PrepareUniformBuffer(e),e.create()},i.prototype.unbind=function(){if(this._activeEffect){var t=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),t=!0),this._refractionTexture&&this._refractionTexture.isRenderTarget&&(this._activeEffect.setTexture("refraction2DSampler",null),t=!0),t&&this._markAllSubMeshesAsTexturesDirty()}e.prototype.unbind.call(this)},i.prototype.bindForSubMesh=function(e,t,r){var n=this.getScene(),o=r._materialDefines;if(o){var s=r.effect;if(s){this._activeEffect=s,o.INSTANCES&&!o.THIN_INSTANCES||this.bindOnlyWorldMatrix(e),this.prePassConfiguration.bindForSubMesh(this._activeEffect,n,t,e,this.isFrozen),o.OBJECTSPACE_NORMALMAP&&(e.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var a=this._mustRebind(n,s,t.visibility);Xi.BindBonesParameters(t,s);var h=this._uniformBuffer;if(a){if(h.bindToEffect(s,"Material"),this.bindViewProjection(s),!h.useUbo||!this.isFrozen||!h.isSync){if(i.FresnelEnabled&&o.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(h.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),h.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&h.updateColor4("opacityParts",new T(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(h.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),h.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(h.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),h.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(h.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),h.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),n.texturesEnabled){if(this._diffuseTexture&&i.DiffuseTextureEnabled&&(h.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),Xi.BindTextureMatrix(this._diffuseTexture,h,"diffuse")),this._ambientTexture&&i.AmbientTextureEnabled&&(h.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),Xi.BindTextureMatrix(this._ambientTexture,h,"ambient")),this._opacityTexture&&i.OpacityTextureEnabled&&(h.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),Xi.BindTextureMatrix(this._opacityTexture,h,"opacity")),this._hasAlphaChannel()&&s.setFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&i.ReflectionTextureEnabled&&(h.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),h.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){var u=this._reflectionTexture;h.updateVector3("vReflectionPosition",u.boundingBoxPosition),h.updateVector3("vReflectionSize",u.boundingBoxSize)}if(this._emissiveTexture&&i.EmissiveTextureEnabled&&(h.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),Xi.BindTextureMatrix(this._emissiveTexture,h,"emissive")),this._lightmapTexture&&i.LightmapTextureEnabled&&(h.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),Xi.BindTextureMatrix(this._lightmapTexture,h,"lightmap")),this._specularTexture&&i.SpecularTextureEnabled&&(h.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),Xi.BindTextureMatrix(this._specularTexture,h,"specular")),this._bumpTexture&&n.getEngine().getCaps().standardDerivatives&&i.BumpTextureEnabled&&(h.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),Xi.BindTextureMatrix(this._bumpTexture,h,"bump"),n._mirroredCameraPosition?h.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):h.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&i.RefractionTextureEnabled){var l=1;this._refractionTexture.isCube||(h.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(l=this._refractionTexture.depth)),h.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,l,this.invertRefractionY?-1:1)}}this.pointsCloud&&h.updateFloat("pointSize",this.pointSize),o.SPECULARTERM&&h.updateColor4("vSpecularColor",this.specularColor,this.specularPower),h.updateColor3("vEmissiveColor",i.EmissiveTextureEnabled?this.emissiveColor:T.BlackReadOnly),h.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha)}if(h.updateFloat("visibility",t.visibility),n.texturesEnabled&&(this._diffuseTexture&&i.DiffuseTextureEnabled&&s.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&i.AmbientTextureEnabled&&s.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&i.OpacityTextureEnabled&&s.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&i.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?s.setTexture("reflectionCubeSampler",this._reflectionTexture):s.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&i.EmissiveTextureEnabled&&s.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&i.LightmapTextureEnabled&&s.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&i.SpecularTextureEnabled&&s.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&n.getEngine().getCaps().standardDerivatives&&i.BumpTextureEnabled&&s.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&i.RefractionTextureEnabled)){l=1;this._refractionTexture.isCube?s.setTexture("refractionCubeSampler",this._refractionTexture):s.setTexture("refraction2DSampler",this._refractionTexture)}this.detailMap.bindForSubMesh(h,n,this.isFrozen),Xi.BindClipPlane(s,n),n.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),Xi.BindEyePosition(s,n),s.setColor3("vAmbientColor",this._globalAmbientColor)}!a&&this.isFrozen||(n.lightsEnabled&&!this._disableLighting&&Xi.BindLights(n,t,s,o,this._maxSimultaneousLights,this._rebuildInParallel),(n.fogEnabled&&t.applyFog&&n.fogMode!==zi.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture)&&this.bindView(s),Xi.BindFogParameters(n,t,s),o.NUM_MORPH_INFLUENCERS&&Xi.BindMorphTargetParameters(t,s),this.useLogarithmicDepth&&Xi.BindLogDepth(o,s,n),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),h.update(),this._afterBind(t,this._activeEffect)}}},i.prototype.getAnimatables=function(){var e=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&e.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&e.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&e.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&e.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&e.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&e.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&e.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&e.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&e.push(this._refractionTexture),this.detailMap.getAnimatables(e),e},i.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);return this._diffuseTexture&&t.push(this._diffuseTexture),this._ambientTexture&&t.push(this._ambientTexture),this._opacityTexture&&t.push(this._opacityTexture),this._reflectionTexture&&t.push(this._reflectionTexture),this._emissiveTexture&&t.push(this._emissiveTexture),this._specularTexture&&t.push(this._specularTexture),this._bumpTexture&&t.push(this._bumpTexture),this._lightmapTexture&&t.push(this._lightmapTexture),this._refractionTexture&&t.push(this._refractionTexture),this.detailMap.getActiveTextures(t),t},i.prototype.hasTexture=function(t){return!!e.prototype.hasTexture.call(this,t)||(this._diffuseTexture===t||(this._ambientTexture===t||(this._opacityTexture===t||(this._reflectionTexture===t||(this._emissiveTexture===t||(this._specularTexture===t||(this._bumpTexture===t||(this._lightmapTexture===t||(this._refractionTexture===t||this.detailMap.hasTexture(t))))))))))},i.prototype.dispose=function(t,i){var r,n,o,s,a,h,u,l,c;i&&(null===(r=this._diffuseTexture)||void 0===r||r.dispose(),null===(n=this._ambientTexture)||void 0===n||n.dispose(),null===(o=this._opacityTexture)||void 0===o||o.dispose(),null===(s=this._reflectionTexture)||void 0===s||s.dispose(),null===(a=this._emissiveTexture)||void 0===a||a.dispose(),null===(h=this._specularTexture)||void 0===h||h.dispose(),null===(u=this._bumpTexture)||void 0===u||u.dispose(),null===(l=this._lightmapTexture)||void 0===l||l.dispose(),null===(c=this._refractionTexture)||void 0===c||c.dispose()),this.detailMap.dispose(i),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),e.prototype.dispose.call(this,t,i)},i.prototype.clone=function(e){var t=this,r=N.Clone((function(){return new i(e,t.getScene())}),this);return r.name=e,r.id=e,r},i.prototype.serialize=function(){return N.Serialize(this)},i.Parse=function(e,t,r){return N.Parse((function(){return new i(e.name,t)}),e,t,r)},Object.defineProperty(i,"DiffuseTextureEnabled",{get:function(){return Qi.DiffuseTextureEnabled},set:function(e){Qi.DiffuseTextureEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(i,"DetailTextureEnabled",{get:function(){return Qi.DetailTextureEnabled},set:function(e){Qi.DetailTextureEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(i,"AmbientTextureEnabled",{get:function(){return Qi.AmbientTextureEnabled},set:function(e){Qi.AmbientTextureEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(i,"OpacityTextureEnabled",{get:function(){return Qi.OpacityTextureEnabled},set:function(e){Qi.OpacityTextureEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(i,"ReflectionTextureEnabled",{get:function(){return Qi.ReflectionTextureEnabled},set:function(e){Qi.ReflectionTextureEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(i,"EmissiveTextureEnabled",{get:function(){return Qi.EmissiveTextureEnabled},set:function(e){Qi.EmissiveTextureEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(i,"SpecularTextureEnabled",{get:function(){return Qi.SpecularTextureEnabled},set:function(e){Qi.SpecularTextureEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(i,"BumpTextureEnabled",{get:function(){return Qi.BumpTextureEnabled},set:function(e){Qi.BumpTextureEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(i,"LightmapTextureEnabled",{get:function(){return Qi.LightmapTextureEnabled},set:function(e){Qi.LightmapTextureEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(i,"RefractionTextureEnabled",{get:function(){return Qi.RefractionTextureEnabled},set:function(e){Qi.RefractionTextureEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(i,"ColorGradingTextureEnabled",{get:function(){return Qi.ColorGradingTextureEnabled},set:function(e){Qi.ColorGradingTextureEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(i,"FresnelEnabled",{get:function(){return Qi.FresnelEnabled},set:function(e){Qi.FresnelEnabled=e},enumerable:!1,configurable:!0}),r([R("diffuseTexture")],i.prototype,"_diffuseTexture",void 0),r([I("_markAllSubMeshesAsTexturesAndMiscDirty")],i.prototype,"diffuseTexture",void 0),r([R("ambientTexture")],i.prototype,"_ambientTexture",void 0),r([I("_markAllSubMeshesAsTexturesDirty")],i.prototype,"ambientTexture",void 0),r([R("opacityTexture")],i.prototype,"_opacityTexture",void 0),r([I("_markAllSubMeshesAsTexturesAndMiscDirty")],i.prototype,"opacityTexture",void 0),r([R("reflectionTexture")],i.prototype,"_reflectionTexture",void 0),r([I("_markAllSubMeshesAsTexturesDirty")],i.prototype,"reflectionTexture",void 0),r([R("emissiveTexture")],i.prototype,"_emissiveTexture",void 0),r([I("_markAllSubMeshesAsTexturesDirty")],i.prototype,"emissiveTexture",void 0),r([R("specularTexture")],i.prototype,"_specularTexture",void 0),r([I("_markAllSubMeshesAsTexturesDirty")],i.prototype,"specularTexture",void 0),r([R("bumpTexture")],i.prototype,"_bumpTexture",void 0),r([I("_markAllSubMeshesAsTexturesDirty")],i.prototype,"bumpTexture",void 0),r([R("lightmapTexture")],i.prototype,"_lightmapTexture",void 0),r([I("_markAllSubMeshesAsTexturesDirty")],i.prototype,"lightmapTexture",void 0),r([R("refractionTexture")],i.prototype,"_refractionTexture",void 0),r([I("_markAllSubMeshesAsTexturesDirty")],i.prototype,"refractionTexture",void 0),r([D("ambient")],i.prototype,"ambientColor",void 0),r([D("diffuse")],i.prototype,"diffuseColor",void 0),r([D("specular")],i.prototype,"specularColor",void 0),r([D("emissive")],i.prototype,"emissiveColor",void 0),r([O()],i.prototype,"specularPower",void 0),r([O("useAlphaFromDiffuseTexture")],i.prototype,"_useAlphaFromDiffuseTexture",void 0),r([I("_markAllSubMeshesAsTexturesAndMiscDirty")],i.prototype,"useAlphaFromDiffuseTexture",void 0),r([O("useEmissiveAsIllumination")],i.prototype,"_useEmissiveAsIllumination",void 0),r([I("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useEmissiveAsIllumination",void 0),r([O("linkEmissiveWithDiffuse")],i.prototype,"_linkEmissiveWithDiffuse",void 0),r([I("_markAllSubMeshesAsTexturesDirty")],i.prototype,"linkEmissiveWithDiffuse",void 0),r([O("useSpecularOverAlpha")],i.prototype,"_useSpecularOverAlpha",void 0),r([I("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useSpecularOverAlpha",void 0),r([O("useReflectionOverAlpha")],i.prototype,"_useReflectionOverAlpha",void 0),r([I("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useReflectionOverAlpha",void 0),r([O("disableLighting")],i.prototype,"_disableLighting",void 0),r([I("_markAllSubMeshesAsLightsDirty")],i.prototype,"disableLighting",void 0),r([O("useObjectSpaceNormalMap")],i.prototype,"_useObjectSpaceNormalMap",void 0),r([I("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useObjectSpaceNormalMap",void 0),r([O("useParallax")],i.prototype,"_useParallax",void 0),r([I("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useParallax",void 0),r([O("useParallaxOcclusion")],i.prototype,"_useParallaxOcclusion",void 0),r([I("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useParallaxOcclusion",void 0),r([O()],i.prototype,"parallaxScaleBias",void 0),r([O("roughness")],i.prototype,"_roughness",void 0),r([I("_markAllSubMeshesAsTexturesDirty")],i.prototype,"roughness",void 0),r([O()],i.prototype,"indexOfRefraction",void 0),r([O()],i.prototype,"invertRefractionY",void 0),r([O()],i.prototype,"alphaCutOff",void 0),r([O("useLightmapAsShadowmap")],i.prototype,"_useLightmapAsShadowmap",void 0),r([I("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useLightmapAsShadowmap",void 0),r([w("diffuseFresnelParameters")],i.prototype,"_diffuseFresnelParameters",void 0),r([I("_markAllSubMeshesAsFresnelDirty")],i.prototype,"diffuseFresnelParameters",void 0),r([w("opacityFresnelParameters")],i.prototype,"_opacityFresnelParameters",void 0),r([I("_markAllSubMeshesAsFresnelAndMiscDirty")],i.prototype,"opacityFresnelParameters",void 0),r([w("reflectionFresnelParameters")],i.prototype,"_reflectionFresnelParameters",void 0),r([I("_markAllSubMeshesAsFresnelDirty")],i.prototype,"reflectionFresnelParameters",void 0),r([w("refractionFresnelParameters")],i.prototype,"_refractionFresnelParameters",void 0),r([I("_markAllSubMeshesAsFresnelDirty")],i.prototype,"refractionFresnelParameters",void 0),r([w("emissiveFresnelParameters")],i.prototype,"_emissiveFresnelParameters",void 0),r([I("_markAllSubMeshesAsFresnelDirty")],i.prototype,"emissiveFresnelParameters",void 0),r([O("useReflectionFresnelFromSpecular")],i.prototype,"_useReflectionFresnelFromSpecular",void 0),r([I("_markAllSubMeshesAsFresnelDirty")],i.prototype,"useReflectionFresnelFromSpecular",void 0),r([O("useGlossinessFromSpecularMapAlpha")],i.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),r([I("_markAllSubMeshesAsTexturesDirty")],i.prototype,"useGlossinessFromSpecularMapAlpha",void 0),r([O("maxSimultaneousLights")],i.prototype,"_maxSimultaneousLights",void 0),r([I("_markAllSubMeshesAsLightsDirty")],i.prototype,"maxSimultaneousLights",void 0),r([O("invertNormalMapX")],i.prototype,"_invertNormalMapX",void 0),r([I("_markAllSubMeshesAsTexturesDirty")],i.prototype,"invertNormalMapX",void 0),r([O("invertNormalMapY")],i.prototype,"_invertNormalMapY",void 0),r([I("_markAllSubMeshesAsTexturesDirty")],i.prototype,"invertNormalMapY",void 0),r([O("twoSidedLighting")],i.prototype,"_twoSidedLighting",void 0),r([I("_markAllSubMeshesAsTexturesDirty")],i.prototype,"twoSidedLighting",void 0),r([O()],i.prototype,"useLogarithmicDepth",null),i}(Zi);c.RegisteredTypes["BABYLON.StandardMaterial"]=tr,zi.DefaultMaterialFactory=function(e){return new tr("default material",e)},Zt._instancedMeshFactory=function(e,t){var i=new ir(e,t);if(t.instancedBuffers)for(var r in i.instancedBuffers={},t.instancedBuffers)i.instancedBuffers[r]=t.instancedBuffers[r];return i};var ir=function(e){function i(t,i){var r=e.call(this,t,i.getScene())||this;r._indexInSourceMeshInstanceArray=-1,i.addInstance(r),r._sourceMesh=i,r._unIndexed=i._unIndexed,r.position.copyFrom(i.position),r.rotation.copyFrom(i.rotation),r.scaling.copyFrom(i.scaling),i.rotationQuaternion&&(r.rotationQuaternion=i.rotationQuaternion.clone()),r.animations=Ue.Slice(i.animations);for(var n=0,o=i.getAnimationRanges();n<o.length;n++){var s=o[n];null!=s&&r.createAnimationRange(s.name,s.from,s.to)}return r.infiniteDistance=i.infiniteDistance,r.setPivotMatrix(i.getPivotMatrix()),r.refreshBoundingInfo(),r._syncSubMeshes(),r}return t(i,e),i.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(i.prototype,"lightSources",{get:function(){return this._sourceMesh._lightSources},enumerable:!1,configurable:!0}),i.prototype._resyncLightSources=function(){},i.prototype._resyncLightSource=function(e){},i.prototype._removeLightSource=function(e,t){},Object.defineProperty(i.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(e){this._sourceMesh&&e!==this._sourceMesh.renderingGroupId&&q.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!1,configurable:!0}),i.prototype.getTotalVertices=function(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0},i.prototype.getTotalIndices=function(){return this._sourceMesh.getTotalIndices()},Object.defineProperty(i.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!1,configurable:!0}),i.prototype.createInstance=function(e){return this._sourceMesh.createInstance(e)},i.prototype.isReady=function(e){return void 0===e&&(e=!1),this._sourceMesh.isReady(e,!0)},i.prototype.getVerticesData=function(e,t){return this._sourceMesh.getVerticesData(e,t)},i.prototype.setVerticesData=function(e,t,i,r){return this.sourceMesh&&this.sourceMesh.setVerticesData(e,t,i,r),this.sourceMesh},i.prototype.updateVerticesData=function(e,t,i,r){return this.sourceMesh&&this.sourceMesh.updateVerticesData(e,t,i,r),this.sourceMesh},i.prototype.setIndices=function(e,t){return void 0===t&&(t=null),this.sourceMesh&&this.sourceMesh.setIndices(e,t),this.sourceMesh},i.prototype.isVerticesDataPresent=function(e){return this._sourceMesh.isVerticesDataPresent(e)},i.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(i.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!1,configurable:!0}),i.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var t=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(e),t),this},i.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},i.prototype._activate=function(e,t){if(this._sourceMesh.subMeshes||q.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>0!=this._getWorldMatrixDeterminant()>0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,e),t){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1},i.prototype._postActivate=function(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)},i.prototype.getWorldMatrix=function(){if(this._currentLOD&&this._currentLOD.billboardMode!==wt.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){var t=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,y.Vector3[7].copyFrom(this._currentLOD.position),this._currentLOD.position.set(0,0,0),y.Matrix[0].copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD.position.copyFrom(y.Vector3[7]),this._currentLOD._masterMesh=t,y.Matrix[0]}return e.prototype.getWorldMatrix.call(this)},Object.defineProperty(i.prototype,"isAnInstance",{get:function(){return!0},enumerable:!1,configurable:!0}),i.prototype.getLOD=function(e){if(!e)return this;var t=this.getBoundingInfo();return this._currentLOD=this.sourceMesh.getLOD(e,t.boundingSphere),this._currentLOD===this.sourceMesh?this.sourceMesh:this._currentLOD},i.prototype._preActivateForIntermediateRendering=function(e){return this.sourceMesh._preActivateForIntermediateRendering(e)},i.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh);return this},i.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},i.prototype._updateBoundingInfo=function(){var e=this;return this._boundingInfo?this._boundingInfo.update(e.worldMatrixFromCache):this._boundingInfo=new Tt(this.absolutePosition,this.absolutePosition,e.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(e.worldMatrixFromCache),this},i.prototype.clone=function(e,t,i){void 0===t&&(t=null);var r=this._sourceMesh.createInstance(e);if(Le.DeepCopy(this,r,["name","subMeshes","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances"],[]),this.refreshBoundingInfo(),t&&(r.parent=t),!i)for(var n=0;n<this.getScene().meshes.length;n++){var o=this.getScene().meshes[n];o.parent===this&&o.clone(o.name,r)}return r.computeWorldMatrix(!0),r},i.prototype.dispose=function(t,i){void 0===i&&(i=!1),this._sourceMesh.removeInstance(this),e.prototype.dispose.call(this,t,i)},i}(kt);Zt.prototype.edgesShareWithInstances=!1,Zt.prototype.registerInstancedBuffer=function(e,t){if(this.removeVerticesData(e),!this.instancedBuffers){this.instancedBuffers={};for(var i=0,r=this.instances;i<r.length;i++){r[i].instancedBuffers={}}this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{}}}this.instancedBuffers[e]=null,this._userInstancedBuffersStorage.strides[e]=t,this._userInstancedBuffersStorage.sizes[e]=32*t,this._userInstancedBuffersStorage.data[e]=new Float32Array(this._userInstancedBuffersStorage.sizes[e]),this._userInstancedBuffersStorage.vertexBuffers[e]=new ft(this.getEngine(),this._userInstancedBuffersStorage.data[e],e,!0,!1,t,!0),this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[e]);for(var n=0,o=this.instances;n<o.length;n++){o[n].instancedBuffers[e]=null}},Zt.prototype._processInstancedBuffers=function(e,t){var i=e.length;for(var r in this.instancedBuffers){for(var n=this._userInstancedBuffersStorage.sizes[r],o=this._userInstancedBuffersStorage.strides[r],s=(i+1)*o;n<s;)n*=2;this._userInstancedBuffersStorage.data[r].length!=n&&(this._userInstancedBuffersStorage.data[r]=new Float32Array(n),this._userInstancedBuffersStorage.sizes[r]=n,this._userInstancedBuffersStorage.vertexBuffers[r]&&(this._userInstancedBuffersStorage.vertexBuffers[r].dispose(),this._userInstancedBuffersStorage.vertexBuffers[r]=null));var a=this._userInstancedBuffersStorage.data[r],h=0;if(t)(l=this.instancedBuffers[r]).toArray?l.toArray(a,h):l.copyToArray(a,h),h+=o;for(var u=0;u<i;u++){var l;(l=e[u].instancedBuffers[r]).toArray?l.toArray(a,h):l.copyToArray(a,h),h+=o}this._userInstancedBuffersStorage.vertexBuffers[r]?this._userInstancedBuffersStorage.vertexBuffers[r].updateDirectly(a,0):(this._userInstancedBuffersStorage.vertexBuffers[r]=new ft(this.getEngine(),this._userInstancedBuffersStorage.data[r],r,!0,!1,o,!0),this.setVerticesBuffer(this._userInstancedBuffersStorage.vertexBuffers[r]))}},Zt.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(var e in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[e]&&this._userInstancedBuffersStorage.vertexBuffers[e].dispose();this.instancedBuffers={}};he.ShadersStore.colorPixelShader="#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#else\nuniform vec4 color;\n#endif\n#include<clipPlaneFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\n#ifdef VERTEXCOLOR\ngl_FragColor=vColor;\n#else\ngl_FragColor=color;\n#endif\n}";he.ShadersStore.colorVertexShader="\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<clipPlaneVertexDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n#ifdef MULTIVIEW\nuniform mat4 viewProjectionR;\n#endif\n\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR == 0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\n#include<clipPlaneVertex>\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n}";var rr=function(e){function i(t,i,r,n,o,s,a){void 0===i&&(i=null),void 0===r&&(r=null),void 0===n&&(n=null);var h=e.call(this,t,i,r,n,o)||this;h.useVertexColor=s,h.useVertexAlpha=a,h.color=new T(1,1,1),h.alpha=1,n&&(h.color=n.color.clone(),h.alpha=n.alpha,h.useVertexColor=n.useVertexColor,h.useVertexAlpha=n.useVertexAlpha),h.intersectionThreshold=.1;var u={attributes:[ft.PositionKind,"world0","world1","world2","world3"],uniforms:["vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","world","viewProjection"],needAlphaBlending:!0,defines:[]};return!1===a&&(u.needAlphaBlending=!1),s?(u.defines.push("#define VERTEXCOLOR"),u.attributes.push(ft.ColorKind)):(u.uniforms.push("color"),h.color4=new E),h._colorShader=new Yi("colorShader",h.getScene(),"color",u),h}return t(i,e),i.prototype._addClipPlaneDefine=function(e){var t="#define "+e;-1===this._colorShader.options.defines.indexOf(t)&&this._colorShader.options.defines.push(t)},i.prototype._removeClipPlaneDefine=function(e){var t="#define "+e,i=this._colorShader.options.defines.indexOf(t);-1!==i&&this._colorShader.options.defines.splice(i,1)},i.prototype.isReady=function(){var t=this.getScene();return t.clipPlane?this._addClipPlaneDefine("CLIPPLANE"):this._removeClipPlaneDefine("CLIPPLANE"),t.clipPlane2?this._addClipPlaneDefine("CLIPPLANE2"):this._removeClipPlaneDefine("CLIPPLANE2"),t.clipPlane3?this._addClipPlaneDefine("CLIPPLANE3"):this._removeClipPlaneDefine("CLIPPLANE3"),t.clipPlane4?this._addClipPlaneDefine("CLIPPLANE4"):this._removeClipPlaneDefine("CLIPPLANE4"),t.clipPlane5?this._addClipPlaneDefine("CLIPPLANE5"):this._removeClipPlaneDefine("CLIPPLANE5"),t.clipPlane6?this._addClipPlaneDefine("CLIPPLANE6"):this._removeClipPlaneDefine("CLIPPLANE6"),!!this._colorShader.isReady(this)&&e.prototype.isReady.call(this)},i.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(i.prototype,"material",{get:function(){return this._colorShader},set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"checkCollisions",{get:function(){return!1},enumerable:!1,configurable:!0}),i.prototype._bind=function(e,t,i){if(!this._geometry)return this;var r=this._colorShader.getEffect(),n=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(this._geometry._bind(r,n),!this.useVertexColor){var o=this.color,s=o.r,a=o.g,h=o.b;this.color4.set(s,a,h,this.alpha),this._colorShader.setColor4("color",this.color4)}return Xi.BindClipPlane(r,this.getScene()),this},i.prototype._draw=function(e,t,i){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var r=this.getScene().getEngine();return this._unIndexed?r.drawArraysType(Vt.LineListDrawMode,e.verticesStart,e.verticesCount,i):r.drawElementsType(Vt.LineListDrawMode,e.indexStart,e.indexCount,i),this},i.prototype.dispose=function(t){this._colorShader.dispose(!1,!1,!0),e.prototype.dispose.call(this,t)},i.prototype.clone=function(e,t,r){return void 0===t&&(t=null),new i(e,this.getScene(),t,this,r)},i.prototype.createInstance=function(e){return new nr(e,this)},i}(Zt),nr=function(e){function i(t,i){var r=e.call(this,t,i)||this;return r.intersectionThreshold=i.intersectionThreshold,r}return t(i,e),i.prototype.getClassName=function(){return"InstancedLinesMesh"},i}(ir);dt.CreateRibbon=function(e){var t=e.pathArray,i=e.closeArray||!1,r=e.closePath||!1,n=e.invertUV||!1,o=Math.floor(t[0].length/2),s=e.offset||o;s=s>o?o:Math.floor(s);var a,h,u,l,c=0===e.sideOrientation?0:e.sideOrientation||dt.DEFAULTSIDE,f=e.uvs,d=e.colors,p=[],_=[],g=[],m=[],v=[],y=[],b=[],T=[],E=[],x=[];if(t.length<2){var A=[],M=[];for(u=0;u<t[0].length-s;u++)A.push(t[0][u]),M.push(t[0][u+s]);t=[A,M]}var P,C,S,I,O,R=0,D=r?1:0;for(a=t[0].length,h=0;h<t.length;h++){for(b[h]=0,v[h]=[0],a=a<(C=(P=t[h]).length)?a:C,l=0;l<C;)p.push(P[l].x,P[l].y,P[l].z),l>0&&(S=P[l].subtract(P[l-1]).length()+b[h],v[h].push(S),b[h]=S),l++;r&&(l--,p.push(P[0].x,P[0].y,P[0].z),S=P[l].subtract(P[0]).length()+b[h],v[h].push(S),b[h]=S),E[h]=C+D,x[h]=R,R+=C+D}var w,L,F=null,N=null;for(u=0;u<a+D;u++){for(T[u]=0,y[u]=[0],h=0;h<t.length-1;h++)I=t[h],O=t[h+1],u===a?(F=I[0],N=O[0]):(F=I[u],N=O[u]),S=N.subtract(F).length()+T[u],y[u].push(S),T[u]=S;i&&N&&F&&(I=t[h],O=t[0],u===a&&(N=O[0]),S=N.subtract(F).length()+T[u],T[u]=S)}if(f)for(h=0;h<f.length;h++)m.push(f[h].x,f[h].y);else for(h=0;h<t.length;h++)for(u=0;u<a+D;u++)w=0!=b[h]?v[h][u]/b[h]:0,L=0!=T[u]?y[u][h]/T[u]:0,n?m.push(L,w):m.push(w,L);for(var B=0,k=E[h=0]-1,U=E[h+1]-1,V=k<U?k:U,W=x[1]-x[0],z=i?E.length:E.length-1;B<=V&&h<z;)_.push(B,B+W,B+1),_.push(B+W+1,B+1,B+W),(B+=1)===V&&(++h===E.length-1?(W=x[0]-x[h],k=E[h]-1,U=E[0]-1):(W=x[h+1]-x[h],k=E[h]-1,U=E[h+1]-1),B=x[h],V=k<U?k+B:U+B);if(dt.ComputeNormals(p,_,g),r){var G=0,H=0;for(h=0;h<t.length;h++)G=3*x[h],H=h+1<t.length?3*(x[h+1]-1):g.length-3,g[G]=.5*(g[G]+g[H]),g[G+1]=.5*(g[G+1]+g[H+1]),g[G+2]=.5*(g[G+2]+g[H+2]),g[H]=g[G],g[H+1]=g[G+1],g[H+2]=g[G+2]}dt._ComputeSides(c,p,_,g,m,e.frontUVs,e.backUVs);var X=null;if(d){X=new Float32Array(4*d.length);for(var j=0;j<d.length;j++)X[4*j]=d[j].r,X[4*j+1]=d[j].g,X[4*j+2]=d[j].b,X[4*j+3]=d[j].a}var K=new dt,Y=new Float32Array(p),q=new Float32Array(g),Z=new Float32Array(m);return K.indices=_,K.positions=Y,K.normals=q,K.uvs=Z,X&&K.set(X,ft.ColorKind),r&&(K._idx=x),K},Zt.CreateRibbon=function(e,t,i,r,n,o,s,a,h){return void 0===i&&(i=!1),void 0===s&&(s=!1),or.CreateRibbon(e,{pathArray:t,closeArray:i,closePath:r,offset:n,updatable:s,sideOrientation:a,instance:h},o)};var or=function(){function e(){}return e.CreateRibbon=function(e,t,i){void 0===i&&(i=null);var r=t.pathArray,n=t.closeArray,o=t.closePath,s=Zt._GetDefaultSideOrientation(t.sideOrientation),a=t.instance,h=t.updatable;if(a){var u=y.Vector3[0].setAll(Number.MAX_VALUE),l=y.Vector3[1].setAll(-Number.MAX_VALUE),c=a.getVerticesData(ft.PositionKind);if(function(e){for(var t=r[0].length,i=a,n=0,o=i._originalBuilderSideOrientation===Zt.DOUBLESIDE?2:1,s=1;s<=o;++s)for(var h=0;h<r.length;++h){var c=r[h],f=c.length;t=t<f?t:f;for(var d=0;d<t;++d){var p=c[d];e[n]=p.x,e[n+1]=p.y,e[n+2]=p.z,u.minimizeInPlaceFromFloats(p.x,p.y,p.z),l.maximizeInPlaceFromFloats(p.x,p.y,p.z),n+=3}if(i._creationDataStorage&&i._creationDataStorage.closePath){p=c[0];e[n]=p.x,e[n+1]=p.y,e[n+2]=p.z,n+=3}}}(c),a._boundingInfo?a._boundingInfo.reConstruct(u,l,a._worldMatrix):a._boundingInfo=new Tt(u,l,a._worldMatrix),a.updateVerticesData(ft.PositionKind,c,!1,!1),t.colors){for(var f=a.getVerticesData(ft.ColorKind),d=0,p=0;d<t.colors.length;d++,p+=4){var _=t.colors[d];f[p]=_.r,f[p+1]=_.g,f[p+2]=_.b,f[p+3]=_.a}a.updateVerticesData(ft.ColorKind,f,!1,!1)}if(t.uvs){for(var g=a.getVerticesData(ft.UVKind),m=0;m<t.uvs.length;m++)g[2*m]=t.uvs[m].x,g[2*m+1]=t.uvs[m].y;a.updateVerticesData(ft.UVKind,g,!1,!1)}if(!a.areNormalsFrozen||a.isFacetDataEnabled){var v=a.getIndices(),b=a.getVerticesData(ft.NormalKind),T=a.isFacetDataEnabled?a.getFacetDataParameters():null;if(dt.ComputeNormals(c,v,b,T),a._creationDataStorage&&a._creationDataStorage.closePath)for(var E=0,x=0,A=0;A<r.length;A++)E=3*a._creationDataStorage.idx[A],x=A+1<r.length?3*(a._creationDataStorage.idx[A+1]-1):b.length-3,b[E]=.5*(b[E]+b[x]),b[E+1]=.5*(b[E+1]+b[x+1]),b[E+2]=.5*(b[E+2]+b[x+2]),b[x]=b[E],b[x+1]=b[E+1],b[x+2]=b[E+2];a.areNormalsFrozen||a.updateVerticesData(ft.NormalKind,b,!1,!1)}return a}var M=new Zt(e,i);M._originalBuilderSideOrientation=s,M._creationDataStorage=new Xt;var P=dt.CreateRibbon(t);return o&&(M._creationDataStorage.idx=P._idx),M._creationDataStorage.closePath=o,M._creationDataStorage.closeArray=n,P.applyToMesh(M,h),M},e}();dt.CreateDisc=function(e){var t=new Array,i=new Array,r=new Array,n=new Array,o=e.radius||.5,s=e.tessellation||64,a=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,h=0===e.sideOrientation?0:e.sideOrientation||dt.DEFAULTSIDE;t.push(0,0,0),n.push(.5,.5);for(var u=2*Math.PI*a,l=1===a?u/s:u/(s-1),c=0,f=0;f<s;f++){var d=Math.cos(c),p=Math.sin(c),_=(d+1)/2,g=(1-p)/2;t.push(o*d,o*p,0),n.push(_,g),c+=l}1===a&&(t.push(t[3],t[4],t[5]),n.push(n[2],n[3]));for(var m=t.length/3,v=1;v<m-1;v++)i.push(v+1,0,v);dt.ComputeNormals(t,i,r),dt._ComputeSides(h,t,i,r,n,e.frontUVs,e.backUVs);var y=new dt;return y.indices=i,y.positions=t,y.normals=r,y.uvs=n,y},Zt.CreateDisc=function(e,t,i,r,n,o){void 0===r&&(r=null);var s={radius:t,tessellation:i,sideOrientation:o,updatable:n};return sr.CreateDisc(e,s,r)};var sr=function(){function e(){}return e.CreateDisc=function(e,t,i){void 0===i&&(i=null);var r=new Zt(e,i);return t.sideOrientation=Zt._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,dt.CreateDisc(t).applyToMesh(r,t.updatable),r},e}();dt.CreateBox=function(e){var t,i=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],r=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],n=[],o=e.width||e.size||1,s=e.height||e.size||1,a=e.depth||e.size||1,h=e.wrap||!1,u=void 0===e.topBaseAt?1:e.topBaseAt,l=void 0===e.bottomBaseAt?0:e.bottomBaseAt,c=[2,0,3,1][u=(u+4)%4],f=[2,0,1,3][l=(l+4)%4],d=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(h){i=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],d=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];for(var p=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],g=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]],m=[17,18,19,16],v=[22,23,20,21];c>0;)p.unshift(p.pop()),m.unshift(m.pop()),c--;for(;f>0;)g.unshift(g.pop()),v.unshift(v.pop()),f--;p=p.flat(),g=g.flat(),d=d.concat(p).concat(g),i.push(m[0],m[2],m[3],m[0],m[1],m[2]),i.push(v[0],v[2],v[3],v[0],v[1],v[2])}var y=[o/2,s/2,a/2];t=d.reduce((function(e,t,i){return e.concat(t*y[i%3])}),[]);for(var b=0===e.sideOrientation?0:e.sideOrientation||dt.DEFAULTSIDE,T=e.faceUV||new Array(6),x=e.faceColors,A=[],M=0;M<6;M++)void 0===T[M]&&(T[M]=new _(0,0,1,1)),x&&void 0===x[M]&&(x[M]=new E(1,1,1,1));for(var P=0;P<6;P++)if(n.push(T[P].z,T[P].w),n.push(T[P].x,T[P].w),n.push(T[P].x,T[P].y),n.push(T[P].z,T[P].y),x)for(var C=0;C<4;C++)A.push(x[P].r,x[P].g,x[P].b,x[P].a);dt._ComputeSides(b,t,i,r,n,e.frontUVs,e.backUVs);var S=new dt;if(S.indices=i,S.positions=t,S.normals=r,S.uvs=n,x){var I=b===dt.DOUBLESIDE?A.concat(A):A;S.colors=I}return S},Zt.CreateBox=function(e,t,i,r,n){void 0===i&&(i=null);var o={size:t,sideOrientation:n,updatable:r};return ar.CreateBox(e,o,i)};var ar=function(){function e(){}return e.CreateBox=function(e,t,i){void 0===i&&(i=null);var r=new Zt(e,i);return t.sideOrientation=Zt._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,dt.CreateBox(t).applyToMesh(r,t.updatable),r},e}();dt.CreateTiledBox=function(e){for(var t=e.faceUV||new Array(6),i=e.faceColors,r=e.pattern||Zt.NO_FLIP,n=e.width||e.size||1,o=e.height||e.size||1,s=e.depth||e.size||1,a=e.tileWidth||e.tileSize||1,h=e.tileHeight||e.tileSize||1,u=e.alignHorizontal||0,l=e.alignVertical||0,c=0===e.sideOrientation?0:e.sideOrientation||dt.DEFAULTSIDE,f=0;f<6;f++)void 0===t[f]&&(t[f]=new _(0,0,1,1)),i&&void 0===i[f]&&(i[f]=new E(1,1,1,1));var d=n/2,g=o/2,v=s/2,y=[];for(f=0;f<2;f++)y[f]=dt.CreateTiledPlane({pattern:r,tileWidth:a,tileHeight:h,width:n,height:o,alignVertical:l,alignHorizontal:u,sideOrientation:c});for(f=2;f<4;f++)y[f]=dt.CreateTiledPlane({pattern:r,tileWidth:a,tileHeight:h,width:s,height:o,alignVertical:l,alignHorizontal:u,sideOrientation:c});var b=l;l===Zt.BOTTOM?b=Zt.TOP:l===Zt.TOP&&(b=Zt.BOTTOM);for(f=4;f<6;f++)y[f]=dt.CreateTiledPlane({pattern:r,tileWidth:a,tileHeight:h,width:n,height:s,alignVertical:b,alignHorizontal:u,sideOrientation:c});var T=[],x=[],A=[],M=[],P=[],C=[],S=[],I=[],O=0,R=0,D=0;for(f=0;f<6;f++){O=y[f].positions.length;C[f]=[],S[f]=[];for(var w=0;w<O/3;w++)C[f].push(new p(y[f].positions[3*w],y[f].positions[3*w+1],y[f].positions[3*w+2])),S[f].push(new p(y[f].normals[3*w],y[f].normals[3*w+1],y[f].normals[3*w+2]));R=y[f].uvs.length,I[f]=[];for(var L=0;L<R;L+=2)I[f][L]=t[f].x+(t[f].z-t[f].x)*y[f].uvs[L],I[f][L+1]=t[f].y+(t[f].w-t[f].y)*y[f].uvs[L+1];if(A=A.concat(I[f]),M=M.concat(y[f].indices.map((function(e){return e+D}))),D+=C[f].length,i)for(var F=0;F<4;F++)P.push(i[f].r,i[f].g,i[f].b,i[f].a)}var N=new p(0,0,v),B=m.RotationY(Math.PI);T=C[0].map((function(e){return p.TransformNormal(e,B).add(N)})).map((function(e){return[e.x,e.y,e.z]})).reduce((function(e,t){return e.concat(t)}),[]),x=S[0].map((function(e){return p.TransformNormal(e,B)})).map((function(e){return[e.x,e.y,e.z]})).reduce((function(e,t){return e.concat(t)}),[]),T=T.concat(C[1].map((function(e){return e.subtract(N)})).map((function(e){return[e.x,e.y,e.z]})).reduce((function(e,t){return e.concat(t)}),[])),x=x.concat(S[1].map((function(e){return[e.x,e.y,e.z]})).reduce((function(e,t){return e.concat(t)}),[]));var k=new p(d,0,0),U=m.RotationY(-Math.PI/2);T=T.concat(C[2].map((function(e){return p.TransformNormal(e,U).add(k)})).map((function(e){return[e.x,e.y,e.z]})).reduce((function(e,t){return e.concat(t)}),[])),x=x.concat(S[2].map((function(e){return p.TransformNormal(e,U)})).map((function(e){return[e.x,e.y,e.z]})).reduce((function(e,t){return e.concat(t)}),[]));var V=m.RotationY(Math.PI/2);T=T.concat(C[3].map((function(e){return p.TransformNormal(e,V).subtract(k)})).map((function(e){return[e.x,e.y,e.z]})).reduce((function(e,t){return e.concat(t)}),[])),x=x.concat(S[3].map((function(e){return p.TransformNormal(e,V)})).map((function(e){return[e.x,e.y,e.z]})).reduce((function(e,t){return e.concat(t)}),[]));var W=new p(0,g,0),z=m.RotationX(Math.PI/2);T=T.concat(C[4].map((function(e){return p.TransformNormal(e,z).add(W)})).map((function(e){return[e.x,e.y,e.z]})).reduce((function(e,t){return e.concat(t)}),[])),x=x.concat(S[4].map((function(e){return p.TransformNormal(e,z)})).map((function(e){return[e.x,e.y,e.z]})).reduce((function(e,t){return e.concat(t)}),[]));var G=m.RotationX(-Math.PI/2);T=T.concat(C[5].map((function(e){return p.TransformNormal(e,G).subtract(W)})).map((function(e){return[e.x,e.y,e.z]})).reduce((function(e,t){return e.concat(t)}),[])),x=x.concat(S[5].map((function(e){return p.TransformNormal(e,G)})).map((function(e){return[e.x,e.y,e.z]})).reduce((function(e,t){return e.concat(t)}),[])),dt._ComputeSides(c,T,M,x,A);var H=new dt;if(H.indices=M,H.positions=T,H.normals=x,H.uvs=A,i){var X=c===dt.DOUBLESIDE?P.concat(P):P;H.colors=X}return H};var hr=function(){function e(){}return e.CreateTiledBox=function(e,t,i){void 0===i&&(i=null);var r=new Zt(e,i);return t.sideOrientation=Zt._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,dt.CreateTiledBox(t).applyToMesh(r,t.updatable),r},e}();dt.CreateSphere=function(e){for(var t=e.segments||32,i=e.diameterX||e.diameter||1,r=e.diameterY||e.diameter||1,n=e.diameterZ||e.diameter||1,o=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,s=e.slice&&e.slice<=0?1:e.slice||1,a=0===e.sideOrientation?0:e.sideOrientation||dt.DEFAULTSIDE,h=!!e.dedupTopBottomIndices,u=new p(i/2,r/2,n/2),l=2+t,c=2*l,f=[],d=[],_=[],g=[],v=0;v<=l;v++){for(var y=v/l,b=y*Math.PI*s,T=0;T<=c;T++){var E=T/c,x=E*Math.PI*2*o,A=m.RotationZ(-b),M=m.RotationY(x),P=p.TransformCoordinates(p.Up(),A),C=p.TransformCoordinates(P,M),S=C.multiply(u),I=C.divide(u).normalize();d.push(S.x,S.y,S.z),_.push(I.x,I.y,I.z),g.push(E,y)}if(v>0)for(var O=d.length/3,R=O-2*(c+1);R+c+2<O;R++)h?(v>1&&(f.push(R),f.push(R+1),f.push(R+c+1)),(v<l||s<1)&&(f.push(R+c+1),f.push(R+1),f.push(R+c+2))):(f.push(R),f.push(R+1),f.push(R+c+1),f.push(R+c+1),f.push(R+1),f.push(R+c+2))}dt._ComputeSides(a,d,f,_,g,e.frontUVs,e.backUVs);var D=new dt;return D.indices=f,D.positions=d,D.normals=_,D.uvs=g,D},Zt.CreateSphere=function(e,t,i,r,n,o){var s={segments:t,diameterX:i,diameterY:i,diameterZ:i,sideOrientation:o,updatable:n};return ur.CreateSphere(e,s,r)};var ur=function(){function e(){}return e.CreateSphere=function(e,t,i){void 0===i&&(i=null);var r=new Zt(e,i);return t.sideOrientation=Zt._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,dt.CreateSphere(t).applyToMesh(r,t.updatable),r},e}();dt.CreateCylinder=function(e){var t=e.height||2,i=0===e.diameterTop?0:e.diameterTop||e.diameter||1,r=0===e.diameterBottom?0:e.diameterBottom||e.diameter||1;i=i||1e-5,r=r||1e-5;var n,o=e.tessellation||24,s=e.subdivisions||1,a=!!e.hasRings,h=!!e.enclose,u=0===e.cap?0:e.cap||Zt.CAP_ALL,l=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,c=0===e.sideOrientation?0:e.sideOrientation||dt.DEFAULTSIDE,f=e.faceUV||new Array(3),g=e.faceColors,m=2+(1+(1!==l&&h?2:0))*(a?s:1);for(n=0;n<m;n++)g&&void 0===g[n]&&(g[n]=new E(1,1,1,1));for(n=0;n<m;n++)f&&void 0===f[n]&&(f[n]=new _(0,0,1,1));var v,y,b,T,x,A,M=new Array,P=new Array,C=new Array,S=new Array,I=new Array,O=2*Math.PI*l/o,R=(r-i)/2/t,D=p.Zero(),w=p.Zero(),L=p.Zero(),F=p.Zero(),N=p.Zero(),B=Dt.Y,k=1,U=1,V=0,W=0;for(T=0;T<=s;T++)for(b=((y=T/s)*(i-r)+r)/2,k=a&&0!==T&&T!==s?2:1,A=0;A<k;A++){for(a&&(U+=A),h&&(U+=2*A),x=0;x<=o;x++)v=x*O,D.x=Math.cos(-v)*b,D.y=-t/2+y*t,D.z=Math.sin(-v)*b,0===i&&T===s?(w.x=C[C.length-3*(o+1)],w.y=C[C.length-3*(o+1)+1],w.z=C[C.length-3*(o+1)+2]):(w.x=D.x,w.z=D.z,w.y=Math.sqrt(w.x*w.x+w.z*w.z)*R,w.normalize()),0===x&&(L.copyFrom(D),F.copyFrom(w)),P.push(D.x,D.y,D.z),C.push(w.x,w.y,w.z),W=a?V!==U?f[U].y:f[U].w:f[U].y+(f[U].w-f[U].y)*y,S.push(f[U].x+(f[U].z-f[U].x)*x/o,W),g&&I.push(g[U].r,g[U].g,g[U].b,g[U].a);1!==l&&h&&(P.push(D.x,D.y,D.z),P.push(0,D.y,0),P.push(0,D.y,0),P.push(L.x,L.y,L.z),p.CrossToRef(B,w,N),N.normalize(),C.push(N.x,N.y,N.z,N.x,N.y,N.z),p.CrossToRef(F,B,N),N.normalize(),C.push(N.x,N.y,N.z,N.x,N.y,N.z),W=a?V!==U?f[U+1].y:f[U+1].w:f[U+1].y+(f[U+1].w-f[U+1].y)*y,S.push(f[U+1].x,W),S.push(f[U+1].z,W),W=a?V!==U?f[U+2].y:f[U+2].w:f[U+2].y+(f[U+2].w-f[U+2].y)*y,S.push(f[U+2].x,W),S.push(f[U+2].z,W),g&&(I.push(g[U+1].r,g[U+1].g,g[U+1].b,g[U+1].a),I.push(g[U+1].r,g[U+1].g,g[U+1].b,g[U+1].a),I.push(g[U+2].r,g[U+2].g,g[U+2].b,g[U+2].a),I.push(g[U+2].r,g[U+2].g,g[U+2].b,g[U+2].a))),V!==U&&(V=U)}var z=1!==l&&h?o+4:o;for(T=0,U=0;U<s;U++){var G=0,H=0,X=0,j=0;for(x=0;x<o;x++)G=T*(z+1)+x,H=(T+1)*(z+1)+x,X=T*(z+1)+(x+1),j=(T+1)*(z+1)+(x+1),M.push(G,H,X),M.push(j,X,H);1!==l&&h&&(M.push(G+2,H+2,X+2),M.push(j+2,X+2,H+2),M.push(G+4,H+4,X+4),M.push(j+4,X+4,H+4)),T=a?T+2:T+1}var K=function(e){var n=e?i/2:r/2;if(0!==n){var s,a,h,u=e?f[m-1]:f[0],c=null;g&&(c=e?g[m-1]:g[0]);var _=P.length/3,v=e?t/2:-t/2,y=new p(0,v,0);P.push(y.x,y.y,y.z),C.push(0,e?1:-1,0),S.push(u.x+.5*(u.z-u.x),u.y+.5*(u.w-u.y)),c&&I.push(c.r,c.g,c.b,c.a);var b=new d(.5,.5);for(h=0;h<=o;h++){s=2*Math.PI*h*l/o;var T=Math.cos(-s),E=Math.sin(-s);a=new p(T*n,v,E*n);var x=new d(T*b.x+.5,E*b.y+.5);P.push(a.x,a.y,a.z),C.push(0,e?1:-1,0),S.push(u.x+(u.z-u.x)*x.x,u.y+(u.w-u.y)*x.y),c&&I.push(c.r,c.g,c.b,c.a)}for(h=0;h<o;h++)e?(M.push(_),M.push(_+(h+2)),M.push(_+(h+1))):(M.push(_),M.push(_+(h+1)),M.push(_+(h+2)))}};u!==Zt.CAP_START&&u!==Zt.CAP_ALL||K(!1),u!==Zt.CAP_END&&u!==Zt.CAP_ALL||K(!0),dt._ComputeSides(c,P,M,C,S,e.frontUVs,e.backUVs);var Y=new dt;return Y.indices=M,Y.positions=P,Y.normals=C,Y.uvs=S,g&&(Y.colors=I),Y},Zt.CreateCylinder=function(e,t,i,r,n,o,s,a,h){void 0!==s&&s instanceof zi||(void 0!==s&&(h=a||Zt.DEFAULTSIDE,a=s),s=o,o=1);var u={height:t,diameterTop:i,diameterBottom:r,tessellation:n,subdivisions:o,sideOrientation:h,updatable:a};return lr.CreateCylinder(e,u,s)};var lr=function(){function e(){}return e.CreateCylinder=function(e,t,i){var r=new Zt(e,i);return t.sideOrientation=Zt._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,dt.CreateCylinder(t).applyToMesh(r,t.updatable),r},e}();dt.CreateTorus=function(e){for(var t=[],i=[],r=[],n=[],o=e.diameter||1,s=e.thickness||.5,a=e.tessellation||16,h=0===e.sideOrientation?0:e.sideOrientation||dt.DEFAULTSIDE,u=a+1,l=0;l<=a;l++)for(var c=l/a,f=l*Math.PI*2/a-Math.PI/2,_=m.Translation(o/2,0,0).multiply(m.RotationY(f)),g=0;g<=a;g++){var v=1-g/a,y=g*Math.PI*2/a+Math.PI,b=Math.cos(y),T=Math.sin(y),E=new p(b,T,0),x=E.scale(s/2),A=new d(c,v);x=p.TransformCoordinates(x,_),E=p.TransformNormal(E,_),i.push(x.x,x.y,x.z),r.push(E.x,E.y,E.z),n.push(A.x,A.y);var M=(l+1)%u,P=(g+1)%u;t.push(l*u+g),t.push(l*u+P),t.push(M*u+g),t.push(l*u+P),t.push(M*u+P),t.push(M*u+g)}dt._ComputeSides(h,i,t,r,n,e.frontUVs,e.backUVs);var C=new dt;return C.indices=t,C.positions=i,C.normals=r,C.uvs=n,C},Zt.CreateTorus=function(e,t,i,r,n,o,s){var a={diameter:t,thickness:i,tessellation:r,sideOrientation:s,updatable:o};return cr.CreateTorus(e,a,n)};var cr=function(){function e(){}return e.CreateTorus=function(e,t,i){var r=new Zt(e,i);return t.sideOrientation=Zt._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,dt.CreateTorus(t).applyToMesh(r,t.updatable),r},e}();dt.CreateTorusKnot=function(e){var t,i,r=new Array,n=new Array,o=new Array,s=new Array,a=e.radius||2,h=e.tube||.5,u=e.radialSegments||32,l=e.tubularSegments||32,c=e.p||2,f=e.q||3,d=0===e.sideOrientation?0:e.sideOrientation||dt.DEFAULTSIDE,_=function(e){var t=Math.cos(e),i=Math.sin(e),r=f/c*e,n=Math.cos(r),o=a*(2+n)*.5*t,s=a*(2+n)*i*.5,h=a*Math.sin(r)*.5;return new p(o,s,h)};for(t=0;t<=u;t++){var g=t%u/u*2*c*Math.PI,m=_(g),v=_(g+.01),y=v.subtract(m),b=v.add(m),T=p.Cross(y,b);for(b=p.Cross(T,y),T.normalize(),b.normalize(),i=0;i<l;i++){var E=i%l/l*2*Math.PI,x=-h*Math.cos(E),A=h*Math.sin(E);n.push(m.x+x*b.x+A*T.x),n.push(m.y+x*b.y+A*T.y),n.push(m.z+x*b.z+A*T.z),s.push(t/u),s.push(i/l)}}for(t=0;t<u;t++)for(i=0;i<l;i++){var M=(i+1)%l,P=t*l+i,C=(t+1)*l+i,S=(t+1)*l+M,I=t*l+M;r.push(I),r.push(C),r.push(P),r.push(I),r.push(S),r.push(C)}dt.ComputeNormals(n,r,o),dt._ComputeSides(d,n,r,o,s,e.frontUVs,e.backUVs);var O=new dt;return O.indices=r,O.positions=n,O.normals=o,O.uvs=s,O},Zt.CreateTorusKnot=function(e,t,i,r,n,o,s,a,h,u){var l={radius:t,tube:i,radialSegments:r,tubularSegments:n,p:o,q:s,sideOrientation:u,updatable:h};return fr.CreateTorusKnot(e,l,a)};var fr=function(){function e(){}return e.CreateTorusKnot=function(e,t,i){var r=new Zt(e,i);return t.sideOrientation=Zt._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,dt.CreateTorusKnot(t).applyToMesh(r,t.updatable),r},e}();dt.CreateLineSystem=function(e){for(var t=[],i=[],r=e.lines,n=e.colors,o=[],s=0,a=0;a<r.length;a++)for(var h=r[a],u=0;u<h.length;u++){if(i.push(h[u].x,h[u].y,h[u].z),n){var l=n[a];o.push(l[u].r,l[u].g,l[u].b,l[u].a)}u>0&&(t.push(s-1),t.push(s)),s++}var c=new dt;return c.indices=t,c.positions=i,n&&(c.colors=o),c},dt.CreateDashedLines=function(e){var t,i,r=e.dashSize||3,n=e.gapSize||1,o=e.dashNb||200,s=e.points,a=new Array,h=new Array,u=p.Zero(),l=0,c=0,f=0,d=0,_=0;for(_=0;_<s.length-1;_++)s[_+1].subtractToRef(s[_],u),l+=u.length();for(i=r*(t=l/o)/(r+n),_=0;_<s.length-1;_++){s[_+1].subtractToRef(s[_],u),c=Math.floor(u.length()/t),u.normalize();for(var g=0;g<c;g++)f=t*g,a.push(s[_].x+f*u.x,s[_].y+f*u.y,s[_].z+f*u.z),a.push(s[_].x+(f+i)*u.x,s[_].y+(f+i)*u.y,s[_].z+(f+i)*u.z),h.push(d,d+1),d+=2}var m=new dt;return m.positions=a,m.indices=h,m},Zt.CreateLines=function(e,t,i,r,n){void 0===i&&(i=null),void 0===r&&(r=!1),void 0===n&&(n=null);var o={points:t,updatable:r,instance:n};return dr.CreateLines(e,o,i)},Zt.CreateDashedLines=function(e,t,i,r,n,o,s,a){void 0===o&&(o=null);var h={points:t,dashSize:i,gapSize:r,dashNb:n,updatable:s,instance:a};return dr.CreateDashedLines(e,h,o)};var dr=function(){function e(){}return e.CreateLineSystem=function(e,t,i){var r=t.instance,n=t.lines,o=t.colors;if(r){var s,a,h=r.getVerticesData(ft.PositionKind);o&&(s=r.getVerticesData(ft.ColorKind));for(var u=0,l=0,c=0;c<n.length;c++)for(var f=n[c],d=0;d<f.length;d++)h[u]=f[d].x,h[u+1]=f[d].y,h[u+2]=f[d].z,o&&s&&(a=o[c],s[l]=a[d].r,s[l+1]=a[d].g,s[l+2]=a[d].b,s[l+3]=a[d].a,l+=4),u+=3;return r.updateVerticesData(ft.PositionKind,h,!1,!1),o&&s&&r.updateVerticesData(ft.ColorKind,s,!1,!1),r}var p=new rr(e,i,null,void 0,void 0,!!o,t.useVertexAlpha);return dt.CreateLineSystem(t).applyToMesh(p,t.updatable),p},e.CreateLines=function(t,i,r){void 0===r&&(r=null);var n=i.colors?[i.colors]:null;return e.CreateLineSystem(t,{lines:[i.points],updatable:i.updatable,instance:i.instance,colors:n,useVertexAlpha:i.useVertexAlpha},r)},e.CreateDashedLines=function(e,t,i){void 0===i&&(i=null);var r=t.points,n=t.instance,o=t.gapSize||1,s=t.dashSize||3;if(n){return n.updateMeshPositions((function(e){var t,i,o=p.Zero(),s=e.length/6,a=0,h=0,u=0,l=0,c=0,f=0;for(c=0;c<r.length-1;c++)r[c+1].subtractToRef(r[c],o),a+=o.length();t=a/s;var d=n._creationDataStorage.dashSize;for(i=d*t/(d+n._creationDataStorage.gapSize),c=0;c<r.length-1;c++)for(r[c+1].subtractToRef(r[c],o),h=Math.floor(o.length()/t),o.normalize(),f=0;f<h&&l<e.length;)u=t*f,e[l]=r[c].x+u*o.x,e[l+1]=r[c].y+u*o.y,e[l+2]=r[c].z+u*o.z,e[l+3]=r[c].x+(u+i)*o.x,e[l+4]=r[c].y+(u+i)*o.y,e[l+5]=r[c].z+(u+i)*o.z,l+=6,f++;for(;l<e.length;)e[l]=r[c].x,e[l+1]=r[c].y,e[l+2]=r[c].z,l+=3}),!1),n}var a=new rr(e,i,null,void 0,void 0,void 0,t.useVertexAlpha);return dt.CreateDashedLines(t).applyToMesh(a,t.updatable),a._creationDataStorage=new Xt,a._creationDataStorage.dashSize=s,a._creationDataStorage.gapSize=o,a},e}(),pr=function(e){function i(t,i){var r=e.call(this,t.x,t.y)||this;return r.index=i,r}return t(i,e),i}(d),_r=function(){function e(){this.elements=new Array}return e.prototype.add=function(e){var t=this,i=new Array;return e.forEach((function(e){var r=new pr(e,t.elements.length);i.push(r),t.elements.push(r)})),i},e.prototype.computeBounds=function(){var e=new d(this.elements[0].x,this.elements[0].y),t=new d(this.elements[0].x,this.elements[0].y);return this.elements.forEach((function(i){i.x<e.x?e.x=i.x:i.x>t.x&&(t.x=i.x),i.y<e.y?e.y=i.y:i.y>t.y&&(t.y=i.y)})),{min:e,max:t,width:t.x-e.x,height:t.y-e.y}},e}(),gr=function(){function e(e,t,i,r){var n;void 0===r&&(r=earcut),this._points=new _r,this._outlinepoints=new _r,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=r,this._name=e,this._scene=i||Ot.LastCreatedScene,n=t instanceof si?t.getPoints():t,this._addToepoint(n),this._points.add(n),this._outlinepoints.add(n),void 0===this.bjsEarcut&&q.Warn("Earcut was not found, the polygon will not be built.")}return e.prototype._addToepoint=function(e){for(var t=0,i=e;t<i.length;t++){var r=i[t];this._epoints.push(r.x,r.y)}},e.prototype.addHole=function(e){this._points.add(e);var t=new _r;return t.add(e),this._holes.push(t),this._eholes.push(this._epoints.length/2),this._addToepoint(e),this},e.prototype.build=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=0);var i=new Zt(this._name,this._scene),r=this.buildVertexData(t);return i.setVerticesData(ft.PositionKind,r.positions,e),i.setVerticesData(ft.NormalKind,r.normals,e),i.setVerticesData(ft.UVKind,r.uvs,e),i.setIndices(r.indices),i},e.prototype.buildVertexData=function(e){var t=this;void 0===e&&(e=0);var i=new dt,r=new Array,n=new Array,o=new Array,s=this._points.computeBounds();this._points.elements.forEach((function(e){r.push(0,1,0),n.push(e.x,0,e.y),o.push((e.x-s.min.x)/s.width,(e.y-s.min.y)/s.height)}));for(var a=new Array,h=this.bjsEarcut(this._epoints,this._eholes,2),u=0;u<h.length;u++)a.push(h[u]);if(e>0){var l=n.length/3;this._points.elements.forEach((function(t){r.push(0,-1,0),n.push(t.x,-e,t.y),o.push(1-(t.x-s.min.x)/s.width,1-(t.y-s.min.y)/s.height)}));var c=a.length;for(u=0;u<c;u+=3){var f=a[u+0],d=a[u+1],p=a[u+2];a.push(p+l),a.push(d+l),a.push(f+l)}this.addSide(n,r,o,a,s,this._outlinepoints,e,!1),this._holes.forEach((function(i){t.addSide(n,r,o,a,s,i,e,!0)}))}return i.indices=a,i.positions=n,i.normals=r,i.uvs=o,i},e.prototype.addSide=function(e,t,i,r,n,o,s,a){for(var h=e.length/3,u=0,l=0;l<o.elements.length;l++){var c,f=o.elements[l];c=l+1>o.elements.length-1?o.elements[0]:o.elements[l+1],e.push(f.x,0,f.y),e.push(f.x,-s,f.y),e.push(c.x,0,c.y),e.push(c.x,-s,c.y);var d=new p(f.x,0,f.y),_=new p(c.x,0,c.y).subtract(d),g=new p(0,1,0),m=p.Cross(_,g);m=m.normalize(),i.push(u/n.width,0),i.push(u/n.width,1),u+=_.length(),i.push(u/n.width,0),i.push(u/n.width,1),a?(t.push(m.x,m.y,m.z),t.push(m.x,m.y,m.z),t.push(m.x,m.y,m.z),t.push(m.x,m.y,m.z),r.push(h),r.push(h+2),r.push(h+1),r.push(h+1),r.push(h+2),r.push(h+3)):(t.push(-m.x,-m.y,-m.z),t.push(-m.x,-m.y,-m.z),t.push(-m.x,-m.y,-m.z),t.push(-m.x,-m.y,-m.z),r.push(h),r.push(h+1),r.push(h+2),r.push(h+1),r.push(h+3),r.push(h+2)),h+=4}},e}();dt.CreatePolygon=function(e,t,i,r,n,o,s){for(var a=i||new Array(3),h=r,u=[],l=s||!1,c=0;c<3;c++)void 0===a[c]&&(a[c]=new _(0,0,1,1)),h&&void 0===h[c]&&(h[c]=new E(1,1,1,1));var f=e.getVerticesData(ft.PositionKind),d=e.getVerticesData(ft.NormalKind),p=e.getVerticesData(ft.UVKind),g=e.getIndices(),m=f.length/9,v=0,y=0,b=0,T=0,x=[0];if(l)for(var A=m;A<f.length/3;A+=4)y=f[3*(A+2)]-f[3*A],b=f[3*(A+2)+2]-f[3*A+2],T+=Math.sqrt(y*y+b*b),x.push(T);A=0;for(var M=0,P=0;P<d.length;P+=3)Math.abs(d[P+1])<.001&&(M=1),Math.abs(d[P+1]-1)<.001&&(M=0),Math.abs(d[P+1]+1)<.001&&(M=2),A=P/3,1===M?(v=A-m,p[2*A]=v%4<1.5?l?a[M].x+(a[M].z-a[M].x)*x[Math.floor(v/4)]/T:a[M].x:l?a[M].x+(a[M].z-a[M].x)*x[Math.floor(v/4)+1]/T:a[M].z,p[2*A+1]=v%2==0?a[M].w:a[M].y):(p[2*A]=(1-p[2*A])*a[M].x+p[2*A]*a[M].z,p[2*A+1]=(1-p[2*A+1])*a[M].y+p[2*A+1]*a[M].w),h&&u.push(h[M].r,h[M].g,h[M].b,h[M].a);dt._ComputeSides(t,f,g,d,p,n,o);var C=new dt;if(C.indices=g,C.positions=f,C.normals=d,C.uvs=p,h){var S=t===dt.DOUBLESIDE?u.concat(u):u;C.colors=S}return C},Zt.CreatePolygon=function(e,t,i,r,n,o,s){void 0===s&&(s=earcut);var a={shape:t,holes:r,updatable:n,sideOrientation:o};return mr.CreatePolygon(e,a,i,s)},Zt.ExtrudePolygon=function(e,t,i,r,n,o,s,a){void 0===a&&(a=earcut);var h={shape:t,holes:n,depth:i,updatable:o,sideOrientation:s};return mr.ExtrudePolygon(e,h,r,a)};var mr=function(){function e(){}return e.CreatePolygon=function(e,t,i,r){void 0===i&&(i=null),void 0===r&&(r=earcut),t.sideOrientation=Zt._GetDefaultSideOrientation(t.sideOrientation);for(var n=t.shape,o=t.holes||[],s=t.depth||0,a=[],h=[],u=0;u<n.length;u++)a[u]=new d(n[u].x,n[u].z);a[0].equalsWithEpsilon(a[a.length-1],1e-8)&&a.pop();for(var l=new gr(e,a,i||V.LastCreatedScene,r),c=0;c<o.length;c++){h=[];for(var f=0;f<o[c].length;f++)h.push(new d(o[c][f].x,o[c][f].z));l.addHole(h)}var p=l.build(t.updatable,s);return p._originalBuilderSideOrientation=t.sideOrientation,dt.CreatePolygon(p,t.sideOrientation,t.faceUV,t.faceColors,t.frontUVs,t.backUVs,t.wrap).applyToMesh(p,t.updatable),p},e.ExtrudePolygon=function(t,i,r,n){return void 0===r&&(r=null),void 0===n&&(n=earcut),e.CreatePolygon(t,i,r,n)},e}();Zt.ExtrudeShape=function(e,t,i,r,n,o,s,a,h,u){void 0===s&&(s=null);var l={shape:t,path:i,scale:r,rotation:n,cap:0===o?0:o||Zt.NO_CAP,sideOrientation:h,instance:u,updatable:a};return vr.ExtrudeShape(e,l,s)},Zt.ExtrudeShapeCustom=function(e,t,i,r,n,o,s,a,h,u,l,c){var f={shape:t,path:i,scaleFunction:r,rotationFunction:n,ribbonCloseArray:o,ribbonClosePath:s,cap:0===a?0:a||Zt.NO_CAP,sideOrientation:l,instance:c,updatable:u};return vr.ExtrudeShapeCustom(e,f,h)};var vr=function(){function e(){}return e.ExtrudeShape=function(t,i,r){void 0===r&&(r=null);var n=i.path,o=i.shape,s=i.scale||1,a=i.rotation||0,h=0===i.cap?0:i.cap||Zt.NO_CAP,u=i.updatable,l=Zt._GetDefaultSideOrientation(i.sideOrientation),c=i.instance||null,f=i.invertUV||!1;return e._ExtrudeShapeGeneric(t,o,n,s,a,null,null,!1,!1,h,!1,r,!!u,l,c,f,i.frontUVs||null,i.backUVs||null)},e.ExtrudeShapeCustom=function(t,i,r){void 0===r&&(r=null);var n=i.path,o=i.shape,s=i.scaleFunction||function(){return 1},a=i.rotationFunction||function(){return 0},h=i.ribbonCloseArray||!1,u=i.ribbonClosePath||!1,l=0===i.cap?0:i.cap||Zt.NO_CAP,c=i.updatable,f=Zt._GetDefaultSideOrientation(i.sideOrientation),d=i.instance,p=i.invertUV||!1;return e._ExtrudeShapeGeneric(t,o,n,null,null,s,a,h,u,l,!0,r,!!c,f,d||null,p,i.frontUVs||null,i.backUVs||null)},e._ExtrudeShapeGeneric=function(e,t,i,r,n,o,s,a,h,u,l,c,f,d,_,g,v,b){var T,E,x=function(e,t,i,r,n,o,s,a,h,u){for(var l=i.getTangents(),c=i.getNormals(),f=i.getBinormals(),d=i.getDistances(),_=0,g=u&&a?a:function(){return null!==o?o:0},v=u&&s?s:function(){return null!==n?n:1},b=h===Zt.NO_CAP||h===Zt.CAP_END?0:2,T=y.Matrix[0],E=0;E<t.length;E++){for(var x=new Array,A=g(E,d[E]),M=v(E,d[E]),P=0;P<e.length;P++){m.RotationAxisToRef(l[E],_,T);var C=l[E].scale(e[P].z).add(c[E].scale(e[P].x)).add(f[E].scale(e[P].y)),S=x[P]?x[P]:p.Zero();p.TransformCoordinatesToRef(C,T,S),S.scaleInPlace(M).addInPlace(t[E]),x[P]=S}r[b]=x,_+=A,b++}var I=function(e){var t,i=Array(),r=p.Zero();for(t=0;t<e.length;t++)r.addInPlace(e[t]);for(r.scaleInPlace(1/e.length),t=0;t<e.length;t++)i.push(r);return i};switch(h){case Zt.NO_CAP:break;case Zt.CAP_START:r[0]=I(r[2]),r[1]=r[2];break;case Zt.CAP_END:r[b]=r[b-1],r[b+1]=I(r[b-1]);break;case Zt.CAP_ALL:r[0]=I(r[2]),r[1]=r[2],r[b]=r[b-1],r[b+1]=I(r[b-1])}return r};if(_){var A=_._creationDataStorage;return T=A.path3D.update(i),E=x(t,i,A.path3D,A.pathArray,r,n,o,s,A.cap,l),_=Zt.CreateRibbon("",E,!1,!1,0,c||void 0,!1,0,_)}E=x(t,i,T=new ai(i),new Array,r,n,o,s,u=u<0||u>3?0:u,l);var M=or.CreateRibbon(e,{pathArray:E,closeArray:a,closePath:h,updatable:f,sideOrientation:d,invertUV:g,frontUVs:v||void 0,backUVs:b||void 0},c);return M._creationDataStorage.pathArray=E,M._creationDataStorage.path3D=T,M._creationDataStorage.cap=u,M},e}();Zt.CreateLathe=function(e,t,i,r,n,o,s){var a={shape:t,radius:i,tessellation:r,sideOrientation:s,updatable:o};return yr.CreateLathe(e,a,n)};var yr=function(){function e(){}return e.CreateLathe=function(e,t,i){void 0===i&&(i=null);var r,n=t.arc?t.arc<=0||t.arc>1?1:t.arc:1,o=void 0===t.closed||t.closed,s=t.shape,a=t.radius||1,h=t.tessellation||64,u=t.clip||0,l=t.updatable,c=Zt._GetDefaultSideOrientation(t.sideOrientation),f=t.cap||Zt.NO_CAP,d=2*Math.PI,_=new Array,g=t.invertUV||!1,m=0,v=0,y=d/h*n,b=new Array;for(m=0;m<=h-u;m++){b=[];for(f!=Zt.CAP_START&&f!=Zt.CAP_ALL||(b.push(new p(0,s[0].y,0)),b.push(new p(Math.cos(m*y)*s[0].x*a,s[0].y,Math.sin(m*y)*s[0].x*a))),v=0;v<s.length;v++)r=new p(Math.cos(m*y)*s[v].x*a,s[v].y,Math.sin(m*y)*s[v].x*a),b.push(r);f!=Zt.CAP_END&&f!=Zt.CAP_ALL||(b.push(new p(Math.cos(m*y)*s[s.length-1].x*a,s[s.length-1].y,Math.sin(m*y)*s[s.length-1].x*a)),b.push(new p(0,s[s.length-1].y,0))),_.push(b)}return or.CreateRibbon(e,{pathArray:_,closeArray:o,sideOrientation:c,updatable:l,invertUV:g,frontUVs:t.frontUVs,backUVs:t.backUVs},i)},e}();dt.CreatePlane=function(e){var t=[],i=[],r=[],n=[],o=e.width||e.size||1,s=e.height||e.size||1,a=0===e.sideOrientation?0:e.sideOrientation||dt.DEFAULTSIDE,h=o/2,u=s/2;i.push(-h,-u,0),r.push(0,0,-1),n.push(0,0),i.push(h,-u,0),r.push(0,0,-1),n.push(1,0),i.push(h,u,0),r.push(0,0,-1),n.push(1,1),i.push(-h,u,0),r.push(0,0,-1),n.push(0,1),t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),dt._ComputeSides(a,i,t,r,n,e.frontUVs,e.backUVs);var l=new dt;return l.indices=t,l.positions=i,l.normals=r,l.uvs=n,l},Zt.CreatePlane=function(e,t,i,r,n){var o={size:t,width:t,height:t,sideOrientation:n,updatable:r};return br.CreatePlane(e,o,i)};var br=function(){function e(){}return e.CreatePlane=function(e,t,i){void 0===i&&(i=null);var r=new Zt(e,i);return t.sideOrientation=Zt._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,dt.CreatePlane(t).applyToMesh(r,t.updatable),t.sourcePlane&&(r.translate(t.sourcePlane.normal,-t.sourcePlane.d),r.setDirection(t.sourcePlane.normal.scale(-1))),r},e}();dt.CreateTiledPlane=function(e){var t=e.pattern||Zt.NO_FLIP,i=e.tileWidth||e.tileSize||1,r=e.tileHeight||e.tileSize||1,n=e.alignHorizontal||0,o=e.alignVertical||0,s=e.width||e.size||1,a=Math.floor(s/i),h=s-a*i,u=e.height||e.size||1,l=Math.floor(u/r),c=u-l*r,f=i*a/2,d=r*l/2,p=0,_=0,g=0,m=0,v=0,y=0;if(h>0||c>0){g=-f,m=-d;v=f,y=d;switch(n){case Zt.CENTER:g-=h/=2,v+=h;break;case Zt.LEFT:v+=h,p=-h/2;break;case Zt.RIGHT:g-=h,p=h/2}switch(o){case Zt.CENTER:m-=c/=2,y+=c;break;case Zt.BOTTOM:y+=c,_=-c/2;break;case Zt.TOP:m-=c,_=c/2}}var b=[],T=[],E=[];E[0]=[0,0,1,0,1,1,0,1],E[1]=[0,0,1,0,1,1,0,1],t!==Zt.ROTATE_TILE&&t!==Zt.ROTATE_ROW||(E[1]=[1,1,0,1,0,0,1,0]),t!==Zt.FLIP_TILE&&t!==Zt.FLIP_ROW||(E[1]=[1,0,0,0,0,1,1,1]),t!==Zt.FLIP_N_ROTATE_TILE&&t!==Zt.FLIP_N_ROTATE_ROW||(E[1]=[0,1,1,1,1,0,0,0]);for(var x=[],A=[],M=[],P=0,C=0;C<l;C++)for(var S=0;S<a;S++)b.push(S*i-f+p,C*r-d+_,0),b.push((S+1)*i-f+p,C*r-d+_,0),b.push((S+1)*i-f+p,(C+1)*r-d+_,0),b.push(S*i-f+p,(C+1)*r-d+_,0),M.push(P,P+1,P+3,P+1,P+2,P+3),x=t===Zt.FLIP_TILE||t===Zt.ROTATE_TILE||t===Zt.FLIP_N_ROTATE_TILE?x.concat(E[(S%2+C%2)%2]):t===Zt.FLIP_ROW||t===Zt.ROTATE_ROW||t===Zt.FLIP_N_ROTATE_ROW?x.concat(E[C%2]):x.concat(E[0]),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),P+=4;if(h>0||c>0){var I,O,R,D,w=c>0&&(o===Zt.CENTER||o===Zt.TOP),L=c>0&&(o===Zt.CENTER||o===Zt.BOTTOM),F=h>0&&(n===Zt.CENTER||n===Zt.RIGHT),N=h>0&&(n===Zt.CENTER||n===Zt.LEFT),B=[];if(w&&F&&(b.push(g+p,m+_,0),b.push(-f+p,m+_,0),b.push(-f+p,m+c+_,0),b.push(g+p,m+c+_,0),M.push(P,P+1,P+3,P+1,P+2,P+3),P+=4,B=[I=1-h/i,O=1-c/r,R=1,O,R,D=1,I,D],t===Zt.ROTATE_ROW&&(B=[1-I,1-O,1-R,1-O,1-R,1-D,1-I,1-D]),t===Zt.FLIP_ROW&&(B=[1-I,O,1-R,O,1-R,D,1-I,D]),t===Zt.FLIP_N_ROTATE_ROW&&(B=[I,1-O,R,1-O,R,1-D,I,1-D]),x=x.concat(B),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),w&&N&&(b.push(f+p,m+_,0),b.push(v+p,m+_,0),b.push(v+p,m+c+_,0),b.push(f+p,m+c+_,0),M.push(P,P+1,P+3,P+1,P+2,P+3),P+=4,B=[I=0,O=1-c/r,R=h/i,O,R,D=1,I,D],(t===Zt.ROTATE_ROW||t===Zt.ROTATE_TILE&&a%2==0)&&(B=[1-I,1-O,1-R,1-O,1-R,1-D,1-I,1-D]),(t===Zt.FLIP_ROW||t===Zt.FLIP_TILE&&a%2==0)&&(B=[1-I,O,1-R,O,1-R,D,1-I,D]),(t===Zt.FLIP_N_ROTATE_ROW||t===Zt.FLIP_N_ROTATE_TILE&&a%2==0)&&(B=[I,1-O,R,1-O,R,1-D,I,1-D]),x=x.concat(B),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),L&&F&&(b.push(g+p,d+_,0),b.push(-f+p,d+_,0),b.push(-f+p,y+_,0),b.push(g+p,y+_,0),M.push(P,P+1,P+3,P+1,P+2,P+3),P+=4,B=[I=1-h/i,O=0,R=1,O,R,D=c/r,I,D],(t===Zt.ROTATE_ROW&&l%2==1||t===Zt.ROTATE_TILE&&l%1==0)&&(B=[1-I,1-O,1-R,1-O,1-R,1-D,1-I,1-D]),(t===Zt.FLIP_ROW&&l%2==1||t===Zt.FLIP_TILE&&l%2==0)&&(B=[1-I,O,1-R,O,1-R,D,1-I,D]),(t===Zt.FLIP_N_ROTATE_ROW&&l%2==1||t===Zt.FLIP_N_ROTATE_TILE&&l%2==0)&&(B=[I,1-O,R,1-O,R,1-D,I,1-D]),x=x.concat(B),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),L&&N&&(b.push(f+p,d+_,0),b.push(v+p,d+_,0),b.push(v+p,y+_,0),b.push(f+p,y+_,0),M.push(P,P+1,P+3,P+1,P+2,P+3),P+=4,B=[I=0,O=0,R=h/i,O,R,D=c/r,I,D],(t===Zt.ROTATE_ROW&&l%2==1||t===Zt.ROTATE_TILE&&(l+a)%2==1)&&(B=[1-I,1-O,1-R,1-O,1-R,1-D,1-I,1-D]),(t===Zt.FLIP_ROW&&l%2==1||t===Zt.FLIP_TILE&&(l+a)%2==1)&&(B=[1-I,O,1-R,O,1-R,D,1-I,D]),(t===Zt.FLIP_N_ROTATE_ROW&&l%2==1||t===Zt.FLIP_N_ROTATE_TILE&&(l+a)%2==1)&&(B=[I,1-O,R,1-O,R,1-D,I,1-D]),x=x.concat(B),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),w){var k=[];I=0,O=1-c/r,R=1,D=1,k[0]=[I,O,R,O,R,D,I,D],k[1]=[I,O,R,O,R,D,I,D],t!==Zt.ROTATE_TILE&&t!==Zt.ROTATE_ROW||(k[1]=[1-I,1-O,1-R,1-O,1-R,1-D,1-I,1-D]),t!==Zt.FLIP_TILE&&t!==Zt.FLIP_ROW||(k[1]=[1-I,O,1-R,O,1-R,D,1-I,D]),t!==Zt.FLIP_N_ROTATE_TILE&&t!==Zt.FLIP_N_ROTATE_ROW||(k[1]=[I,1-O,R,1-O,R,1-D,I,1-D]);for(S=0;S<a;S++)b.push(S*i-f+p,m+_,0),b.push((S+1)*i-f+p,m+_,0),b.push((S+1)*i-f+p,m+c+_,0),b.push(S*i-f+p,m+c+_,0),M.push(P,P+1,P+3,P+1,P+2,P+3),P+=4,x=t===Zt.FLIP_TILE||t===Zt.ROTATE_TILE||t===Zt.FLIP_N_ROTATE_TILE?x.concat(k[(S+1)%2]):t===Zt.FLIP_ROW||t===Zt.ROTATE_ROW||t===Zt.FLIP_N_ROTATE_ROW?x.concat(k[1]):x.concat(k[0]),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(L){var U=[];I=0,O=0,R=1,D=c/r,U[0]=[I,O,R,O,R,D,I,D],U[1]=[I,O,R,O,R,D,I,D],t!==Zt.ROTATE_TILE&&t!==Zt.ROTATE_ROW||(U[1]=[1-I,1-O,1-R,1-O,1-R,1-D,1-I,1-D]),t!==Zt.FLIP_TILE&&t!==Zt.FLIP_ROW||(U[1]=[1-I,O,1-R,O,1-R,D,1-I,D]),t!==Zt.FLIP_N_ROTATE_TILE&&t!==Zt.FLIP_N_ROTATE_ROW||(U[1]=[I,1-O,R,1-O,R,1-D,I,1-D]);for(S=0;S<a;S++)b.push(S*i-f+p,y-c+_,0),b.push((S+1)*i-f+p,y-c+_,0),b.push((S+1)*i-f+p,y+_,0),b.push(S*i-f+p,y+_,0),M.push(P,P+1,P+3,P+1,P+2,P+3),P+=4,x=t===Zt.FLIP_TILE||t===Zt.ROTATE_TILE||t===Zt.FLIP_N_ROTATE_TILE?x.concat(U[(S+l)%2]):t===Zt.FLIP_ROW||t===Zt.ROTATE_ROW||t===Zt.FLIP_N_ROTATE_ROW?x.concat(U[l%2]):x.concat(U[0]),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(F){var V=[];I=1-h/i,O=0,R=1,D=1,V[0]=[I,O,R,O,R,D,I,D],V[1]=[I,O,R,O,R,D,I,D],t!==Zt.ROTATE_TILE&&t!==Zt.ROTATE_ROW||(V[1]=[1-I,1-O,1-R,1-O,1-R,1-D,1-I,1-D]),t!==Zt.FLIP_TILE&&t!==Zt.FLIP_ROW||(V[1]=[1-I,O,1-R,O,1-R,D,1-I,D]),t!==Zt.FLIP_N_ROTATE_TILE&&t!==Zt.FLIP_N_ROTATE_ROW||(V[1]=[I,1-O,R,1-O,R,1-D,I,1-D]);for(C=0;C<l;C++)b.push(g+p,C*r-d+_,0),b.push(g+h+p,C*r-d+_,0),b.push(g+h+p,(C+1)*r-d+_,0),b.push(g+p,(C+1)*r-d+_,0),M.push(P,P+1,P+3,P+1,P+2,P+3),P+=4,x=t===Zt.FLIP_TILE||t===Zt.ROTATE_TILE||t===Zt.FLIP_N_ROTATE_TILE?x.concat(V[(C+1)%2]):t===Zt.FLIP_ROW||t===Zt.ROTATE_ROW||t===Zt.FLIP_N_ROTATE_ROW?x.concat(V[C%2]):x.concat(V[0]),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(N){var W=[];I=0,O=0,R=h/r,D=1,W[0]=[I,O,R,O,R,D,I,D],W[1]=[I,O,R,O,R,D,I,D],t!==Zt.ROTATE_TILE&&t!==Zt.ROTATE_ROW||(W[1]=[1-I,1-O,1-R,1-O,1-R,1-D,1-I,1-D]),t!==Zt.FLIP_TILE&&t!==Zt.FLIP_ROW||(W[1]=[1-I,O,1-R,O,1-R,D,1-I,D]),t!==Zt.FLIP_N_ROTATE_TILE&&t!==Zt.FLIP_N_ROTATE_ROW||(W[1]=[I,1-O,R,1-O,R,1-D,I,1-D]);for(C=0;C<l;C++)b.push(v-h+p,C*r-d+_,0),b.push(v+p,C*r-d+_,0),b.push(v+p,(C+1)*r-d+_,0),b.push(v-h+p,(C+1)*r-d+_,0),M.push(P,P+1,P+3,P+1,P+2,P+3),P+=4,x=t===Zt.FLIP_TILE||t===Zt.ROTATE_TILE||t===Zt.FLIP_N_ROTATE_TILE?x.concat(W[(C+a)%2]):t===Zt.FLIP_ROW||t===Zt.ROTATE_ROW||t===Zt.FLIP_N_ROTATE_ROW?x.concat(W[C%2]):x.concat(W[0]),A.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),T.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}var z=0===e.sideOrientation?0:e.sideOrientation||dt.DEFAULTSIDE;dt._ComputeSides(z,b,M,T,x,e.frontUVs,e.backUVs);var G=new dt;G.indices=M,G.positions=b,G.normals=T,G.uvs=x;var H=z===dt.DOUBLESIDE?A.concat(A):A;return G.colors=H,G};var Tr=function(){function e(){}return e.CreateTiledPlane=function(e,t,i){void 0===i&&(i=null);var r=new Zt(e,i);return t.sideOrientation=Zt._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,dt.CreateTiledPlane(t).applyToMesh(r,t.updatable),r},e}();Zt._GroundMeshParser=function(e,t){return Er.Parse(e,t)};var Er=function(e){function i(t,i){var r=e.call(this,t,i)||this;return r.generateOctree=!1,r}return t(i,e),i.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(i.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!1,configurable:!0}),i.prototype.optimize=function(e,t){void 0===t&&(t=32),this._subdivisionsX=e,this._subdivisionsY=e,this.subdivide(e);this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(t)},i.prototype.getHeightAtCoordinates=function(e,t){var i=this.getWorldMatrix(),r=y.Matrix[5];i.invertToRef(r);var n=y.Vector3[8];if(p.TransformCoordinatesFromFloatsToRef(e,0,t,r,n),e=n.x,t=n.z,e<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var o=this._getFacetAt(e,t),s=-(o.x*e+o.z*t+o.w)/o.y;return p.TransformCoordinatesFromFloatsToRef(0,s,0,i,n),n.y},i.prototype.getNormalAtCoordinates=function(e,t){var i=new p(0,1,0);return this.getNormalAtCoordinatesToRef(e,t,i),i},i.prototype.getNormalAtCoordinatesToRef=function(e,t,i){var r=this.getWorldMatrix(),n=y.Matrix[5];r.invertToRef(n);var o=y.Vector3[8];if(p.TransformCoordinatesFromFloatsToRef(e,0,t,n,o),e=o.x,t=o.z,e<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var s=this._getFacetAt(e,t);return p.TransformNormalFromFloatsToRef(s.x,s.y,s.z,r,i),this},i.prototype.updateCoordinateHeights=function(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this},i.prototype._getFacetAt=function(e,t){var i=Math.floor((e+this._maxX)*this._subdivisionsX/this._width),r=Math.floor(-(t+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),n=this._heightQuads[r*this._subdivisionsX+i];return t<n.slope.x*e+n.slope.y?n.facet1:n.facet2},i.prototype._initHeightQuads=function(){var e=this._subdivisionsX,t=this._subdivisionsY;this._heightQuads=new Array;for(var i=0;i<t;i++)for(var r=0;r<e;r++){var n={slope:d.Zero(),facet1:new _(0,0,0,0),facet2:new _(0,0,0,0)};this._heightQuads[i*e+r]=n}return this},i.prototype._computeHeightQuads=function(){var e=this.getVerticesData(ft.PositionKind);if(!e)return this;for(var t=y.Vector3[3],i=y.Vector3[2],r=y.Vector3[1],n=y.Vector3[0],o=y.Vector3[4],s=y.Vector3[5],a=y.Vector3[6],h=y.Vector3[7],u=y.Vector3[8],l=0,c=0,f=0,d=0,_=0,g=0,m=0,v=this._subdivisionsX,b=this._subdivisionsY,T=0;T<b;T++)for(var E=0;E<v;E++){l=3*E,c=T*(v+1)*3,f=(T+1)*(v+1)*3,t.x=e[c+l],t.y=e[c+l+1],t.z=e[c+l+2],i.x=e[c+l+3],i.y=e[c+l+4],i.z=e[c+l+5],r.x=e[f+l],r.y=e[f+l+1],r.z=e[f+l+2],n.x=e[f+l+3],n.y=e[f+l+4],n.z=e[f+l+5],d=(n.z-t.z)/(n.x-t.x),_=t.z-d*t.x,i.subtractToRef(t,o),r.subtractToRef(t,s),n.subtractToRef(t,a),p.CrossToRef(a,s,h),p.CrossToRef(o,a,u),h.normalize(),u.normalize(),g=-(h.x*t.x+h.y*t.y+h.z*t.z),m=-(u.x*i.x+u.y*i.y+u.z*i.z);var x=this._heightQuads[T*v+E];x.slope.copyFromFloats(d,_),x.facet1.copyFromFloats(h.x,h.y,h.z,g),x.facet2.copyFromFloats(u.x,u.y,u.z,m)}return this},i.prototype.serialize=function(t){e.prototype.serialize.call(this,t),t.subdivisionsX=this._subdivisionsX,t.subdivisionsY=this._subdivisionsY,t.minX=this._minX,t.maxX=this._maxX,t.minZ=this._minZ,t.maxZ=this._maxZ,t.width=this._width,t.height=this._height},i.Parse=function(e,t){var r=new i(e.name,t);return r._subdivisionsX=e.subdivisionsX||1,r._subdivisionsY=e.subdivisionsY||1,r._minX=e.minX,r._maxX=e.maxX,r._minZ=e.minZ,r._maxZ=e.maxZ,r._width=e.width,r._height=e.height,r},i}(Zt);dt.CreateGround=function(e){var t,i,r=[],n=[],o=[],s=[],a=e.width||1,h=e.height||1,u=e.subdivisionsX||e.subdivisions||1,l=e.subdivisionsY||e.subdivisions||1;for(t=0;t<=l;t++)for(i=0;i<=u;i++){var c=new p(i*a/u-a/2,0,(l-t)*h/l-h/2),f=new p(0,1,0);n.push(c.x,c.y,c.z),o.push(f.x,f.y,f.z),s.push(i/u,1-t/l)}for(t=0;t<l;t++)for(i=0;i<u;i++)r.push(i+1+(t+1)*(u+1)),r.push(i+1+t*(u+1)),r.push(i+t*(u+1)),r.push(i+(t+1)*(u+1)),r.push(i+1+(t+1)*(u+1)),r.push(i+t*(u+1));var d=new dt;return d.indices=r,d.positions=n,d.normals=o,d.uvs=s,d},dt.CreateTiledGround=function(e){var t,i,r,n,o=void 0!==e.xmin&&null!==e.xmin?e.xmin:-1,s=void 0!==e.zmin&&null!==e.zmin?e.zmin:-1,a=void 0!==e.xmax&&null!==e.xmax?e.xmax:1,h=void 0!==e.zmax&&null!==e.zmax?e.zmax:1,u=e.subdivisions||{w:1,h:1},l=e.precision||{w:1,h:1},c=new Array,f=new Array,d=new Array,_=new Array;u.h=u.h<1?1:u.h,u.w=u.w<1?1:u.w,l.w=l.w<1?1:l.w,l.h=l.h<1?1:l.h;var g=(a-o)/u.w,m=(h-s)/u.h;function v(e,r,n,o){var s=f.length/3,a=l.w+1;for(t=0;t<l.h;t++)for(i=0;i<l.w;i++){var h=[s+i+t*a,s+(i+1)+t*a,s+(i+1)+(t+1)*a,s+i+(t+1)*a];c.push(h[1]),c.push(h[2]),c.push(h[3]),c.push(h[0]),c.push(h[1]),c.push(h[3])}var u=p.Zero(),g=new p(0,1,0);for(t=0;t<=l.h;t++)for(u.z=t*(o-r)/l.h+r,i=0;i<=l.w;i++)u.x=i*(n-e)/l.w+e,u.y=0,f.push(u.x,u.y,u.z),d.push(g.x,g.y,g.z),_.push(i/l.w,t/l.h)}for(r=0;r<u.h;r++)for(n=0;n<u.w;n++)v(o+n*g,s+r*m,o+(n+1)*g,s+(r+1)*m);var y=new dt;return y.indices=c,y.positions=f,y.normals=d,y.uvs=_,y},dt.CreateGroundFromHeightMap=function(e){var t,i,r=[],n=[],o=[],s=[],a=e.colorFilter||new T(.3,.59,.11),h=e.alphaFilter||0,l=!1;if(e.minHeight>e.maxHeight){l=!0;var c=e.maxHeight;e.maxHeight=e.minHeight,e.minHeight=c}for(t=0;t<=e.subdivisions;t++)for(i=0;i<=e.subdivisions;i++){var f=new p(i*e.width/e.subdivisions-e.width/2,0,(e.subdivisions-t)*e.height/e.subdivisions-e.height/2),d=4*(((f.x+e.width/2)/e.width*(e.bufferWidth-1)|0)+((1-(f.z+e.height/2)/e.height)*(e.bufferHeight-1)|0)*e.bufferWidth),_=e.buffer[d]/255,g=e.buffer[d+1]/255,m=e.buffer[d+2]/255,v=e.buffer[d+3]/255;l&&(_=1-_,g=1-g,m=1-m);var y=_*a.r+g*a.g+m*a.b;f.y=v>=h?e.minHeight+(e.maxHeight-e.minHeight)*y:e.minHeight-u,n.push(f.x,f.y,f.z),o.push(0,0,0),s.push(i/e.subdivisions,1-t/e.subdivisions)}for(t=0;t<e.subdivisions;t++)for(i=0;i<e.subdivisions;i++){var b=i+1+(t+1)*(e.subdivisions+1),E=i+1+t*(e.subdivisions+1),x=i+t*(e.subdivisions+1),A=i+(t+1)*(e.subdivisions+1),M=n[3*b+1]>=e.minHeight,P=n[3*E+1]>=e.minHeight,C=n[3*x+1]>=e.minHeight;M&&P&&C&&(r.push(b),r.push(E),r.push(x)),n[3*A+1]>=e.minHeight&&M&&C&&(r.push(A),r.push(b),r.push(x))}dt.ComputeNormals(n,r,o);var S=new dt;return S.indices=r,S.positions=n,S.normals=o,S.uvs=s,S},Zt.CreateGround=function(e,t,i,r,n,o){var s={width:t,height:i,subdivisions:r,updatable:o};return xr.CreateGround(e,s,n)},Zt.CreateTiledGround=function(e,t,i,r,n,o,s,a,h){var u={xmin:t,zmin:i,xmax:r,zmax:n,subdivisions:o,precision:s,updatable:h};return xr.CreateTiledGround(e,u,a)},Zt.CreateGroundFromHeightMap=function(e,t,i,r,n,o,s,a,h,u,l){var c={width:i,height:r,subdivisions:n,minHeight:o,maxHeight:s,updatable:h,onReady:u,alphaFilter:l};return xr.CreateGroundFromHeightMap(e,t,c,a)};var xr=function(){function e(){}return e.CreateGround=function(e,t,i){var r=new Er(e,i);return r._setReady(!1),r._subdivisionsX=t.subdivisionsX||t.subdivisions||1,r._subdivisionsY=t.subdivisionsY||t.subdivisions||1,r._width=t.width||1,r._height=t.height||1,r._maxX=r._width/2,r._maxZ=r._height/2,r._minX=-r._maxX,r._minZ=-r._maxZ,dt.CreateGround(t).applyToMesh(r,t.updatable),r._setReady(!0),r},e.CreateTiledGround=function(e,t,i){void 0===i&&(i=null);var r=new Zt(e,i);return dt.CreateTiledGround(t).applyToMesh(r,t.updatable),r},e.CreateGroundFromHeightMap=function(e,t,i,r){void 0===r&&(r=null);var n=i.width||10,o=i.height||10,s=i.subdivisions||1,a=i.minHeight||0,h=i.maxHeight||1,u=i.colorFilter||new T(.3,.59,.11),l=i.alphaFilter||0,c=i.updatable,f=i.onReady;r=r||V.LastCreatedScene;var d=new Er(e,r);d._subdivisionsX=s,d._subdivisionsY=s,d._width=n,d._height=o,d._maxX=d._width/2,d._maxZ=d._height/2,d._minX=-d._maxX,d._minZ=-d._maxZ,d._setReady(!1);return Ue.LoadImage(t,(function(e){var t=e.width,i=e.height,p=ve.CreateCanvas(t,i).getContext("2d");if(!p)throw new Error("Unable to get 2d context for CreateGroundFromHeightMap");if(!r.isDisposed){p.drawImage(e,0,0);var _=p.getImageData(0,0,t,i).data;dt.CreateGroundFromHeightMap({width:n,height:o,subdivisions:s,minHeight:a,maxHeight:h,colorFilter:u,buffer:_,bufferWidth:t,bufferHeight:i,alphaFilter:l}).applyToMesh(d,c),f&&f(d),d._setReady(!0)}}),(function(){}),r.offlineProvider),d},e}();Zt.CreateTube=function(e,t,i,r,n,o,s,a,h,u){var l={path:t,radius:i,tessellation:r,radiusFunction:n,arc:1,cap:o,updatable:a,sideOrientation:h,instance:u};return Ar.CreateTube(e,l,s)};var Ar=function(){function e(){}return e.CreateTube=function(e,t,i){void 0===i&&(i=null);var r=t.path,n=t.instance,o=1;void 0!==t.radius?o=t.radius:n&&(o=n._creationDataStorage.radius);var s=t.tessellation||64,a=t.radiusFunction||null,h=t.cap||Zt.NO_CAP,u=t.invertUV||!1,l=t.updatable,c=Zt._GetDefaultSideOrientation(t.sideOrientation);t.arc=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1;var f,d,_=function(e,t,i,r,n,o,s,a){for(var h,u,l,c,f=t.getTangents(),d=t.getNormals(),_=t.getDistances(),g=2*Math.PI/n*a,v=o||function(){return r},b=y.Matrix[0],T=s===Zt.NO_CAP||s===Zt.CAP_END?0:2,E=0;E<e.length;E++){u=v(E,_[E]),h=Array(),l=d[E];for(var x=0;x<n;x++)m.RotationAxisToRef(f[E],g*x,b),c=h[x]?h[x]:p.Zero(),p.TransformCoordinatesToRef(l,b,c),c.scaleInPlace(u).addInPlace(e[E]),h[x]=c;i[T]=h,T++}var A=function(t,i){for(var r=Array(),n=0;n<t;n++)r.push(e[i]);return r};switch(s){case Zt.NO_CAP:break;case Zt.CAP_START:i[0]=A(n,0),i[1]=i[2].slice(0);break;case Zt.CAP_END:i[T]=i[T-1].slice(0),i[T+1]=A(n,e.length-1);break;case Zt.CAP_ALL:i[0]=A(n,0),i[1]=i[2].slice(0),i[T]=i[T-1].slice(0),i[T+1]=A(n,e.length-1)}return i};if(n){var g=n._creationDataStorage,v=t.arc||g.arc;return d=_(r,f=g.path3D.update(r),g.pathArray,o,g.tessellation,a,g.cap,v),n=or.CreateRibbon("",{pathArray:d,instance:n}),g.path3D=f,g.pathArray=d,g.arc=v,g.radius=o,n}d=_(r,f=new ai(r),new Array,o,s,a,h=h<0||h>3?0:h,t.arc);var b=or.CreateRibbon(e,{pathArray:d,closePath:!0,closeArray:!1,updatable:l,sideOrientation:c,invertUV:u,frontUVs:t.frontUVs,backUVs:t.backUVs},i);return b._creationDataStorage.pathArray=d,b._creationDataStorage.path3D=f,b._creationDataStorage.tessellation=s,b._creationDataStorage.cap=h,b._creationDataStorage.arc=t.arc,b._creationDataStorage.radius=o,b},e}();dt.CreatePolyhedron=function(e){var t=[];t[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},t[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},t[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},t[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},t[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},t[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},t[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},t[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},t[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},t[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},t[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},t[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},t[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},t[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},t[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var i,r,n,o,s,a,h=e.type&&(e.type<0||e.type>=t.length)?0:e.type||0,u=e.size,l=e.sizeX||u||1,c=e.sizeY||u||1,f=e.sizeZ||u||1,d=e.custom||t[h],p=d.face.length,g=e.faceUV||new Array(p),m=e.faceColors,v=void 0===e.flat||e.flat,y=0===e.sideOrientation?0:e.sideOrientation||dt.DEFAULTSIDE,b=new Array,T=new Array,x=new Array,A=new Array,M=new Array,P=0,C=0,S=new Array,I=0,O=0;if(v)for(O=0;O<p;O++)m&&void 0===m[O]&&(m[O]=new E(1,1,1,1)),g&&void 0===g[O]&&(g[O]=new _(0,0,1,1));if(v)for(O=0;O<p;O++){var R=d.face[O].length;for(n=2*Math.PI/R,o=.5*Math.tan(n/2),s=.5,I=0;I<R;I++)b.push(d.vertex[d.face[O][I]][0]*l,d.vertex[d.face[O][I]][1]*c,d.vertex[d.face[O][I]][2]*f),S.push(P),P++,i=g[O].x+(g[O].z-g[O].x)*(.5+o),r=g[O].y+(g[O].w-g[O].y)*(s-.5),A.push(i,r),a=o*Math.cos(n)-s*Math.sin(n),s=o*Math.sin(n)+s*Math.cos(n),o=a,m&&M.push(m[O].r,m[O].g,m[O].b,m[O].a);for(I=0;I<R-2;I++)T.push(S[0+C],S[I+2+C],S[I+1+C]);C+=R}else{for(I=0;I<d.vertex.length;I++)b.push(d.vertex[I][0]*l,d.vertex[I][1]*c,d.vertex[I][2]*f),A.push(0,0);for(O=0;O<p;O++)for(I=0;I<d.face[O].length-2;I++)T.push(d.face[O][0],d.face[O][I+2],d.face[O][I+1])}dt.ComputeNormals(b,T,x),dt._ComputeSides(y,b,T,x,A,e.frontUVs,e.backUVs);var D=new dt;return D.positions=b,D.indices=T,D.normals=x,D.uvs=A,m&&v&&(D.colors=M),D},Zt.CreatePolyhedron=function(e,t,i){return Mr.CreatePolyhedron(e,t,i)};var Mr=function(){function e(){}return e.CreatePolyhedron=function(e,t,i){void 0===i&&(i=null);var r=new Zt(e,i);return t.sideOrientation=Zt._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,dt.CreatePolyhedron(t).applyToMesh(r,t.updatable),r},e}();dt.CreateIcoSphere=function(e){var t,i=e.sideOrientation||dt.DEFAULTSIDE,r=e.radius||1,n=void 0===e.flat||e.flat,o=e.subdivisions||4,s=e.radiusX||r,a=e.radiusY||r,h=e.radiusZ||r,u=(1+Math.sqrt(5))/2,l=[-1,u,-0,1,u,0,-1,-u,0,1,-u,0,0,-1,-u,0,1,-u,0,-1,u,0,1,u,u,0,1,u,0,-1,-u,0,1,-u,0,-1],c=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],f=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],_=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],g=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],m=new Array,v=new Array,y=new Array,b=new Array,T=0,E=new Array(3),x=new Array(3);for(t=0;t<3;t++)E[t]=p.Zero(),x[t]=d.Zero();for(var A=0;A<20;A++){for(t=0;t<3;t++){var M=c[3*A+t];E[t].copyFromFloats(l[3*f[M]],l[3*f[M]+1],l[3*f[M]+2]),E[t].normalize().scaleInPlace(r),x[t].copyFromFloats(.134765625*_[2*M]+.05859375+-.0390625*g[A],.2333984375*_[2*M+1]+.025390625+.01953125*g[A])}for(var P=function(e,t,i,r){var u,l=p.Lerp(E[0],E[2],t/o),c=p.Lerp(E[1],E[2],t/o),f=o===t?E[2]:p.Lerp(l,c,e/(o-t));if(f.normalize(),n){var _=p.Lerp(E[0],E[2],r/o),g=p.Lerp(E[1],E[2],r/o);u=p.Lerp(_,g,i/(o-r))}else u=new p(f.x,f.y,f.z);u.x/=s,u.y/=a,u.z/=h,u.normalize();var A=d.Lerp(x[0],x[2],t/o),M=d.Lerp(x[1],x[2],t/o),P=o===t?x[2]:d.Lerp(A,M,e/(o-t));v.push(f.x*s,f.y*a,f.z*h),y.push(u.x,u.y,u.z),b.push(P.x,P.y),m.push(T),T++},C=0;C<o;C++)for(var S=0;S+C<o;S++)P(S,C,S+1/3,C+1/3),P(S+1,C,S+1/3,C+1/3),P(S,C+1,S+1/3,C+1/3),S+C+1<o&&(P(S+1,C,S+2/3,C+2/3),P(S+1,C+1,S+2/3,C+2/3),P(S,C+1,S+2/3,C+2/3))}dt._ComputeSides(i,v,m,y,b,e.frontUVs,e.backUVs);var I=new dt;return I.indices=m,I.positions=v,I.normals=y,I.uvs=b,I},Zt.CreateIcoSphere=function(e,t,i){return Pr.CreateIcoSphere(e,t,i)};var Pr=function(){function e(){}return e.CreateIcoSphere=function(e,t,i){void 0===i&&(i=null);var r=new Zt(e,i);return t.sideOrientation=Zt._GetDefaultSideOrientation(t.sideOrientation),r._originalBuilderSideOrientation=t.sideOrientation,dt.CreateIcoSphere(t).applyToMesh(r,t.updatable),r},e}(),Cr=function(){function e(e,t){void 0===e&&(e=p.Zero()),void 0===t&&(t=p.Up()),this.position=e,this.normal=t}return e.prototype.clone=function(){return new e(this.position.clone(),this.normal.clone())},e}();Zt.CreateDecal=function(e,t,i,r,n,o){var s={position:i,normal:r,size:n,angle:o};return Sr.CreateDecal(e,t,s)};var Sr=function(){function e(){}return e.CreateDecal=function(e,t,i){var r=t.getIndices(),n=t.getVerticesData(ft.PositionKind),o=t.getVerticesData(ft.NormalKind),s=i.position||p.Zero(),a=i.normal||p.Up(),h=i.size||p.One(),u=i.angle||0;if(!a){var l=new p(0,0,1),c=t.getScene().activeCamera,f=p.TransformCoordinates(l,c.getWorldMatrix());a=c.globalPosition.subtract(f)}var d=-Math.atan2(a.z,a.x)-Math.PI/2,_=Math.sqrt(a.x*a.x+a.z*a.z),g=Math.atan2(a.y,_),v=m.RotationYawPitchRoll(d,g,u).multiply(m.Translation(s.x,s.y,s.z)),y=m.Invert(v),b=t.getWorldMatrix().multiply(y),T=new dt;T.indices=[],T.positions=[],T.normals=[],T.uvs=[];for(var E=0,x=function(e){var t=new Cr;if(!r||!n||!o)return t;var i=r[e];return t.position=new p(n[3*i],n[3*i+1],n[3*i+2]),t.position=p.TransformCoordinates(t.position,b),t.normal=new p(o[3*i],o[3*i+1],o[3*i+2]),t.normal=p.TransformNormal(t.normal,b),t},A=function(e,t){if(0===e.length)return e;for(var i=.5*Math.abs(p.Dot(h,t)),r=function(e,r){var n=p.GetClipFactor(e.position,r.position,t,i);return new Cr(p.Lerp(e.position,r.position,n),p.Lerp(e.normal,r.normal,n))},n=new Array,o=0;o<e.length;o+=3){var s,a,u,l=null,c=null,f=null,d=null;switch(((s=p.Dot(e[o].position,t)-i>0)?1:0)+((a=p.Dot(e[o+1].position,t)-i>0)?1:0)+((u=p.Dot(e[o+2].position,t)-i>0)?1:0)){case 0:n.push(e[o]),n.push(e[o+1]),n.push(e[o+2]);break;case 1:if(s&&(l=e[o+1],c=e[o+2],f=r(e[o],l),d=r(e[o],c)),a){l=e[o],c=e[o+2],f=r(e[o+1],l),d=r(e[o+1],c),n.push(f),n.push(c.clone()),n.push(l.clone()),n.push(c.clone()),n.push(f.clone()),n.push(d);break}u&&(l=e[o],c=e[o+1],f=r(e[o+2],l),d=r(e[o+2],c)),l&&c&&f&&d&&(n.push(l.clone()),n.push(c.clone()),n.push(f),n.push(d),n.push(f.clone()),n.push(c.clone()));break;case 2:s||(c=r(l=e[o].clone(),e[o+1]),f=r(l,e[o+2]),n.push(l),n.push(c),n.push(f)),a||(c=r(l=e[o+1].clone(),e[o+2]),f=r(l,e[o]),n.push(l),n.push(c),n.push(f)),u||(c=r(l=e[o+2].clone(),e[o]),f=r(l,e[o+1]),n.push(l),n.push(c),n.push(f))}}return n},M=0;M<r.length;M+=3){var P=new Array;if(P.push(x(M)),P.push(x(M+1)),P.push(x(M+2)),P=A(P,new p(1,0,0)),P=A(P,new p(-1,0,0)),P=A(P,new p(0,1,0)),P=A(P,new p(0,-1,0)),P=A(P,new p(0,0,1)),0!==(P=A(P,new p(0,0,-1))).length)for(var C=0;C<P.length;C++){var S=P[C];T.indices.push(E),S.position.toArray(T.positions,3*E),S.normal.toArray(T.normals,3*E),T.uvs.push(.5+S.position.x/h.x),T.uvs.push(.5+S.position.y/h.y),E++}}var I=new Zt(e,t.getScene());return T.applyToMesh(I),I.position=s.clone(),I.rotation=new p(g,d,u),I},e}();dt.CreateCapsule=function(e){void 0===e&&(e={subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6});var t,i,r=Math.max(e.subdivisions?e.subdivisions:2,1),n=Math.max(e.tessellation?e.tessellation:16,3),o=Math.max(e.height?e.height:1,0),s=Math.max(e.radius?e.radius:.25,0),a=Math.max(e.capSubdivisions?e.capSubdivisions:6,1),h=n,u=r,l=Math.max(e.radiusTop?e.radiusTop:s,0),c=Math.max(e.radiusBottom?e.radiusBottom:s,0),f=o-(l+c),_=2*Math.PI,g=Math.max(e.topCapSubdivisions?e.topCapSubdivisions:a,1),v=Math.max(e.bottomCapSubdivisions?e.bottomCapSubdivisions:a,1),y=Math.acos((c-l)/o),b=[],T=[],E=[],x=[],A=0,M=[],P=.5*f,C=.5*Math.PI,S=p.Zero(),I=p.Zero(),O=Math.cos(y),R=Math.sin(y),D=new d(l*R,P+l*O).subtract(new d(c*R,c*O-P)).length(),w=l*y+D+c*(C-y),L=0;for(i=0;i<=g;i++){var F=[],N=C-y*(i/g);L+=l*y/g;var B=Math.cos(N),k=Math.sin(N),U=B*l;for(t=0;t<=h;t++){var V=(X=t/h)*_+0,W=Math.sin(V),z=Math.cos(V);I.x=U*W,I.y=P+k*l,I.z=U*z,T.push(I.x,I.y,I.z),S.set(B*W,k,B*z),E.push(S.x,S.y,S.z),x.push(X,1-L/w),F.push(A),A++}M.push(F)}var G=o-l-c+O*l-O*c,H=R*(c-l)/G;for(i=1;i<=u;i++){F=[];L+=D/u;U=R*(i*(c-l)/u+l);for(t=0;t<=h;t++){V=(X=t/h)*_+0,W=Math.sin(V),z=Math.cos(V);I.x=U*W,I.y=P+O*l-i*G/u,I.z=U*z,T.push(I.x,I.y,I.z),S.set(W,H,z).normalize(),E.push(S.x,S.y,S.z),x.push(X,1-L/w),F.push(A),A++}M.push(F)}for(i=1;i<=v;i++){F=[],N=C-y-(Math.PI-y)*(i/v);L+=c*y/v;B=Math.cos(N),k=Math.sin(N),U=B*c;for(t=0;t<=h;t++){var X;V=(X=t/h)*_+0,W=Math.sin(V),z=Math.cos(V);I.x=U*W,I.y=k*c-P,I.z=U*z,T.push(I.x,I.y,I.z),S.set(B*W,k,B*z),E.push(S.x,S.y,S.z),x.push(X,1-L/w),F.push(A),A++}M.push(F)}for(t=0;t<h;t++)for(i=0;i<g+u+v;i++){var j=M[i][t],K=M[i+1][t],Y=M[i+1][t+1],q=M[i][t+1];b.push(j),b.push(K),b.push(q),b.push(K),b.push(Y),b.push(q)}if(b=b.reverse(),e.orientation&&!e.orientation.equals(p.Up())){var Z=new m;e.orientation.clone().scale(.5*Math.PI).cross(p.Up()).toQuaternion().toRotationMatrix(Z);for(var Q=p.Zero(),J=0;J<T.length;J+=3)Q.set(T[J],T[J+1],T[J+2]),p.TransformCoordinatesToRef(Q.clone(),Z,Q),T[J]=Q.x,T[J+1]=Q.y,T[J+2]=Q.z}var $=new dt;return $.positions=T,$.normals=E,$.uvs=x,$.indices=b,$},Zt.CreateCapsule=function(e,t,i){return Ir.CreateCapsule(e,t,i)};var Ir=function(){function e(){}return e.CreateCapsule=function(e,t,i){void 0===t&&(t={orientation:p.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6});var r=new Zt(e,i);return dt.CreateCapsule(t).applyToMesh(r),r},e}(),Or=function(){function e(){}return e.CreateBox=function(e,t,i){return void 0===i&&(i=null),ar.CreateBox(e,t,i)},e.CreateTiledBox=function(e,t,i){return void 0===i&&(i=null),hr.CreateTiledBox(e,t,i)},e.CreateSphere=function(e,t,i){return void 0===i&&(i=null),ur.CreateSphere(e,t,i)},e.CreateDisc=function(e,t,i){return void 0===i&&(i=null),sr.CreateDisc(e,t,i)},e.CreateIcoSphere=function(e,t,i){return void 0===i&&(i=null),Pr.CreateIcoSphere(e,t,i)},e.CreateRibbon=function(e,t,i){return void 0===i&&(i=null),or.CreateRibbon(e,t,i)},e.CreateCylinder=function(e,t,i){return void 0===i&&(i=null),lr.CreateCylinder(e,t,i)},e.CreateTorus=function(e,t,i){return void 0===i&&(i=null),cr.CreateTorus(e,t,i)},e.CreateTorusKnot=function(e,t,i){return void 0===i&&(i=null),fr.CreateTorusKnot(e,t,i)},e.CreateLineSystem=function(e,t,i){return dr.CreateLineSystem(e,t,i)},e.CreateLines=function(e,t,i){return void 0===i&&(i=null),dr.CreateLines(e,t,i)},e.CreateDashedLines=function(e,t,i){return void 0===i&&(i=null),dr.CreateDashedLines(e,t,i)},e.ExtrudeShape=function(e,t,i){return void 0===i&&(i=null),vr.ExtrudeShape(e,t,i)},e.ExtrudeShapeCustom=function(e,t,i){return void 0===i&&(i=null),vr.ExtrudeShapeCustom(e,t,i)},e.CreateLathe=function(e,t,i){return void 0===i&&(i=null),yr.CreateLathe(e,t,i)},e.CreateTiledPlane=function(e,t,i){return void 0===i&&(i=null),Tr.CreateTiledPlane(e,t,i)},e.CreatePlane=function(e,t,i){return void 0===i&&(i=null),br.CreatePlane(e,t,i)},e.CreateGround=function(e,t,i){return void 0===i&&(i=null),xr.CreateGround(e,t,i)},e.CreateTiledGround=function(e,t,i){return void 0===i&&(i=null),xr.CreateTiledGround(e,t,i)},e.CreateGroundFromHeightMap=function(e,t,i,r){return void 0===r&&(r=null),xr.CreateGroundFromHeightMap(e,t,i,r)},e.CreatePolygon=function(e,t,i,r){return void 0===i&&(i=null),void 0===r&&(r=earcut),mr.CreatePolygon(e,t,i,r)},e.ExtrudePolygon=function(e,t,i,r){return void 0===i&&(i=null),void 0===r&&(r=earcut),mr.ExtrudePolygon(e,t,i,r)},e.CreateTube=function(e,t,i){return void 0===i&&(i=null),Ar.CreateTube(e,t,i)},e.CreatePolyhedron=function(e,t,i){return void 0===i&&(i=null),Mr.CreatePolyhedron(e,t,i)},e.CreateDecal=function(e,t,i){return Sr.CreateDecal(e,t,i)},e.CreateCapsule=function(e,t,i){return void 0===t&&(t={orientation:p.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}),void 0===i&&(i=null),Ir.CreateCapsule(e,t,i)},e}(),Rr=function(){function e(t,i,r){void 0===i&&(i=e.UNITMODE_PIXEL),void 0===r&&(r=!0),this.unit=i,this.negativeValueAllowed=r,this._value=1,this.ignoreAdaptiveScaling=!1,this._value=t,this._originalUnit=i}return Object.defineProperty(e.prototype,"isPercentage",{get:function(){return this.unit===e.UNITMODE_PERCENTAGE},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isPixel",{get:function(){return this.unit===e.UNITMODE_PIXEL},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"internalValue",{get:function(){return this._value},enumerable:!1,configurable:!0}),e.prototype.getValueInPixel=function(e,t){return this.isPixel?this.getValue(e):this.getValue(e)*t},e.prototype.updateInPlace=function(t,i){return void 0===i&&(i=e.UNITMODE_PIXEL),this._value=t,this.unit=i,this},e.prototype.getValue=function(t){if(t&&!this.ignoreAdaptiveScaling&&this.unit!==e.UNITMODE_PERCENTAGE){var i=0,r=0;if(t.idealWidth&&(i=this._value*t.getSize().width/t.idealWidth),t.idealHeight&&(r=this._value*t.getSize().height/t.idealHeight),t.useSmallestIdeal&&t.idealWidth&&t.idealHeight)return window.innerWidth<window.innerHeight?i:r;if(t.idealWidth)return i;if(t.idealHeight)return r}return this._value},e.prototype.toString=function(t,i){switch(this.unit){case e.UNITMODE_PERCENTAGE:var r=100*this.getValue(t);return(i?r.toFixed(i):r)+"%";case e.UNITMODE_PIXEL:var n=this.getValue(t);return(i?n.toFixed(i):n)+"px"}return this.unit.toString()},e.prototype.fromString=function(t){var i=e._Regex.exec(t.toString());if(!i||0===i.length)return!1;var r=parseFloat(i[1]),n=this._originalUnit;if(this.negativeValueAllowed||r<0&&(r=0),4===i.length)switch(i[3]){case"px":n=e.UNITMODE_PIXEL;break;case"%":n=e.UNITMODE_PERCENTAGE,r/=100}return(r!==this._value||n!==this.unit)&&(this._value=r,this.unit=n,!0)},Object.defineProperty(e,"UNITMODE_PERCENTAGE",{get:function(){return e._UNITMODE_PERCENTAGE},enumerable:!1,configurable:!0}),Object.defineProperty(e,"UNITMODE_PIXEL",{get:function(){return e._UNITMODE_PIXEL},enumerable:!1,configurable:!0}),e._Regex=/(^-?\d*(\.\d+)?)(%|px)?/,e._UNITMODE_PERCENTAGE=0,e._UNITMODE_PIXEL=1,e}(),Dr=[new d(0,0),new d(0,0),new d(0,0),new d(0,0)],wr=[new d(0,0),new d(0,0),new d(0,0),new d(0,0)],Lr=new d(0,0),Fr=new d(0,0),Nr=function(){function e(e,t,i,r){this.left=e,this.top=t,this.width=i,this.height=r}return e.prototype.copyFrom=function(e){this.left=e.left,this.top=e.top,this.width=e.width,this.height=e.height},e.prototype.copyFromFloats=function(e,t,i,r){this.left=e,this.top=t,this.width=i,this.height=r},e.CombineToRef=function(e,t,i){var r=Math.min(e.left,t.left),n=Math.min(e.top,t.top),o=Math.max(e.left+e.width,t.left+t.width),s=Math.max(e.top+e.height,t.top+t.height);i.left=r,i.top=n,i.width=o-r,i.height=s-n},e.prototype.addAndTransformToRef=function(e,t,i,r,n,o){var s=this.left+t,a=this.top+i,h=this.width+r,u=this.height+n;Dr[0].copyFromFloats(s,a),Dr[1].copyFromFloats(s+h,a),Dr[2].copyFromFloats(s+h,a+u),Dr[3].copyFromFloats(s,a+u),Lr.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE),Fr.copyFromFloats(0,0);for(var l=0;l<4;l++)e.transformCoordinates(Dr[l].x,Dr[l].y,wr[l]),Lr.x=Math.floor(Math.min(Lr.x,wr[l].x)),Lr.y=Math.floor(Math.min(Lr.y,wr[l].y)),Fr.x=Math.ceil(Math.max(Fr.x,wr[l].x)),Fr.y=Math.ceil(Math.max(Fr.y,wr[l].y));o.left=Lr.x,o.top=Lr.y,o.width=Fr.x-Lr.x,o.height=Fr.y-Lr.y},e.prototype.transformToRef=function(e,t){this.addAndTransformToRef(e,0,0,0,0,t)},e.prototype.isEqualsTo=function(e){return this.left===e.left&&(this.top===e.top&&(this.width===e.width&&this.height===e.height))},e.Empty=function(){return new e(0,0,0,0)},e}(),Br=function(e){function i(t,i){void 0===i&&(i=0);var r=e.call(this,t.x,t.y)||this;return r.buttonIndex=i,r}return t(i,e),i}(d),kr=function(){function e(e,t,i,r,n,o){this.m=new Float32Array(6),this.fromValues(e,t,i,r,n,o)}return e.prototype.fromValues=function(e,t,i,r,n,o){return this.m[0]=e,this.m[1]=t,this.m[2]=i,this.m[3]=r,this.m[4]=n,this.m[5]=o,this},e.prototype.determinant=function(){return this.m[0]*this.m[3]-this.m[1]*this.m[2]},e.prototype.invertToRef=function(e){var t=this.m[0],i=this.m[1],r=this.m[2],n=this.m[3],o=this.m[4],s=this.m[5],a=this.determinant();if(a<1e-6)return e.m[0]=0,e.m[1]=0,e.m[2]=0,e.m[3]=0,e.m[4]=0,e.m[5]=0,this;var h=1/a,u=r*s-n*o,l=i*o-t*s;return e.m[0]=n*h,e.m[1]=-i*h,e.m[2]=-r*h,e.m[3]=t*h,e.m[4]=u*h,e.m[5]=l*h,this},e.prototype.multiplyToRef=function(e,t){var i=this.m[0],r=this.m[1],n=this.m[2],o=this.m[3],s=this.m[4],a=this.m[5],h=e.m[0],u=e.m[1],l=e.m[2],c=e.m[3],f=e.m[4],d=e.m[5];return t.m[0]=i*h+r*l,t.m[1]=i*u+r*c,t.m[2]=n*h+o*l,t.m[3]=n*u+o*c,t.m[4]=s*h+a*l+f,t.m[5]=s*u+a*c+d,this},e.prototype.transformCoordinates=function(e,t,i){return i.x=e*this.m[0]+t*this.m[2]+this.m[4],i.y=e*this.m[1]+t*this.m[3]+this.m[5],this},e.Identity=function(){return new e(1,0,0,1,0,0)},e.TranslationToRef=function(e,t,i){i.fromValues(1,0,0,1,e,t)},e.ScalingToRef=function(e,t,i){i.fromValues(e,0,0,t,0,0)},e.RotationToRef=function(e,t){var i=Math.sin(e),r=Math.cos(e);t.fromValues(r,i,-i,r,0,0)},e.ComposeToRef=function(t,i,r,n,o,s,a){e.TranslationToRef(t,i,e._TempPreTranslationMatrix),e.ScalingToRef(n,o,e._TempScalingMatrix),e.RotationToRef(r,e._TempRotationMatrix),e.TranslationToRef(-t,-i,e._TempPostTranslationMatrix),e._TempPreTranslationMatrix.multiplyToRef(e._TempScalingMatrix,e._TempCompose0),e._TempCompose0.multiplyToRef(e._TempRotationMatrix,e._TempCompose1),s?(e._TempCompose1.multiplyToRef(e._TempPostTranslationMatrix,e._TempCompose2),e._TempCompose2.multiplyToRef(s,a)):e._TempCompose1.multiplyToRef(e._TempPostTranslationMatrix,a)},e._TempPreTranslationMatrix=e.Identity(),e._TempPostTranslationMatrix=e.Identity(),e._TempRotationMatrix=e.Identity(),e._TempScalingMatrix=e.Identity(),e._TempCompose0=e.Identity(),e._TempCompose1=e.Identity(),e._TempCompose2=e.Identity(),e}(),Ur=function(){function e(t){this.name=t,this._alpha=1,this._alphaSet=!1,this._zIndex=0,this._currentMeasure=Nr.Empty(),this._fontFamily="Arial",this._fontStyle="",this._fontWeight="",this._fontSize=new Rr(18,Rr.UNITMODE_PIXEL,!1),this._width=new Rr(1,Rr.UNITMODE_PERCENTAGE,!1),this._height=new Rr(1,Rr.UNITMODE_PERCENTAGE,!1),this._color="",this._style=null,this._horizontalAlignment=e.HORIZONTAL_ALIGNMENT_CENTER,this._verticalAlignment=e.VERTICAL_ALIGNMENT_CENTER,this._isDirty=!0,this._wasDirty=!1,this._tempParentMeasure=Nr.Empty(),this._prevCurrentMeasureTransformedIntoGlobalSpace=Nr.Empty(),this._cachedParentMeasure=Nr.Empty(),this._paddingLeft=new Rr(0),this._paddingRight=new Rr(0),this._paddingTop=new Rr(0),this._paddingBottom=new Rr(0),this._left=new Rr(0),this._top=new Rr(0),this._scaleX=1,this._scaleY=1,this._rotation=0,this._transformCenterX=.5,this._transformCenterY=.5,this._transformMatrix=kr.Identity(),this._invertTransformMatrix=kr.Identity(),this._transformedPosition=d.Zero(),this._isMatrixDirty=!0,this._isVisible=!0,this._isHighlighted=!1,this._fontSet=!1,this._dummyVector2=d.Zero(),this._downCount=0,this._enterCount=-1,this._doNotRender=!1,this._downPointerIds={},this._isEnabled=!0,this._disabledColor="#9a9a9a",this._disabledColorItem="#6a6a6a",this._rebuildLayout=!1,this._customData={},this._isClipped=!1,this._automaticSize=!1,this.metadata=null,this.isHitTestVisible=!0,this.isPointerBlocker=!1,this.isFocusInvisible=!1,this.clipChildren=!0,this.clipContent=!0,this.useBitmapCache=!1,this._shadowOffsetX=0,this._shadowOffsetY=0,this._shadowBlur=0,this._shadowColor="black",this.hoverCursor="",this._linkOffsetX=new Rr(0),this._linkOffsetY=new Rr(0),this.onWheelObservable=new U,this.onPointerMoveObservable=new U,this.onPointerOutObservable=new U,this.onPointerDownObservable=new U,this.onPointerUpObservable=new U,this.onPointerClickObservable=new U,this.onPointerEnterObservable=new U,this.onDirtyObservable=new U,this.onBeforeDrawObservable=new U,this.onAfterDrawObservable=new U,this.onDisposeObservable=new U,this.fixedRatio=0,this._fixedRatioMasterIsWidth=!0,this._tmpMeasureA=new Nr(0,0,0,0)}return Object.defineProperty(e.prototype,"shadowOffsetX",{get:function(){return this._shadowOffsetX},set:function(e){this._shadowOffsetX!==e&&(this._shadowOffsetX=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowOffsetY",{get:function(){return this._shadowOffsetY},set:function(e){this._shadowOffsetY!==e&&(this._shadowOffsetY=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowBlur",{get:function(){return this._shadowBlur},set:function(e){this._shadowBlur!==e&&(this._shadowBlur=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowColor",{get:function(){return this._shadowColor},set:function(e){this._shadowColor!==e&&(this._shadowColor=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"typeName",{get:function(){return this._getTypeName()},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return this._getTypeName()},Object.defineProperty(e.prototype,"host",{get:function(){return this._host},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontOffset",{get:function(){return this._fontOffset},set:function(e){this._fontOffset=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(e){this._alpha!==e&&(this._alphaSet=!0,this._alpha=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHighlighted",{get:function(){return this._isHighlighted},set:function(e){this._isHighlighted!==e&&(this._isHighlighted=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaleX",{get:function(){return this._scaleX},set:function(e){this._scaleX!==e&&(this._scaleX=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scaleY",{get:function(){return this._scaleY},set:function(e){this._scaleY!==e&&(this._scaleY=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation!==e&&(this._rotation=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformCenterY",{get:function(){return this._transformCenterY},set:function(e){this._transformCenterY!==e&&(this._transformCenterY=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transformCenterX",{get:function(){return this._transformCenterX},set:function(e){this._transformCenterX!==e&&(this._transformCenterX=e,this._markAsDirty(),this._markMatrixAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"horizontalAlignment",{get:function(){return this._horizontalAlignment},set:function(e){this._horizontalAlignment!==e&&(this._horizontalAlignment=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"verticalAlignment",{get:function(){return this._verticalAlignment},set:function(e){this._verticalAlignment!==e&&(this._verticalAlignment=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(e){this._fixedRatioMasterIsWidth=!0,this._width.toString(this._host)!==e&&this._width.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"widthInPixels",{get:function(){return this._width.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this._fixedRatioMasterIsWidth=!0,this.width=e+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height.toString(this._host)},set:function(e){this._fixedRatioMasterIsWidth=!1,this._height.toString(this._host)!==e&&this._height.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"heightInPixels",{get:function(){return this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this._fixedRatioMasterIsWidth=!1,this.height=e+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontFamily",{get:function(){return this._fontSet?this._fontFamily:""},set:function(e){this._fontFamily!==e&&(this._fontFamily=e,this._resetFontCache())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(e){this._fontStyle!==e&&(this._fontStyle=e,this._resetFontCache())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(e){this._fontWeight!==e&&(this._fontWeight=e,this._resetFontCache())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this._style},set:function(e){var t=this;this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this._style=e,this._style&&(this._styleObserver=this._style.onChangedObservable.add((function(){t._markAsDirty(),t._resetFontCache()}))),this._markAsDirty(),this._resetFontCache()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_isFontSizeInPercentage",{get:function(){return this._fontSize.isPercentage},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSizeInPixels",{get:function(){var e=this._style?this._style._fontSize:this._fontSize;return e.isPixel?e.getValue(this._host):e.getValueInPixel(this._host,this._tempParentMeasure.height||this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.fontSize=e+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize.toString(this._host)},set:function(e){this._fontSize.toString(this._host)!==e&&this._fontSize.fromString(e)&&(this._markAsDirty(),this._resetFontCache())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){this._color!==e&&(this._color=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zIndex",{get:function(){return this._zIndex},set:function(e){this.zIndex!==e&&(this._zIndex=e,this.parent&&this.parent._reOrderControl(this))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"notRenderable",{get:function(){return this._doNotRender},set:function(e){this._doNotRender!==e&&(this._doNotRender=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isVisible",{get:function(){return this._isVisible},set:function(e){this._isVisible!==e&&(this._isVisible=e,this._markAsDirty(!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"linkedMesh",{get:function(){return this._linkedMesh},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingLeft",{get:function(){return this._paddingLeft.toString(this._host)},set:function(e){this._paddingLeft.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingLeftInPixels",{get:function(){return this._paddingLeft.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this.paddingLeft=e+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingRight",{get:function(){return this._paddingRight.toString(this._host)},set:function(e){this._paddingRight.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingRightInPixels",{get:function(){return this._paddingRight.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this.paddingRight=e+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingTop",{get:function(){return this._paddingTop.toString(this._host)},set:function(e){this._paddingTop.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingTopInPixels",{get:function(){return this._paddingTop.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.paddingTop=e+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingBottom",{get:function(){return this._paddingBottom.toString(this._host)},set:function(e){this._paddingBottom.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paddingBottomInPixels",{get:function(){return this._paddingBottom.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.paddingBottom=e+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this._left.toString(this._host)},set:function(e){this._left.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftInPixels",{get:function(){return this._left.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this.left=e+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this._top.toString(this._host)},set:function(e){this._top.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"topInPixels",{get:function(){return this._top.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.top=e+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"linkOffsetX",{get:function(){return this._linkOffsetX.toString(this._host)},set:function(e){this._linkOffsetX.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"linkOffsetXInPixels",{get:function(){return this._linkOffsetX.getValueInPixel(this._host,this._cachedParentMeasure.width)},set:function(e){isNaN(e)||(this.linkOffsetX=e+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"linkOffsetY",{get:function(){return this._linkOffsetY.toString(this._host)},set:function(e){this._linkOffsetY.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"linkOffsetYInPixels",{get:function(){return this._linkOffsetY.getValueInPixel(this._host,this._cachedParentMeasure.height)},set:function(e){isNaN(e)||(this.linkOffsetY=e+"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"centerX",{get:function(){return this._currentMeasure.left+this._currentMeasure.width/2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"centerY",{get:function(){return this._currentMeasure.top+this._currentMeasure.height/2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disabledColor",{get:function(){return this._disabledColor},set:function(e){this._disabledColor!==e&&(this._disabledColor=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disabledColorItem",{get:function(){return this._disabledColorItem},set:function(e){this._disabledColorItem!==e&&(this._disabledColorItem=e,this._markAsDirty())},enumerable:!1,configurable:!0}),e.prototype._getTypeName=function(){return"Control"},e.prototype.getAscendantOfClass=function(e){return this.parent?this.parent.getClassName()===e?this.parent:this.parent.getAscendantOfClass(e):null},e.prototype._resetFontCache=function(){this._fontSet=!0,this._markAsDirty()},e.prototype.isAscendant=function(e){return!!this.parent&&(this.parent===e||this.parent.isAscendant(e))},e.prototype.getLocalCoordinates=function(e){var t=d.Zero();return this.getLocalCoordinatesToRef(e,t),t},e.prototype.getLocalCoordinatesToRef=function(e,t){return t.x=e.x-this._currentMeasure.left,t.y=e.y-this._currentMeasure.top,this},e.prototype.getParentLocalCoordinates=function(e){var t=d.Zero();return t.x=e.x-this._cachedParentMeasure.left,t.y=e.y-this._cachedParentMeasure.top,t},e.prototype.moveToVector3=function(t,i){if(this._host&&this.parent===this._host._rootContainer){this.horizontalAlignment=e.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=e.VERTICAL_ALIGNMENT_TOP;var r=this._host._getGlobalViewport(i),n=p.Project(t,m.Identity(),i.getTransformMatrix(),r);this._moveToProjectedPosition(n),n.z<0||n.z>1?this.notRenderable=!0:this.notRenderable=!1}else Ue.Error("Cannot move a control to a vector3 if the control is not at root level")},e.prototype.getDescendantsToRef=function(e,t,i){},e.prototype.getDescendants=function(e,t){var i=new Array;return this.getDescendantsToRef(i,e,t),i},e.prototype.linkWithMesh=function(t){if(!this._host||this.parent&&this.parent!==this._host._rootContainer)t&&Ue.Error("Cannot link a control to a mesh if the control is not at root level");else{var i=this._host._linkedControls.indexOf(this);if(-1!==i)return this._linkedMesh=t,void(t||this._host._linkedControls.splice(i,1));t&&(this.horizontalAlignment=e.HORIZONTAL_ALIGNMENT_LEFT,this.verticalAlignment=e.VERTICAL_ALIGNMENT_TOP,this._linkedMesh=t,this._host._linkedControls.push(this))}},e.prototype._moveToProjectedPosition=function(e){var t=this._left.getValue(this._host),i=this._top.getValue(this._host),r=e.x+this._linkOffsetX.getValue(this._host)-this._currentMeasure.width/2,n=e.y+this._linkOffsetY.getValue(this._host)-this._currentMeasure.height/2;this._left.ignoreAdaptiveScaling&&this._top.ignoreAdaptiveScaling&&(Math.abs(r-t)<.5&&(r=t),Math.abs(n-i)<.5&&(n=i)),this.left=r+"px",this.top=n+"px",this._left.ignoreAdaptiveScaling=!0,this._top.ignoreAdaptiveScaling=!0,this._markAsDirty()},e.prototype._offsetLeft=function(e){this._isDirty=!0,this._currentMeasure.left+=e},e.prototype._offsetTop=function(e){this._isDirty=!0,this._currentMeasure.top+=e},e.prototype._markMatrixAsDirty=function(){this._isMatrixDirty=!0,this._flagDescendantsAsMatrixDirty()},e.prototype._flagDescendantsAsMatrixDirty=function(){},e.prototype._intersectsRect=function(e){return this._currentMeasure.transformToRef(this._transformMatrix,this._tmpMeasureA),!(this._tmpMeasureA.left>=e.left+e.width)&&(!(this._tmpMeasureA.top>=e.top+e.height)&&(!(this._tmpMeasureA.left+this._tmpMeasureA.width<=e.left)&&!(this._tmpMeasureA.top+this._tmpMeasureA.height<=e.top)))},e.prototype.invalidateRect=function(){if(this._transform(),this.host&&this.host.useInvalidateRectOptimization)if(this._currentMeasure.transformToRef(this._transformMatrix,this._tmpMeasureA),Nr.CombineToRef(this._tmpMeasureA,this._prevCurrentMeasureTransformedIntoGlobalSpace,this._tmpMeasureA),this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY){var e=this.shadowOffsetX,t=this.shadowOffsetY,i=this.shadowBlur,r=Math.min(Math.min(e,0)-2*i,0),n=Math.max(Math.max(e,0)+2*i,0),o=Math.min(Math.min(t,0)-2*i,0),s=Math.max(Math.max(t,0)+2*i,0);this.host.invalidateRect(Math.floor(this._tmpMeasureA.left+r),Math.floor(this._tmpMeasureA.top+o),Math.ceil(this._tmpMeasureA.left+this._tmpMeasureA.width+n),Math.ceil(this._tmpMeasureA.top+this._tmpMeasureA.height+s))}else this.host.invalidateRect(Math.floor(this._tmpMeasureA.left),Math.floor(this._tmpMeasureA.top),Math.ceil(this._tmpMeasureA.left+this._tmpMeasureA.width),Math.ceil(this._tmpMeasureA.top+this._tmpMeasureA.height))},e.prototype._markAsDirty=function(e){void 0===e&&(e=!1),(this._isVisible||e)&&(this._isDirty=!0,this._host&&this._host.markAsDirty())},e.prototype._markAllAsDirty=function(){this._markAsDirty(),this._font&&this._prepareFont()},e.prototype._link=function(e){this._host=e,this._host&&(this.uniqueId=this._host.getScene().getUniqueId())},e.prototype._transform=function(e){if(this._isMatrixDirty||1!==this._scaleX||1!==this._scaleY||0!==this._rotation){var t=this._currentMeasure.width*this._transformCenterX+this._currentMeasure.left,i=this._currentMeasure.height*this._transformCenterY+this._currentMeasure.top;e&&(e.translate(t,i),e.rotate(this._rotation),e.scale(this._scaleX,this._scaleY),e.translate(-t,-i)),(this._isMatrixDirty||this._cachedOffsetX!==t||this._cachedOffsetY!==i)&&(this._cachedOffsetX=t,this._cachedOffsetY=i,this._isMatrixDirty=!1,this._flagDescendantsAsMatrixDirty(),kr.ComposeToRef(-t,-i,this._rotation,this._scaleX,this._scaleY,this.parent?this.parent._transformMatrix:null,this._transformMatrix),this._transformMatrix.invertToRef(this._invertTransformMatrix))}},e.prototype._renderHighlight=function(e){this.isHighlighted&&(e.save(),e.strokeStyle="#4affff",e.lineWidth=2,this._renderHighlightSpecific(e),e.restore())},e.prototype._renderHighlightSpecific=function(e){e.strokeRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)},e.prototype._applyStates=function(t){this._isFontSizeInPercentage&&(this._fontSet=!0),this._fontSet&&(this._prepareFont(),this._fontSet=!1),this._font&&(t.font=this._font),this._color&&(t.fillStyle=this._color),e.AllowAlphaInheritance?t.globalAlpha*=this._alpha:this._alphaSet&&(t.globalAlpha=this.parent?this.parent.alpha*this._alpha:this._alpha)},e.prototype._layout=function(e,t){if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;if(this._isDirty||!this._cachedParentMeasure.isEqualsTo(e)){this.host._numLayoutCalls++,this._currentMeasure.addAndTransformToRef(this._transformMatrix,0|-this.paddingLeftInPixels,0|-this.paddingTopInPixels,0|this.paddingRightInPixels,0|this.paddingBottomInPixels,this._prevCurrentMeasureTransformedIntoGlobalSpace),t.save(),this._applyStates(t);var i=0;do{this._rebuildLayout=!1,this._processMeasures(e,t),i++}while(this._rebuildLayout&&i<3);i>=3&&q.Error("Layout cycle detected in GUI (Control name="+this.name+", uniqueId="+this.uniqueId+")"),t.restore(),this.invalidateRect(),this._evaluateClippingState(e)}return this._wasDirty=this._isDirty,this._isDirty=!1,!0},e.prototype._processMeasures=function(e,t){this._currentMeasure.copyFrom(e),this._preMeasure(e,t),this._measure(),this._computeAlignment(e,t),this._currentMeasure.left=0|this._currentMeasure.left,this._currentMeasure.top=0|this._currentMeasure.top,this._currentMeasure.width=0|this._currentMeasure.width,this._currentMeasure.height=0|this._currentMeasure.height,this._additionalProcessing(e,t),this._cachedParentMeasure.copyFrom(e),this.onDirtyObservable.hasObservers()&&this.onDirtyObservable.notifyObservers(this)},e.prototype._evaluateClippingState=function(e){if(this.parent&&this.parent.clipChildren){if(this._currentMeasure.left>e.left+e.width)return void(this._isClipped=!0);if(this._currentMeasure.left+this._currentMeasure.width<e.left)return void(this._isClipped=!0);if(this._currentMeasure.top>e.top+e.height)return void(this._isClipped=!0);if(this._currentMeasure.top+this._currentMeasure.height<e.top)return void(this._isClipped=!0)}this._isClipped=!1},e.prototype._measure=function(){this._width.isPixel?this._currentMeasure.width=this._width.getValue(this._host):this._currentMeasure.width*=this._width.getValue(this._host),this._height.isPixel?this._currentMeasure.height=this._height.getValue(this._host):this._currentMeasure.height*=this._height.getValue(this._host),0!==this.fixedRatio&&(this._fixedRatioMasterIsWidth?this._currentMeasure.height=this._currentMeasure.width*this.fixedRatio:this._currentMeasure.width=this._currentMeasure.height*this.fixedRatio)},e.prototype._computeAlignment=function(t,i){var r=this._currentMeasure.width,n=this._currentMeasure.height,o=t.width,s=t.height,a=0,h=0;switch(this.horizontalAlignment){case e.HORIZONTAL_ALIGNMENT_LEFT:a=0;break;case e.HORIZONTAL_ALIGNMENT_RIGHT:a=o-r;break;case e.HORIZONTAL_ALIGNMENT_CENTER:a=(o-r)/2}switch(this.verticalAlignment){case e.VERTICAL_ALIGNMENT_TOP:h=0;break;case e.VERTICAL_ALIGNMENT_BOTTOM:h=s-n;break;case e.VERTICAL_ALIGNMENT_CENTER:h=(s-n)/2}this._paddingLeft.isPixel?(this._currentMeasure.left+=this._paddingLeft.getValue(this._host),this._currentMeasure.width-=this._paddingLeft.getValue(this._host)):(this._currentMeasure.left+=o*this._paddingLeft.getValue(this._host),this._currentMeasure.width-=o*this._paddingLeft.getValue(this._host)),this._paddingRight.isPixel?this._currentMeasure.width-=this._paddingRight.getValue(this._host):this._currentMeasure.width-=o*this._paddingRight.getValue(this._host),this._paddingTop.isPixel?(this._currentMeasure.top+=this._paddingTop.getValue(this._host),this._currentMeasure.height-=this._paddingTop.getValue(this._host)):(this._currentMeasure.top+=s*this._paddingTop.getValue(this._host),this._currentMeasure.height-=s*this._paddingTop.getValue(this._host)),this._paddingBottom.isPixel?this._currentMeasure.height-=this._paddingBottom.getValue(this._host):this._currentMeasure.height-=s*this._paddingBottom.getValue(this._host),this._left.isPixel?this._currentMeasure.left+=this._left.getValue(this._host):this._currentMeasure.left+=o*this._left.getValue(this._host),this._top.isPixel?this._currentMeasure.top+=this._top.getValue(this._host):this._currentMeasure.top+=s*this._top.getValue(this._host),this._currentMeasure.left+=a,this._currentMeasure.top+=h},e.prototype._preMeasure=function(e,t){},e.prototype._additionalProcessing=function(e,t){},e.prototype._clipForChildren=function(e){},e.prototype._clip=function(t,i){if(t.beginPath(),e._ClipMeasure.copyFrom(this._currentMeasure),i){i.transformToRef(this._invertTransformMatrix,this._tmpMeasureA);var r=new Nr(0,0,0,0);r.left=Math.max(this._tmpMeasureA.left,this._currentMeasure.left),r.top=Math.max(this._tmpMeasureA.top,this._currentMeasure.top),r.width=Math.min(this._tmpMeasureA.left+this._tmpMeasureA.width,this._currentMeasure.left+this._currentMeasure.width)-r.left,r.height=Math.min(this._tmpMeasureA.top+this._tmpMeasureA.height,this._currentMeasure.top+this._currentMeasure.height)-r.top,e._ClipMeasure.copyFrom(r)}if(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY){var n=this.shadowOffsetX,o=this.shadowOffsetY,s=this.shadowBlur,a=Math.min(Math.min(n,0)-2*s,0),h=Math.max(Math.max(n,0)+2*s,0),u=Math.min(Math.min(o,0)-2*s,0),l=Math.max(Math.max(o,0)+2*s,0);t.rect(e._ClipMeasure.left+a,e._ClipMeasure.top+u,e._ClipMeasure.width+h-a,e._ClipMeasure.height+l-u)}else t.rect(e._ClipMeasure.left,e._ClipMeasure.top,e._ClipMeasure.width,e._ClipMeasure.height);t.clip()},e.prototype._render=function(e,t){return!this.isVisible||this.notRenderable||this._isClipped?(this._isDirty=!1,!1):(this.host._numRenderCalls++,e.save(),this._applyStates(e),this._transform(e),this.clipContent&&this._clip(e,t),this.onBeforeDrawObservable.hasObservers()&&this.onBeforeDrawObservable.notifyObservers(this),this.useBitmapCache&&!this._wasDirty&&this._cacheData?e.putImageData(this._cacheData,this._currentMeasure.left,this._currentMeasure.top):this._draw(e,t),this.useBitmapCache&&this._wasDirty&&(this._cacheData=e.getImageData(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._renderHighlight(e),this.onAfterDrawObservable.hasObservers()&&this.onAfterDrawObservable.notifyObservers(this),e.restore(),!0)},e.prototype._draw=function(e,t){},e.prototype.contains=function(e,t){return this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y,!(e<this._currentMeasure.left)&&(!(e>this._currentMeasure.left+this._currentMeasure.width)&&(!(t<this._currentMeasure.top)&&(!(t>this._currentMeasure.top+this._currentMeasure.height)&&(this.isPointerBlocker&&(this._host._shouldBlockPointer=!0),!0))))},e.prototype._processPicking=function(e,t,i,r,n,o,s,a){return!!this._isEnabled&&(!(!this.isHitTestVisible||!this.isVisible||this._doNotRender)&&(!!this.contains(e,t)&&(this._processObservables(r,e,t,i,n,o,s,a),!0)))},e.prototype._onPointerMove=function(e,t,i,r){this.onPointerMoveObservable.notifyObservers(t,-1,e,this,r)&&null!=this.parent&&this.parent._onPointerMove(e,t,i,r)},e.prototype._onPointerEnter=function(e,t){return!!this._isEnabled&&(!(this._enterCount>0)&&(-1===this._enterCount&&(this._enterCount=0),this._enterCount++,this.onPointerEnterObservable.notifyObservers(this,-1,e,this,t)&&null!=this.parent&&this.parent._onPointerEnter(e,t),!0))},e.prototype._onPointerOut=function(e,t,i){if(void 0===i&&(i=!1),i||this._isEnabled&&e!==this){this._enterCount=0;var r=!0;e.isAscendant(this)||(r=this.onPointerOutObservable.notifyObservers(this,-1,e,this,t)),r&&null!=this.parent&&this.parent._onPointerOut(e,t,i)}},e.prototype._onPointerDown=function(e,t,i,r,n){return this._onPointerEnter(this,n),0===this._downCount&&(this._downCount++,this._downPointerIds[i]=!0,this.onPointerDownObservable.notifyObservers(new Br(t,r),-1,e,this,n)&&null!=this.parent&&this.parent._onPointerDown(e,t,i,r,n),!0)},e.prototype._onPointerUp=function(e,t,i,r,n,o){if(this._isEnabled){this._downCount=0,delete this._downPointerIds[i];var s=n;n&&(this._enterCount>0||-1===this._enterCount)&&(s=this.onPointerClickObservable.notifyObservers(new Br(t,r),-1,e,this,o)),this.onPointerUpObservable.notifyObservers(new Br(t,r),-1,e,this,o)&&null!=this.parent&&this.parent._onPointerUp(e,t,i,r,s,o)}},e.prototype._forcePointerUp=function(e){if(void 0===e&&(e=null),null!==e)this._onPointerUp(this,d.Zero(),e,0,!0);else for(var t in this._downPointerIds)this._onPointerUp(this,d.Zero(),+t,0,!0)},e.prototype._onWheelScroll=function(e,t){this._isEnabled&&(this.onWheelObservable.notifyObservers(new d(e,t))&&null!=this.parent&&this.parent._onWheelScroll(e,t))},e.prototype._onCanvasBlur=function(){},e.prototype._processObservables=function(e,t,i,r,n,o,s,a){if(!this._isEnabled)return!1;if(this._dummyVector2.copyFromFloats(t,i),e===Jt.POINTERMOVE){this._onPointerMove(this,this._dummyVector2,n,r);var h=this._host._lastControlOver[n];return h&&h!==this&&h._onPointerOut(this,r),h!==this&&this._onPointerEnter(this,r),this._host._lastControlOver[n]=this,!0}return e===Jt.POINTERDOWN?(this._onPointerDown(this,this._dummyVector2,n,o,r),this._host._registerLastControlDown(this,n),this._host._lastPickedControl=this,!0):e===Jt.POINTERUP?(this._host._lastControlDown[n]&&this._host._lastControlDown[n]._onPointerUp(this,this._dummyVector2,n,o,!0,r),delete this._host._lastControlDown[n],!0):!(e!==Jt.POINTERWHEEL||!this._host._lastControlOver[n])&&(this._host._lastControlOver[n]._onWheelScroll(s,a),!0)},e.prototype._prepareFont=function(){(this._font||this._fontSet)&&(this._style?this._font=this._style.fontStyle+" "+this._style.fontWeight+" "+this.fontSizeInPixels+"px "+this._style.fontFamily:this._font=this._fontStyle+" "+this._fontWeight+" "+this.fontSizeInPixels+"px "+this._fontFamily,this._fontOffset=e._GetFontOffset(this._font))},e.prototype.dispose=function(){(this.onDirtyObservable.clear(),this.onBeforeDrawObservable.clear(),this.onAfterDrawObservable.clear(),this.onPointerDownObservable.clear(),this.onPointerEnterObservable.clear(),this.onPointerMoveObservable.clear(),this.onPointerOutObservable.clear(),this.onPointerUpObservable.clear(),this.onPointerClickObservable.clear(),this.onWheelObservable.clear(),this._styleObserver&&this._style&&(this._style.onChangedObservable.remove(this._styleObserver),this._styleObserver=null),this.parent&&(this.parent.removeControl(this),this.parent=null),this._host)&&(this._host._linkedControls.indexOf(this)>-1&&this.linkWithMesh(null));this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},Object.defineProperty(e,"HORIZONTAL_ALIGNMENT_LEFT",{get:function(){return e._HORIZONTAL_ALIGNMENT_LEFT},enumerable:!1,configurable:!0}),Object.defineProperty(e,"HORIZONTAL_ALIGNMENT_RIGHT",{get:function(){return e._HORIZONTAL_ALIGNMENT_RIGHT},enumerable:!1,configurable:!0}),Object.defineProperty(e,"HORIZONTAL_ALIGNMENT_CENTER",{get:function(){return e._HORIZONTAL_ALIGNMENT_CENTER},enumerable:!1,configurable:!0}),Object.defineProperty(e,"VERTICAL_ALIGNMENT_TOP",{get:function(){return e._VERTICAL_ALIGNMENT_TOP},enumerable:!1,configurable:!0}),Object.defineProperty(e,"VERTICAL_ALIGNMENT_BOTTOM",{get:function(){return e._VERTICAL_ALIGNMENT_BOTTOM},enumerable:!1,configurable:!0}),Object.defineProperty(e,"VERTICAL_ALIGNMENT_CENTER",{get:function(){return e._VERTICAL_ALIGNMENT_CENTER},enumerable:!1,configurable:!0}),e._GetFontOffset=function(t){if(e._FontHeightSizes[t])return e._FontHeightSizes[t];var i=document.createElement("span");i.innerHTML="Hg",i.style.font=t;var r=document.createElement("div");r.style.display="inline-block",r.style.width="1px",r.style.height="0px",r.style.verticalAlign="bottom";var n=document.createElement("div");n.style.whiteSpace="nowrap",n.appendChild(i),n.appendChild(r),document.body.appendChild(n);var o=0,s=0;try{s=r.getBoundingClientRect().top-i.getBoundingClientRect().top,r.style.verticalAlign="baseline",o=r.getBoundingClientRect().top-i.getBoundingClientRect().top}finally{document.body.removeChild(n)}var a={ascent:o,height:s,descent:s-o};return e._FontHeightSizes[t]=a,a},e.drawEllipse=function(e,t,i,r,n){n.translate(e,t),n.scale(i,r),n.beginPath(),n.arc(0,0,1,0,2*Math.PI),n.closePath(),n.scale(1/i,1/r),n.translate(-e,-t)},e.AllowAlphaInheritance=!1,e._ClipMeasure=new Nr(0,0,0,0),e._HORIZONTAL_ALIGNMENT_LEFT=0,e._HORIZONTAL_ALIGNMENT_RIGHT=1,e._HORIZONTAL_ALIGNMENT_CENTER=2,e._VERTICAL_ALIGNMENT_TOP=0,e._VERTICAL_ALIGNMENT_BOTTOM=1,e._VERTICAL_ALIGNMENT_CENTER=2,e._FontHeightSizes={},e.AddHeader=function(){},e}();c.RegisteredTypes["BABYLON.GUI.Control"]=Ur;var Vr=function(e){function i(t){var i=e.call(this,t)||this;return i.name=t,i._children=new Array,i._measureForChildren=Nr.Empty(),i._background="",i._adaptWidthToChildren=!1,i._adaptHeightToChildren=!1,i.logLayoutCycleErrors=!1,i.maxLayoutCycle=3,i}return t(i,e),Object.defineProperty(i.prototype,"adaptHeightToChildren",{get:function(){return this._adaptHeightToChildren},set:function(e){this._adaptHeightToChildren!==e&&(this._adaptHeightToChildren=e,e&&(this.height="100%"),this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"adaptWidthToChildren",{get:function(){return this._adaptWidthToChildren},set:function(e){this._adaptWidthToChildren!==e&&(this._adaptWidthToChildren=e,e&&(this.width="100%"),this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"children",{get:function(){return this._children},enumerable:!1,configurable:!0}),i.prototype._getTypeName=function(){return"Container"},i.prototype._flagDescendantsAsMatrixDirty=function(){for(var e=0,t=this.children;e<t.length;e++){t[e]._markMatrixAsDirty()}},i.prototype.getChildByName=function(e){for(var t=0,i=this.children;t<i.length;t++){var r=i[t];if(r.name===e)return r}return null},i.prototype.getChildByType=function(e,t){for(var i=0,r=this.children;i<r.length;i++){var n=r[i];if(n.typeName===t)return n}return null},i.prototype.containsControl=function(e){return-1!==this.children.indexOf(e)},i.prototype.addControl=function(e){return e?(-1!==this._children.indexOf(e)||(e._link(this._host),e._markAllAsDirty(),this._reOrderControl(e),this._markAsDirty()),this):this},i.prototype.clearControls=function(){for(var e=0,t=this.children.slice();e<t.length;e++){var i=t[e];this.removeControl(i)}return this},i.prototype.removeControl=function(e){var t=this._children.indexOf(e);return-1!==t&&(this._children.splice(t,1),e.parent=null),e.linkWithMesh(null),this._host&&this._host._cleanControlAfterRemoval(e),this._markAsDirty(),this},i.prototype._reOrderControl=function(e){this.removeControl(e);for(var t=!1,i=0;i<this._children.length;i++)if(this._children[i].zIndex>e.zIndex){this._children.splice(i,0,e),t=!0;break}t||this._children.push(e),e.parent=this,this._markAsDirty()},i.prototype._offsetLeft=function(t){e.prototype._offsetLeft.call(this,t);for(var i=0,r=this._children;i<r.length;i++){r[i]._offsetLeft(t)}},i.prototype._offsetTop=function(t){e.prototype._offsetTop.call(this,t);for(var i=0,r=this._children;i<r.length;i++){r[i]._offsetTop(t)}},i.prototype._markAllAsDirty=function(){e.prototype._markAllAsDirty.call(this);for(var t=0;t<this._children.length;t++)this._children[t]._markAllAsDirty()},i.prototype._localDraw=function(e){this._background&&(e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),e.fillStyle=this._background,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),e.restore())},i.prototype._link=function(t){e.prototype._link.call(this,t);for(var i=0,r=this._children;i<r.length;i++){r[i]._link(t)}},i.prototype._beforeLayout=function(){},i.prototype._processMeasures=function(t,i){!this._isDirty&&this._cachedParentMeasure.isEqualsTo(t)||(e.prototype._processMeasures.call(this,t,i),this._evaluateClippingState(t))},i.prototype._layout=function(e,t){if(!this.isDirty&&(!this.isVisible||this.notRenderable))return!1;this.host._numLayoutCalls++,this._isDirty&&this._currentMeasure.transformToRef(this._transformMatrix,this._prevCurrentMeasureTransformedIntoGlobalSpace);var i=0;t.save(),this._applyStates(t),this._beforeLayout();do{var r=-1,n=-1;if(this._rebuildLayout=!1,this._processMeasures(e,t),!this._isClipped){for(var o=0,s=this._children;o<s.length;o++){var a=s[o];a._tempParentMeasure.copyFrom(this._measureForChildren),a._layout(this._measureForChildren,t)&&(this.adaptWidthToChildren&&a._width.isPixel&&(r=Math.max(r,a._currentMeasure.width+a.paddingLeftInPixels+a.paddingRightInPixels)),this.adaptHeightToChildren&&a._height.isPixel&&(n=Math.max(n,a._currentMeasure.height+a.paddingTopInPixels+a.paddingBottomInPixels)))}this.adaptWidthToChildren&&r>=0&&(r+=this.paddingLeftInPixels+this.paddingRightInPixels,this.width!==r+"px"&&(this.width=r+"px",this._rebuildLayout=!0)),this.adaptHeightToChildren&&n>=0&&(n+=this.paddingTopInPixels+this.paddingBottomInPixels,this.height!==n+"px"&&(this.height=n+"px",this._rebuildLayout=!0)),this._postMeasure()}i++}while(this._rebuildLayout&&i<this.maxLayoutCycle);return i>=3&&this.logLayoutCycleErrors&&q.Error("Layout cycle detected in GUI (Container name="+this.name+", uniqueId="+this.uniqueId+")"),t.restore(),this._isDirty&&(this.invalidateRect(),this._isDirty=!1),!0},i.prototype._postMeasure=function(){},i.prototype._draw=function(e,t){this._localDraw(e),this.clipChildren&&this._clipForChildren(e);for(var i=0,r=this._children;i<r.length;i++){var n=r[i];t&&!n._intersectsRect(t)||n._render(e,t)}},i.prototype.getDescendantsToRef=function(e,t,i){if(void 0===t&&(t=!1),this.children)for(var r=0;r<this.children.length;r++){var n=this.children[r];i&&!i(n)||e.push(n),t||n.getDescendantsToRef(e,!1,i)}},i.prototype._processPicking=function(t,i,r,n,o,s,a,h){if(!this._isEnabled||!this.isVisible||this.notRenderable)return!1;if(!e.prototype.contains.call(this,t,i))return!1;for(var u=this._children.length-1;u>=0;u--){var l=this._children[u];if(l._processPicking(t,i,r,n,o,s,a,h))return l.hoverCursor&&this._host._changeCursor(l.hoverCursor),!0}return!!this.isHitTestVisible&&this._processObservables(n,t,i,r,o,s,a,h)},i.prototype._additionalProcessing=function(t,i){e.prototype._additionalProcessing.call(this,t,i),this._measureForChildren.copyFrom(this._currentMeasure)},i.prototype.dispose=function(){e.prototype.dispose.call(this);for(var t=this.children.length-1;t>=0;t--)this.children[t].dispose()},i}(Ur);c.RegisteredTypes["BABYLON.GUI.Container"]=Vr;var Wr,zr=function(e){function i(t){var i=e.call(this,t)||this;return i.name=t,i._thickness=1,i._cornerRadius=0,i}return t(i,e),Object.defineProperty(i.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cornerRadius",{get:function(){return this._cornerRadius},set:function(e){e<0&&(e=0),this._cornerRadius!==e&&(this._cornerRadius=e,this._markAsDirty())},enumerable:!1,configurable:!0}),i.prototype._getTypeName=function(){return"Rectangle"},i.prototype._localDraw=function(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._background&&(e.fillStyle=this._background,this._cornerRadius?(this._drawRoundedRect(e,this._thickness/2),e.fill()):e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),this._thickness&&((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this.color&&(e.strokeStyle=this.color),e.lineWidth=this._thickness,this._cornerRadius?(this._drawRoundedRect(e,this._thickness/2),e.stroke()):e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness)),e.restore()},i.prototype._additionalProcessing=function(t,i){e.prototype._additionalProcessing.call(this,t,i),this._measureForChildren.width-=2*this._thickness,this._measureForChildren.height-=2*this._thickness,this._measureForChildren.left+=this._thickness,this._measureForChildren.top+=this._thickness},i.prototype._drawRoundedRect=function(e,t){void 0===t&&(t=0);var i=this._currentMeasure.left+t,r=this._currentMeasure.top+t,n=this._currentMeasure.width-2*t,o=this._currentMeasure.height-2*t,s=Math.min(o/2-2,Math.min(n/2-2,this._cornerRadius));e.beginPath(),e.moveTo(i+s,r),e.lineTo(i+n-s,r),e.quadraticCurveTo(i+n,r,i+n,r+s),e.lineTo(i+n,r+o-s),e.quadraticCurveTo(i+n,r+o,i+n-s,r+o),e.lineTo(i+s,r+o),e.quadraticCurveTo(i,r+o,i,r+o-s),e.lineTo(i,r+s),e.quadraticCurveTo(i,r,i+s,r),e.closePath()},i.prototype._clipForChildren=function(e){this._cornerRadius&&(this._drawRoundedRect(e,this._thickness),e.clip())},i}(Vr);c.RegisteredTypes["BABYLON.GUI.Rectangle"]=zr,function(e){e[e.Clip=0]="Clip",e[e.WordWrap=1]="WordWrap",e[e.Ellipsis=2]="Ellipsis"}(Wr||(Wr={}));var Gr=function(e){function i(t,i){void 0===i&&(i="");var r=e.call(this,t)||this;return r.name=t,r._text="",r._textWrapping=Wr.Clip,r._textHorizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_CENTER,r._textVerticalAlignment=Ur.VERTICAL_ALIGNMENT_CENTER,r._resizeToFit=!1,r._lineSpacing=new Rr(0),r._outlineWidth=0,r._outlineColor="white",r._underline=!1,r._lineThrough=!1,r.onTextChangedObservable=new U,r.onLinesReadyObservable=new U,r.text=i,r}return t(i,e),Object.defineProperty(i.prototype,"lines",{get:function(){return this._lines},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"resizeToFit",{get:function(){return this._resizeToFit},set:function(e){this._resizeToFit!==e&&(this._resizeToFit=e,this._resizeToFit&&(this._width.ignoreAdaptiveScaling=!0,this._height.ignoreAdaptiveScaling=!0),this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"textWrapping",{get:function(){return this._textWrapping},set:function(e){this._textWrapping!==e&&(this._textWrapping=+e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"text",{get:function(){return this._text},set:function(e){this._text!==e&&(this._text=e,this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"textHorizontalAlignment",{get:function(){return this._textHorizontalAlignment},set:function(e){this._textHorizontalAlignment!==e&&(this._textHorizontalAlignment=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"textVerticalAlignment",{get:function(){return this._textVerticalAlignment},set:function(e){this._textVerticalAlignment!==e&&(this._textVerticalAlignment=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"lineSpacing",{get:function(){return this._lineSpacing.toString(this._host)},set:function(e){this._lineSpacing.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"outlineWidth",{get:function(){return this._outlineWidth},set:function(e){this._outlineWidth!==e&&(this._outlineWidth=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"underline",{get:function(){return this._underline},set:function(e){this._underline!==e&&(this._underline=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"lineThrough",{get:function(){return this._lineThrough},set:function(e){this._lineThrough!==e&&(this._lineThrough=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"outlineColor",{get:function(){return this._outlineColor},set:function(e){this._outlineColor!==e&&(this._outlineColor=e,this._markAsDirty())},enumerable:!1,configurable:!0}),i.prototype._getTypeName=function(){return"TextBlock"},i.prototype._processMeasures=function(t,i){this._fontOffset||(this._fontOffset=Ur._GetFontOffset(i.font)),e.prototype._processMeasures.call(this,t,i),this._lines=this._breakLines(this._currentMeasure.width,i),this.onLinesReadyObservable.notifyObservers(this);for(var r=0,n=0;n<this._lines.length;n++){var o=this._lines[n];o.width>r&&(r=o.width)}if(this._resizeToFit){if(this._textWrapping===Wr.Clip){var s=this.paddingLeftInPixels+this.paddingRightInPixels+r|0;s!==this._width.internalValue&&(this._width.updateInPlace(s,Rr.UNITMODE_PIXEL),this._rebuildLayout=!0)}var a=this.paddingTopInPixels+this.paddingBottomInPixels+this._fontOffset.height*this._lines.length|0;if(this._lines.length>0&&0!==this._lineSpacing.internalValue){var h=0;h=this._lineSpacing.isPixel?this._lineSpacing.getValue(this._host):this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height),a+=(this._lines.length-1)*h}a!==this._height.internalValue&&(this._height.updateInPlace(a,Rr.UNITMODE_PIXEL),this._rebuildLayout=!0)}},i.prototype._drawText=function(e,t,i,r){var n=this._currentMeasure.width,o=0;switch(this._textHorizontalAlignment){case Ur.HORIZONTAL_ALIGNMENT_LEFT:o=0;break;case Ur.HORIZONTAL_ALIGNMENT_RIGHT:o=n-t;break;case Ur.HORIZONTAL_ALIGNMENT_CENTER:o=(n-t)/2}(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(r.shadowColor=this.shadowColor,r.shadowBlur=this.shadowBlur,r.shadowOffsetX=this.shadowOffsetX,r.shadowOffsetY=this.shadowOffsetY),this.outlineWidth&&r.strokeText(e,this._currentMeasure.left+o,i),r.fillText(e,this._currentMeasure.left+o,i),this._underline&&(r.beginPath(),r.lineWidth=Math.round(.05*this.fontSizeInPixels),r.moveTo(this._currentMeasure.left+o,i+3),r.lineTo(this._currentMeasure.left+o+t,i+3),r.stroke(),r.closePath()),this._lineThrough&&(r.beginPath(),r.lineWidth=Math.round(.05*this.fontSizeInPixels),r.moveTo(this._currentMeasure.left+o,i-this.fontSizeInPixels/3),r.lineTo(this._currentMeasure.left+o+t,i-this.fontSizeInPixels/3),r.stroke(),r.closePath())},i.prototype._draw=function(e,t){e.save(),this._applyStates(e),this._renderLines(e),e.restore()},i.prototype._applyStates=function(t){e.prototype._applyStates.call(this,t),this.outlineWidth&&(t.lineWidth=this.outlineWidth,t.strokeStyle=this.outlineColor,t.lineJoin="miter",t.miterLimit=2)},i.prototype._breakLines=function(e,t){var i=[],r=this.text.split("\n");if(this._textWrapping===Wr.Ellipsis)for(var n=0,o=r;n<o.length;n++){var s=o[n];i.push(this._parseLineEllipsis(s,e,t))}else if(this._textWrapping===Wr.WordWrap)for(var a=0,h=r;a<h.length;a++){s=h[a];i.push.apply(i,this._parseLineWordWrap(s,e,t))}else for(var u=0,l=r;u<l.length;u++){s=l[u];i.push(this._parseLine(s,t))}return i},i.prototype._parseLine=function(e,t){return void 0===e&&(e=""),{text:e,width:t.measureText(e).width}},i.prototype._parseLineEllipsis=function(e,t,i){void 0===e&&(e="");var r=i.measureText(e).width;r>t&&(e+="…");var n=Array.from&&Array.from(e);if(n)for(;n.length&&r>t;)n.pop(),e=n.join("")+"...",r=i.measureText(e).width;else for(;e.length>2&&r>t;)e=e.slice(0,-2)+"…",r=i.measureText(e).width;return{text:e,width:r}},i.prototype._parseLineWordWrap=function(e,t,i){void 0===e&&(e="");for(var r=[],n=this.wordSplittingFunction?this.wordSplittingFunction(e):e.split(" "),o=0,s=0;s<n.length;s++){var a=s>0?e+" "+n[s]:n[0],h=i.measureText(a).width;h>t&&s>0?(r.push({text:e,width:o}),e=n[s],o=i.measureText(e).width):(o=h,e=a)}return r.push({text:e,width:o}),r},i.prototype._renderLines=function(e){var t=this._currentMeasure.height,i=0;switch(this._textVerticalAlignment){case Ur.VERTICAL_ALIGNMENT_TOP:i=this._fontOffset.ascent;break;case Ur.VERTICAL_ALIGNMENT_BOTTOM:i=t-this._fontOffset.height*(this._lines.length-1)-this._fontOffset.descent;break;case Ur.VERTICAL_ALIGNMENT_CENTER:i=this._fontOffset.ascent+(t-this._fontOffset.height*this._lines.length)/2}i+=this._currentMeasure.top;for(var r=0;r<this._lines.length;r++){var n=this._lines[r];0!==r&&0!==this._lineSpacing.internalValue&&(this._lineSpacing.iage
/MediaBox [ 0.00 0.00 612.00 936.00 ]
/Contents [ 28 0 R ]
/Parent 3 0 R
/Rotate 0
/Resources <<
/ProcSet [ /PDF /ImageB ]
/XObject <<
/Im27 27 0 R
>>
>>
>>
endobj
2 0 obj
<<
/Type /Catalog
/Pages 3 0 R
>>
endobj
3 0 obj
<<
/Type /Pages
/Count 2
/Kids [ 26 0 R 30 0 R ]
>>
endobj
xref
0 31
0000000000 65535 f
0000000015 00000 n
0000180392 00000 n
0000180441 00000 n
0000000000 00000 f
0000000000 00000 f
0000000000 00000 f
0000000000 00000 f
0000000000 00000 f
0000000000 00000 f
0000000000 00000 f
0000000000 00000 f
0000000000 00000 f
0000000000 00000 f
0000000000 00000 f
0000000000 00000 f
0000000000 00000 f
0000000000 00000 f
0000000000 00000 f
0000000000 00000 f
0000000000 00000 f
0000000000 00000 f
0000000000 00000 f
0000000174 00000 n
0000054414 00000 n
0000054513 00000 n
0000054532 00000 n
0000054720 00000 n
0000180086 00000 n
0000180185 00000 n
0000180204 00000 n
trailer
<<
/Size 31
/Root 2 0 R
/Info 1 0 R
>>
startxref
180508
%%EOF
