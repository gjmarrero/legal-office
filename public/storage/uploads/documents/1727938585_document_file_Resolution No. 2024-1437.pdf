sPixel?i+=this._lineSpacing.getValue(this._host):i+=this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height)),this._drawText(n.text,n.width,i,e),i+=this._fontOffset.height}},i.prototype.computeExpectedHeight=function(){if(this.text&&this.widthInPixels){var e=document.createElement("canvas").getContext("2d");if(e){this._applyStates(e),this._fontOffset||(this._fontOffset=Ur._GetFontOffset(e.font));var t=this._lines?this._lines:this._breakLines(this.widthInPixels-this.paddingLeftInPixels-this.paddingRightInPixels,e),i=this.paddingTopInPixels+this.paddingBottomInPixels+this._fontOffset.height*t.length;if(t.length>0&&0!==this._lineSpacing.internalValue){var r=0;r=this._lineSpacing.isPixel?this._lineSpacing.getValue(this._host):this._lineSpacing.getValue(this._host)*this._height.getValueInPixel(this._host,this._cachedParentMeasure.height),i+=(t.length-1)*r}return i}}return 0},i.prototype.dispose=function(){e.prototype.dispose.call(this),this.onTextChangedObservable.clear()},i}(Ur);c.RegisteredTypes["BABYLON.GUI.TextBlock"]=Gr;var Hr=function(e){function i(t,r){void 0===r&&(r=null);var n=e.call(this,t)||this;return n.name=t,n._workingCanvas=null,n._loaded=!1,n._stretch=i.STRETCH_FILL,n._autoScale=!1,n._sourceLeft=0,n._sourceTop=0,n._sourceWidth=0,n._sourceHeight=0,n._svgAttributesComputationCompleted=!1,n._isSVG=!1,n._cellWidth=0,n._cellHeight=0,n._cellId=-1,n._populateNinePatchSlicesFromImage=!1,n._imageDataCache={data:null,key:""},n.onImageLoadedObservable=new U,n.onSVGAttributesComputedObservable=new U,n.source=r,n}return t(i,e),Object.defineProperty(i.prototype,"isLoaded",{get:function(){return this._loaded},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"populateNinePatchSlicesFromImage",{get:function(){return this._populateNinePatchSlicesFromImage},set:function(e){this._populateNinePatchSlicesFromImage!==e&&(this._populateNinePatchSlicesFromImage=e,this._populateNinePatchSlicesFromImage&&this._loaded&&this._extractNinePatchSliceDataFromImage())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"detectPointerOnOpaqueOnly",{get:function(){return this._detectPointerOnOpaqueOnly},set:function(e){this._detectPointerOnOpaqueOnly!==e&&(this._detectPointerOnOpaqueOnly=e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sliceLeft",{get:function(){return this._sliceLeft},set:function(e){this._sliceLeft!==e&&(this._sliceLeft=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sliceRight",{get:function(){return this._sliceRight},set:function(e){this._sliceRight!==e&&(this._sliceRight=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sliceTop",{get:function(){return this._sliceTop},set:function(e){this._sliceTop!==e&&(this._sliceTop=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sliceBottom",{get:function(){return this._sliceBottom},set:function(e){this._sliceBottom!==e&&(this._sliceBottom=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sourceLeft",{get:function(){return this._sourceLeft},set:function(e){this._sourceLeft!==e&&(this._sourceLeft=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sourceTop",{get:function(){return this._sourceTop},set:function(e){this._sourceTop!==e&&(this._sourceTop=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sourceWidth",{get:function(){return this._sourceWidth},set:function(e){this._sourceWidth!==e&&(this._sourceWidth=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"sourceHeight",{get:function(){return this._sourceHeight},set:function(e){this._sourceHeight!==e&&(this._sourceHeight=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isSVG",{get:function(){return this._isSVG},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"svgAttributesComputationCompleted",{get:function(){return this._svgAttributesComputationCompleted},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"autoScale",{get:function(){return this._autoScale},set:function(e){this._autoScale!==e&&(this._autoScale=e,e&&this._loaded&&this.synchronizeSizeWithContent())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"stretch",{get:function(){return this._stretch},set:function(e){this._stretch!==e&&(this._stretch=e,this._markAsDirty())},enumerable:!1,configurable:!0}),i.prototype._rotate90=function(e,t){void 0===t&&(t=!1);var r=document.createElement("canvas"),n=r.getContext("2d"),o=this._domImage.width,s=this._domImage.height;r.width=s,r.height=o,n.translate(r.width/2,r.height/2),n.rotate(e*Math.PI/2),n.drawImage(this._domImage,0,0,o,s,-o/2,-s/2,o,s);var a=r.toDataURL("image/jpg"),h=new i(this.name+"rotated",a);return t&&(h._stretch=this._stretch,h._autoScale=this._autoScale,h._cellId=this._cellId,h._cellWidth=e%1?this._cellHeight:this._cellWidth,h._cellHeight=e%1?this._cellWidth:this._cellHeight),this._handleRotationForSVGImage(this,h,e),this._imageDataCache.data=null,h},i.prototype._handleRotationForSVGImage=function(e,t,i){var r=this;e._isSVG&&(e._svgAttributesComputationCompleted?(this._rotate90SourceProperties(e,t,i),this._markAsDirty()):e.onSVGAttributesComputedObservable.addOnce((function(){r._rotate90SourceProperties(e,t,i),r._markAsDirty()})))},i.prototype._rotate90SourceProperties=function(e,t,i){var r,n,o=e.sourceLeft,s=e.sourceTop,a=e.domImage.width,h=e.domImage.height,u=o,l=s,c=e.sourceWidth,f=e.sourceHeight;if(0!=i){var d=i<0?-1:1;i%=4;for(var p=0;p<Math.abs(i);++p)u=-(s-h/2)*d+h/2,l=(o-a/2)*d+a/2,c=(r=[f,c])[0],f=r[1],i<0?l-=f:u-=c,o=u,s=l,a=(n=[h,a])[0],h=n[1]}t.sourceLeft=u,t.sourceTop=l,t.sourceWidth=c,t.sourceHeight=f},Object.defineProperty(i.prototype,"domImage",{get:function(){return this._domImage},set:function(e){var t=this;this._domImage=e,this._loaded=!1,this._imageDataCache.data=null,this._domImage.width?this._onImageLoaded():this._domImage.onload=function(){t._onImageLoaded()}},enumerable:!1,configurable:!0}),i.prototype._onImageLoaded=function(){this._imageDataCache.data=null,this._imageWidth=this._domImage.width,this._imageHeight=this._domImage.height,this._loaded=!0,this._populateNinePatchSlicesFromImage&&this._extractNinePatchSliceDataFromImage(),this._autoScale&&this.synchronizeSizeWithContent(),this.onImageLoadedObservable.notifyObservers(this),this._markAsDirty()},i.prototype._extractNinePatchSliceDataFromImage=function(){this._workingCanvas||(this._workingCanvas=document.createElement("canvas"));var e=this._workingCanvas,t=e.getContext("2d"),i=this._domImage.width,r=this._domImage.height;e.width=i,e.height=r,t.drawImage(this._domImage,0,0,i,r);var n=t.getImageData(0,0,i,r);this._sliceLeft=-1,this._sliceRight=-1;for(var o=0;o<i;o++){if((a=n.data[4*o+3])>127&&-1===this._sliceLeft)this._sliceLeft=o;else if(a<127&&this._sliceLeft>-1){this._sliceRight=o;break}}this._sliceTop=-1,this._sliceBottom=-1;for(var s=0;s<r;s++){var a;if((a=n.data[s*i*4+3])>127&&-1===this._sliceTop)this._sliceTop=s;else if(a<127&&this._sliceTop>-1){this._sliceBottom=s;break}}},Object.defineProperty(i.prototype,"source",{set:function(e){var t=this;this._source!==e&&(this._loaded=!1,this._source=e,this._imageDataCache.data=null,e&&(e=this._svgCheck(e)),this._domImage=document.createElement("img"),this._domImage.onload=function(){t._onImageLoaded()},e&&(Ue.SetCorsBehavior(e,this._domImage),this._domImage.src=e))},enumerable:!1,configurable:!0}),i.prototype._svgCheck=function(e){var t=this;if(window.SVGSVGElement&&-1!==e.search(/.svg#/gi)&&e.indexOf("#")===e.lastIndexOf("#")){this._isSVG=!0;var i=e.split("#")[0],r=e.split("#")[1],n=document.body.querySelector('object[data="'+i+'"]');if(n){var o=n.contentDocument;if(o&&o.documentElement){var s=o.documentElement.getAttribute("viewBox"),a=Number(o.documentElement.getAttribute("width")),h=Number(o.documentElement.getAttribute("height"));if(o.getElementById(r)&&s&&a&&h)return this._getSVGAttribs(n,r),e}n.addEventListener("load",(function(){t._getSVGAttribs(n,r)}))}else{var u=document.createElement("object");u.data=i,u.type="image/svg+xml",u.width="0%",u.height="0%",document.body.appendChild(u),u.onload=function(){var e=document.body.querySelector('object[data="'+i+'"]');e&&t._getSVGAttribs(e,r)}}return i}return e},i.prototype._getSVGAttribs=function(e,t){var i=e.contentDocument;if(i&&i.documentElement){var r=i.documentElement.getAttribute("viewBox"),n=Number(i.documentElement.getAttribute("width")),o=Number(i.documentElement.getAttribute("height")),s=i.getElementById(t);if(r&&n&&o&&s){var a=Number(r.split(" ")[2]),h=Number(r.split(" ")[3]),u=s.getBBox(),l=1,c=1,f=0,d=0;s.transform&&s.transform.baseVal.consolidate()&&(l=s.transform.baseVal.consolidate().matrix.a,c=s.transform.baseVal.consolidate().matrix.d,f=s.transform.baseVal.consolidate().matrix.e,d=s.transform.baseVal.consolidate().matrix.f),this.sourceLeft=(l*u.x+f)*n/a,this.sourceTop=(c*u.y+d)*o/h,this.sourceWidth=u.width*l*(n/a),this.sourceHeight=u.height*c*(o/h),this._svgAttributesComputationCompleted=!0,this.onSVGAttributesComputedObservable.notifyObservers(this)}}},Object.defineProperty(i.prototype,"cellWidth",{get:function(){return this._cellWidth},set:function(e){this._cellWidth!==e&&(this._cellWidth=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cellHeight",{get:function(){return this._cellHeight},set:function(e){this._cellHeight!==e&&(this._cellHeight=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cellId",{get:function(){return this._cellId},set:function(e){this._cellId!==e&&(this._cellId=e,this._markAsDirty())},enumerable:!1,configurable:!0}),i.prototype.contains=function(t,i){if(!e.prototype.contains.call(this,t,i))return!1;if(!this._detectPointerOnOpaqueOnly||!this._workingCanvas)return!0;var r=0|this._currentMeasure.width,n=0|this._currentMeasure.height,o=r+"_"+n,s=this._imageDataCache.data;if(!s||this._imageDataCache.key!==o){var a=this._workingCanvas.getContext("2d");this._imageDataCache.data=s=a.getImageData(0,0,r,n).data,this._imageDataCache.key=o}return s[4*((t=t-this._currentMeasure.left|0)+(i=i-this._currentMeasure.top|0)*r)+3]>0},i.prototype._getTypeName=function(){return"Image"},i.prototype.synchronizeSizeWithContent=function(){this._loaded&&(this.width=this._domImage.width+"px",this.height=this._domImage.height+"px")},i.prototype._processMeasures=function(t,r){if(this._loaded)switch(this._stretch){case i.STRETCH_NONE:case i.STRETCH_FILL:case i.STRETCH_UNIFORM:case i.STRETCH_NINE_PATCH:break;case i.STRETCH_EXTEND:this._autoScale&&this.synchronizeSizeWithContent(),this.parent&&this.parent.parent&&(this.parent.adaptWidthToChildren=!0,this.parent.adaptHeightToChildren=!0)}e.prototype._processMeasures.call(this,t,r)},i.prototype._prepareWorkingCanvasForOpaqueDetection=function(){if(this._detectPointerOnOpaqueOnly){this._workingCanvas||(this._workingCanvas=document.createElement("canvas"));var e=this._workingCanvas,t=this._currentMeasure.width,i=this._currentMeasure.height,r=e.getContext("2d");e.width=t,e.height=i,r.clearRect(0,0,t,i)}},i.prototype._drawImage=function(e,t,i,r,n,o,s,a,h){(e.drawImage(this._domImage,t,i,r,n,o,s,a,h),this._detectPointerOnOpaqueOnly)&&(e=this._workingCanvas.getContext("2d")).drawImage(this._domImage,t,i,r,n,o-this._currentMeasure.left,s-this._currentMeasure.top,a,h)},i.prototype._draw=function(e){var t,r,n,o;if(e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),-1==this.cellId)t=this._sourceLeft,r=this._sourceTop,n=this._sourceWidth?this._sourceWidth:this._imageWidth,o=this._sourceHeight?this._sourceHeight:this._imageHeight;else{var s=this._domImage.naturalWidth/this.cellWidth,a=this.cellId/s>>0,h=this.cellId%s;t=this.cellWidth*h,r=this.cellHeight*a,n=this.cellWidth,o=this.cellHeight}if(this._prepareWorkingCanvasForOpaqueDetection(),this._applyStates(e),this._loaded)switch(this._stretch){case i.STRETCH_NONE:case i.STRETCH_FILL:this._drawImage(e,t,r,n,o,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case i.STRETCH_UNIFORM:var u=this._currentMeasure.width/n,l=this._currentMeasure.height/o,c=Math.min(u,l),f=(this._currentMeasure.width-n*c)/2,d=(this._currentMeasure.height-o*c)/2;this._drawImage(e,t,r,n,o,this._currentMeasure.left+f,this._currentMeasure.top+d,n*c,o*c);break;case i.STRETCH_EXTEND:this._drawImage(e,t,r,n,o,this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height);break;case i.STRETCH_NINE_PATCH:this._renderNinePatch(e)}e.restore()},i.prototype._renderCornerPatch=function(e,t,i,r,n,o,s){this._drawImage(e,t,i,r,n,this._currentMeasure.left+o,this._currentMeasure.top+s,r,n)},i.prototype._renderNinePatch=function(e){var t=this._imageHeight,i=this._sliceLeft,r=this._sliceTop,n=this._imageHeight-this._sliceBottom,o=this._imageWidth-this._sliceRight,s=0,a=0;this._populateNinePatchSlicesFromImage&&(s=1,a=1,t-=2,i-=1,r-=1,n-=1,o-=1);var h=this._sliceRight-this._sliceLeft,u=this._currentMeasure.width-o-this.sliceLeft,l=this._currentMeasure.height-t+this._sliceBottom;this._renderCornerPatch(e,s,a,i,r,0,0),this._renderCornerPatch(e,s,this._sliceBottom,i,t-this._sliceBottom,0,l),this._renderCornerPatch(e,this._sliceRight,a,o,r,this._currentMeasure.width-o,0),this._renderCornerPatch(e,this._sliceRight,this._sliceBottom,o,t-this._sliceBottom,this._currentMeasure.width-o,l),this._drawImage(e,this._sliceLeft,this._sliceTop,h,this._sliceBottom-this._sliceTop,this._currentMeasure.left+i,this._currentMeasure.top+r,u,l-r),this._drawImage(e,s,this._sliceTop,i,this._sliceBottom-this._sliceTop,this._currentMeasure.left,this._currentMeasure.top+r,i,l-r),this._drawImage(e,this._sliceRight,this._sliceTop,i,this._sliceBottom-this._sliceTop,this._currentMeasure.left+this._currentMeasure.width-o,this._currentMeasure.top+r,i,l-r),this._drawImage(e,this._sliceLeft,a,h,r,this._currentMeasure.left+i,this._currentMeasure.top,u,r),this._drawImage(e,this._sliceLeft,this._sliceBottom,h,n,this._currentMeasure.left+i,this._currentMeasure.top+l,u,n)},i.prototype.dispose=function(){e.prototype.dispose.call(this),this.onImageLoadedObservable.clear(),this.onSVGAttributesComputedObservable.clear()},i.STRETCH_NONE=0,i.STRETCH_FILL=1,i.STRETCH_UNIFORM=2,i.STRETCH_EXTEND=3,i.STRETCH_NINE_PATCH=4,i}(Ur);c.RegisteredTypes["BABYLON.GUI.Image"]=Hr;var Xr=function(e){function i(t){var i=e.call(this,t)||this;i.name=t,i.delegatePickingToChildren=!1,i.thickness=1,i.isPointerBlocker=!0;var r=null;return i.pointerEnterAnimation=function(){r=i.alpha,i.alpha-=.1},i.pointerOutAnimation=function(){null!==r&&(i.alpha=r)},i.pointerDownAnimation=function(){i.scaleX-=.05,i.scaleY-=.05},i.pointerUpAnimation=function(){i.scaleX+=.05,i.scaleY+=.05},i}return t(i,e),Object.defineProperty(i.prototype,"image",{get:function(){return this._image},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"textBlock",{get:function(){return this._textBlock},enumerable:!1,configurable:!0}),i.prototype._getTypeName=function(){return"Button"},i.prototype._processPicking=function(t,i,r,n,o,s,a,h){if(!this._isEnabled||!this.isHitTestVisible||!this.isVisible||this.notRenderable)return!1;if(!e.prototype.contains.call(this,t,i))return!1;if(this.delegatePickingToChildren){for(var u=!1,l=this._children.length-1;l>=0;l--){var c=this._children[l];if(c.isEnabled&&c.isHitTestVisible&&c.isVisible&&!c.notRenderable&&c.contains(t,i)){u=!0;break}}if(!u)return!1}return this._processObservables(n,t,i,r,o,s,a,h),!0},i.prototype._onPointerEnter=function(t,i){return!!e.prototype._onPointerEnter.call(this,t,i)&&(this.pointerEnterAnimation&&this.pointerEnterAnimation(),!0)},i.prototype._onPointerOut=function(t,i,r){void 0===r&&(r=!1),this.pointerOutAnimation&&this.pointerOutAnimation(),e.prototype._onPointerOut.call(this,t,i,r)},i.prototype._onPointerDown=function(t,i,r,n,o){return!!e.prototype._onPointerDown.call(this,t,i,r,n,o)&&(this.pointerDownAnimation&&this.pointerDownAnimation(),!0)},i.prototype._onPointerUp=function(t,i,r,n,o,s){this.pointerUpAnimation&&this.pointerUpAnimation(),e.prototype._onPointerUp.call(this,t,i,r,n,o,s)},i.CreateImageButton=function(e,t,r){var n=new i(e),o=new Gr(e+"_button",t);o.textWrapping=!0,o.textHorizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_CENTER,o.paddingLeft="20%",n.addControl(o);var s=new Hr(e+"_icon",r);return s.width="20%",s.stretch=Hr.STRETCH_UNIFORM,s.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT,n.addControl(s),n._image=s,n._textBlock=o,n},i.CreateImageOnlyButton=function(e,t){var r=new i(e),n=new Hr(e+"_icon",t);return n.stretch=Hr.STRETCH_FILL,n.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT,r.addControl(n),r._image=n,r},i.CreateSimpleButton=function(e,t){var r=new i(e),n=new Gr(e+"_button",t);return n.textWrapping=!0,n.textHorizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_CENTER,r.addControl(n),r._textBlock=n,r},i.CreateImageWithCenterTextButton=function(e,t,r){var n=new i(e),o=new Hr(e+"_icon",r);o.stretch=Hr.STRETCH_FILL,n.addControl(o);var s=new Gr(e+"_button",t);return s.textWrapping=!0,s.textHorizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_CENTER,n.addControl(s),n._image=o,n._textBlock=s,n},i}(zr);c.RegisteredTypes["BABYLON.GUI.Button"]=Xr;var jr=function(e){function i(t){var i=e.call(this,t)||this;return i.name=t,i._isVertical=!0,i._manualWidth=!1,i._manualHeight=!1,i._doNotTrackManualChanges=!1,i.ignoreLayoutWarnings=!1,i}return t(i,e),Object.defineProperty(i.prototype,"isVertical",{get:function(){return this._isVertical},set:function(e){this._isVertical!==e&&(this._isVertical=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(e){this._doNotTrackManualChanges||(this._manualWidth=!0),this._width.toString(this._host)!==e&&this._width.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._height.toString(this._host)},set:function(e){this._doNotTrackManualChanges||(this._manualHeight=!0),this._height.toString(this._host)!==e&&this._height.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),i.prototype._getTypeName=function(){return"StackPanel"},i.prototype._preMeasure=function(t,i){for(var r=0,n=this._children;r<n.length;r++){var o=n[r];this._isVertical?o.verticalAlignment=Ur.VERTICAL_ALIGNMENT_TOP:o.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT}e.prototype._preMeasure.call(this,t,i)},i.prototype._additionalProcessing=function(t,i){e.prototype._additionalProcessing.call(this,t,i),this._measureForChildren.copyFrom(t),this._measureForChildren.left=this._currentMeasure.left,this._measureForChildren.top=this._currentMeasure.top,this.isVertical&&!this._manualWidth||(this._measureForChildren.width=this._currentMeasure.width),(this.isVertical||this._manualHeight)&&(this._measureForChildren.height=this._currentMeasure.height)},i.prototype._postMeasure=function(){for(var t=0,i=0,r=0,n=this._children;r<n.length;r++){var o=n[r];o.isVisible&&!o.notRenderable&&(this._isVertical?(o.top!==i+"px"&&(o.top=i+"px",this._rebuildLayout=!0,o._top.ignoreAdaptiveScaling=!0),o._height.isPercentage&&!o._automaticSize?this.ignoreLayoutWarnings||Ue.Warn("Control (Name:"+o.name+", UniqueId:"+o.uniqueId+") is using height in percentage mode inside a vertical StackPanel"):i+=o._currentMeasure.height+o.paddingTopInPixels+o.paddingBottomInPixels):(o.left!==t+"px"&&(o.left=t+"px",this._rebuildLayout=!0,o._left.ignoreAdaptiveScaling=!0),o._width.isPercentage&&!o._automaticSize?this.ignoreLayoutWarnings||Ue.Warn("Control (Name:"+o.name+", UniqueId:"+o.uniqueId+") is using width in percentage mode inside a horizontal StackPanel"):t+=o._currentMeasure.width+o.paddingLeftInPixels+o.paddingRightInPixels))}t+=this.paddingLeftInPixels+this.paddingRightInPixels,i+=this.paddingTopInPixels+this.paddingBottomInPixels,this._doNotTrackManualChanges=!0;var s=!1,a=!1;if(!this._manualHeight&&this._isVertical){var h=this.height;this.height=i+"px",a=h!==this.height||!this._height.ignoreAdaptiveScaling}if(!this._manualWidth&&!this._isVertical){var u=this.width;this.width=t+"px",s=u!==this.width||!this._width.ignoreAdaptiveScaling}a&&(this._height.ignoreAdaptiveScaling=!0),s&&(this._width.ignoreAdaptiveScaling=!0),this._doNotTrackManualChanges=!1,(s||a)&&(this._rebuildLayout=!0),e.prototype._postMeasure.call(this)},i}(Vr);c.RegisteredTypes["BABYLON.GUI.StackPanel"]=jr;var Kr=function(e){function i(t){var i=e.call(this,t)||this;return i.name=t,i._isChecked=!1,i._background="black",i._checkSizeRatio=.8,i._thickness=1,i.onIsCheckedChangedObservable=new U,i.isPointerBlocker=!0,i}return t(i,e),Object.defineProperty(i.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"checkSizeRatio",{get:function(){return this._checkSizeRatio},set:function(e){e=Math.max(Math.min(1,e),0),this._checkSizeRatio!==e&&(this._checkSizeRatio=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isChecked",{get:function(){return this._isChecked},set:function(e){this._isChecked!==e&&(this._isChecked=e,this._markAsDirty(),this.onIsCheckedChangedObservable.notifyObservers(e))},enumerable:!1,configurable:!0}),i.prototype._getTypeName=function(){return"Checkbox"},i.prototype._draw=function(e,t){e.save(),this._applyStates(e);var i=this._currentMeasure.width-this._thickness,r=this._currentMeasure.height-this._thickness;if((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),e.fillStyle=this._isEnabled?this._background:this._disabledColor,e.fillRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,i,r),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._isChecked){e.fillStyle=this._isEnabled?this.color:this._disabledColorItem;var n=i*this._checkSizeRatio,o=r*this._checkSizeRatio;e.fillRect(this._currentMeasure.left+this._thickness/2+(i-n)/2,this._currentMeasure.top+this._thickness/2+(r-o)/2,n,o)}e.strokeStyle=this.color,e.lineWidth=this._thickness,e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,i,r),e.restore()},i.prototype._onPointerDown=function(t,i,r,n,o){return!!e.prototype._onPointerDown.call(this,t,i,r,n,o)&&(this.isChecked=!this.isChecked,!0)},i.AddCheckBoxWithHeader=function(e,t){var r=new jr;r.isVertical=!1,r.height="30px";var n=new i;n.width="20px",n.height="20px",n.isChecked=!0,n.color="green",n.onIsCheckedChangedObservable.add(t),r.addControl(n);var o=new Gr;return o.text=e,o.width="180px",o.paddingLeft="5px",o.textHorizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT,o.color="white",r.addControl(o),r},i}(Ur);c.RegisteredTypes["BABYLON.GUI.Checkbox"]=Kr;var Yr=function(){function e(){}return e.COPY=1,e.CUT=2,e.PASTE=3,e}(),qr=function(){function e(e,t){this.type=e,this.event=t}return e.GetTypeFromCharacter=function(e){switch(e){case 67:return Yr.COPY;case 86:return Yr.PASTE;case 88:return Yr.CUT;default:return-1}},e}(),Zr=function(){function e(){}return Object.defineProperty(e.prototype,"text",{get:function(){return this._characters?this._characters.join(""):this._text},set:function(e){this._text=e,this._characters=Array.from&&Array.from(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._characters?this._characters.length:this._text.length},enumerable:!1,configurable:!0}),e.prototype.removePart=function(e,t,i){var r;if(this._text=this._text.slice(0,e)+(i||"")+this._text.slice(t),this._characters){var n=i?Array.from(i):[];(r=this._characters).splice.apply(r,function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var r=Array(e),n=0;for(t=0;t<i;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,n++)r[n]=o[s];return r}([e,t-e],n))}},e.prototype.charAt=function(e){return this._characters?this._characters[e]:this._text.charAt(e)},e.prototype.substr=function(e,t){if(this._characters){e=isNaN(e)?0:e>=0?Math.min(e,this._characters.length):this._characters.length+Math.max(e,-this._characters.length),void 0===t?t=this._characters.length-e:(isNaN(t)||t<0)&&(t=0);for(var i=[];--t>=0;)i[t]=this._characters[e+t];return i.join("")}return this._text.substr(e,t)},e.prototype.substring=function(e,t){if(this._characters){isNaN(e)?e=0:e>this._characters.length?e=this._characters.length:e<0&&(e=0),void 0===t?t=this._characters.length:isNaN(t)?t=0:t>this._characters.length?t=this._characters.length:t<0&&(t=0);for(var i=[],r=0;e<t;)i[r++]=this._characters[e++];return i.join("")}return this._text.substring(e,t)},e.prototype.isWord=function(e){var t=/\w/g;return this._characters?-1!==this._characters[e].search(t):-1!==this._text.search(t)},e}(),Qr=function(e){function i(t,i){void 0===i&&(i="");var r=e.call(this,t)||this;return r.name=t,r._placeholderText="",r._background="#222222",r._focusedBackground="#000000",r._focusedColor="white",r._placeholderColor="gray",r._thickness=1,r._margin=new Rr(10,Rr.UNITMODE_PIXEL),r._autoStretchWidth=!0,r._maxWidth=new Rr(1,Rr.UNITMODE_PERCENTAGE,!1),r._isFocused=!1,r._blinkIsEven=!1,r._cursorOffset=0,r._deadKey=!1,r._addKey=!0,r._currentKey="",r._isTextHighlightOn=!1,r._textHighlightColor="#d5e0ff",r._highligherOpacity=.4,r._highlightedText="",r._startHighlightIndex=0,r._endHighlightIndex=0,r._cursorIndex=-1,r._onFocusSelectAll=!1,r._isPointerDown=!1,r.promptMessage="Please enter text:",r.disableMobilePrompt=!1,r.onTextChangedObservable=new U,r.onBeforeKeyAddObservable=new U,r.onFocusObservable=new U,r.onBlurObservable=new U,r.onTextHighlightObservable=new U,r.onTextCopyObservable=new U,r.onTextCutObservable=new U,r.onTextPasteObservable=new U,r.onKeyboardEventProcessedObservable=new U,r.text=i,r.isPointerBlocker=!0,r}return t(i,e),Object.defineProperty(i.prototype,"maxWidth",{get:function(){return this._maxWidth.toString(this._host)},set:function(e){this._maxWidth.toString(this._host)!==e&&this._maxWidth.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"maxWidthInPixels",{get:function(){return this._maxWidth.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"highligherOpacity",{get:function(){return this._highligherOpacity},set:function(e){this._highligherOpacity!==e&&(this._highligherOpacity=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onFocusSelectAll",{get:function(){return this._onFocusSelectAll},set:function(e){this._onFocusSelectAll!==e&&(this._onFocusSelectAll=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"textHighlightColor",{get:function(){return this._textHighlightColor},set:function(e){this._textHighlightColor!==e&&(this._textHighlightColor=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"margin",{get:function(){return this._margin.toString(this._host)},set:function(e){this._margin.toString(this._host)!==e&&this._margin.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"marginInPixels",{get:function(){return this._margin.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"autoStretchWidth",{get:function(){return this._autoStretchWidth},set:function(e){this._autoStretchWidth!==e&&(this._autoStretchWidth=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"focusedBackground",{get:function(){return this._focusedBackground},set:function(e){this._focusedBackground!==e&&(this._focusedBackground=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"focusedColor",{get:function(){return this._focusedColor},set:function(e){this._focusedColor!==e&&(this._focusedColor=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"placeholderColor",{get:function(){return this._placeholderColor},set:function(e){this._placeholderColor!==e&&(this._placeholderColor=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"placeholderText",{get:function(){return this._placeholderText},set:function(e){this._placeholderText!==e&&(this._placeholderText=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"deadKey",{get:function(){return this._deadKey},set:function(e){this._deadKey=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"highlightedText",{get:function(){return this._highlightedText},set:function(e){this._highlightedText!==e&&(this._highlightedText=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"addKey",{get:function(){return this._addKey},set:function(e){this._addKey=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"currentKey",{get:function(){return this._currentKey},set:function(e){this._currentKey=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"text",{get:function(){return this._textWrapper.text},set:function(e){var t=e.toString();this._textWrapper||(this._textWrapper=new Zr),this._textWrapper.text!==t&&(this._textWrapper.text=t,this._textHasChanged())},enumerable:!1,configurable:!0}),i.prototype._textHasChanged=function(){this._markAsDirty(),this.onTextChangedObservable.notifyObservers(this)},Object.defineProperty(i.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(e){this._width.toString(this._host)!==e&&(this._width.fromString(e)&&this._markAsDirty(),this.autoStretchWidth=!1)},enumerable:!1,configurable:!0}),i.prototype.onBlur=function(){this._isFocused=!1,this._scrollLeft=null,this._cursorOffset=0,clearTimeout(this._blinkTimeout),this._markAsDirty(),this.onBlurObservable.notifyObservers(this),this._host.unRegisterClipboardEvents(),this._onClipboardObserver&&this._host.onClipboardObservable.remove(this._onClipboardObserver);var e=this._host.getScene();this._onPointerDblTapObserver&&e&&e.onPointerObservable.remove(this._onPointerDblTapObserver)},i.prototype.onFocus=function(){var e=this;if(this._isEnabled){if(this._scrollLeft=null,this._isFocused=!0,this._blinkIsEven=!1,this._cursorOffset=0,this._markAsDirty(),this.onFocusObservable.notifyObservers(this),-1!==navigator.userAgent.indexOf("Mobile")&&!this.disableMobilePrompt){var t=prompt(this.promptMessage);return null!==t&&(this.text=t),void(this._host.focusedControl=null)}this._host.registerClipboardEvents(),this._onClipboardObserver=this._host.onClipboardObservable.add((function(t){switch(t.type){case Yr.COPY:e._onCopyText(t.event),e.onTextCopyObservable.notifyObservers(e);break;case Yr.CUT:e._onCutText(t.event),e.onTextCutObservable.notifyObservers(e);break;case Yr.PASTE:e._onPasteText(t.event),e.onTextPasteObservable.notifyObservers(e);break;default:return}}));var i=this._host.getScene();i&&(this._onPointerDblTapObserver=i.onPointerObservable.add((function(t){e._isFocused&&t.type===Jt.POINTERDOUBLETAP&&e._processDblClick(t)}))),this._onFocusSelectAll&&this._selectAllText()}},i.prototype._getTypeName=function(){return"InputText"},i.prototype.keepsFocusWith=function(){return this._connectedVirtualKeyboard?[this._connectedVirtualKeyboard]:null},i.prototype.processKey=function(e,t,i){if(!i||!i.ctrlKey&&!i.metaKey||67!==e&&86!==e&&88!==e){if(i&&(i.ctrlKey||i.metaKey)&&65===e)return this._selectAllText(),void i.preventDefault();switch(e){case 32:t=" ";break;case 191:i&&i.preventDefault();break;case 8:if(this._textWrapper.text&&this._textWrapper.length>0){if(this._isTextHighlightOn)return this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex),this._textHasChanged(),this._isTextHighlightOn=!1,this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,this._blinkIsEven=!1,void(i&&i.preventDefault());if(0===this._cursorOffset)this.text=this._textWrapper.substr(0,this._textWrapper.length-1);else(r=this._textWrapper.length-this._cursorOffset)>0&&(this._textWrapper.removePart(r-1,r),this._textHasChanged())}return void(i&&i.preventDefault());case 46:if(this._isTextHighlightOn)return this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex),this._textHasChanged(),this._isTextHighlightOn=!1,this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,void(i&&i.preventDefault());if(this._textWrapper.text&&this._textWrapper.length>0&&this._cursorOffset>0){var r=this._textWrapper.length-this._cursorOffset;this._textWrapper.removePart(r,r+1),this._textHasChanged(),this._cursorOffset--}return void(i&&i.preventDefault());case 13:return this._host.focusedControl=null,void(this._isTextHighlightOn=!1);case 35:return this._cursorOffset=0,this._blinkIsEven=!1,this._isTextHighlightOn=!1,void this._markAsDirty();case 36:return this._cursorOffset=this._textWrapper.length,this._blinkIsEven=!1,this._isTextHighlightOn=!1,void this._markAsDirty();case 37:if(this._cursorOffset++,this._cursorOffset>this._textWrapper.length&&(this._cursorOffset=this._textWrapper.length),i&&i.shiftKey){if(this._blinkIsEven=!1,i.ctrlKey||i.metaKey){if(!this._isTextHighlightOn){if(this._textWrapper.length===this._cursorOffset)return;this._endHighlightIndex=this._textWrapper.length-this._cursorOffset+1}return this._startHighlightIndex=0,this._cursorIndex=this._textWrapper.length-this._endHighlightIndex,this._cursorOffset=this._textWrapper.length,this._isTextHighlightOn=!0,void this._markAsDirty()}return this._isTextHighlightOn?-1===this._cursorIndex&&(this._cursorIndex=this._textWrapper.length-this._endHighlightIndex,this._cursorOffset=0===this._startHighlightIndex?this._textWrapper.length:this._textWrapper.length-this._startHighlightIndex+1):(this._isTextHighlightOn=!0,this._cursorIndex=this._cursorOffset>=this._textWrapper.length?this._textWrapper.length:this._cursorOffset-1),this._cursorIndex<this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorIndex,this._startHighlightIndex=this._textWrapper.length-this._cursorOffset):this._cursorIndex>this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorOffset,this._startHighlightIndex=this._textWrapper.length-this._cursorIndex):this._isTextHighlightOn=!1,void this._markAsDirty()}return this._isTextHighlightOn&&(this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,this._isTextHighlightOn=!1),i&&(i.ctrlKey||i.metaKey)&&(this._cursorOffset=this._textWrapper.length,i.preventDefault()),this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._cursorIndex=-1,void this._markAsDirty();case 39:if(this._cursorOffset--,this._cursorOffset<0&&(this._cursorOffset=0),i&&i.shiftKey){if(this._blinkIsEven=!1,i.ctrlKey||i.metaKey){if(!this._isTextHighlightOn){if(0===this._cursorOffset)return;this._startHighlightIndex=this._textWrapper.length-this._cursorOffset-1}return this._endHighlightIndex=this._textWrapper.length,this._isTextHighlightOn=!0,this._cursorIndex=this._textWrapper.length-this._startHighlightIndex,this._cursorOffset=0,void this._markAsDirty()}return this._isTextHighlightOn?-1===this._cursorIndex&&(this._cursorIndex=this._textWrapper.length-this._startHighlightIndex,this._cursorOffset=this._textWrapper.length===this._endHighlightIndex?0:this._textWrapper.length-this._endHighlightIndex-1):(this._isTextHighlightOn=!0,this._cursorIndex=this._cursorOffset<=0?0:this._cursorOffset+1),this._cursorIndex<this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorIndex,this._startHighlightIndex=this._textWrapper.length-this._cursorOffset):this._cursorIndex>this._cursorOffset?(this._endHighlightIndex=this._textWrapper.length-this._cursorOffset,this._startHighlightIndex=this._textWrapper.length-this._cursorIndex):this._isTextHighlightOn=!1,void this._markAsDirty()}return this._isTextHighlightOn&&(this._cursorOffset=this._textWrapper.length-this._endHighlightIndex,this._isTextHighlightOn=!1),i&&(i.ctrlKey||i.metaKey)&&(this._cursorOffset=0,i.preventDefault()),this._blinkIsEven=!1,this._isTextHighlightOn=!1,this._cursorIndex=-1,void this._markAsDirty();case 222:i&&i.preventDefault(),this._cursorIndex=-1,this.deadKey=!0}if(t&&(-1===e||32===e||e>47&&e<64||e>64&&e<91||e>159&&e<193||e>218&&e<223||e>95&&e<112)&&(this._currentKey=t,this.onBeforeKeyAddObservable.notifyObservers(this),t=this._currentKey,this._addKey))if(this._isTextHighlightOn)this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex,t),this._textHasChanged(),this._cursorOffset=this._textWrapper.length-(this._startHighlightIndex+1),this._isTextHighlightOn=!1,this._blinkIsEven=!1,this._markAsDirty();else if(0===this._cursorOffset)this.text+=t;else{var n=this._textWrapper.length-this._cursorOffset;this._textWrapper.removePart(n,n,t),this._textHasChanged()}}},i.prototype._updateValueFromCursorIndex=function(e){if(this._blinkIsEven=!1,-1===this._cursorIndex)this._cursorIndex=e;else if(this._cursorIndex<this._cursorOffset)this._endHighlightIndex=this._textWrapper.length-this._cursorIndex,this._startHighlightIndex=this._textWrapper.length-this._cursorOffset;else{if(!(this._cursorIndex>this._cursorOffset))return this._isTextHighlightOn=!1,void this._markAsDirty();this._endHighlightIndex=this._textWrapper.length-this._cursorOffset,this._startHighlightIndex=this._textWrapper.length-this._cursorIndex}this._isTextHighlightOn=!0,this._markAsDirty()},i.prototype._processDblClick=function(e){var t,i;this._startHighlightIndex=this._textWrapper.length-this._cursorOffset,this._endHighlightIndex=this._startHighlightIndex;do{i=this._endHighlightIndex<this._textWrapper.length&&this._textWrapper.isWord(this._endHighlightIndex)?++this._endHighlightIndex:0,t=this._startHighlightIndex>0&&this._textWrapper.isWord(this._startHighlightIndex-1)?--this._startHighlightIndex:0}while(t||i);this._cursorOffset=this._textWrapper.length-this._startHighlightIndex,this.onTextHighlightObservable.notifyObservers(this),this._isTextHighlightOn=!0,this._clickedCoordinate=null,this._blinkIsEven=!0,this._cursorIndex=-1,this._markAsDirty()},i.prototype._selectAllText=function(){this._blinkIsEven=!0,this._isTextHighlightOn=!0,this._startHighlightIndex=0,this._endHighlightIndex=this._textWrapper.length,this._cursorOffset=this._textWrapper.length,this._cursorIndex=-1,this._markAsDirty()},i.prototype.processKeyboard=function(e){this.processKey(e.keyCode,e.key,e),this.onKeyboardEventProcessedObservable.notifyObservers(e)},i.prototype._onCopyText=function(e){this._isTextHighlightOn=!1;try{e.clipboardData&&e.clipboardData.setData("text/plain",this._highlightedText)}catch(e){}this._host.clipboardData=this._highlightedText},i.prototype._onCutText=function(e){if(this._highlightedText){this._textWrapper.removePart(this._startHighlightIndex,this._endHighlightIndex),this._textHasChanged(),this._isTextHighlightOn=!1,this._cursorOffset=this._textWrapper.length-this._startHighlightIndex;try{e.clipboardData&&e.clipboardData.setData("text/plain",this._highlightedText)}catch(e){}this._host.clipboardData=this._highlightedText,this._highlightedText=""}},i.prototype._onPasteText=function(e){var t="";t=e.clipboardData&&-1!==e.clipboardData.types.indexOf("text/plain")?e.clipboardData.getData("text/plain"):this._host.clipboardData;var i=this._textWrapper.length-this._cursorOffset;this._textWrapper.removePart(i,i,t),this._textHasChanged()},i.prototype._draw=function(e,t){var i=this;e.save(),this._applyStates(e),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._isFocused?this._focusedBackground&&(e.fillStyle=this._isEnabled?this._focusedBackground:this._disabledColor,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)):this._background&&(e.fillStyle=this._isEnabled?this._background:this._disabledColor,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height)),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._fontOffset||(this._fontOffset=Ur._GetFontOffset(e.font));var r=this._currentMeasure.left+this._margin.getValueInPixel(this._host,this._tempParentMeasure.width);this.color&&(e.fillStyle=this.color);var n=this._beforeRenderText(this._textWrapper);this._isFocused||this._textWrapper.text||!this._placeholderText||((n=new Zr).text=this._placeholderText,this._placeholderColor&&(e.fillStyle=this._placeholderColor)),this._textWidth=e.measureText(n.text).width;var o=2*this._margin.getValueInPixel(this._host,this._tempParentMeasure.width);this._autoStretchWidth&&(this.width=Math.min(this._maxWidth.getValueInPixel(this._host,this._tempParentMeasure.width),this._textWidth+o)+"px");var s=this._fontOffset.ascent+(this._currentMeasure.height-this._fontOffset.height)/2,a=this._width.getValueInPixel(this._host,this._tempParentMeasure.width)-o;if(e.save(),e.beginPath(),e.rect(r,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,a+2,this._currentMeasure.height),e.clip(),this._isFocused&&this._textWidth>a){var h=r-this._textWidth+a;this._scrollLeft||(this._scrollLeft=h)}else this._scrollLeft=r;if(e.fillText(n.text,this._scrollLeft,this._currentMeasure.top+s),this._isFocused){if(this._clickedCoordinate){var u=this._scrollLeft+this._textWidth-this._clickedCoordinate,l=0;this._cursorOffset=0;var c=0;do{this._cursorOffset&&(c=Math.abs(u-l)),this._cursorOffset++,l=e.measureText(n.substr(n.length-this._cursorOffset,this._cursorOffset)).width}while(l<u&&n.length>=this._cursorOffset);Math.abs(u-l)>c&&this._cursorOffset--,this._blinkIsEven=!1,this._clickedCoordinate=null}if(!this._blinkIsEven){var f=n.substr(n.length-this._cursorOffset),d=e.measureText(f).width,p=this._scrollLeft+this._textWidth-d;p<r?(this._scrollLeft+=r-p,p=r,this._markAsDirty()):p>r+a&&(this._scrollLeft+=r+a-p,p=r+a,this._markAsDirty()),this._isTextHighlightOn||e.fillRect(p,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,2,this._fontOffset.height)}if(clearTimeout(this._blinkTimeout),this._blinkTimeout=setTimeout((function(){i._blinkIsEven=!i._blinkIsEven,i._markAsDirty()}),500),this._isTextHighlightOn){clearTimeout(this._blinkTimeout);var _=e.measureText(n.substring(this._startHighlightIndex)).width,g=this._scrollLeft+this._textWidth-_;this._highlightedText=n.substring(this._startHighlightIndex,this._endHighlightIndex);var m=e.measureText(n.substring(this._startHighlightIndex,this._endHighlightIndex)).width;g<r&&((m-=r-g)||(m=e.measureText(n.charAt(n.length-this._cursorOffset)).width),g=r),e.globalAlpha=this._highligherOpacity,e.fillStyle=this._textHighlightColor,e.fillRect(g,this._currentMeasure.top+(this._currentMeasure.height-this._fontOffset.height)/2,m,this._fontOffset.height),e.globalAlpha=1}}e.restore(),this._thickness&&(this._isFocused?this.focusedColor&&(e.strokeStyle=this.focusedColor):this.color&&(e.strokeStyle=this.color),e.lineWidth=this._thickness,e.strokeRect(this._currentMeasure.left+this._thickness/2,this._currentMeasure.top+this._thickness/2,this._currentMeasure.width-this._thickness,this._currentMeasure.height-this._thickness)),e.restore()},i.prototype._onPointerDown=function(t,i,r,n,o){return!!e.prototype._onPointerDown.call(this,t,i,r,n,o)&&(this._clickedCoordinate=i.x,this._isTextHighlightOn=!1,this._highlightedText="",this._cursorIndex=-1,this._isPointerDown=!0,this._host._capturingControl[r]=this,this._host.focusedControl===this?(clearTimeout(this._blinkTimeout),this._markAsDirty(),!0):!!this._isEnabled&&(this._host.focusedControl=this,!0))},i.prototype._onPointerMove=function(t,i,r,n){this._host.focusedControl===this&&this._isPointerDown&&(this._clickedCoordinate=i.x,this._markAsDirty(),this._updateValueFromCursorIndex(this._cursorOffset)),e.prototype._onPointerMove.call(this,t,i,r,n)},i.prototype._onPointerUp=function(t,i,r,n,o){this._isPointerDown=!1,delete this._host._capturingControl[r],e.prototype._onPointerUp.call(this,t,i,r,n,o)},i.prototype._beforeRenderText=function(e){return e},i.prototype.dispose=function(){e.prototype.dispose.call(this),this.onBlurObservable.clear(),this.onFocusObservable.clear(),this.onTextChangedObservable.clear(),this.onTextCopyObservable.clear(),this.onTextCutObservable.clear(),this.onTextPasteObservable.clear(),this.onTextHighlightObservable.clear(),this.onKeyboardEventProcessedObservable.clear()},i}(Ur);c.RegisteredTypes["BABYLON.GUI.InputText"]=Qr;var Jr=function(e){function i(t){var i=e.call(this,t)||this;return i.name=t,i._rowDefinitions=new Array,i._columnDefinitions=new Array,i._cells={},i._childControls=new Array,i}return t(i,e),Object.defineProperty(i.prototype,"columnCount",{get:function(){return this._columnDefinitions.length},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rowCount",{get:function(){return this._rowDefinitions.length},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"children",{get:function(){return this._childControls},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"cells",{get:function(){return this._cells},enumerable:!1,configurable:!0}),i.prototype.getRowDefinition=function(e){return e<0||e>=this._rowDefinitions.length?null:this._rowDefinitions[e]},i.prototype.getColumnDefinition=function(e){return e<0||e>=this._columnDefinitions.length?null:this._columnDefinitions[e]},i.prototype.addRowDefinition=function(e,t){return void 0===t&&(t=!1),this._rowDefinitions.push(new Rr(e,t?Rr.UNITMODE_PIXEL:Rr.UNITMODE_PERCENTAGE)),this._markAsDirty(),this},i.prototype.addColumnDefinition=function(e,t){return void 0===t&&(t=!1),this._columnDefinitions.push(new Rr(e,t?Rr.UNITMODE_PIXEL:Rr.UNITMODE_PERCENTAGE)),this._markAsDirty(),this},i.prototype.setRowDefinition=function(e,t,i){if(void 0===i&&(i=!1),e<0||e>=this._rowDefinitions.length)return this;var r=this._rowDefinitions[e];return r&&r.isPixel===i&&r.internalValue===t||(this._rowDefinitions[e]=new Rr(t,i?Rr.UNITMODE_PIXEL:Rr.UNITMODE_PERCENTAGE),this._markAsDirty()),this},i.prototype.setColumnDefinition=function(e,t,i){if(void 0===i&&(i=!1),e<0||e>=this._columnDefinitions.length)return this;var r=this._columnDefinitions[e];return r&&r.isPixel===i&&r.internalValue===t||(this._columnDefinitions[e]=new Rr(t,i?Rr.UNITMODE_PIXEL:Rr.UNITMODE_PERCENTAGE),this._markAsDirty()),this},i.prototype.getChildrenAt=function(e,t){var i=this._cells[e+":"+t];return i?i.children:null},i.prototype.getChildCellInfo=function(e){return e._tag},i.prototype._removeCell=function(t,i){if(t){e.prototype.removeControl.call(this,t);for(var r=0,n=t.children;r<n.length;r++){var o=n[r],s=this._childControls.indexOf(o);-1!==s&&this._childControls.splice(s,1)}delete this._cells[i]}},i.prototype._offsetCell=function(e,t){if(this._cells[t]){this._cells[e]=this._cells[t];for(var i=0,r=this._cells[e].children;i<r.length;i++){r[i]._tag=e}delete this._cells[t]}},i.prototype.removeColumnDefinition=function(e){if(e<0||e>=this._columnDefinitions.length)return this;for(var t=0;t<this._rowDefinitions.length;t++){var i=t+":"+e,r=this._cells[i];this._removeCell(r,i)}for(t=0;t<this._rowDefinitions.length;t++)for(var n=e+1;n<this._columnDefinitions.length;n++){var o=t+":"+(n-1);i=t+":"+n;this._offsetCell(o,i)}return this._columnDefinitions.splice(e,1),this._markAsDirty(),this},i.prototype.removeRowDefinition=function(e){if(e<0||e>=this._rowDefinitions.length)return this;for(var t=0;t<this._columnDefinitions.length;t++){var i=e+":"+t,r=this._cells[i];this._removeCell(r,i)}for(t=0;t<this._columnDefinitions.length;t++)for(var n=e+1;n<this._rowDefinitions.length;n++){var o=n-1+":"+t;i=n+":"+t;this._offsetCell(o,i)}return this._rowDefinitions.splice(e,1),this._markAsDirty(),this},i.prototype.addControl=function(t,i,r){if(void 0===i&&(i=0),void 0===r&&(r=0),0===this._rowDefinitions.length&&this.addRowDefinition(1,!1),0===this._columnDefinitions.length&&this.addColumnDefinition(1,!1),-1!==this._childControls.indexOf(t))return Ue.Warn("Control (Name:"+t.name+", UniqueId:"+t.uniqueId+") is already associated with this grid. You must remove it before reattaching it"),this;var n=Math.min(i,this._rowDefinitions.length-1)+":"+Math.min(r,this._columnDefinitions.length-1),o=this._cells[n];return o||(o=new Vr(n),this._cells[n]=o,o.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT,o.verticalAlignment=Ur.VERTICAL_ALIGNMENT_TOP,e.prototype.addControl.call(this,o)),o.addControl(t),this._childControls.push(t),t._tag=n,t.parent=this,this._markAsDirty(),this},i.prototype.removeControl=function(e){var t=this._childControls.indexOf(e);-1!==t&&this._childControls.splice(t,1);var i=this._cells[e._tag];return i&&(i.removeControl(e),e._tag=null),this._markAsDirty(),this},i.prototype._getTypeName=function(){return"Grid"},i.prototype._getGridDefinitions=function(e){for(var t=[],i=[],r=[],n=[],o=this._currentMeasure.width,s=0,a=this._currentMeasure.height,h=0,u=0,l=0,c=this._rowDefinitions;l<c.length;l++){if((g=c[l]).isPixel)a-=_=g.getValue(this._host),i[u]=_;else h+=g.internalValue;u++}var f=0;u=0;for(var d=0,p=this._rowDefinitions;d<p.length;d++){var _,g=p[d];if(n.push(f),g.isPixel)f+=g.getValue(this._host);else f+=_=g.internalValue/h*a,i[u]=_;u++}u=0;for(var m=0,v=this._columnDefinitions;m<v.length;m++){if((g=v[m]).isPixel)o-=E=g.getValue(this._host),t[u]=E;else s+=g.internalValue;u++}var y=0;u=0;for(var b=0,T=this._columnDefinitions;b<T.length;b++){var E;g=T[b];if(r.push(y),g.isPixel)y+=g.getValue(this._host);else y+=E=g.internalValue/s*o,t[u]=E;u++}e(r,n,t,i)},i.prototype._additionalProcessing=function(t,i){var r=this;this._getGridDefinitions((function(e,t,i,n){for(var o in r._cells)if(r._cells.hasOwnProperty(o)){var s=o.split(":"),a=parseInt(s[0]),h=parseInt(s[1]),u=r._cells[o];u.left=e[h]+"px",u.top=t[a]+"px",u.width=i[h]+"px",u.height=n[a]+"px",u._left.ignoreAdaptiveScaling=!0,u._top.ignoreAdaptiveScaling=!0,u._width.ignoreAdaptiveScaling=!0,u._height.ignoreAdaptiveScaling=!0}})),e.prototype._additionalProcessing.call(this,t,i)},i.prototype._flagDescendantsAsMatrixDirty=function(){for(var e in this._cells){if(this._cells.hasOwnProperty(e))this._cells[e]._markMatrixAsDirty()}},i.prototype._renderHighlightSpecific=function(t){var i=this;e.prototype._renderHighlightSpecific.call(this,t),this._getGridDefinitions((function(e,r,n,o){for(var s=0;s<e.length;s++){var a=i._currentMeasure.left+e[s]+n[s];t.beginPath(),t.moveTo(a,i._currentMeasure.top),t.lineTo(a,i._currentMeasure.top+i._currentMeasure.height),t.stroke()}for(s=0;s<r.length;s++){var h=i._currentMeasure.top+r[s]+o[s];t.beginPath(),t.moveTo(i._currentMeasure.left,h),t.lineTo(i._currentMeasure.left+i._currentMeasure.width,h),t.stroke()}})),t.restore()},i.prototype.dispose=function(){e.prototype.dispose.call(this);for(var t=0,i=this._childControls;t<i.length;t++){i[t].dispose()}this._childControls=[]},i}(Vr);c.RegisteredTypes["BABYLON.GUI.Grid"]=Jr;var $r=function(e){function i(t){var i=e.call(this,t)||this;return i.name=t,i._value=T.Red(),i._tmpColor=new T,i._pointerStartedOnSquare=!1,i._pointerStartedOnWheel=!1,i._squareLeft=0,i._squareTop=0,i._squareSize=0,i._h=360,i._s=1,i._v=1,i._lastPointerDownID=-1,i.onValueChangedObservable=new U,i._pointerIsDown=!1,i.value=new T(.88,.1,.1),i.size="200px",i.isPointerBlocker=!0,i}return t(i,e),Object.defineProperty(i.prototype,"value",{get:function(){return this._value},set:function(e){this._value.equals(e)||(this._value.copyFrom(e),this._value.toHSVToRef(this._tmpColor),this._h=this._tmpColor.r,this._s=Math.max(this._tmpColor.g,1e-5),this._v=Math.max(this._tmpColor.b,1e-5),this._markAsDirty(),this._value.r<=i._Epsilon&&(this._value.r=0),this._value.g<=i._Epsilon&&(this._value.g=0),this._value.b<=i._Epsilon&&(this._value.b=0),this._value.r>=1-i._Epsilon&&(this._value.r=1),this._value.g>=1-i._Epsilon&&(this._value.g=1),this._value.b>=1-i._Epsilon&&(this._value.b=1),this.onValueChangedObservable.notifyObservers(this._value))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._width.toString(this._host)},set:function(e){this._width.toString(this._host)!==e&&this._width.fromString(e)&&(this._height.fromString(e),this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._height.toString(this._host)},set:function(e){this._height.toString(this._host)!==e&&this._height.fromString(e)&&(this._width.fromString(e),this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"size",{get:function(){return this.width},set:function(e){this.width=e},enumerable:!1,configurable:!0}),i.prototype._getTypeName=function(){return"ColorPicker"},i.prototype._preMeasure=function(e,t){e.width<e.height?this._currentMeasure.height=e.width:this._currentMeasure.width=e.height},i.prototype._updateSquareProps=function(){var e=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),t=2*(e-.2*e)/Math.sqrt(2),i=e-.5*t;this._squareLeft=this._currentMeasure.left+i,this._squareTop=this._currentMeasure.top+i,this._squareSize=t},i.prototype._drawGradientSquare=function(e,t,i,r,n,o){var s=o.createLinearGradient(t,i,r+t,i);s.addColorStop(0,"#fff"),s.addColorStop(1,"hsl("+e+", 100%, 50%)"),o.fillStyle=s,o.fillRect(t,i,r,n);var a=o.createLinearGradient(t,i,t,n+i);a.addColorStop(0,"rgba(0,0,0,0)"),a.addColorStop(1,"#000"),o.fillStyle=a,o.fillRect(t,i,r,n)},i.prototype._drawCircle=function(e,t,i,r){r.beginPath(),r.arc(e,t,i+1,0,2*Math.PI,!1),r.lineWidth=3,r.strokeStyle="#333333",r.stroke(),r.beginPath(),r.arc(e,t,i,0,2*Math.PI,!1),r.lineWidth=3,r.strokeStyle="#ffffff",r.stroke()},i.prototype._createColorWheelCanvas=function(e,t){var i=document.createElement("canvas");i.width=2*e,i.height=2*e;for(var r=i.getContext("2d"),n=r.getImageData(0,0,2*e,2*e),o=n.data,s=this._tmpColor,a=e*e,h=e-t,u=h*h,l=-e;l<e;l++)for(var c=-e;c<e;c++){var f=l*l+c*c;if(!(f>a||f<u)){var d=Math.sqrt(f),p=Math.atan2(c,l);T.HSVtoRGBToRef(180*p/Math.PI+180,d/e,1,s);var _=4*(l+e+2*(c+e)*e);o[_]=255*s.r,o[_+1]=255*s.g,o[_+2]=255*s.b;var g=.2;g=e<50?.2:e>150?.04:-.16*(e-50)/100+.2;var m=(d-h)/(e-h);o[_+3]=m<g?m/g*255:m>1-g?255*(1-(m-(1-g))/g):255}}return r.putImageData(n,0,0),i},i.prototype._draw=function(e){e.save(),this._applyStates(e);var t=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),i=.2*t,r=this._currentMeasure.left,n=this._currentMeasure.top;this._colorWheelCanvas&&this._colorWheelCanvas.width==2*t||(this._colorWheelCanvas=this._createColorWheelCanvas(t,i)),this._updateSquareProps(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY,e.fillRect(this._squareLeft,this._squareTop,this._squareSize,this._squareSize)),e.drawImage(this._colorWheelCanvas,r,n),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._drawGradientSquare(this._h,this._squareLeft,this._squareTop,this._squareSize,this._squareSize,e);var o=this._squareLeft+this._squareSize*this._s,s=this._squareTop+this._squareSize*(1-this._v);this._drawCircle(o,s,.04*t,e);var a=t-.5*i;o=r+t+Math.cos((this._h-180)*Math.PI/180)*a,s=n+t+Math.sin((this._h-180)*Math.PI/180)*a,this._drawCircle(o,s,.35*i,e),e.restore()},i.prototype._updateValueFromPointer=function(e,t){if(this._pointerStartedOnWheel){var r=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),n=r+this._currentMeasure.left,o=r+this._currentMeasure.top;this._h=180*Math.atan2(t-o,e-n)/Math.PI+180}else this._pointerStartedOnSquare&&(this._updateSquareProps(),this._s=(e-this._squareLeft)/this._squareSize,this._v=1-(t-this._squareTop)/this._squareSize,this._s=Math.min(this._s,1),this._s=Math.max(this._s,i._Epsilon),this._v=Math.min(this._v,1),this._v=Math.max(this._v,i._Epsilon));T.HSVtoRGBToRef(this._h,this._s,this._v,this._tmpColor),this.value=this._tmpColor},i.prototype._isPointOnSquare=function(e,t){this._updateSquareProps();var i=this._squareLeft,r=this._squareTop,n=this._squareSize;return e>=i&&e<=i+n&&t>=r&&t<=r+n},i.prototype._isPointOnWheel=function(e,t){var i=.5*Math.min(this._currentMeasure.width,this._currentMeasure.height),r=i-.2*i,n=e-(i+this._currentMeasure.left),o=t-(i+this._currentMeasure.top),s=n*n+o*o;return s<=i*i&&s>=r*r},i.prototype._onPointerDown=function(t,i,r,n,o){if(!e.prototype._onPointerDown.call(this,t,i,r,n,o))return!1;this._pointerIsDown=!0,this._pointerStartedOnSquare=!1,this._pointerStartedOnWheel=!1,this._invertTransformMatrix.transformCoordinates(i.x,i.y,this._transformedPosition);var s=this._transformedPosition.x,a=this._transformedPosition.y;return this._isPointOnSquare(s,a)?this._pointerStartedOnSquare=!0:this._isPointOnWheel(s,a)&&(this._pointerStartedOnWheel=!0),this._updateValueFromPointer(s,a),this._host._capturingControl[r]=this,this._lastPointerDownID=r,!0},i.prototype._onPointerMove=function(t,i,r,n){if(r==this._lastPointerDownID){this._invertTransformMatrix.transformCoordinates(i.x,i.y,this._transformedPosition);var o=this._transformedPosition.x,s=this._transformedPosition.y;this._pointerIsDown&&this._updateValueFromPointer(o,s),e.prototype._onPointerMove.call(this,t,i,r,n)}},i.prototype._onPointerUp=function(t,i,r,n,o,s){this._pointerIsDown=!1,delete this._host._capturingControl[r],e.prototype._onPointerUp.call(this,t,i,r,n,o,s)},i.prototype._onCanvasBlur=function(){this._forcePointerUp(),e.prototype._onCanvasBlur.call(this)},i.ShowPickerDialogAsync=function(e,t){return new Promise((function(r,n){t.pickerWidth=t.pickerWidth||"640px",t.pickerHeight=t.pickerHeight||"400px",t.headerHeight=t.headerHeight||"35px",t.lastColor=t.lastColor||"#000000",t.swatchLimit=t.swatchLimit||20,t.numSwatchesPerLine=t.numSwatchesPerLine||10;var o,s,a,h,u,l,c,f,d,p,_,g,m,v,y,b,E,x,A,M=t.swatchLimit/t.numSwatchesPerLine,P=parseFloat(t.pickerWidth)/t.numSwatchesPerLine,C=Math.floor(.25*P),S=C*(t.numSwatchesPerLine+1),I=Math.floor((parseFloat(t.pickerWidth)-S)/t.numSwatchesPerLine),O=I*M+C*(M+1),R=(parseInt(t.pickerHeight)+O+Math.floor(.25*I)).toString()+"px",D="#c0c0c0",w="#535353",L="#414141",F="515151",N="#555555",B="#454545",k=T.FromHexString("#dddddd"),U=k.r+k.g+k.b,V="#aaaaaa",W="#ffffff",z=["R","G","B"],G="#454545",H="#f0f0f0",X=!1;function j(e,t){A=t;var i=e.toHexString();if(E.background=i,p.name!=A&&(p.text=Math.floor(255*e.r).toString()),_.name!=A&&(_.text=Math.floor(255*e.g).toString()),g.name!=A&&(g.text=Math.floor(255*e.b).toString()),m.name!=A&&(m.text=e.r.toString()),v.name!=A&&(v.text=e.g.toString()),y.name!=A&&(y.text=e.b.toString()),b.name!=A){var r=i.split("#");b.text=r[1]}d.name!=A&&(d.value=e)}function K(e,t){var i=e.text;if(/[^0-9]/g.test(i))e.text=x;else if(""!=i&&(Math.floor(parseInt(i))<0?i="0":Math.floor(parseInt(i))>255?i="255":isNaN(parseInt(i))&&(i="0")),A==e.name&&(x=i),""!=i){i=parseInt(i).toString(),e.text=i;var r=T.FromHexString(E.background);A==e.name&&j("r"==t?new T(parseInt(i)/255,r.g,r.b):"g"==t?new T(r.r,parseInt(i)/255,r.b):new T(r.r,r.g,parseInt(i)/255),e.name)}}function Y(e,t){var i=e.text;if(/[^0-9\.]/g.test(i))e.text=x;else{""!=i&&"."!=i&&0!=parseFloat(i)&&(parseFloat(i)<0?i="0.0":parseFloat(i)>1?i="1.0":isNaN(parseFloat(i))&&(i="0.0")),A==e.name&&(x=i),""!=i&&"."!=i&&0!=parseFloat(i)?(i=parseFloat(i).toString(),e.text=i):i="0.0";var r=T.FromHexString(E.background);A==e.name&&j("r"==t?new T(parseFloat(i),r.g,r.b):"g"==t?new T(r.r,parseFloat(i),r.b):new T(r.r,r.g,parseFloat(i)),e.name)}}function q(){if(t.savedColors&&t.savedColors[c]){if(X)var e="b";else e="";var i=Xr.CreateSimpleButton("Swatch_"+c,e);i.fontFamily="BabylonJSglyphs";var r=T.FromHexString(t.savedColors[c]),n=r.r+r.g+r.b;i.color=n>U?V:W,i.fontSize=Math.floor(.7*I),i.textBlock.verticalAlignment=Ur.VERTICAL_ALIGNMENT_CENTER,i.height=i.width=I.toString()+"px",i.background=t.savedColors[c],i.thickness=2;var o=c;return i.pointerDownAnimation=function(){i.thickness=4},i.pointerUpAnimation=function(){i.thickness=3},i.pointerEnterAnimation=function(){i.thickness=3},i.pointerOutAnimation=function(){i.thickness=2},i.onPointerClickObservable.add((function(){var e;X?(e=o,t.savedColors&&t.savedColors.splice(e,1),t.savedColors&&0==t.savedColors.length&&(J(!1),X=!1),Q("",we)):t.savedColors&&j(T.FromHexString(t.savedColors[o]),i.name)})),i}return null}function Z(e){if(void 0!==e&&(X=e),X){for(var t=0;t<f.children.length;t++){f.children[t].textBlock.text="b"}void 0!==a&&(a.textBlock.text="Done")}else{for(t=0;t<f.children.length;t++){f.children[t].textBlock.text=""}void 0!==a&&(a.textBlock.text="Edit")}}function Q(e,i){if(t.savedColors){""!=e&&t.savedColors.push(e),c=0,f.clearControls();var r=Math.ceil(t.savedColors.length/t.numSwatchesPerLine);if(0==r)var n=0;else n=r+1;if(f.rowCount!=r+n){for(var o=f.rowCount,s=0;s<o;s++)f.removeRowDefinition(0);for(s=0;s<r+n;s++)s%2?f.addRowDefinition(I,!0):f.addRowDefinition(C,!0)}f.height=(I*r+n*C).toString()+"px";for(var a=1,h=1;a<r+n;a+=2,h++){if(t.savedColors.length>h*t.numSwatchesPerLine)var u=t.numSwatchesPerLine;else u=t.savedColors.length-(h-1)*t.numSwatchesPerLine;for(var l=Math.min(Math.max(u,0),t.numSwatchesPerLine),d=0,p=1;d<l;d++)if(!(d>t.numSwatchesPerLine)){var _=q();null!=_&&(f.addControl(_,a,p),p+=2,c++)}}t.savedColors.length>=t.swatchLimit?$(i,!0):$(i,!1)}}function J(e){e?((a=Xr.CreateSimpleButton("butEdit","Edit")).width=h,a.height=u,a.left=Math.floor(.1*parseInt(h)).toString()+"px",a.top=(-1*parseFloat(a.left)).toString()+"px",a.verticalAlignment=Ur.VERTICAL_ALIGNMENT_BOTTOM,a.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT,a.thickness=2,a.color=D,a.fontSize=s,a.background=w,a.onPointerEnterObservable.add((function(){a.background=L})),a.onPointerOutObservable.add((function(){a.background=w})),a.pointerDownAnimation=function(){a.background=F},a.pointerUpAnimation=function(){a.background=L},a.onPointerClickObservable.add((function(){X=!X,Z()})),pe.addControl(a,1,0)):pe.removeControl(a)}function $(e,t){t?(e.color=N,e.background=B):(e.color=D,e.background=w)}function ee(i){t.savedColors&&t.savedColors.length>0?r({savedColors:t.savedColors,pickedColor:i}):r({pickedColor:i}),e.removeControl(te)}var te=new Jr;if(te.name="Dialog Container",te.width=t.pickerWidth,t.savedColors){te.height=R;var ie=parseInt(t.pickerHeight)/parseInt(R);te.addRowDefinition(ie,!1),te.addRowDefinition(1-ie,!1)}else te.height=t.pickerHeight,te.addRowDefinition(1,!1);if(e.addControl(te),t.savedColors){(f=new Jr).name="Swatch Drawer",f.verticalAlignment=Ur.VERTICAL_ALIGNMENT_TOP,f.background=w,f.width=t.pickerWidth;var re=t.savedColors.length/t.numSwatchesPerLine;if(0==re)var ne=0;else ne=re+1;f.height=(I*re+ne*C).toString()+"px",f.top=Math.floor(.25*I).toString()+"px";for(var oe=0;oe<2*Math.ceil(t.savedColors.length/t.numSwatchesPerLine)+1;oe++)oe%2!=0?f.addRowDefinition(I,!0):f.addRowDefinition(C,!0);for(oe=0;oe<2*t.numSwatchesPerLine+1;oe++)oe%2!=0?f.addColumnDefinition(I,!0):f.addColumnDefinition(C,!0);te.addControl(f,1,0)}var se=new Jr;se.name="Picker Panel",se.height=t.pickerHeight;var ae=parseInt(t.headerHeight)/parseInt(t.pickerHeight),he=[ae,1-ae];se.addRowDefinition(he[0],!1),se.addRowDefinition(he[1],!1),te.addControl(se,0,0);var ue=new zr;ue.name="Dialogue Header Bar",ue.background="#cccccc",ue.thickness=0,se.addControl(ue,0,0);var le=Xr.CreateSimpleButton("closeButton","a");le.fontFamily="BabylonJSglyphs";var ce=T.FromHexString(ue.background);o=new T(1-ce.r,1-ce.g,1-ce.b),le.color=o.toHexString(),le.fontSize=Math.floor(.6*parseInt(t.headerHeight)),le.textBlock.textVerticalAlignment=Ur.VERTICAL_ALIGNMENT_CENTER,le.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_RIGHT,le.height=le.width=t.headerHeight,le.background=ue.background,le.thickness=0,le.pointerDownAnimation=function(){},le.pointerUpAnimation=function(){le.background=ue.background},le.pointerEnterAnimation=function(){le.color=ue.background,le.background="red"},le.pointerOutAnimation=function(){le.color=o.toHexString(),le.background=ue.background},le.onPointerClickObservable.add((function(){ee(Pe.background)})),se.addControl(le,0,0);var fe=new Jr;fe.name="Dialogue Body",fe.background=w;var de=[.4375,.5625];fe.addRowDefinition(1,!1),fe.addColumnDefinition(de[0],!1),fe.addColumnDefinition(de[1],!1),se.addControl(fe,1,0);var pe=new Jr;pe.name="Picker Grid",pe.addRowDefinition(.85,!1),pe.addRowDefinition(.15,!1),fe.addControl(pe,0,0),(d=new i).name="GUI Color Picker",t.pickerHeight<t.pickerWidth?d.width=.89:d.height=.89,d.value=T.FromHexString(t.lastColor),d.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_CENTER,d.verticalAlignment=Ur.VERTICAL_ALIGNMENT_CENTER,d.onPointerDownObservable.add((function(){A=d.name,x="",Z(!1)})),d.onValueChangedObservable.add((function(e){A==d.name&&j(e,d.name)})),pe.addControl(d,0,0);var _e=new Jr;_e.name="Dialogue Right Half",_e.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT;var ge=[.514,.486];_e.addRowDefinition(ge[0],!1),_e.addRowDefinition(ge[1],!1),fe.addControl(_e,1,1);var me=new Jr;me.name="Swatches and Buttons";var ve=[.417,.583];me.addRowDefinition(1,!1),me.addColumnDefinition(ve[0],!1),me.addColumnDefinition(ve[1],!1),_e.addControl(me,0,0);var ye=new Jr;ye.name="New and Current Swatches";var be=[.04,.16,.64,.16];ye.addRowDefinition(be[0],!1),ye.addRowDefinition(be[1],!1),ye.addRowDefinition(be[2],!1),ye.addRowDefinition(be[3],!1),me.addControl(ye,0,0);var Te=new Jr;Te.name="Active Swatches",Te.width=.67,Te.addRowDefinition(.5,!1),Te.addRowDefinition(.5,!1),ye.addControl(Te,2,0);var Ee=Math.floor(parseInt(t.pickerWidth)*de[1]*ve[0]*.11),xe=Math.floor(parseInt(t.pickerHeight)*he[1]*ge[0]*be[1]*.5);if(t.pickerWidth>t.pickerHeight)var Ae=xe;else Ae=Ee;var Me=new Gr;Me.text="new",Me.name="New Color Label",Me.color=D,Me.fontSize=Ae,ye.addControl(Me,1,0),(E=new zr).name="New Color Swatch",E.background=t.lastColor,E.thickness=0,Te.addControl(E,0,0);var Pe=Xr.CreateSimpleButton("currentSwatch","");Pe.background=t.lastColor,Pe.thickness=0,Pe.onPointerClickObservable.add((function(){j(T.FromHexString(Pe.background),Pe.name),Z(!1)})),Pe.pointerDownAnimation=function(){},Pe.pointerUpAnimation=function(){},Pe.pointerEnterAnimation=function(){},Pe.pointerOutAnimation=function(){},Te.addControl(Pe,1,0);var Ce=new zr;Ce.name="Swatch Outline",Ce.width=.67,Ce.thickness=2,Ce.color="#404040",Ce.isHitTestVisible=!1,ye.addControl(Ce,2,0);var Se=new Gr;Se.name="Current Color Label",Se.text="current",Se.color=D,Se.fontSize=Ae,ye.addControl(Se,3,0);var Ie=new Jr;Ie.name="Button Grid",Ie.height=.8;var Oe=1/3;Ie.addRowDefinition(Oe,!1),Ie.addRowDefinition(Oe,!1),Ie.addRowDefinition(Oe,!1),me.addControl(Ie,0,1),h=Math.floor(parseInt(t.pickerWidth)*de[1]*ve[1]*.67).toString()+"px",u=Math.floor(parseInt(t.pickerHeight)*he[1]*ge[0]*(parseFloat(Ie.height.toString())/100)*Oe*.7).toString()+"px",s=parseFloat(h)>parseFloat(u)?Math.floor(.45*parseFloat(u)):Math.floor(.11*parseFloat(h));var Re=Xr.CreateSimpleButton("butOK","OK");Re.width=h,Re.height=u,Re.verticalAlignment=Ur.VERTICAL_ALIGNMENT_CENTER,Re.thickness=2,Re.color=D,Re.fontSize=s,Re.background=w,Re.onPointerEnterObservable.add((function(){Re.background=L})),Re.onPointerOutObservable.add((function(){Re.background=w})),Re.pointerDownAnimation=function(){Re.background=F},Re.pointerUpAnimation=function(){Re.background=L},Re.onPointerClickObservable.add((function(){Z(!1),ee(E.background)})),Ie.addControl(Re,0,0);var De=Xr.CreateSimpleButton("butCancel","Cancel");if(De.width=h,De.height=u,De.verticalAlignment=Ur.VERTICAL_ALIGNMENT_CENTER,De.thickness=2,De.color=D,De.fontSize=s,De.background=w,De.onPointerEnterObservable.add((function(){De.background=L})),De.onPointerOutObservable.add((function(){De.background=w})),De.pointerDownAnimation=function(){De.background=F},De.pointerUpAnimation=function(){De.background=L},De.onPointerClickObservable.add((function(){Z(!1),ee(Pe.background)})),Ie.addControl(De,1,0),t.savedColors){var we=Xr.CreateSimpleButton("butSave","Save");we.width=h,we.height=u,we.verticalAlignment=Ur.VERTICAL_ALIGNMENT_CENTER,we.thickness=2,we.fontSize=s,t.savedColors.length<t.swatchLimit?(we.color=D,we.background=w):$(we,!0),we.onPointerEnterObservable.add((function(){t.savedColors&&t.savedColors.length<t.swatchLimit&&(we.background=L)})),we.onPointerOutObservable.add((function(){t.savedColors&&t.savedColors.length<t.swatchLimit&&(we.background=w)})),we.pointerDownAnimation=function(){t.savedColors&&t.savedColors.length<t.swatchLimit&&(we.background=F)},we.pointerUpAnimation=function(){t.savedColors&&t.savedColors.length<t.swatchLimit&&(we.background=L)},we.onPointerClickObservable.add((function(){t.savedColors&&(0==t.savedColors.length&&J(!0),t.savedColors.length<t.swatchLimit&&Q(E.background,we),Z(!1))})),t.savedColors.length>0&&J(!0),Ie.addControl(we,2,0)}var Le=new Jr;Le.name="Dialog Lower Right",Le.addRowDefinition(.02,!1),Le.addRowDefinition(.63,!1),Le.addRowDefinition(.21,!1),Le.addRowDefinition(.14,!1),_e.addControl(Le,1,0),l=T.FromHexString(t.lastColor);var Fe=new Jr;Fe.name="RGB Values",Fe.width=.82,Fe.verticalAlignment=Ur.VERTICAL_ALIGNMENT_CENTER,Fe.addRowDefinition(1/3,!1),Fe.addRowDefinition(1/3,!1),Fe.addRowDefinition(1/3,!1),Fe.addColumnDefinition(.1,!1),Fe.addColumnDefinition(.2,!1),Fe.addColumnDefinition(.7,!1),Le.addControl(Fe,1,0);for(oe=0;oe<z.length;oe++){(Ne=new Gr).text=z[oe],Ne.color=D,Ne.fontSize=s,Fe.addControl(Ne,oe,0)}(p=new Qr).width=.83,p.height=.72,p.name="rIntField",p.fontSize=s,p.text=(255*l.r).toString(),p.color=H,p.background=G,p.onFocusObservable.add((function(){A=p.name,x=p.text,Z(!1)})),p.onBlurObservable.add((function(){""==p.text&&(p.text="0"),K(p,"r"),A==p.name&&(A="")})),p.onTextChangedObservable.add((function(){A==p.name&&K(p,"r")})),Fe.addControl(p,0,1),(_=new Qr).width=.83,_.height=.72,_.name="gIntField",_.fontSize=s,_.text=(255*l.g).toString(),_.color=H,_.background=G,_.onFocusObservable.add((function(){A=_.name,x=_.text,Z(!1)})),_.onBlurObservable.add((function(){""==_.text&&(_.text="0"),K(_,"g"),A==_.name&&(A="")})),_.onTextChangedObservable.add((function(){A==_.name&&K(_,"g")})),Fe.addControl(_,1,1),(g=new Qr).width=.83,g.height=.72,g.name="bIntField",g.fontSize=s,g.text=(255*l.b).toString(),g.color=H,g.background=G,g.onFocusObservable.add((function(){A=g.name,x=g.text,Z(!1)})),g.onBlurObservable.add((function(){""==g.text&&(g.text="0"),K(g,"b"),A==g.name&&(A="")})),g.onTextChangedObservable.add((function(){A==g.name&&K(g,"b")})),Fe.addControl(g,2,1),(m=new Qr).width=.95,m.height=.72,m.name="rDecField",m.fontSize=s,m.text=l.r.toString(),m.color=H,m.background=G,m.onFocusObservable.add((function(){A=m.name,x=m.text,Z(!1)})),m.onBlurObservable.add((function(){0!=parseFloat(m.text)&&""!=m.text||(m.text="0",Y(m,"r")),A==m.name&&(A="")})),m.onTextChangedObservable.add((function(){A==m.name&&Y(m,"r")})),Fe.addControl(m,0,2),(v=new Qr).width=.95,v.height=.72,v.name="gDecField",v.fontSize=s,v.text=l.g.toString(),v.color=H,v.background=G,v.onFocusObservable.add((function(){A=v.name,x=v.text,Z(!1)})),v.onBlurObservable.add((function(){0!=parseFloat(v.text)&&""!=v.text||(v.text="0",Y(v,"g")),A==v.name&&(A="")})),v.onTextChangedObservable.add((function(){A==v.name&&Y(v,"g")})),Fe.addControl(v,1,2),(y=new Qr).width=.95,y.height=.72,y.name="bDecField",y.fontSize=s,y.text=l.b.toString(),y.color=H,y.background=G,y.onFocusObservable.add((function(){A=y.name,x=y.text,Z(!1)})),y.onBlurObservable.add((function(){0!=parseFloat(y.text)&&""!=y.text||(y.text="0",Y(y,"b")),A==y.name&&(A="")})),y.onTextChangedObservable.add((function(){A==y.name&&Y(y,"b")})),Fe.addControl(y,2,2);var Ne,Be=new Jr;Be.name="Hex Value",Be.width=.82,Be.addRowDefinition(1,!1),Be.addColumnDefinition(.1,!1),Be.addColumnDefinition(.9,!1),Le.addControl(Be,2,0),(Ne=new Gr).text="#",Ne.color=D,Ne.fontSize=s,Be.addControl(Ne,0,0),(b=new Qr).width=.96,b.height=.72,b.name="hexField",b.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_CENTER,b.fontSize=s;var ke=t.lastColor.split("#");b.text=ke[1],b.color=H,b.background=G,b.onFocusObservable.add((function(){A=b.name,x=b.text,Z(!1)})),b.onBlurObservable.add((function(){if(3==b.text.length){var e=b.text.split("");b.text=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]}""==b.text&&(b.text="000000",j(T.FromHexString(b.text),"b")),A==b.name&&(A="")})),b.onTextChangedObservable.add((function(){var e=b.text,t=/[^0-9A-F]/i.test(e);if((b.text.length>6||t)&&A==b.name)b.text=x;else{if(b.text.length<6)for(var i=6-b.text.length,r=0;r<i;r++)e="0"+e;if(3==b.text.length){var n=b.text.split("");e=n[0]+n[0]+n[1]+n[1]+n[2]+n[2]}e="#"+e,A==b.name&&(x=b.text,j(T.FromHexString(e),b.name))}})),Be.addControl(b,0,1),t.savedColors&&t.savedColors.length>0&&Q("",we)}))},i._Epsilon=1e-6,i}(Ur);c.RegisteredTypes["BABYLON.GUI.ColorPicker"]=$r;var en=function(e){function i(t){var i=e.call(this,t)||this;return i.name=t,i._thickness=1,i}return t(i,e),Object.defineProperty(i.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!1,configurable:!0}),i.prototype._getTypeName=function(){return"Ellipse"},i.prototype._localDraw=function(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),Ur.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._thickness/2,this._currentMeasure.height/2-this._thickness/2,e),this._background&&(e.fillStyle=this._background,e.fill()),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),this._thickness&&(this.color&&(e.strokeStyle=this.color),e.lineWidth=this._thickness,e.stroke()),e.restore()},i.prototype._additionalProcessing=function(t,i){e.prototype._additionalProcessing.call(this,t,i),this._measureForChildren.width-=2*this._thickness,this._measureForChildren.height-=2*this._thickness,this._measureForChildren.left+=this._thickness,this._measureForChildren.top+=this._thickness},i.prototype._clipForChildren=function(e){Ur.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2,this._currentMeasure.height/2,e),e.clip()},i}(Vr);c.RegisteredTypes["BABYLON.GUI.Ellipse"]=en;var tn=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return t(i,e),i.prototype._beforeRenderText=function(e){for(var t=new Zr,i="",r=0;r<e.length;r++)i+="•";return t.text=i,t},i}(Qr);c.RegisteredTypes["BABYLON.GUI.InputPassword"]=tn;var rn=function(e){function i(t){var i=e.call(this,t)||this;return i.name=t,i._lineWidth=1,i._x1=new Rr(0),i._y1=new Rr(0),i._x2=new Rr(0),i._y2=new Rr(0),i._dash=new Array,i._automaticSize=!0,i.isHitTestVisible=!1,i._horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT,i._verticalAlignment=Ur.VERTICAL_ALIGNMENT_TOP,i}return t(i,e),Object.defineProperty(i.prototype,"dash",{get:function(){return this._dash},set:function(e){this._dash!==e&&(this._dash=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"connectedControl",{get:function(){return this._connectedControl},set:function(e){var t=this;this._connectedControl!==e&&(this._connectedControlDirtyObserver&&this._connectedControl&&(this._connectedControl.onDirtyObservable.remove(this._connectedControlDirtyObserver),this._connectedControlDirtyObserver=null),e&&(this._connectedControlDirtyObserver=e.onDirtyObservable.add((function(){return t._markAsDirty()}))),this._connectedControl=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"x1",{get:function(){return this._x1.toString(this._host)},set:function(e){this._x1.toString(this._host)!==e&&this._x1.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"y1",{get:function(){return this._y1.toString(this._host)},set:function(e){this._y1.toString(this._host)!==e&&this._y1.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"x2",{get:function(){return this._x2.toString(this._host)},set:function(e){this._x2.toString(this._host)!==e&&this._x2.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"y2",{get:function(){return this._y2.toString(this._host)},set:function(e){this._y2.toString(this._host)!==e&&this._y2.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"lineWidth",{get:function(){return this._lineWidth},set:function(e){this._lineWidth!==e&&(this._lineWidth=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"horizontalAlignment",{set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"verticalAlignment",{set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"_effectiveX2",{get:function(){return(this._connectedControl?this._connectedControl.centerX:0)+this._x2.getValue(this._host)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"_effectiveY2",{get:function(){return(this._connectedControl?this._connectedControl.centerY:0)+this._y2.getValue(this._host)},enumerable:!1,configurable:!0}),i.prototype._getTypeName=function(){return"Line"},i.prototype._draw=function(e){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._applyStates(e),e.strokeStyle=this.color,e.lineWidth=this._lineWidth,e.setLineDash(this._dash),e.beginPath(),e.moveTo(this._cachedParentMeasure.left+this._x1.getValue(this._host),this._cachedParentMeasure.top+this._y1.getValue(this._host)),e.lineTo(this._cachedParentMeasure.left+this._effectiveX2,this._cachedParentMeasure.top+this._effectiveY2),e.stroke(),e.restore()},i.prototype._measure=function(){this._currentMeasure.width=Math.abs(this._x1.getValue(this._host)-this._effectiveX2)+this._lineWidth,this._currentMeasure.height=Math.abs(this._y1.getValue(this._host)-this._effectiveY2)+this._lineWidth},i.prototype._computeAlignment=function(e,t){this._currentMeasure.left=e.left+Math.min(this._x1.getValue(this._host),this._effectiveX2)-this._lineWidth/2,this._currentMeasure.top=e.top+Math.min(this._y1.getValue(this._host),this._effectiveY2)-this._lineWidth/2},i.prototype.moveToVector3=function(e,t,i){if(void 0===i&&(i=!1),this._host&&this.parent===this._host._rootContainer){var r=this._host._getGlobalViewport(t),n=p.Project(e,m.Identity(),t.getTransformMatrix(),r);this._moveToProjectedPosition(n,i),n.z<0||n.z>1?this.notRenderable=!0:this.notRenderable=!1}else Ue.Error("Cannot move a control to a vector3 if the control is not at root level")},i.prototype._moveToProjectedPosition=function(e,t){void 0===t&&(t=!1);var i=e.x+this._linkOffsetX.getValue(this._host)+"px",r=e.y+this._linkOffsetY.getValue(this._host)+"px";t?(this.x2=i,this.y2=r,this._x2.ignoreAdaptiveScaling=!0,this._y2.ignoreAdaptiveScaling=!0):(this.x1=i,this.y1=r,this._x1.ignoreAdaptiveScaling=!0,this._y1.ignoreAdaptiveScaling=!0)},i}(Ur);c.RegisteredTypes["BABYLON.GUI.Line"]=rn;var nn=function(){function e(e){this._multiLine=e,this._x=new Rr(0),this._y=new Rr(0),this._point=new p(0,0,0)}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x.toString(this._multiLine._host)},set:function(e){this._x.toString(this._multiLine._host)!==e&&this._x.fromString(e)&&this._multiLine._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y.toString(this._multiLine._host)},set:function(e){this._y.toString(this._multiLine._host)!==e&&this._y.fromString(e)&&this._multiLine._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"control",{get:function(){return this._control},set:function(e){this._control!==e&&(this._control&&this._controlObserver&&(this._control.onDirtyObservable.remove(this._controlObserver),this._controlObserver=null),this._control=e,this._control&&(this._controlObserver=this._control.onDirtyObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mesh",{get:function(){return this._mesh},set:function(e){this._mesh!==e&&(this._mesh&&this._meshObserver&&this._mesh.getScene().onAfterCameraRenderObservable.remove(this._meshObserver),this._mesh=e,this._mesh&&(this._meshObserver=this._mesh.getScene().onAfterCameraRenderObservable.add(this._multiLine.onPointUpdate)),this._multiLine._markAsDirty())},enumerable:!1,configurable:!0}),e.prototype.resetLinks=function(){this.control=null,this.mesh=null},e.prototype.translate=function(){return this._point=this._translatePoint(),this._point},e.prototype._translatePoint=function(){if(null!=this._mesh)return this._multiLine._host.getProjectedPositionWithZ(this._mesh.getBoundingInfo().boundingSphere.center,this._mesh.getWorldMatrix());if(null!=this._control)return new p(this._control.centerX,this._control.centerY,.999);var e=this._multiLine._host,t=this._x.getValueInPixel(e,Number(e._canvas.width)),i=this._y.getValueInPixel(e,Number(e._canvas.height));return new p(t,i,.999)},e.prototype.dispose=function(){this.resetLinks()},e}(),on=function(e){function i(t){var i=e.call(this,t)||this;return i.name=t,i._lineWidth=1,i.onPointUpdate=function(){i._markAsDirty()},i._automaticSize=!0,i.isHitTestVisible=!1,i._horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT,i._verticalAlignment=Ur.VERTICAL_ALIGNMENT_TOP,i._dash=[],i._points=[],i}return t(i,e),Object.defineProperty(i.prototype,"dash",{get:function(){return this._dash},set:function(e){this._dash!==e&&(this._dash=e,this._markAsDirty())},enumerable:!1,configurable:!0}),i.prototype.getAt=function(e){return this._points[e]||(this._points[e]=new nn(this)),this._points[e]},i.prototype.add=function(){for(var e=this,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return t.map((function(t){return e.push(t)}))},i.prototype.push=function(e){var t=this.getAt(this._points.length);return null==e||(e instanceof kt?t.mesh=e:e instanceof Ur?t.control=e:null!=e.x&&null!=e.y&&(t.x=e.x,t.y=e.y)),t},i.prototype.remove=function(e){var t;if(e instanceof nn){if(-1===(t=this._points.indexOf(e)))return}else t=e;var i=this._points[t];i&&(i.dispose(),this._points.splice(t,1))},i.prototype.reset=function(){for(;this._points.length>0;)this.remove(this._points.length-1)},i.prototype.resetLinks=function(){this._points.forEach((function(e){null!=e&&e.resetLinks()}))},Object.defineProperty(i.prototype,"lineWidth",{get:function(){return this._lineWidth},set:function(e){this._lineWidth!==e&&(this._lineWidth=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"horizontalAlignment",{set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"verticalAlignment",{set:function(e){},enumerable:!1,configurable:!0}),i.prototype._getTypeName=function(){return"MultiLine"},i.prototype._draw=function(e,t){e.save(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._applyStates(e),e.strokeStyle=this.color,e.lineWidth=this._lineWidth,e.setLineDash(this._dash),e.beginPath();var i,r=!0;this._points.forEach((function(t){t&&(r?(e.moveTo(t._point.x,t._point.y),r=!1):t._point.z<1&&i.z<1?e.lineTo(t._point.x,t._point.y):e.moveTo(t._point.x,t._point.y),i=t._point)})),e.stroke(),e.restore()},i.prototype._additionalProcessing=function(e,t){var i=this;this._minX=null,this._minY=null,this._maxX=null,this._maxY=null,this._points.forEach((function(e,t){e&&(e.translate(),(null==i._minX||e._point.x<i._minX)&&(i._minX=e._point.x),(null==i._minY||e._point.y<i._minY)&&(i._minY=e._point.y),(null==i._maxX||e._point.x>i._maxX)&&(i._maxX=e._point.x),(null==i._maxY||e._point.y>i._maxY)&&(i._maxY=e._point.y))})),null==this._minX&&(this._minX=0),null==this._minY&&(this._minY=0),null==this._maxX&&(this._maxX=0),null==this._maxY&&(this._maxY=0)},i.prototype._measure=function(){null!=this._minX&&null!=this._maxX&&null!=this._minY&&null!=this._maxY&&(this._currentMeasure.width=Math.abs(this._maxX-this._minX)+this._lineWidth,this._currentMeasure.height=Math.abs(this._maxY-this._minY)+this._lineWidth)},i.prototype._computeAlignment=function(e,t){null!=this._minX&&null!=this._minY&&(this._currentMeasure.left=this._minX-this._lineWidth/2,this._currentMeasure.top=this._minY-this._lineWidth/2)},i.prototype.dispose=function(){this.reset(),e.prototype.dispose.call(this)},i}(Ur);c.RegisteredTypes["BABYLON.GUI.MultiLine"]=on;var sn=function(e){function i(t){var i=e.call(this,t)||this;return i.name=t,i._isChecked=!1,i._background="black",i._checkSizeRatio=.8,i._thickness=1,i.group="",i.onIsCheckedChangedObservable=new U,i.isPointerBlocker=!0,i}return t(i,e),Object.defineProperty(i.prototype,"thickness",{get:function(){return this._thickness},set:function(e){this._thickness!==e&&(this._thickness=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"checkSizeRatio",{get:function(){return this._checkSizeRatio},set:function(e){e=Math.max(Math.min(1,e),0),this._checkSizeRatio!==e&&(this._checkSizeRatio=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isChecked",{get:function(){return this._isChecked},set:function(e){var t=this;this._isChecked!==e&&(this._isChecked=e,this._markAsDirty(),this.onIsCheckedChangedObservable.notifyObservers(e),this._isChecked&&this._host&&this._host.executeOnAllControls((function(e){if(e!==t&&void 0!==e.group){var i=e;i.group===t.group&&(i.isChecked=!1)}})))},enumerable:!1,configurable:!0}),i.prototype._getTypeName=function(){return"RadioButton"},i.prototype._draw=function(e){e.save(),this._applyStates(e);var t=this._currentMeasure.width-this._thickness,i=this._currentMeasure.height-this._thickness;if((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),Ur.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,this._currentMeasure.width/2-this._thickness/2,this._currentMeasure.height/2-this._thickness/2,e),e.fillStyle=this._isEnabled?this._background:this._disabledColor,e.fill(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.strokeStyle=this.color,e.lineWidth=this._thickness,e.stroke(),this._isChecked){e.fillStyle=this._isEnabled?this.color:this._disabledColor;var r=t*this._checkSizeRatio,n=i*this._checkSizeRatio;Ur.drawEllipse(this._currentMeasure.left+this._currentMeasure.width/2,this._currentMeasure.top+this._currentMeasure.height/2,r/2-this._thickness/2,n/2-this._thickness/2,e),e.fill()}e.restore()},i.prototype._onPointerDown=function(t,i,r,n,o){return!!e.prototype._onPointerDown.call(this,t,i,r,n,o)&&(this.isChecked||(this.isChecked=!0),!0)},i.AddRadioButtonWithHeader=function(e,t,r,n){var o=new jr;o.isVertical=!1,o.height="30px";var s=new i;s.width="20px",s.height="20px",s.isChecked=r,s.color="green",s.group=t,s.onIsCheckedChangedObservable.add((function(e){return n(s,e)})),o.addControl(s);var a=new Gr;return a.text=e,a.width="180px",a.paddingLeft="5px",a.textHorizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT,a.color="white",o.addControl(a),o},i}(Ur);c.RegisteredTypes["BABYLON.GUI.RadioButton"]=sn;var an=function(e){function i(t){var i=e.call(this,t)||this;return i.name=t,i._thumbWidth=new Rr(20,Rr.UNITMODE_PIXEL,!1),i._minimum=0,i._maximum=100,i._value=50,i._isVertical=!1,i._barOffset=new Rr(5,Rr.UNITMODE_PIXEL,!1),i._isThumbClamped=!1,i._displayThumb=!0,i._step=0,i._lastPointerDownID=-1,i._effectiveBarOffset=0,i.onValueChangedObservable=new U,i._pointerIsDown=!1,i.isPointerBlocker=!0,i}return t(i,e),Object.defineProperty(i.prototype,"displayThumb",{get:function(){return this._displayThumb},set:function(e){this._displayThumb!==e&&(this._displayThumb=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"step",{get:function(){return this._step},set:function(e){this._step!==e&&(this._step=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"barOffset",{get:function(){return this._barOffset.toString(this._host)},set:function(e){this._barOffset.toString(this._host)!==e&&this._barOffset.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"barOffsetInPixels",{get:function(){return this._barOffset.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"thumbWidth",{get:function(){return this._thumbWidth.toString(this._host)},set:function(e){this._thumbWidth.toString(this._host)!==e&&this._thumbWidth.fromString(e)&&this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"thumbWidthInPixels",{get:function(){return this._thumbWidth.getValueInPixel(this._host,this._cachedParentMeasure.width)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"minimum",{get:function(){return this._minimum},set:function(e){this._minimum!==e&&(this._minimum=e,this._markAsDirty(),this.value=Math.max(Math.min(this.value,this._maximum),this._minimum))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"maximum",{get:function(){return this._maximum},set:function(e){this._maximum!==e&&(this._maximum=e,this._markAsDirty(),this.value=Math.max(Math.min(this.value,this._maximum),this._minimum))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"value",{get:function(){return this._value},set:function(e){e=Math.max(Math.min(e,this._maximum),this._minimum),this._value!==e&&(this._value=e,this._markAsDirty(),this.onValueChangedObservable.notifyObservers(this._value))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isVertical",{get:function(){return this._isVertical},set:function(e){this._isVertical!==e&&(this._isVertical=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isThumbClamped",{get:function(){return this._isThumbClamped},set:function(e){this._isThumbClamped!==e&&(this._isThumbClamped=e,this._markAsDirty())},enumerable:!1,configurable:!0}),i.prototype._getTypeName=function(){return"BaseSlider"},i.prototype._getThumbPosition=function(){return this.isVertical?(this.maximum-this.value)/(this.maximum-this.minimum)*this._backgroundBoxLength:(this.value-this.minimum)/(this.maximum-this.minimum)*this._backgroundBoxLength},i.prototype._getThumbThickness=function(e){var t=0;switch(e){case"circle":t=this._thumbWidth.isPixel?Math.max(this._thumbWidth.getValue(this._host),this._backgroundBoxThickness):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host);break;case"rectangle":t=this._thumbWidth.isPixel?Math.min(this._thumbWidth.getValue(this._host),this._backgroundBoxThickness):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)}return t},i.prototype._prepareRenderingData=function(e){this._effectiveBarOffset=0,this._renderLeft=this._currentMeasure.left,this._renderTop=this._currentMeasure.top,this._renderWidth=this._currentMeasure.width,this._renderHeight=this._currentMeasure.height,this._backgroundBoxLength=Math.max(this._currentMeasure.width,this._currentMeasure.height),this._backgroundBoxThickness=Math.min(this._currentMeasure.width,this._currentMeasure.height),this._effectiveThumbThickness=this._getThumbThickness(e),this.displayThumb&&(this._backgroundBoxLength-=this._effectiveThumbThickness),this.isVertical&&this._currentMeasure.height<this._currentMeasure.width||(this._barOffset.isPixel?this._effectiveBarOffset=Math.min(this._barOffset.getValue(this._host),this._backgroundBoxThickness):this._effectiveBarOffset=this._backgroundBoxThickness*this._barOffset.getValue(this._host),this._backgroundBoxThickness-=2*this._effectiveBarOffset,this.isVertical?(this._renderLeft+=this._effectiveBarOffset,!this.isThumbClamped&&this.displayThumb&&(this._renderTop+=this._effectiveThumbThickness/2),this._renderHeight=this._backgroundBoxLength,this._renderWidth=this._backgroundBoxThickness):(this._renderTop+=this._effectiveBarOffset,!this.isThumbClamped&&this.displayThumb&&(this._renderLeft+=this._effectiveThumbThickness/2),this._renderHeight=this._backgroundBoxThickness,this._renderWidth=this._backgroundBoxLength))},i.prototype._updateValueFromPointer=function(e,t){var i;0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y),i=this._isVertical?this._minimum+(1-(t-this._currentMeasure.top)/this._currentMeasure.height)*(this._maximum-this._minimum):this._minimum+(e-this._currentMeasure.left)/this._currentMeasure.width*(this._maximum-this._minimum);var r=1/this._step|0;this.value=this._step?(i*r|0)/r:i},i.prototype._onPointerDown=function(t,i,r,n,o){return!!e.prototype._onPointerDown.call(this,t,i,r,n,o)&&(this._pointerIsDown=!0,this._updateValueFromPointer(i.x,i.y),this._host._capturingControl[r]=this,this._lastPointerDownID=r,!0)},i.prototype._onPointerMove=function(t,i,r,n){r==this._lastPointerDownID&&(this._pointerIsDown&&this._updateValueFromPointer(i.x,i.y),e.prototype._onPointerMove.call(this,t,i,r,n))},i.prototype._onPointerUp=function(t,i,r,n,o){this._pointerIsDown=!1,delete this._host._capturingControl[r],e.prototype._onPointerUp.call(this,t,i,r,n,o)},i.prototype._onCanvasBlur=function(){this._forcePointerUp(),e.prototype._onCanvasBlur.call(this)},i}(Ur),hn=function(e){function i(t){var i=e.call(this,t)||this;return i.name=t,i._background="black",i._borderColor="white",i._thumbColor="",i._isThumbCircle=!1,i._displayValueBar=!0,i}return t(i,e),Object.defineProperty(i.prototype,"displayValueBar",{get:function(){return this._displayValueBar},set:function(e){this._displayValueBar!==e&&(this._displayValueBar=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"borderColor",{get:function(){return this._borderColor},set:function(e){this._borderColor!==e&&(this._borderColor=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"thumbColor",{get:function(){return this._thumbColor},set:function(e){this._thumbColor!==e&&(this._thumbColor=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isThumbCircle",{get:function(){return this._isThumbCircle},set:function(e){this._isThumbCircle!==e&&(this._isThumbCircle=e,this._markAsDirty())},enumerable:!1,configurable:!0}),i.prototype._getTypeName=function(){return"Slider"},i.prototype._draw=function(e,t){e.save(),this._applyStates(e),this._prepareRenderingData(this.isThumbCircle?"circle":"rectangle");var i=this._renderLeft,r=this._renderTop,n=this._renderWidth,o=this._renderHeight,s=0;this.isThumbClamped&&this.isThumbCircle?(this.isVertical?r+=this._effectiveThumbThickness/2:i+=this._effectiveThumbThickness/2,s=this._backgroundBoxThickness/2):s=(this._effectiveThumbThickness-this._effectiveBarOffset)/2,(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY);var a=this._getThumbPosition();e.fillStyle=this._background,this.isVertical?this.isThumbClamped?this.isThumbCircle?(e.beginPath(),e.arc(i+this._backgroundBoxThickness/2,r,s,Math.PI,2*Math.PI),e.fill(),e.fillRect(i,r,n,o)):e.fillRect(i,r,n,o+this._effectiveThumbThickness):e.fillRect(i,r,n,o):this.isThumbClamped?this.isThumbCircle?(e.beginPath(),e.arc(i+this._backgroundBoxLength,r+this._backgroundBoxThickness/2,s,0,2*Math.PI),e.fill(),e.fillRect(i,r,n,o)):e.fillRect(i,r,n+this._effectiveThumbThickness,o):e.fillRect(i,r,n,o),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.fillStyle=this.color,this._displayValueBar&&(this.isVertical?this.isThumbClamped?this.isThumbCircle?(e.beginPath(),e.arc(i+this._backgroundBoxThickness/2,r+this._backgroundBoxLength,s,0,2*Math.PI),e.fill(),e.fillRect(i,r+a,n,o-a)):e.fillRect(i,r+a,n,o-a+this._effectiveThumbThickness):e.fillRect(i,r+a,n,o-a):this.isThumbClamped&&this.isThumbCircle?(e.beginPath(),e.arc(i,r+this._backgroundBoxThickness/2,s,0,2*Math.PI),e.fill(),e.fillRect(i,r,a,o)):e.fillRect(i,r,a,o)),e.fillStyle=this._thumbColor||this.color,this.displayThumb&&((this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowColor=this.shadowColor,e.shadowBlur=this.shadowBlur,e.shadowOffsetX=this.shadowOffsetX,e.shadowOffsetY=this.shadowOffsetY),this._isThumbCircle?(e.beginPath(),this.isVertical?e.arc(i+this._backgroundBoxThickness/2,r+a,s,0,2*Math.PI):e.arc(i+a,r+this._backgroundBoxThickness/2,s,0,2*Math.PI),e.fill(),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.strokeStyle=this._borderColor,e.stroke()):(this.isVertical?e.fillRect(i-this._effectiveBarOffset,this._currentMeasure.top+a,this._currentMeasure.width,this._effectiveThumbThickness):e.fillRect(this._currentMeasure.left+a,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height),(this.shadowBlur||this.shadowOffsetX||this.shadowOffsetY)&&(e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),e.strokeStyle=this._borderColor,this.isVertical?e.strokeRect(i-this._effectiveBarOffset,this._currentMeasure.top+a,this._currentMeasure.width,this._effectiveThumbThickness):e.strokeRect(this._currentMeasure.left+a,this._currentMeasure.top,this._effectiveThumbThickness,this._currentMeasure.height))),e.restore()},i}(an);c.RegisteredTypes["BABYLON.GUI.Slider"]=hn;var un=function(){function e(e){this.name=e,this._groupPanel=new jr,this._selectors=new Array,this._groupPanel.verticalAlignment=Ur.VERTICAL_ALIGNMENT_TOP,this._groupPanel.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT,this._groupHeader=this._addGroupHeader(e)}return Object.defineProperty(e.prototype,"groupPanel",{get:function(){return this._groupPanel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectors",{get:function(){return this._selectors},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"header",{get:function(){return this._groupHeader.text},set:function(e){"label"!==this._groupHeader.text&&(this._groupHeader.text=e)},enumerable:!1,configurable:!0}),e.prototype._addGroupHeader=function(e){var t=new Gr("groupHead",e);return t.width=.9,t.height="30px",t.textWrapping=!0,t.color="black",t.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT,t.textHorizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT,t.left="2px",this._groupPanel.addControl(t),t},e.prototype._getSelector=function(e){if(!(e<0||e>=this._selectors.length))return this._selectors[e]},e.prototype.removeSelector=function(e){e<0||e>=this._selectors.length||(this._groupPanel.removeControl(this._selectors[e]),this._selectors.splice(e,1))},e}(),ln=(function(e){function i(){return null!==e&&e.apply(this,arguments)||this}t(i,e),i.prototype.addCheckbox=function(e,t,i){void 0===t&&(t=function(e){}),void 0===i&&(i=!1);i=i||!1;var r=new Kr;r.width="20px",r.height="20px",r.color="#364249",r.background="#CCCCCC",r.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT,r.onIsCheckedChangedObservable.add((function(e){t(e)}));var n=Ur.AddHeader(r,e,"200px",{isHorizontal:!0,controlFirst:!0});n.height="30px",n.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT,n.left="4px",this.groupPanel.addControl(n),this.selectors.push(n),r.isChecked=i,this.groupPanel.parent&&this.groupPanel.parent.parent&&(r.color=this.groupPanel.parent.parent.buttonColor,r.background=this.groupPanel.parent.parent.buttonBackground)},i.prototype._setSelectorLabel=function(e,t){this.selectors[e].children[1].text=t},i.prototype._setSelectorLabelColor=function(e,t){this.selectors[e].children[1].color=t},i.prototype._setSelectorButtonColor=function(e,t){this.selectors[e].children[0].color=t},i.prototype._setSelectorButtonBackground=function(e,t){this.selectors[e].children[0].background=t}}(un),function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._selectNb=0,t}t(i,e),i.prototype.addRadio=function(e,t,i){void 0===t&&(t=function(e){}),void 0===i&&(i=!1);var r=this._selectNb++,n=new sn;n.name=e,n.width="20px",n.height="20px",n.color="#364249",n.background="#CCCCCC",n.group=this.name,n.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT,n.onIsCheckedChangedObservable.add((function(e){e&&t(r)}));var o=Ur.AddHeader(n,e,"200px",{isHorizontal:!0,controlFirst:!0});o.height="30px",o.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT,o.left="4px",this.groupPanel.addControl(o),this.selectors.push(o),n.isChecked=i,this.groupPanel.parent&&this.groupPanel.parent.parent&&(n.color=this.groupPanel.parent.parent.buttonColor,n.background=this.groupPanel.parent.parent.buttonBackground)},i.prototype._setSelectorLabel=function(e,t){this.selectors[e].children[1].text=t},i.prototype._setSelectorLabelColor=function(e,t){this.selectors[e].children[1].color=t},i.prototype._setSelectorButtonColor=function(e,t){this.selectors[e].children[0].color=t},i.prototype._setSelectorButtonBackground=function(e,t){this.selectors[e].children[0].background=t}}(un),function(e){function i(){return null!==e&&e.apply(this,arguments)||this}t(i,e),i.prototype.addSlider=function(e,t,i,r,n,o,s){void 0===t&&(t=function(e){}),void 0===i&&(i="Units"),void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=function(e){return 0|e});var a=new hn;a.name=i,a.value=o,a.minimum=r,a.maximum=n,a.width=.9,a.height="20px",a.color="#364249",a.background="#CCCCCC",a.borderColor="black",a.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT,a.left="4px",a.paddingBottom="4px",a.onValueChangedObservable.add((function(e){a.parent.children[0].text=a.parent.children[0].name+": "+s(e)+" "+a.name,t(e)}));var h=Ur.AddHeader(a,e+": "+s(o)+" "+i,"30px",{isHorizontal:!1,controlFirst:!1});h.height="60px",h.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT,h.left="4px",h.children[0].name=e,this.groupPanel.addControl(h),this.selectors.push(h),this.groupPanel.parent&&this.groupPanel.parent.parent&&(a.color=this.groupPanel.parent.parent.buttonColor,a.background=this.groupPanel.parent.parent.buttonBackground)},i.prototype._setSelectorLabel=function(e,t){this.selectors[e].children[0].name=t,this.selectors[e].children[0].text=t+": "+this.selectors[e].children[1].value+" "+this.selectors[e].children[1].name},i.prototype._setSelectorLabelColor=function(e,t){this.selectors[e].children[0].color=t},i.prototype._setSelectorButtonColor=function(e,t){this.selectors[e].children[1].color=t},i.prototype._setSelectorButtonBackground=function(e,t){this.selectors[e].children[1].background=t}}(un),function(e){function i(t,i){void 0===i&&(i=[]);var r=e.call(this,t)||this;if(r.name=t,r.groups=i,r._buttonColor="#364249",r._buttonBackground="#CCCCCC",r._headerColor="black",r._barColor="white",r._barHeight="2px",r._spacerHeight="20px",r._bars=new Array,r._groups=i,r.thickness=2,r._panel=new jr,r._panel.verticalAlignment=Ur.VERTICAL_ALIGNMENT_TOP,r._panel.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT,r._panel.top=5,r._panel.left=5,r._panel.width=.95,i.length>0){for(var n=0;n<i.length-1;n++)r._panel.addControl(i[n].groupPanel),r._addSpacer();r._panel.addControl(i[i.length-1].groupPanel)}return r.addControl(r._panel),r}t(i,e),i.prototype._getTypeName=function(){return"SelectionPanel"},Object.defineProperty(i.prototype,"panel",{get:function(){return this._panel},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"headerColor",{get:function(){return this._headerColor},set:function(e){this._headerColor!==e&&(this._headerColor=e,this._setHeaderColor())},enumerable:!1,configurable:!0}),i.prototype._setHeaderColor=function(){for(var e=0;e<this._groups.length;e++)this._groups[e].groupPanel.children[0].color=this._headerColor},Object.defineProperty(i.prototype,"buttonColor",{get:function(){return this._buttonColor},set:function(e){this._buttonColor!==e&&(this._buttonColor=e,this._setbuttonColor())},enumerable:!1,configurable:!0}),i.prototype._setbuttonColor=function(){for(var e=0;e<this._groups.length;e++)for(var t=0;t<this._groups[e].selectors.length;t++)this._groups[e]._setSelectorButtonColor(t,this._buttonColor)},Object.defineProperty(i.prototype,"labelColor",{get:function(){return this._labelColor},set:function(e){this._labelColor!==e&&(this._labelColor=e,this._setLabelColor())},enumerable:!1,configurable:!0}),i.prototype._setLabelColor=function(){for(var e=0;e<this._groups.length;e++)for(var t=0;t<this._groups[e].selectors.length;t++)this._groups[e]._setSelectorLabelColor(t,this._labelColor)},Object.defineProperty(i.prototype,"buttonBackground",{get:function(){return this._buttonBackground},set:function(e){this._buttonBackground!==e&&(this._buttonBackground=e,this._setButtonBackground())},enumerable:!1,configurable:!0}),i.prototype._setButtonBackground=function(){for(var e=0;e<this._groups.length;e++)for(var t=0;t<this._groups[e].selectors.length;t++)this._groups[e]._setSelectorButtonBackground(t,this._buttonBackground)},Object.defineProperty(i.prototype,"barColor",{get:function(){return this._barColor},set:function(e){this._barColor!==e&&(this._barColor=e,this._setBarColor())},enumerable:!1,configurable:!0}),i.prototype._setBarColor=function(){for(var e=0;e<this._bars.length;e++)this._bars[e].children[0].background=this._barColor},Object.defineProperty(i.prototype,"barHeight",{get:function(){return this._barHeight},set:function(e){this._barHeight!==e&&(this._barHeight=e,this._setBarHeight())},enumerable:!1,configurable:!0}),i.prototype._setBarHeight=function(){for(var e=0;e<this._bars.length;e++)this._bars[e].children[0].height=this._barHeight},Object.defineProperty(i.prototype,"spacerHeight",{get:function(){return this._spacerHeight},set:function(e){this._spacerHeight!==e&&(this._spacerHeight=e,this._setSpacerHeight())},enumerable:!1,configurable:!0}),i.prototype._setSpacerHeight=function(){for(var e=0;e<this._bars.length;e++)this._bars[e].height=this._spacerHeight},i.prototype._addSpacer=function(){var e=new Vr;e.width=1,e.height=this._spacerHeight,e.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT;var t=new zr;t.width=1,t.height=this._barHeight,t.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT,t.verticalAlignment=Ur.VERTICAL_ALIGNMENT_CENTER,t.background=this._barColor,t.color="transparent",e.addControl(t),this._panel.addControl(e),this._bars.push(e)},i.prototype.addGroup=function(e){this._groups.length>0&&this._addSpacer(),this._panel.addControl(e.groupPanel),this._groups.push(e),e.groupPanel.children[0].color=this._headerColor;for(var t=0;t<e.selectors.length;t++)e._setSelectorButtonColor(t,this._buttonColor),e._setSelectorButtonBackground(t,this._buttonBackground)},i.prototype.removeGroup=function(e){if(!(e<0||e>=this._groups.length)){var t=this._groups[e];this._panel.removeControl(t.groupPanel),this._groups.splice(e,1),e<this._bars.length&&(this._panel.removeControl(this._bars[e]),this._bars.splice(e,1))}},i.prototype.setHeaderName=function(e,t){t<0||t>=this._groups.length||(this._groups[t].groupPanel.children[0].text=e)},i.prototype.relabel=function(e,t,i){if(!(t<0||t>=this._groups.length)){var r=this._groups[t];i<0||i>=r.selectors.length||r._setSelectorLabel(i,e)}},i.prototype.removeFromGroupSelector=function(e,t){if(!(e<0||e>=this._groups.length)){var i=this._groups[e];t<0||t>=i.selectors.length||i.removeSelector(t)}},i.prototype.addToGroupCheckbox=function(e,t,i,r){(void 0===i&&(i=function(){}),void 0===r&&(r=!1),e<0||e>=this._groups.length)||this._groups[e].addCheckbox(t,i,r)},i.prototype.addToGroupRadio=function(e,t,i,r){(void 0===i&&(i=function(){}),void 0===r&&(r=!1),e<0||e>=this._groups.length)||this._groups[e].addRadio(t,i,r)},i.prototype.addToGroupSlider=function(e,t,i,r,n,o,s,a){(void 0===i&&(i=function(){}),void 0===r&&(r="Units"),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=function(e){return 0|e}),e<0||e>=this._groups.length)||this._groups[e].addSlider(t,i,r,n,o,s,a)}}(zr),function(e){function i(t){var i=e.call(this,t)||this;return i._freezeControls=!1,i._bucketWidth=0,i._bucketHeight=0,i._buckets={},i}return t(i,e),Object.defineProperty(i.prototype,"freezeControls",{get:function(){return this._freezeControls},set:function(e){if(this._freezeControls!==e){e||this._restoreMeasures(),this._freezeControls=!1;var t=this.host.getSize(),i=t.width,r=t.height,n=this.host.getContext(),o=new Nr(0,0,i,r);this.host._numLayoutCalls=0,this.host._rootContainer._layout(o,n),e&&(this._updateMeasures(),this._useBuckets()&&this._makeBuckets()),this._freezeControls=e,this.host.markAsDirty()}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"bucketWidth",{get:function(){return this._bucketWidth},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"bucketHeight",{get:function(){return this._bucketHeight},enumerable:!1,configurable:!0}),i.prototype.setBucketSizes=function(e,t){this._bucketWidth=e,this._bucketHeight=t,this._useBuckets()?this._freezeControls&&this._makeBuckets():this._buckets={}},i.prototype._useBuckets=function(){return this._bucketWidth>0&&this._bucketHeight>0},i.prototype._makeBuckets=function(){this._buckets={},this._bucketLen=Math.ceil(this.widthInPixels/this._bucketWidth),this._dispatchInBuckets(this._children),this._oldLeft=null,this._oldTop=null},i.prototype._dispatchInBuckets=function(e){for(var t=0;t<e.length;++t){for(var i=e[t],r=Math.max(0,Math.floor((i._customData._origLeft-this._customData.origLeft)/this._bucketWidth)),n=Math.floor((i._customData._origLeft-this._customData.origLeft+i._currentMeasure.width-1)/this._bucketWidth),o=Math.max(0,Math.floor((i._customData._origTop-this._customData.origTop)/this._bucketHeight)),s=Math.floor((i._customData._origTop-this._customData.origTop+i._currentMeasure.height-1)/this._bucketHeight);o<=s;){for(var a=r;a<=n;++a){var h=o*this._bucketLen+a,u=this._buckets[h];u||(u=[],this._buckets[h]=u),u.push(i)}o++}i instanceof Vr&&i._children.length>0&&this._dispatchInBuckets(i._children)}},i.prototype._updateMeasures=function(){var e=0|this.leftInPixels,t=0|this.topInPixels;this._measureForChildren.left-=e,this._measureForChildren.top-=t,this._currentMeasure.left-=e,this._currentMeasure.top-=t,this._customData.origLeftForChildren=this._measureForChildren.left,this._customData.origTopForChildren=this._measureForChildren.top,this._customData.origLeft=this._currentMeasure.left,this._customData.origTop=this._currentMeasure.top,this._updateChildrenMeasures(this._children,e,t)},i.prototype._updateChildrenMeasures=function(e,t,i){for(var r=0;r<e.length;++r){var n=e[r];n._currentMeasure.left-=t,n._currentMeasure.top-=i,n._customData._origLeft=n._currentMeasure.left,n._customData._origTop=n._currentMeasure.top,n instanceof Vr&&n._children.length>0&&this._updateChildrenMeasures(n._children,t,i)}},i.prototype._restoreMeasures=function(){var e=0|this.leftInPixels,t=0|this.topInPixels;this._measureForChildren.left=this._customData.origLeftForChildren+e,this._measureForChildren.top=this._customData.origTopForChildren+t,this._currentMeasure.left=this._customData.origLeft+e,this._currentMeasure.top=this._customData.origTop+t},i.prototype._getTypeName=function(){return"ScrollViewerWindow"},i.prototype._additionalProcessing=function(t,i){e.prototype._additionalProcessing.call(this,t,i),this._parentMeasure=t,this._measureForChildren.left=this._currentMeasure.left,this._measureForChildren.top=this._currentMeasure.top,this._measureForChildren.width=t.width,this._measureForChildren.height=t.height},i.prototype._layout=function(t,i){return this._freezeControls?(this.invalidateRect(),!1):e.prototype._layout.call(this,t,i)},i.prototype._scrollChildren=function(e,t,i){for(var r=0;r<e.length;++r){var n=e[r];n._currentMeasure.left=n._customData._origLeft+t,n._currentMeasure.top=n._customData._origTop+i,n._isClipped=!1,n instanceof Vr&&n._children.length>0&&this._scrollChildren(n._children,t,i)}},i.prototype._scrollChildrenWithBuckets=function(e,t,i,r){for(var n=Math.max(0,Math.floor(-e/this._bucketWidth)),o=Math.floor((-e+this._parentMeasure.width-1)/this._bucketWidth),s=Math.max(0,Math.floor(-t/this._bucketHeight)),a=Math.floor((-t+this._parentMeasure.height-1)/this._bucketHeight);s<=a;){for(var h=n;h<=o;++h){var u=s*this._bucketLen+h,l=this._buckets[u];if(l)for(var c=0;c<l.length;++c){var f=l[c];f._currentMeasure.left=f._customData._origLeft+i,f._currentMeasure.top=f._customData._origTop+r,f._isClipped=!1}}s++}},i.prototype._draw=function(t,i){if(this._freezeControls){this._localDraw(t),this.clipChildren&&this._clipForChildren(t);var r=0|this.leftInPixels,n=0|this.topInPixels;this._useBuckets()&&null!==this._oldLeft&&null!==this._oldTop?(this._scrollChildrenWithBuckets(this._oldLeft,this._oldTop,r,n),this._scrollChildrenWithBuckets(r,n,r,n)):this._scrollChildren(this._children,r,n),this._oldLeft=r,this._oldTop=n;for(var o=0,s=this._children;o<s.length;o++){var a=s[o];a._intersectsRect(this._parentMeasure)&&a._render(t,this._parentMeasure)}}else e.prototype._draw.call(this,t,i)},i.prototype._postMeasure=function(){if(this._freezeControls)e.prototype._postMeasure.call(this);else{for(var t=this.parentClientWidth,i=this.parentClientHeight,r=0,n=this.children;r<n.length;r++){var o=n[r];o.isVisible&&!o.notRenderable&&(o.horizontalAlignment===Ur.HORIZONTAL_ALIGNMENT_CENTER&&o._offsetLeft(this._currentMeasure.left-o._currentMeasure.left),o.verticalAlignment===Ur.VERTICAL_ALIGNMENT_CENTER&&o._offsetTop(this._currentMeasure.top-o._currentMeasure.top),t=Math.max(t,o._currentMeasure.left-this._currentMeasure.left+o._currentMeasure.width+o.paddingRightInPixels),i=Math.max(i,o._currentMeasure.top-this._currentMeasure.top+o._currentMeasure.height+o.paddingBottomInPixels))}this._currentMeasure.width!==t&&(this._width.updateInPlace(t,Rr.UNITMODE_PIXEL),this._currentMeasure.width=t,this._rebuildLayout=!0,this._isDirty=!0),this._currentMeasure.height!==i&&(this._height.updateInPlace(i,Rr.UNITMODE_PIXEL),this._currentMeasure.height=i,this._rebuildLayout=!0,this._isDirty=!0),e.prototype._postMeasure.call(this)}},i}(Vr)),cn=function(e){function i(t){var i=e.call(this,t)||this;return i.name=t,i._background="black",i._borderColor="white",i._tempMeasure=new Nr(0,0,0,0),i}return t(i,e),Object.defineProperty(i.prototype,"borderColor",{get:function(){return this._borderColor},set:function(e){this._borderColor!==e&&(this._borderColor=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"background",{get:function(){return this._background},set:function(e){this._background!==e&&(this._background=e,this._markAsDirty())},enumerable:!1,configurable:!0}),i.prototype._getTypeName=function(){return"Scrollbar"},i.prototype._getThumbThickness=function(){return this._thumbWidth.isPixel?this._thumbWidth.getValue(this._host):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)},i.prototype._draw=function(e){e.save(),this._applyStates(e),this._prepareRenderingData("rectangle");var t=this._renderLeft,i=this._getThumbPosition();e.fillStyle=this._background,e.fillRect(this._currentMeasure.left,this._currentMeasure.top,this._currentMeasure.width,this._currentMeasure.height),e.fillStyle=this.color,this.isVertical?(this._tempMeasure.left=t-this._effectiveBarOffset,this._tempMeasure.top=this._currentMeasure.top+i,this._tempMeasure.width=this._currentMeasure.width,this._tempMeasure.height=this._effectiveThumbThickness):(this._tempMeasure.left=this._currentMeasure.left+i,this._tempMeasure.top=this._currentMeasure.top,this._tempMeasure.width=this._effectiveThumbThickness,this._tempMeasure.height=this._currentMeasure.height),e.fillRect(this._tempMeasure.left,this._tempMeasure.top,this._tempMeasure.width,this._tempMeasure.height),e.restore()},i.prototype._updateValueFromPointer=function(e,t){0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y),this._first&&(this._first=!1,this._originX=e,this._originY=t,(e<this._tempMeasure.left||e>this._tempMeasure.left+this._tempMeasure.width||t<this._tempMeasure.top||t>this._tempMeasure.top+this._tempMeasure.height)&&(this.isVertical?this.value=this.minimum+(1-(t-this._currentMeasure.top)/this._currentMeasure.height)*(this.maximum-this.minimum):this.value=this.minimum+(e-this._currentMeasure.left)/this._currentMeasure.width*(this.maximum-this.minimum)));var i=0;i=this.isVertical?-(t-this._originY)/(this._currentMeasure.height-this._effectiveThumbThickness):(e-this._originX)/(this._currentMeasure.width-this._effectiveThumbThickness),this.value+=i*(this.maximum-this.minimum),this._originX=e,this._originY=t},i.prototype._onPointerDown=function(t,i,r,n,o){return this._first=!0,e.prototype._onPointerDown.call(this,t,i,r,n,o)},i}(an),fn=function(e){function i(t){var i=e.call(this,t)||this;return i.name=t,i._thumbLength=.5,i._thumbHeight=1,i._barImageHeight=1,i._tempMeasure=new Nr(0,0,0,0),i.num90RotationInVerticalMode=1,i}return t(i,e),Object.defineProperty(i.prototype,"backgroundImage",{get:function(){return this._backgroundBaseImage},set:function(e){var t=this;this._backgroundBaseImage!==e&&(this._backgroundBaseImage=e,this.isVertical&&0!==this.num90RotationInVerticalMode?e.isLoaded?(this._backgroundImage=e._rotate90(this.num90RotationInVerticalMode,!0),this._markAsDirty()):e.onImageLoadedObservable.addOnce((function(){var i=e._rotate90(t.num90RotationInVerticalMode,!0);t._backgroundImage=i,i.isLoaded||i.onImageLoadedObservable.addOnce((function(){t._markAsDirty()})),t._markAsDirty()})):(this._backgroundImage=e,e&&!e.isLoaded&&e.onImageLoadedObservable.addOnce((function(){t._markAsDirty()})),this._markAsDirty()))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"thumbImage",{get:function(){return this._thumbBaseImage},set:function(e){var t=this;this._thumbBaseImage!==e&&(this._thumbBaseImage=e,this.isVertical&&0!==this.num90RotationInVerticalMode?e.isLoaded?(this._thumbImage=e._rotate90(-this.num90RotationInVerticalMode,!0),this._markAsDirty()):e.onImageLoadedObservable.addOnce((function(){var i=e._rotate90(-t.num90RotationInVerticalMode,!0);t._thumbImage=i,i.isLoaded||i.onImageLoadedObservable.addOnce((function(){t._markAsDirty()})),t._markAsDirty()})):(this._thumbImage=e,e&&!e.isLoaded&&e.onImageLoadedObservable.addOnce((function(){t._markAsDirty()})),this._markAsDirty()))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"thumbLength",{get:function(){return this._thumbLength},set:function(e){this._thumbLength!==e&&(this._thumbLength=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"thumbHeight",{get:function(){return this._thumbHeight},set:function(e){this._thumbLength!==e&&(this._thumbHeight=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"barImageHeight",{get:function(){return this._barImageHeight},set:function(e){this._barImageHeight!==e&&(this._barImageHeight=e,this._markAsDirty())},enumerable:!1,configurable:!0}),i.prototype._getTypeName=function(){return"ImageScrollBar"},i.prototype._getThumbThickness=function(){return this._thumbWidth.isPixel?this._thumbWidth.getValue(this._host):this._backgroundBoxThickness*this._thumbWidth.getValue(this._host)},i.prototype._draw=function(e){e.save(),this._applyStates(e),this._prepareRenderingData("rectangle");var t=this._getThumbPosition(),i=this._renderLeft,r=this._renderTop,n=this._renderWidth,o=this._renderHeight;this._backgroundImage&&(this._tempMeasure.copyFromFloats(i,r,n,o),this.isVertical?(this._tempMeasure.copyFromFloats(i+n*(1-this._barImageHeight)*.5,this._currentMeasure.top,n*this._barImageHeight,o),this._tempMeasure.height+=this._effectiveThumbThickness,this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure)):(this._tempMeasure.copyFromFloats(this._currentMeasure.left,r+o*(1-this._barImageHeight)*.5,n,o*this._barImageHeight),this._tempMeasure.width+=this._effectiveThumbThickness,this._backgroundImage._currentMeasure.copyFrom(this._tempMeasure)),this._backgroundImage._draw(e)),this.isVertical?this._tempMeasure.copyFromFloats(i-this._effectiveBarOffset+this._currentMeasure.width*(1-this._thumbHeight)*.5,this._currentMeasure.top+t,this._currentMeasure.width*this._thumbHeight,this._effectiveThumbThickness):this._tempMeasure.copyFromFloats(this._currentMeasure.left+t,this._currentMeasure.top+this._currentMeasure.height*(1-this._thumbHeight)*.5,this._effectiveThumbThickness,this._currentMeasure.height*this._thumbHeight),this._thumbImage&&(this._thumbImage._currentMeasure.copyFrom(this._tempMeasure),this._thumbImage._draw(e)),e.restore()},i.prototype._updateValueFromPointer=function(e,t){0!=this.rotation&&(this._invertTransformMatrix.transformCoordinates(e,t,this._transformedPosition),e=this._transformedPosition.x,t=this._transformedPosition.y),this._first&&(this._first=!1,this._originX=e,this._originY=t,(e<this._tempMeasure.left||e>this._tempMeasure.left+this._tempMeasure.width||t<this._tempMeasure.top||t>this._tempMeasure.top+this._tempMeasure.height)&&(this.isVertical?this.value=this.minimum+(1-(t-this._currentMeasure.top)/this._currentMeasure.height)*(this.maximum-this.minimum):this.value=this.minimum+(e-this._currentMeasure.left)/this._currentMeasure.width*(this.maximum-this.minimum)));var i=0;i=this.isVertical?-(t-this._originY)/(this._currentMeasure.height-this._effectiveThumbThickness):(e-this._originX)/(this._currentMeasure.width-this._effectiveThumbThickness),this.value+=i*(this.maximum-this.minimum),this._originX=e,this._originY=t},i.prototype._onPointerDown=function(t,i,r,n,o){return this._first=!0,e.prototype._onPointerDown.call(this,t,i,r,n,o)},i}(an),dn=function(e){function i(t,i){var r=e.call(this,t)||this;return r._barSize=20,r._pointerIsOver=!1,r._wheelPrecision=.05,r._thumbLength=.5,r._thumbHeight=1,r._barImageHeight=1,r._horizontalBarImageHeight=1,r._verticalBarImageHeight=1,r._oldWindowContentsWidth=0,r._oldWindowContentsHeight=0,r._forceHorizontalBar=!1,r._forceVerticalBar=!1,r._useImageBar=i||!1,r.onDirtyObservable.add((function(){r._horizontalBarSpace.color=r.color,r._verticalBarSpace.color=r.color,r._dragSpace.color=r.color})),r.onPointerEnterObservable.add((function(){r._pointerIsOver=!0})),r.onPointerOutObservable.add((function(){r._pointerIsOver=!1})),r._grid=new Jr,r._useImageBar?(r._horizontalBar=new fn,r._verticalBar=new fn):(r._horizontalBar=new cn,r._verticalBar=new cn),r._window=new ln("scrollViewer_window"),r._window.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT,r._window.verticalAlignment=Ur.VERTICAL_ALIGNMENT_TOP,r._grid.addColumnDefinition(1),r._grid.addColumnDefinition(0,!0),r._grid.addRowDefinition(1),r._grid.addRowDefinition(0,!0),e.prototype.addControl.call(r,r._grid),r._grid.addControl(r._window,0,0),r._verticalBarSpace=new zr,r._verticalBarSpace.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT,r._verticalBarSpace.verticalAlignment=Ur.VERTICAL_ALIGNMENT_TOP,r._verticalBarSpace.thickness=1,r._grid.addControl(r._verticalBarSpace,0,1),r._addBar(r._verticalBar,r._verticalBarSpace,!0,Math.PI),r._horizontalBarSpace=new zr,r._horizontalBarSpace.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_LEFT,r._horizontalBarSpace.verticalAlignment=Ur.VERTICAL_ALIGNMENT_TOP,r._horizontalBarSpace.thickness=1,r._grid.addControl(r._horizontalBarSpace,1,0),r._addBar(r._horizontalBar,r._horizontalBarSpace,!1,0),r._dragSpace=new zr,r._dragSpace.thickness=1,r._grid.addControl(r._dragSpace,1,1),r._useImageBar||(r.barColor="grey",r.barBackground="transparent"),r}return t(i,e),Object.defineProperty(i.prototype,"horizontalBar",{get:function(){return this._horizontalBar},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"verticalBar",{get:function(){return this._verticalBar},enumerable:!1,configurable:!0}),i.prototype.addControl=function(e){return e?(this._window.addControl(e),this):this},i.prototype.removeControl=function(e){return this._window.removeControl(e),this},Object.defineProperty(i.prototype,"children",{get:function(){return this._window.children},enumerable:!1,configurable:!0}),i.prototype._flagDescendantsAsMatrixDirty=function(){for(var e=0,t=this._children;e<t.length;e++){t[e]._markMatrixAsDirty()}},Object.defineProperty(i.prototype,"freezeControls",{get:function(){return this._window.freezeControls},set:function(e){this._window.freezeControls=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"bucketWidth",{get:function(){return this._window.bucketWidth},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"bucketHeight",{get:function(){return this._window.bucketHeight},enumerable:!1,configurable:!0}),i.prototype.setBucketSizes=function(e,t){this._window.setBucketSizes(e,t)},Object.defineProperty(i.prototype,"forceHorizontalBar",{get:function(){return this._forceHorizontalBar},set:function(e){this._grid.setRowDefinition(1,e?this._barSize:0,!0),this._horizontalBar.isVisible=e,this._forceHorizontalBar=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"forceVerticalBar",{get:function(){return this._forceVerticalBar},set:function(e){this._grid.setColumnDefinition(1,e?this._barSize:0,!0),this._verticalBar.isVisible=e,this._forceVerticalBar=e},enumerable:!1,configurable:!0}),i.prototype.resetWindow=function(){this._window.width="100%",this._window.height="100%"},i.prototype._getTypeName=function(){return"ScrollViewer"},i.prototype._buildClientSizes=function(){var e=this.host.idealRatio;this._window.parentClientWidth=this._currentMeasure.width-(this._verticalBar.isVisible||this.forceVerticalBar?this._barSize*e:0)-2*this.thickness,this._window.parentClientHeight=this._currentMeasure.height-(this._horizontalBar.isVisible||this.forceHorizontalBar?this._barSize*e:0)-2*this.thickness,this._clientWidth=this._window.parentClientWidth,this._clientHeight=this._window.parentClientHeight},i.prototype._additionalProcessing=function(t,i){e.prototype._additionalProcessing.call(this,t,i),this._buildClientSizes()},i.prototype._postMeasure=function(){e.prototype._postMeasure.call(this),this._updateScroller(),this._setWindowPosition(!1)},Object.defineProperty(i.prototype,"wheelPrecision",{get:function(){return this._wheelPrecision},set:function(e){this._wheelPrecision!==e&&(e<0&&(e=0),e>1&&(e=1),this._wheelPrecision=e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"scrollBackground",{get:function(){return this._horizontalBarSpace.background},set:function(e){this._horizontalBarSpace.background!==e&&(this._horizontalBarSpace.background=e,this._verticalBarSpace.background=e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"barColor",{get:function(){return this._barColor},set:function(e){this._barColor!==e&&(this._barColor=e,this._horizontalBar.color=e,this._verticalBar.color=e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"thumbImage",{get:function(){return this._barImage},set:function(e){if(this._barImage!==e){this._barImage=e;var t=this._horizontalBar,i=this._verticalBar;t.thumbImage=e,i.thumbImage=e}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"horizontalThumbImage",{get:function(){return this._horizontalBarImage},set:function(e){this._horizontalBarImage!==e&&(this._horizontalBarImage=e,this._horizontalBar.thumbImage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"verticalThumbImage",{get:function(){return this._verticalBarImage},set:function(e){this._verticalBarImage!==e&&(this._verticalBarImage=e,this._verticalBar.thumbImage=e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"barSize",{get:function(){return this._barSize},set:function(e){this._barSize!==e&&(this._barSize=e,this._markAsDirty(),this._horizontalBar.isVisible&&this._grid.setRowDefinition(1,this._barSize,!0),this._verticalBar.isVisible&&this._grid.setColumnDefinition(1,this._barSize,!0))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"thumbLength",{get:function(){return this._thumbLength},set:function(e){if(this._thumbLength!==e){e<=0&&(e=.1),e>1&&(e=1),this._thumbLength=e;var t=this._horizontalBar,i=this._verticalBar;t.thumbLength=e,i.thumbLength=e,this._markAsDirty()}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"thumbHeight",{get:function(){return this._thumbHeight},set:function(e){if(this._thumbHeight!==e){e<=0&&(e=.1),e>1&&(e=1),this._thumbHeight=e;var t=this._horizontalBar,i=this._verticalBar;t.thumbHeight=e,i.thumbHeight=e,this._markAsDirty()}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"barImageHeight",{get:function(){return this._barImageHeight},set:function(e){if(this._barImageHeight!==e){e<=0&&(e=.1),e>1&&(e=1),this._barImageHeight=e;var t=this._horizontalBar,i=this._verticalBar;t.barImageHeight=e,i.barImageHeight=e,this._markAsDirty()}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"horizontalBarImageHeight",{get:function(){return this._horizontalBarImageHeight},set:function(e){this._horizontalBarImageHeight!==e&&(e<=0&&(e=.1),e>1&&(e=1),this._horizontalBarImageHeight=e,this._horizontalBar.barImageHeight=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"verticalBarImageHeight",{get:function(){return this._verticalBarImageHeight},set:function(e){this._verticalBarImageHeight!==e&&(e<=0&&(e=.1),e>1&&(e=1),this._verticalBarImageHeight=e,this._verticalBar.barImageHeight=e,this._markAsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"barBackground",{get:function(){return this._barBackground},set:function(e){if(this._barBackground!==e){this._barBackground=e;var t=this._horizontalBar,i=this._verticalBar;t.background=e,i.background=e,this._dragSpace.background=e}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"barImage",{get:function(){return this._barBackgroundImage},set:function(e){this._barBackgroundImage,this._barBackgroundImage=e;var t=this._horizontalBar,i=this._verticalBar;t.backgroundImage=e,i.backgroundImage=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"horizontalBarImage",{get:function(){return this._horizontalBarBackgroundImage},set:function(e){this._horizontalBarBackgroundImage,this._horizontalBarBackgroundImage=e,this._horizontalBar.backgroundImage=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"verticalBarImage",{get:function(){return this._verticalBarBackgroundImage},set:function(e){this._verticalBarBackgroundImage,this._verticalBarBackgroundImage=e,this._verticalBar.backgroundImage=e},enumerable:!1,configurable:!0}),i.prototype._setWindowPosition=function(e){void 0===e&&(e=!0);var t=this.host.idealRatio,i=this._window._currentMeasure.width,r=this._window._currentMeasure.height;if(e||this._oldWindowContentsWidth!==i||this._oldWindowContentsHeight!==r){this._oldWindowContentsWidth=i,this._oldWindowContentsHeight=r;var n=this._clientWidth-i,o=this._clientHeight-r,s=this._horizontalBar.value/t*n+"px",a=this._verticalBar.value/t*o+"px";s!==this._window.left&&(this._window.left=s,this.freezeControls||(this._rebuildLayout=!0)),a!==this._window.top&&(this._window.top=a,this.freezeControls||(this._rebuildLayout=!0))}},i.prototype._updateScroller=function(){var e=this._window._currentMeasure.width,t=this._window._currentMeasure.height;this._horizontalBar.isVisible&&e<=this._clientWidth&&!this.forceHorizontalBar?(this._grid.setRowDefinition(1,0,!0),this._horizontalBar.isVisible=!1,this._horizontalBar.value=0,this._rebuildLayout=!0):!this._horizontalBar.isVisible&&(e>this._clientWidth||this.forceHorizontalBar)&&(this._grid.setRowDefinition(1,this._barSize,!0),this._horizontalBar.isVisible=!0,this._rebuildLayout=!0),this._verticalBar.isVisible&&t<=this._clientHeight&&!this.forceVerticalBar?(this._grid.setColumnDefinition(1,0,!0),this._verticalBar.isVisible=!1,this._verticalBar.value=0,this._rebuildLayout=!0):!this._verticalBar.isVisible&&(t>this._clientHeight||this.forceVerticalBar)&&(this._grid.setColumnDefinition(1,this._barSize,!0),this._verticalBar.isVisible=!0,this._rebuildLayout=!0),this._buildClientSizes();var i=this.host.idealRatio;this._horizontalBar.thumbWidth=.9*this._thumbLength*(this._clientWidth/i)+"px",this._verticalBar.thumbWidth=.9*this._thumbLength*(this._clientHeight/i)+"px"},i.prototype._link=function(t){e.prototype._link.call(this,t),this._attachWheel()},i.prototype._addBar=function(e,t,i,r){var n=this;e.paddingLeft=0,e.width="100%",e.height="100%",e.barOffset=0,e.value=0,e.maximum=1,e.horizontalAlignment=Ur.HORIZONTAL_ALIGNMENT_CENTER,e.verticalAlignment=Ur.VERTICAL_ALIGNMENT_CENTER,e.isVertical=i,e.rotation=r,e.isVisible=!1,t.addControl(e),e.onValueChangedObservable.add((function(e){n._setWindowPosition()}))},i.prototype._attachWheel=function(){var e=this;this._host&&!this._onWheelObserver&&(this._onWheelObserver=this.onWheelObservable.add((function(t){e._pointerIsOver&&(1==e._verticalBar.isVisible&&(t.y<0&&e._verticalBar.value>0?e._verticalBar.value-=e._wheelPrecision:t.y>0&&e._verticalBar.value<e._verticalBar.maximum&&(e._verticalBar.value+=e._wheelPrecision)),1==e._horizontalBar.isVisible&&(t.x<0&&e._horizontalBar.value<e._horizontalBar.maximum?e._horizontalBar.value+=e._wheelPrecision:t.x>0&&e._horizontalBar.value>0&&(e._horizontalBar.value-=e._wheelPrecision)))})))},i.prototype._renderHighlightSpecific=function(t){this.isHighlighted&&(e.prototype._renderHighlightSpecific.call(this,t),this._grid._renderHighlightSpecific(t),t.restore())},i.prototype.dispose=function(){this.onWheelObservable.remove(this._onWheelObserver),this._onWheelObserver=null,e.prototype.dispose.call(this)},i}(zr);c.RegisteredTypes["BABYLON.GUI.ScrollViewer"]=dn;var pn=function(e){function i(){var t=null!==e&&e.apply(