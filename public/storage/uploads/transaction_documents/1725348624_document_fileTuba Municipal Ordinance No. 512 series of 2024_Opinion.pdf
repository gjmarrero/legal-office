w;\n            align-self: center;\n            margin-top: 15px;\n        }\n        #divJoinRebatesWrapper {\n            display: flex;\n            flex-direction: row;\n            align-self: center;\n            margin-top: 15px;\n        }\n        .hrDivider {\n            width: calc(100% - 20px);\n            margin-bottom: 16px;\n            height: 0px;\n            border: 1px solid rgba(0, 0, 0, 0.1);\n            border-width: 0px;\n            border-top-width: 1px;\n            position: absolute;\n            left: 0;\n            right: 0;\n        }\n        #txtJoinRebates {\n            width: 100%;\n            display: flex;\n            flex-direction: column;\n            flex-grow: 2;\n            margin: 20px;\n            margin-left: 0px;\n            justify-content: center;\n        }\n        #imgPositiveResult {\n            position: absolute;\n            align-self: center;\n            margin-top: 13px;\n        }\n        /* The dots/bullets/indicators */\n        .dot {\n        cursor: pointer;\n        height: 8px;\n        width: 8px;\n        margin: 0 2px;\n        background-color: #bbb;\n        border-radius: 50%;\n        display: inline-block;\n        transition: background-color 0.6s ease;\n        }\n        .active, .dot:hover {\n        background-color: #717171;\n        }\n        /* Fading animation */\n        .fade {\n        -webkit-animation-name: fade;\n        -webkit-animation-duration: 1.5s;\n        animation-name: fade;\n        animation-duration: 1.5s;\n        }\n        @-webkit-keyframes fade {\n        from {opacity: .4}\n        to {opacity: 1}\n        }\n        @keyframes fade {\n        from {opacity: .4}\n        to {opacity: 1}\n        }\n        .show {\n            display:flex;\n        }\n        .hide {\n            display:none;\n        }\n        .ecspan {\n            color: rgba(0, 0, 0, 0.83);\n            display: inline;\n        }\n        .ecspangrey {\n            color: grey;\n        }\n        @media (prefers-color-scheme: dark) {\n            div, span, p {\n              color: #FFFFFF!important;\n            }\n            .closeIcon > svg > path {\n                fill: #FFFFFF;\n            }\n            .divOverlayFooter {\n                background: #424242;\n            }\n            .divOverlayContentWrapper {\n                background: #4A4A4A;\n            }\n            #btnOverlayCancel {\n                background: rgba(255, 255, 255, 0.09);\n                color: #FFFFFF;\n            }\n            #btnOverlayRebates {\n                background: rgba(255, 255, 255, 0.09);\n                color: #FFFFFF;\n            }\n            #divOverlayShare {\n                border: 1px solid rgba(255, 255, 255, 0.09);\n            }\n            #divOverlayResultNegative {\n                margin-top: 20px;\n                margin-bottom: 20px;\n            }\n            .ecspan {\n                color: #FFFFFF;\n            }\n        }\n        @media (forced-colors: active) {\n            #btnOverlayClose, #btnOverlayCheckout {\n                background-color: Highlight;\n                forced-color-adjust: none;\n                color: highlightText;\n            }\n            .btnCashbackUpsellCloseOverlay{\n                color:buttontext;\n                border-color:buttontext;\n            }\n            #btnOverlayCancel {\n                background-color: Highlight;\n                forced-color-adjust: none;\n                color: highlightText;\n            }\n            #btnOverlayClose: focus, #btnOverlayCheckout:focus {\n                box-shadow: 0 0 0 2px HighlightText inset;\n                border-color: buttonText;\n            }\n            #btnOverlayCancel: focus {\n                box-shadow: 0 0 0 2px HighlightText inset;\n                border-color: buttonText;\n            }\n            #btnOverlayRebates: focus {\n                box-shadow: 0 0 0 2px HighlightText inset;\n                border-color: buttonText;\n            }\n            #imgPositiveResult {\n                display: none;\n            }\n            .btnSocialSharing {\n                border: none;\n            }\n            #divOverlayProgress {\n                border: 1px solid buttontext;\n            }\n            .textContent {\n                width: calc(100% - 40px);\n            }\n        }\n        @media (max-width: 500px) {\n            .divOverlayContentWrapper{\n                max-width: 500px;\n                height: 100%;\n                top: 0px;\n                left: 0px;\n                align-self: center;\n                flex-direction: column;\n                justify-content: space-between;\n                position: relative;\n                border-radius: 4px;\n                background: linear-gradient(0deg, #FFFFFF, #FFFFFF);\n                overflow:auto;\n                z-index: 21;\n            }\n            .overlayContent {\n                margin-top: 0px;\n                margin-bottom: 0px;\n            }\n            .resultWrapper {\n                height: auto;\n                width: auto;\n                max-width: 500px;\n                top: 0px;\n                left: 0px;\n                flex-direction: column;\n                align-items: center;\n                border-radius: 4px;\n                background: transparent;\n                z-index: 21;\n            }\n            .mainModals {\n                width: 100%;\n                height: 100%;\n                display: flex;\n                flex-direction: column;\n                align-content: center;\n                align-self: center;\n            }\n            #txtBarTitle {\n                width: 100%;\n            }\n            #txtProgressTitle {\n                width: 100%;\n            }\n            .txtSmall {\n                display: inline-block;\n            }\n            .txtMedium {\n                display: inline-block;\n            }\n            .txtLarge {\n                display: inline-block;\n            }\n            .divOverlayFooter {\n                width: 100%;\n            }\n        }"}GetECOverlayHtml(){return`\n        <div id="mainOverlayWrapper"><div role="dialog" aria-labelledby="txtProgressTitle" class="divOverlayHide divOverlayContentWrapper divOverlayContentWrapperCheckout" id="divOverlayTestingCouponsWrapper" aria-modal="true">\n            <div class="mainModals mainModalsCheckout">\n                <div class="overlayContent overlayContentCheckout">\n                    <p aria-live="polite" role="heading" aria-level="1" class="txtLargeCheckout txtProgressTitleCheckout" id="txtProgressTitle"></p>\n                    <span id="spanTestingCoupons" role="alert" style="top: 0px; position: fixed;\n                    opacity: 0;"></span>\n                    <div id="divOverlayProgressCheckout">\n                        <div id="divOverlayBar" class="divOverlayBarCheckout" aria-hidden="true"></div>\n                    </div>\n                    <p id="txtBarCheckoutTitle" class="divOverlayHide txtSmall txtBarCheckoutTitleCheckout" style="margin: 16px 0;color: rgba(0, 0, 0, 0.55);" aria-hidden="true"></p>\n                </div>\n            </div>\n            <div class="divOverlayFooter">\n                <div style="display:flex; flex-direction: row;">\n                    <img aria-hidden="true" class="imgOverlayExtensionIcon"/>\n                    <p class="txtMedium txtClientName"></p>\n                </div>\n                <button id="btnOverlayCancel" class="txtSmall overlayClose" autofocus></button>\n            </div>\n        </div>\n        <div class="divOverlayHide divOverlayContentWrapper divOverlayContentWrapperCheckout" id="divOverlayResultWrapper" role="dialog" aria-live="assertive" aria-relevant="text" aria-hidden="true" aria-modal="true">\n            <div class="mainModals mainModalsCheckout">\n                <div class="resultWrapper divOverlayHide">\n                    <div class="overlayContent overlayContentCheckout" id="divOverlayResultPositive">\n                        <div id="divOverlayResultSavings" class="divOverlayHide">\n                            <p class="txtLargeCheckout txtOverlayResultPositive" id="txtPositiveHeader" role="heading" aria-level="1"></p>\n                        </div>\n                        <div id="divOverlayResultCoupon" class="divOverlayHide">\n                            <div style="display: flex; flex-direction: row; justify-content: center; align-self: center;">\n                                <span class="txtMedium"\n                                id="txtResultPositiveCouponDetails" style="margin-left:3px; font-size: 16px; line-height: 24px;"></span>\n                            </div>\n                            <div id="divPositiveCouponDetails">\n                            </div>\n                        </div>\n                        <div id="divOverlayResultCheckoutTitle">\n                            <p class="txtLargeCheckout txtOverlayResultPositive" id="txtECPositiveHeader" role="heading" aria-level="1"></p>\n                            <img id="divCVVSVG" src="${this.imageEndPoint}autoApply/EEPositiveIcon.png" aria-hidden="true"></img>\n                        </div>\n                        <div id="divOverlayResultCheckoutDetails">\n                            <p class="txtSmall"\n                                id="txtResultPositiveCheckoutCvv" style="margin-left:3px;color: rgba(0, 0, 0, 0.55);"></p>\n                        </div>\n                    </div>\n                </div>\n                <div class="resultWrapper divOverlayHide">\n                    <div class="overlayContent overlayContentCheckout">\n                        <p class="txtLargeCheckout"\n                                id="txtECResultNegativeTitle" role="heading" aria-level="1"></p>\n                        <div id="divOverlayResultCheckoutTitle">\n                            <p class="txtLargeCheckout txtOverlayResultPositive" id="txtECNegativeHeader" role="heading" aria-level="1"></p>\n                        </div>\n                        <div id="divOverlayResultCheckoutDetails">\n                            <p class="txtSmall"\n                                id="txtResultNegativeCheckoutCvv" style="margin-left:3px;color: rgba(0, 0, 0, 0.55);"></p>\n                        </div>\n                    </div>\n                </div>\n                ${this.GetBNPLTotalAmountContainer()}\n            </div>\n            <div class="divOverlayFooter divOverlayShow">\n                <div style="display:flex; flex-direction: row;">\n                    <img aria-hidden="true" class="imgOverlayExtensionIcon"/>\n                    <p class="txtMedium txtClientName"></p>\n                </div>\n                <div style="display: flex; flex-direction: row; margin-right: 24px; align-items: center;">\n                    <button id="btnOverlayCheckout" class="txtSmall" autofocus></button>\n                </div>\n            </div>\n            ${this.GetBNPLTotalAmountFooter()}\n        </div></div>`}GetOverlayCSS(){return`\n        #mainOverlayWrapper {\n            --text-green-savings-color: #008A21;\n        }\n        #mainOverlayWrapper {\n            position: relative;\n            width: 100%;\n            height: 100%;\n            display: flex;\n            justify-content: center;\n        }\n        .divOverlayContentWrapper {\n            width: auto;\n            height:  auto;\n            min-width: 700px;\n            flex-direction: column;\n            justify-content: space-between;\n            place-self: center;\n            position: absolute;\n            border: 1px solid transparent;\n            border-radius: 4px;\n            background: linear-gradient(0deg, #FFFFFF, #FFFFFF);\n            background: #FFFFFF;\n            overflow:hidden;\n            z-index: 21;\n        }\n        .divOverlayContentWrapperCheckout {\n            min-width: 500px;\n        }\n        .mainModals {\n            width: 700px;\n            height: 100%;\n            display: flex;\n            flex-direction: column;\n            align-content: center;\n            align-self: center;\n        }\n        .mainModalsCheckout {\n            width: 500px;\n        }\n        .divCommissionValue {\n            display: inline-block;\n            margin: 0px;\n            vertical-align: text-bottom;\n        }\n        .spanCommissionValue {\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 28px;\n            line-height: 22px;\n            font-size: 20px;\n            background: #3267FA;\n            border-radius: 6px 0px 0px 6px;\n            color: #fff;\n            font-weight: 500;\n            float: left;\n            padding: 0px 1px 0px 6px;\n            margin-right: -1px;\n        }\n        .spanCommissionValueSmall {\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 20px;\n            line-height: 16px;\n            font-size: 12px;\n            background: #3267FA;\n            border-radius: 4px 0px 0px 4px;\n            color: #fff;\n            font-weight: 400;\n            float: left;\n            padding: 0px 2px 0px 4px;\n            margin-right: -1px;\n        }\n        .imgCBTag {\n            display: none;\n        }\n        .imgCashbackActivatedResultNegative {\n            height: 20px;\n        }\n        .imgOverlayExtensionIcon {\n            width: auto;\n            height: auto;\n            margin: 24px;\n            margin-right: 0px;\n            z-index: 25;\n        }\n        .txtLarge {\n            font-family: 'Segoe UI', sans-serif;\n            font-size: 24px;\n            font-style: normal;\n            color: rgba(0, 0, 0, 0.83);\n            font-weight: 600;\n            line-height: 28px;\n            margin: 0px;\n        }\n        .txtLargeCheckout {\n            font-family: 'Segoe UI', sans-serif;\n            font-size: 26px;\n            font-style: normal;\n            color: rgba(0, 0, 0, 0.83);\n            font-weight: 600;\n            line-height: 36px;\n            margin: 0px;\n        }\n        .txtMedium {\n            font-family: 'Segoe UI', sans-serif;\n            font-size: 14px;\n            font-style: normal;\n            color: rgba(0, 0, 0, 0.83);\n            font-weight: normal;\n            line-height: 20px;\n            margin: 0px;\n        }\n        .txtSmall {\n            font-family: 'Segoe UI', sans-serif;\n            font-size: 12px;\n            font-style: normal;\n            color: rgba(0, 0, 0, 0.83);\n            font-weight: normal;\n            line-height: 16px;\n            margin: 0px;\n        }\n        .textContent {\n            display: flex;\n            flex-direction: column;\n            align-items: flex-start;\n            justify-content: center;\n            min-height: 300px;\n            margin-top: 10px;\n            margin-bottom: 10px;\n            margin-left: 20px;\n            width: 100%;\n            max-width: 350px;\n        }\n        .txtCashbackUpsellOffer {\n            position: absolute;\n            display: inline-block;\n            width: 343px;\n            height: 64px;\n            left: 40px;\n            top: 105px;\n            font-family: 'Segoe UI', sans-serif;\n            font-style: normal;\n            font-size: 26px;\n            font-weight: 600;\n            line-height: 28px;\n            margin-top: 0px;\n            margin-bottom: 0px;\n            color: #1A1A1A;\n        }\n        .txtCashbackUpsellStoreName{\n            position: absolute;\n            margin-top:0px;\n            margin-bottom:0px;\n            width: 343px;\n            height: 16px;\n            left: 61px;\n            top: 83px;\n            font-family: 'Segoe UI Variable Static Small', sans-serif;\n            font-style: normal;\n            font-weight: 400;\n            font-size: 12px;\n            line-height: 16px;\n            align-items: center;\n            text-align: left;\n            color: #1A1A1A;\n        }\n        .txtResultNegativeCashbackHeader{\n            font-size: 14px;\n            font-weight: 400;\n            line-height: 20px;\n            margin-left: 7.33px;\n        }\n        .txtCashbackUpsellTitle{\n            position: absolute;\n            margin-top: 0px;\n            margin-bottom: 0px;\n            width: 450px;\n            height: 20px;\n            left: 40px;\n            top: 40px;\n            font-family: 'Segoe UI', sans-serif;\n            font-style: normal;\n            font-weight: 400;\n            font-size: 14px;\n            line-height: 20px;\n            color: #1A1A1A;\n        }\n        .txtCashbackUpsellPrivacy{\n            position: absolute;\n            left: 6.14%;\n            right: 44.7%;\n            top: 64.96%;\n            bottom: 27.49%;\n            font-family: 'Segoe UI Variable Static Small', sans-serif;\n            font-style: normal;\n            font-weight: 400;\n            font-size: 10px;\n            line-height: 14px;\n            color: #7A7A7A;\n        }\n        .txtCashbackUpsellCloseOverlay{\n            font-family: 'Segoe UI Variable Static Text', sans-serif;\n            font-style: normal;\n            font-weight: 400;\n            font-size: 14px;\n            line-height: 20px;\n            color: #036AC4;\n        }\n        .imgStoreLogo{\n            position: absolute;\n            margin-top: 0px;\n            margin-bottom: 0px;\n            width: 16px;\n            height: 16px;\n            left: 41px;\n            top: 83px;\n        }\n        .vdoAutoApply {\n            max-height: 300px;\n        }\n        .divOverlayShow{\n            display: flex;\n        }\n        .divOverlayBlockShow {\n            display: block;\n        }\n        .divOverlayInlineShow{\n            display: inline;\n        }\n        .divOverlayGridShow{\n            display: grid;\n        }\n        .divOverlayHide{\n            display: none!important;\n        }\n        .overlayContent {\n            width: calc(100% - 30px);\n            align-self: center;\n            display: flex;\n            background-color: transparent;\n            flex-direction: row;\n            justify-content: flex-start;\n            align-content: center;\n            align-items: center;\n            text-align: left;\n            margin: 0px;\n            flex-grow: 2;\n            z-index: 1;\n            min-height: 250px;\n        }\n        .overlayContentCheckout {\n            min-height: 172px;\n            flex-direction: column;\n            justify-content: center;\n            text-align: center;\n        }\n        #txtBarTitle,\n        #txtBarCheckoutTitle {\n            width: 100%;\n            text-align: center;\n            align-self: flex-start;\n            text-align: left;\n        }\n        #txtProgressCouponTitle {\n            width: 100%;\n            text-align: center;\n            align-self: flex-start;\n            margin-bottom: 15px;\n            text-align: left;\n        }\n        #divOverlayProgress {\n            width: 100%;\n            align-self: flex-start;\n            margin-top: 12px;\n            margin-bottom: 12px;\n            background-color: rgba(0, 0, 0, 0.07);\n            border-radius: 8px;\n        }\n        #txtProgressTitle {\n            width: 100%;\n            align-text: start;\n            margin-bottom: 40px;\n            font-weight: 500;\n        }\n        .txtProgressTitleCheckout {\n            margin-bottom: 23px!important;\n            margin-top: 53px!important;\n        }\n        .txtClientName {\n            font-weight: 400;\n            align-self: center;\n            margin-left: 5px;\n            margin-right: 5px;\n        }\n        #divOverlayBar {\n            width: 1%;\n            height: 8px;\n            background: linear-gradient(90deg, #CB5CFF 0%, #35CFFF 50%, #64E816 100%);\n            border-radius: 8px;\n        }\n        .divOverlayBarCheckout {\n            background: linear-gradient(90deg, #E70780 0%, #FFA318 32.29%, #01C190 58.33%, #01ADA5 70.83%, #00A9FF 98.96%)!important;\n        }\n        .txtSavingsColor {\n            color: var(--text-green-savings-color);\n            font-size: 28px;\n            line-height: 33px;\n            font-weight: 500;\n        }\n        #btnOverlayCancel {\n            width: auto;\n            min-width: 130px;\n            height: 38px;\n            display: block;\n            margin: 24px;\n            align-self: center;\n            padding: 5px 10px;\n            align-items: center;\n            border-radius: 8px;\n            background: #FFFFFF;\n            border: 1px solid #008076;\n            outline:none;\n            box-sizing: border-box;\n            fill: inherit;\n            text-align: center;\n            cursor: pointer;\n            z-index: 25;\n            color: #008076;\n            font-weight: 600;\n        }\n        #btnOverlayClose, #btnOverlayCheckout {\n            box-sizing: border-box;\n            width: auto;\n            min-width: 196px;\n            height: 40px;\n            display: block;\n            align-self: center;\n            padding: 5px;\n            align-items: center;\n            color: #FFFFFF;\n            box-sizing: border-box;\n            background: linear-gradient(#036EC9,#036EC9) padding-box, linear-gradient(180deg, #1C7DCE 90%, #024C8B 100%) border-box;\n            border-radius: 8px;\n            fill: inherit;\n            border-color: transparent;\n            text-align: center;\n            cursor: pointer;\n            z-index: 25;\n            font-weight: 600;\n            border: 1px solid transparent;\n        }\n        #btnOverlayRebates {\n            width: auto;\n            min-width: 196px;\n            height: 38px;\n            display: block;\n            margin-right: 8px;\n            align-self: center;\n            padding: 5px;\n            align-items: center;\n            border-radius: 8px;\n            background: #FFFFFF;\n            border: 1px solid #008076;\n            outline:none;\n            box-sizing: border-box;\n            fill: inherit;\n            text-align: center;\n            cursor: pointer;\n            z-index: 25;\n            color: #008076;\n            font-weight: 600;\n        }\n        .closeIcon {\n            width: auto;\n            height: auto;\n            position: absolute;\n            right: 12px;\n            top: 12px;\n            cursor: pointer;\n            z-index: 25;\n        }\n        .resultWrapper {\n            width: 100%;\n            height: 100%;\n            top: 0px;\n            left: 0px;\n            flex-direction: column;\n            justify-content: stretch;\n            align-items: center;\n            border-radius: 4px;\n            background: transparent;\n            z-index: 21;\n        }\n        #divOverlayResultSavings {\n            display: flex;\n            align-self: flex-start;\n            justify-content: center;\n            flex-direction: column;\n            text-align: left;\n            width: 100%;\n        }\n        #divOverlayResultPositive {\n            width: inherit;\n        }\n        #divPositiveCouponDetails {\n            width: 100%;\n            display: flex;\n            flex-direction: row;\n            justify-content: flex-start;\n            text-align: left;\n            color: rgba(0, 0, 0, 0.55);\n            grid-template-rows: auto 5% auto;\n            align-items: baseline;\n        }\n        #divOverlayResultNegative {\n            width: 100%;\n            display: flex;\n            flex-direction: row;\n            justify-content: center;\n            text-align: left;\n            margin-top: 0px;\n            margin-bottom: 0px;\n        }\n        .txtOverlayResultPositive {\n            margin-top: 0px;\n            margin-bottom: 15px;\n            letter-spacing: unset;\n            font-weight: 500;\n        }\n        #divOverlayResultCoupon {\n            display: flex;\n            flex-direction: column;\n            justify-content: center;\n            align-self: flex-start;\n            margin-top: 10px;\n            row-gap: 3px;\n        }\n        ${this.GetSocialSharingOverlayRefresh()}\n        #txtResultPositiveCoupon {\n            display: inline;\n            margin-right: 1px;\n            align-self: flex-start;\n            text-transform: uppercase;\n            font-weight: 600;\n            letter-spacing: unset;\n            text-align: left;\n        }\n        .divOverlayFooter {\n            width: auto;\n            height: 64px;\n            display: flex;\n            flex-direction: row;\n            justify-content: space-between;\n            align-items: center;\n            border-top: 1px solid rgba(0, 0, 0, 0.09);\n            background: linear-gradient(180deg, #EEFCFF 20.31%, #F5F9FF 46.88%, #FFFFFF 98.44%);\n            box-sizing: border-box;\n        }\n        #btnOverlayClose:hover, #btnOverlayCheckout:hover {\n            background: #006cbe;\n            color: #FFFFFF;\n        }\n        #btnOverlayCancel:hover, #btnOverlayRebates:hover {\n            outline: 2px solid transparent;\n            background: linear-gradient(267.73deg, #F0FEFF -9.53%, #DBFFFB 45.72%, #F8FDFF 97.76%);\n            color: #008076;\n            border-color: #008076;\n        }\n        #btnOverlayClose:focus, #btnOverlayCheckout:focus {\n            box-shadow: 0 0 0 2px inset #fbfdfe, 0 0 0 1px #878787;\n            border: 1px solid #878787;\n        }\n        #btnOverlayCancel:focus {\n            box-shadow: 0 0 0 2px inset #fbfdfe, 0 0 0 1px #878787;\n            border: 1px solid #878787;\n        }\n        #btnOverlayRebates:focus {\n            box-shadow: 0 0 0 2px inset #fbfdfe, 0 0 0 1px #878787;\n            border: 1px solid #878787;\n        }\n        #divImportBrowser {\n            flex-direction: column;\n            align-self: flex-start;\n            margin-top: 15px;\n        }\n        #divJoinRebates {\n            flex-direction: column;\n            align-self: flex-start;\n            margin-top: 10px;\n            width: 100%;\n        }\n        #divImportBrowserWrapper {\n            width: calc(100% - 60px);\n            display: flex;\n            flex-direction: row;\n            align-self: flex-start;\n            margin-top: 15px;\n        }\n        #divJoinRebatesWrapper {\n            display: flex;\n            flex-direction: row;\n            align-self: flex-start;\n            margin-top: 10px;\n        }\n        .hrDivider {\n            width: 100%;\n            height: 0px;\n            border: 1px solid rgba(0, 0, 0, 0.1);\n            border-width: 0px;\n            border-top-width: 1px;\n            left: 0;\n            right: 0;\n        }\n        #txtJoinRebates {\n            width: 100%;\n            display: flex;\n            flex-direction: column;\n            flex-grow: 2;\n            margin: 20px;\n            margin-left: 0px;\n            justify-content: center;\n        }\n        #divOverlayResultCheckoutTitle {\n            display: flex;\n            flex-direction: row;\n            column-gap: 4px;\n            justify-content: center;\n            align-items: center;\n            margin-bottom: 23px;\n        }\n        #txtECPositiveHeader {\n            margin: 0px;\n        }\n        #txtBarCheckoutTitle {\n            text-align: center;\n        }\n        .txtBarCheckoutTitleCheckout {\n            margin-bottom: 41px!important;\n        }\n        #divOverlayProgressCheckout {\n            width: calc(100% - 50px);\n            align-self: center;\n            margin-top: 12px;\n            margin-bottom: 12px;\n            background-color: rgba(0, 0, 0, 0.07);\n            border-radius: 8px;\n        }\n        #imgPositiveResult {\n            position: absolute;\n            align-self: center;\n            margin-top: 13px;\n        }\n        #divOverlayPromptPos, #divOverlayPromptNeg {\n            display: flex;\n            column-gap: 9px;\n        }\n        #divIconPromptPos, #divIconPromptNeg {\n            width: 24px;\n            height: 24px;\n        }\n        #txtAttCouponPromptPos, #txtAttCouponPromptNeg {\n            font-size: 18px;\n            line-height: 24px;\n            color: #949494;\n        }\n        #btnColorfulPos, #btnColorfulNeg {\n            background: linear-gradient(88.14deg, #018DC8 0.49%, #01CC83 53.44%, #0CBFC9 104.22%);\n            height: 36px;\n            width: auto;\n            max-width: 147px;\n            border-radius: 8px;\n            padding: 1.5px;\n            margin-top: 16px;\n        }\n        #btnTransparentNeg{\n            background: transparent;\n            border-color: #1C7DCE;\n            border-radius: 4px;\n            position: absolute;\n            width: 258px;\n            height: 32px;\n            left: 369px;\n            top: 319px;\n            display: flex;\n            flex-direction: row;\n            justify-content: center;\n            align-items: center;\n            padding: 2px;\n        }\n        #btnSolidColorNeg {\n            background: linear-gradient(0deg, #036EC9, #036EC9), linear-gradient(180deg, #1C7DCE 90%, #024C8B 100%);\n            border-radius:4px;\n            width: 200px;\n            height: 32px;\n            left: 40px;\n            top: 190px;\n            padding: 2px;\n            position: absolute;\n        }\n        #btnContinueShoppingPos, #btnContinueShoppingNeg {\n            background: white;\n            height: calc(100%);\n            width: calc(100%);\n            border-radius: 6px;\n            line-height: 20px;\n            color: #008076;\n            font-weight: 500;\n            border: none;\n            cursor: pointer;\n        }\n        #btnJoinAndActivate{\n            background: linear-gradient(0deg, #036EC9, #036EC9), linear-gradient(180deg, #1C7DCE 90%, #024C8B 100%);\n            border-radius:4px;\n            border-color: transparent;\n            height: calc(100%);\n            width: calc(100%);\n            font-weight:400;\n            font-size: 14px;\n            line-height:20px;\n        }\n        #btnCashbackUpsellCloseOverlay{\n            background: transparent;\n            justifyContent: center;\n            border-style:solid;\n            border-radius: 4px;\n            width: 258px;\n            height: 32px;\n            font-weight: 400;\n        }\n        #infoIcon {\n            display: inline-flex;\n            position: relative;\n            margin-left: 4px;\n        }\n        #infoTooltip.rightPositioned {\n            left: -150%;;\n        }\n        #infoTooltip {\n            display: none;\n            position: absolute;\n            top: 100%;\n            right: 150%;\n            margin-top: 5px;\n            margin-right: -30px;\n            background: #FFFFFF;\n            font-family: Segoe UI;\n            font-size: 14px;\n            line-height: 20px;\n            text-align: left;\n            box-shadow: 0px 12.8px 28.8px rgba(0, 0, 0, 0.13), 0px 0px 9.2px rgba(0, 0, 0, 0.11);\n            border-radius: 4px;\n            padding: 12px;\n            padding-bottom: 10px;\n            z-index: 900;\n            max-width: 300px;\n            width: max-content;\n        }\n        #infoTooltip.rightPositioned:before {\n            left: 10px;\n        }\n        #infoTooltip:before {\n            content: " ";\n            width: 0;\n            height: 0;\n            border-left: 10px solid transparent;\n            border-right: 10px solid transparent;\n            border-bottom: 6px solid #FFFFFF;\n            position: absolute;\n            top: -5px;\n            right: 10px;\n        }\n        #infoIcon:hover > #infoTooltip {\n            display: block;\n        }\n        #infoIcon:focus-visible > #infoTooltip,\n        #infoIcon:focus-within > #infoTooltip {\n            display: block;\n        }\n        #infoIcon:focus-visible,\n        #infoIcon:focus-within {\n            outline: none;\n        }\n        #infoIcon:focus-visible > svg {\n            outline: none;\n            box-shadow: 0px 0px 0px 2px #898989;\n            border-radius: 50%;\n        }\n        #countdown-container {\n            fill: rgb(255, 255, 255);\n            left: 50%;\n            display: inline;\n            top: 50%;\n            margin-left:310px;\n            background: transparent;\n            border: unset;\n            cursor: pointer;\n            transform: translate(-50%, -50%);\n            padding:0;\n        }\n        #countdown-svg {\n            width: 30px;\n            height: 30px;\n            display:block;\n            margin:auto;\n            transform: rotateY(-180deg) rotateZ(-90deg) scale(1,-1);\n        }\n        #countdown-circle {\n            stroke-dasharray: 81.6px;\n            stroke-dashoffset: 0px;\n            stroke-linecap: round;\n            stroke-width: 1.3px;\n            stroke: #4F94D3;\n            fill: none;\n            animation: countdown 10s linear 1 forwards;\n        }\n        #back-countdown-circle {\n            stroke-dasharray: 81.6px;\n            stroke-dashoffset: 0px;\n            stroke-linecap: round;\n            stroke-width: 1px;\n            stroke: #afacac;\n            fill: none;\n        }\n        @keyframes countdown {\n            from {\n                stroke-dashoffset: 81.6px;\n            }\n            to {\n                stroke-dashoffset: 0px;\n            }\n        }\n        @media (-ms-high-contrast: active) {\n            #flyoutClose {\n                fill: ButtonText;\n            }\n            #shopping-tag-icon path {\n                d: path("M12 5C12.5523 5 13 4.55228 13 4C13 3.44772 12.5523 3 12 3C11.4477 3 11 3.44772 11 4C11 4.55228 11.4477 5 12 5ZM9.12922                 4.30281e-05C8.59514 -0.00345791 8.08184 0.206807 7.7037 0.583987L1.02216 7.24852C0.239412 8.02928 0.238604 9.297 1.02036                 10.0788L5.96875 15.0271C6.7498 15.8082 8.01613 15.8082 8.79718 15.0271L15.428 8.39633C15.8038 8.02054 16.0146 7.51063 16.0138                 6.97917L16.0065 2.02911C16.0049 0.930807 15.1179 0.0393006 14.0196 0.032101L9.12922 4.30281e-05ZM8.4099 1.29199C8.59897 1.1034                8.85562 0.998271 9.12266 1.00002L14.013 1.03208C14.5622 1.03568 15.0057 1.48143 15.0065 2.03058L15.0138 6.98065C15.0142 7.24637                14.9088 7.50133 14.7209 7.68923L8.09007 14.32C7.69955 14.7106 7.06638 14.7106 6.67586 14.32L1.72746 9.37164C1.33659 8.98077 1.33699                 8.34691 1.72836 7.95653L8.4099 1.29199Z");\n                fill: ButtonText;\n                transform: scale(0.85);\n            }\n            #countdown-circle{\n                stroke: Text;\n            }\n            #back-countdown-circle {\n                display: none;\n            }\n        }\n        #offerDetails {\n            color: #036AC4;\n            text-decoration: none;\n            cursor: pointer;\n        }\n        #offerDetails:hover,\n        #offerDetails:focus-visible {\n            text-decoration: underline;\n            outline: none;\n        }\n        #alternateLabel {\n            font-size: 14px;\n            font-weight: 600;\n        }\n        #nonstackOr {\n            color: #616161;\n            margin-left: 30px;\n        }\n        .radioWrapper {\n            display: flex;\n            flex-direction: row;\n        }\n        .radioWrapper input {\n            opacity: 0;\n            width: 28px;\n        }\n        label#recommendedLabel {\n            display: flex;\n            flex-direction: column;\n        }\n        .radioWrapper input + label {\n            display: block;\n            position: relative;\n            cursor: pointer;\n        }\n        .radioWrapper input + label::before {\n            content: '';\n            position: absolute;\n            display: inline-block;\n            height: 16px;\n            width: 16px;\n            left: -34px;\n            border-radius: 50%;\n            box-sizing: border-box;\n            border: 1px solid #616161;\n        }\n        .radioWrapper input + label#recommendedLabel::before {\n            top: 10px;\n        }\n        .radioWrapper input + label#alternateLabel::before {\n            top: 3px;\n        }\n        .radioWrapper input + label::after {\n            content: '';\n            position: absolute;\n            display: inline-block;\n            left: -30px;\n            width: 8px;\n            height: 8px;\n            border-radius: 50%;\n        }\n        .radioWrapper input + label#recommendedLabel::after {\n            top: 14px;\n        }\n        .radioWrapper input + label#alternateLabel::after {\n            top: 7px;\n        }\n        .radioWrapper input:checked + label::before {\n            border: 1px solid #0F6CBD;\n        }\n        .radioWrapper input:checked + label::after {\n            background: #0F6CBD;\n        }\n        .radioWrapper input:focus-visible + label::before {\n            outline: black solid 1.5px;\n        }\n        /* The dots/bullets/indicators */\n        .dot {\n            cursor: pointer;\n            height: 8px;\n            width: 8px;\n            margin: 0 2px;\n            background-color: #bbb;\n            border-radius: 50%;\n            display: inline-block;\n            transition: background-color 0.6s ease;\n        }\n        .active, .dot:hover {\n            background-color: #717171;\n        }\n        /* Fading animation */\n        .fade {\n            -webkit-animation-name: fade;\n            -webkit-animation-duration: 1.5s;\n            animation-name: fade;\n            animation-duration: 1.5s;\n        }\n        @-webkit-keyframes fade {\n            from {opacity: .4}\n            to {opacity: 1}\n        }\n        @keyframes fade {\n            from {opacity: .4}\n            to {opacity: 1}\n        }\n        .show {\n            display:flex;\n        }\n        .hide {\n            display:none;\n        }\n        .ecspan {\n            color: rgba(0, 0, 0, 0.83);\n            display: inline;\n        }\n        #divOverlayResultError, #divOverlayResultShortCircuit {\n            flex-direction: column;\n            justify-content: center;\n        }\n        .txtshortcircuitDetails {\n            margin-top: 15px;\n            width: calc(100% - 100px);\n            font-size: 16px;\n            line-height: 24px;\n            text-align: center;\n        }\n        #btnResultShortcircuitCoupon {\n            cursor: pointer;\n            margin-top: 15px;\n            width: 350px;\n            height: 100px;\n            border-radius: 10px;\n            border-style: dashed;\n            border-width: 1px;\n            border-color: #A6C6E3;\n            display: flex;\n            flex-direction: column;\n            justify-content: space-around;\n            align-items: center;\n            padding: 10px;\n            background-color: transparent;\n        }\n        #btnResultShortcircuitCoupon:hover {\n            background-color: rgba(0, 87, 173, 0.05);\n        }\n        #pauseComponent {\n            width: 100%;\n        }\n        #txtResultShortcircuitCouponCode {\n            margin: 0;\n            font-size: 26px;\n            color: #0056AE;\n            font-weight: bold\n        }\n        @media (-ms-high-contrast: active) {\n            .radioWrapper input:checked + label::after {\n                background: WindowText;\n            }\n            .imgCBTag {\n                display: none!important;\n            }\n            #infoTooltip p {\n                color: WindowText!important;\n            }\n            #offerDetails {\n                color: LinkText;\n            }\n        }\n        @media (prefers-color-scheme: dark) {\n            #mainOverlayWrapper {\n                --text-green-savings-color:#35D95B;\n            }\n            div, span, p {\n              color: #FFFFFF!important;\n            }\n            .txtMedium {\n                color: rgb(255 255 255 / 83%);\n            }\n            #nonstackOr {\n                color: #EBEBEB;\n            }\n            .radioWrapper input + label::before {\n                border: 1px solid #EBEBEB;\n            }\n            .radioWrapper input:focus-visible + label::before {\n                outline: white solid 1.5px;\n            }\n            #offerDetails {\n                color: #63ADE5;\n            }\n            .radioWrapper input:checked + label::before {\n                border: 1px solid #63ADE5;\n            }\n            .radioWrapper input:checked + label::after {\n                background: #63ADE5;\n                forced-color-adjust: none;\n            }\n            .closeIcon > svg > path {\n                fill: #FFFFFF;\n            }\n            .divOverlayFooter {\n                background: #424242;\n            }\n            .divOverlayContentWrapper {\n                background: #4A4A4A;\n            }\n            #btnOverlayCancel {\n                background: rgba(255, 255, 255, 0.09);\n                color: #FFFFFF;\n            }\n            #txtCopyToClipboard {\n                background: #454446;\n            }\n            #btnOverlayRebates {\n                background: rgba(255, 255, 255, 0.09);\n                color: #FFFFFF;\n            }\n            .ecspan {\n                color: #FFFFFF;\n            }\n            .overlayContent {\n                background: #454446;\n            }\n            .mainModals {\n                background: #454446;\n            }\n            #btnContinueShoppingPos, #btnContinueShoppingNeg {\n                background: #454446;\n                color: #02d9c8;\n            }\n            #infoTooltip {\n                background: #3b3b3b;\n            }\n            #infoTooltip .txtSmall {\n                color: #FFFFFF;\n            }\n            #infoTooltip::before {\n                border-bottom: 6px solid #3b3b3b;\n            }\n            #infoIcon svg path {\n                fill: #FFFFFF;\n            }\n            #infoIcon:focus-visible > svg {\n                outline: none;\n                box-shadow: 0px 0px 0px 1px #FFFFFF;\n                border-radius: 50%;\n            }\n        }\n        @media (forced-colors: active) {\n            #btnOverlayClose, #btnOverlayCheckout {\n                background: Highlight;\n                forced-color-adjust: none;\n                color: highlightText;\n            }\n            #btnCashbackUpsellCloseOverlay{\n                color:buttontext;\n                border-color:buttontext;\n            }\n            #btnOverlayClose:hover, #btnOverlayCheckout:hover {\n                background: highlighttext;\n                color: highlight;\n                border: 1px solid highlight;\n            }\n            #btnOverlayCancel {\n                background: Highlight;\n                forced-color-adjust: none;\n                color: highlightText;\n            }\n            #btnOverlayCancel:hover {\n                background: highlighttext;\n                color: highlight;\n                border: 1px solid highlight;\n            }\n            #divOverlayBar {\n                background: Highlight;\n                forced-color-adjust: none;\n            }\n            #btnOverlayClose:focus-visible, #bnplContinueButton:focus-visible, #btnOverlayCheckout:focus-visible {\n                outline: 2px solid transparent;\n                border: 1px solid buttontext;\n                box-shadow: highlighttext 0px 0px 0px 2px inset;\n            }\n            #btnOverlayCancel:focus-visible {\n                box-shadow: 0 0 0 2px HighlightText inset;\n                border-color: buttonText;\n            }\n            #btnOverlayRebates:hover, #btnOverlayRebates:focus-visible {\n                outline: 2px solid transparent;\n                background: highlighttext;\n                color: highlight;\n                border: 1px solid highlight;\n            }\n            #imgPositiveResult {\n                display: none;\n            }\n            .vdoAutoApply {\n                display: none;\n            }\n            .btnSocialSharing {\n                border: none;\n            }\n            #divOverlayProgress {\n                border: 1px solid buttontext;\n            }\n            .textContent {\n                width: calc(100% - 40px);\n            }\n        }\n        @media (max-width: 700px) {\n            .divOverlayContentWrapper{\n                max-width: 700px;\n                height: 100%;\n                top: 0px;\n                left: 0px;\n                align-self: flex-start;\n                flex-direction: column;\n                justify-content: space-between;\n                position: relative;\n                border-radius: 4px;\n                background: linear-gradient(0deg, #FFFFFF, #FFFFFF);\n                overflow:auto;\n                z-index: 21;\n            }\n            .textContent {\n                min-height: unset;\n            }\n            .overlayContent {\n                margin-top: 0px;\n                margin-bottom: 0px;\n            }\n            .resultWrapper {\n                height: 100%;\n                width: auto;\n                max-width: 700px;\n                top: 0px;\n                left: 0px;\n                flex-direction: column;\n                align-items: center;\n                border-radius: 4px;\n                background: transparent;\n                z-index: 21;\n            }\n            .mainModals {\n                width: 100%;\n                height: 100%;\n                display: flex;\n                flex-direction: column;\n                align-content: center;\n                align-self: center;\n            }\n            #txtBarTitle {\n                width: 100%;\n            }\n            #txtProgressTitle {\n                width: 100%;\n            }\n            #divOverlayProgress {\n                width: 100%;\n                align-self: flex-start;\n                margin-top: 12px;\n                margin-bottom: 12px;\n                background-color: rgba(0, 0, 0, 0.07);\n                border-radius: 8px;\n            }\n            #divOverlayBar {\n                width: 1%;\n                height: 8px;\n                background-color: #0078D4;\n                border-radius: 8px;\n            }\n            .txtSmall {\n                display: inline-block;\n            }\n            .txtMedium {\n                display: inline-block;\n            }\n            .txtLarge {\n                display: inline-block;\n            }\n            .divOverlayFooter {\n                width: 100%;\n            }\n            .vdoAutoApply {\n                display: none;\n            }\n        }`}GetOverlayHtml(){return`<div id="mainOverlayWrapper"><div role="dialog" aria-labelledby="txtProgressTitle" class="divOverlayHide divOverlayContentWrapper" id="divOverlayTestingCouponsWrapper" aria-modal="true">\n        <div class="mainModals">\n            <div class="overlayContent">\n                <div class="textContent">\n                    <p aria-live="polite" role="heading" aria-level="1" class="txtLarge" id="txtProgressTitle"></p>\n                    <span id="spanTestingCoupons" role="alert" style="top: 0px; position: fixed;\n                    opacity: 0;"></span>\n                    <p id="txtBarCheckoutTitle" class="divOverlayHide txtSmall" style="margin: 16px 0;color: rgba(0, 0, 0, 0.55);" aria-hidden="true"></p>\n                    <p id="txtBarTitle" class="txtSmall" ></p>\n                    <div id="divOverlayProgress">\n                        <div id="divOverlayBar" aria-hidden="true"></div>\n                    </div>\n                    <span class="txtMedium" id="txtProgressCouponTitle"></span>\n                    <p id="txtECCurrentProgressTitle" class="divOverlayHide txtSmall"></p>\n                    ${this.GetReceiptScannerBanner()}\n                </div>\n                <video aria-hidden="true" muted="true" loop name="media" class="vdoAutoApply"><source id="vdoTestingCoupons" type="video/mp4"></video>\n            </div>\n        </div>\n        <div class="divOverlayFooter">\n            <div style="display:flex; flex-direction: row;">\n                <img aria-hidden="true" class="imgOverlayExtensionIcon"/>\n                <p class="txtMedium txtClientName"></p>\n            </div>\n            <button id="btnOverlayCancel" class="txtMedium overlayClose" autofocus></button>\n        </div>\n    </div>\n    <div class="divOverlayHide divOverlayContentWrapper" id="divOverlayResultWrapper" role="dialog" aria-live="assertive" aria-relevant="text" aria-hidden="true" aria-modal="true">\n        <div class="mainModals">\n            <div class="resultWrapper">\n                <div class="overlayContent" id="divOverlayResultPositive">\n                    <div class="textContent" style="margin-left: 36px;">\n                        <div id="divOverlayResultSavings">\n                            <p class="txtLarge txtOverlayResultPositive" id="txtPositiveHeader" role="heading" aria-level="1"></p>\n                        </div>\n                        <div id="divOverlayResultCoupon">\n                            <div style="display: flex; flex-direction: row; align-self: flex-start;">\n                                <span class="txtMedium" id="txtResultPositiveCouponDetails" style="font-size: 12px; line-height: 20px; text-align: left;"></span>\n                            </div>\n                            <div class="txtMedium" id="txtResultPositiveCashBackDetails" style="display: none; margin-bottom: 10px; font-size: 12px; line-height: 20px; text-align: left;"></div>\n                            <div id="divPositiveCouponDetails">\n                            </div>\n                        </div>\n                        <div id="divOverlayAttCouponPos" class="divOverlayHide">\n                            <div id="divOverlayPromptPos"><div id="iconPromptPos" aria-hidden="true"></div><p class="txtLarge" id="txtAttCouponPromptPos"></p></div>\n                            <p class="txtLarge" id="txtAttCouponTitlePos" role="heading" aria-level="2" style="font-size: 20px;"></p>\n                            <div id="btnColorfulPos"><button class="txtMedium" id="btnContinueShoppingPos"></button></div>\n                        </div>\n                        <div id="divOverlayResultExpressCheckoutPositive" class="divOverlayHide" style="margin-top:17px;">\n                            <div id="divOverlayResultCheckoutTitle">\n                                <p class="txtSmall txtOverlayResultPositive" id="txtECPositiveHeader" style="line-height:24px;color:rgba(0, 0, 0, 0.83);" role="heading" aria-level="1"></p>\n                            </div>\n                            <div id="divOverlayResultCheckoutDetails">\n                                <svg style="margin:auto; margin-top:10px; margin-bottom:5px" width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">\n                                <rect x="1" y="8" width="30" height="16" rx="1" fill="#1F65F1"/>\n                                <rect x="1" y="10" width="30" height="3" fill="#1243A6"/>\n                                <rect x="2" y="14" width="14" height="4" rx="1" fill="#F5F5F5"/>\n                                <circle cx="24" cy="20" r="7.5" fill="white" stroke="#FFAC01"/>\n                                <path d="M21.5947 20.2495L20.3906 20.4561L21.2344 21.4624L20.6104 21.8931L19.96 20.7505L19.3096 21.8931L18.6812 21.4624L19.5293 20.4561L18.3208 20.2495L18.5713 19.5464L19.7007 19.999L19.5601 18.6982H20.3599L20.2192 19.999L21.3486 19.5464L21.5947 20.2495ZM25.5059 20.2495L24.3018 20.4561L25.1455 21.4624L24.5215 21.8931L23.8711 20.7505L23.2207 21.8931L22.5923 21.4624L23.4404 20.4561L22.2319 20.2495L22.4824 19.5464L23.6118 19.999L23.4712 18.6982H24.271L24.1304 19.999L25.2598 19.5464L25.5059 20.2495ZM29.417 20.2495L28.2129 20.4561L29.0566 21.4624L28.4326 21.8931L27.7822 20.7505L27.1318 21.8931L26.5034 21.4624L27.3516 20.4561L26.1431 20.2495L26.3936 19.5464L27.5229 19.999L27.3823 18.6982H28.1821L28.0415 19.999L29.1709 19.5464L29.417 20.2495Z" fill="#1F65F1"/>\n                                <path d="M3 20H7" stroke="#F5F5F5" stroke-linecap="round"/>\n                                <path d="M3 22H6" stroke="#F5F5F5" stroke-linecap="round"/>\n                                </svg>\n                                <p class="txtSmall"\n                                    id="txtResultPositiveCheckoutCvv" style="margin-left:3px;color: rgba(0, 0, 0, 0.55);"></p>\n                            </div>\n                        </div>\n                        <div id="divOverlayShare" class="divOverlayHide" role="group" aria-labelledby="txtOverlayShare">\n                        <p id="txtOverlayShare" class="divOverlayInlineShow"></p>\n                        <button id="btnOverlayShareFB" class="btnSocialSharing divOverlayHide"></button>\n                        <button id="btnOverlayShareTwitter" class="btnSocialSharing divOverlayHide"></button>\n                        <button id="btnOverlayShareWhatsapp" class="btnSocialSharing divOverlayHide"></button>\n                        <button id="btnOverlayShareClipboard" class="btnSocialSharing divOverlayHide">\n                            <div id="txtCopyToClipboard" class="showMessage copyInfoTxtMargin">\n                                <p class="copyInfoTxtMargin">Copied link to clipboard</p>\n                            </div>\n                        </button>\n                        </div>\n                        <div id="divJoinRebates" class="divOverlayHide">\n                        <hr class="hrDivider"></hr>\n                        </div>\n                        <div id="divImportBrowser" class="divOverlayHide">\n                        <hr class="hrDivider"></hr>\n                        </div>\n                        ${this.GetReceiptScannerBanner()}\n                    </div>\n                    <video aria-hidden="true" name="media" class="vdoAutoApply"><source id="vdoResultPositive" type="video/mp4"></video>\n                    <img aria-hidden="true" id="imgAutoApply" style="display: none;" />\n                </div>\n            </div>\n            ${this.GetResultNegativeContainer()}\n            ${this.GetNegativeCashbackUpsellContainer()}\n            <div class="resultWrapper">\n                <div class="overlayContent" id="divOverlayResultError">\n                    <p class="txtLarge" id="txtResultErrorTitle" role="heading" aria-level="1"></p>\n                    <p class="txtMedium" id="txtResultErrorDetails" style="margin-top: 15px; width: calc(100% - 100px); font-size: 16px; line-height: 24px; text-align: center; color: rgba(121, 121, 121, 0.55);"></p>\n                </div>\n            </div>\n            ${this.GetShortcircuitResultContainer()}\n            ${this.GetResultNegativeUpsellRewardsContainer()}\n            ${this.GetBNPLTotalAmountContainer()}\n        </div>\n        ${this.GetOverlayFooter()}\n        ${this.GetBNPLTotalAmountFooter()}\n    </div></div>`}}(vn.GetPlatformInstance())),(0,i.Z)(vn,"applicatorStateService",new class{constructor(e){(0,i.Z)(this,"platformSpecific",void 0),(0,i.Z)(this,"CouponApplicatorUIStateKey","CouponApplicatorUIState"),(0,i.Z)(this,"couponApplicatorState",void 0),this.platformSpecific=e,this.couponApplicatorState=null}LoadCouponApplicatorState(){return new Promise(((e,t)=>{this.couponApplicatorState?e(this.couponApplicatorState):(this.SaveCouponApplicatorState(null),e(null))}))}SaveCouponApplicatorState(e){this.couponApplicatorState=e;let o="";e&&(o=e.ToString());const a=[o];t.a.postMessageToHost(d.Pd.SetAutoApplyState,a)}async GetUIState(e){return new Promise(((t,o)=>{this.platformSpecific.ReadFromStorage(this.CouponApplicatorUIStateKey,(o=>{if(o&&o[this.CouponApplicatorUIStateKey]){let a=St.CreateFromObject(o[this.CouponApplicatorUIStateKey]);if(!a||a.Hostname!==e){a=St.CreateNew(e);const t={[this.CouponApplicatorUIStateKey]:a};this.platformSpecific.WriteToStorage(t)}t(a)}else{const o=St.CreateNew(e),a={[this.CouponApplicatorUIStateKey]:o};this.platformSpecific.WriteToStorage(a),t(o)}}))}))}async SaveUIState(e){const t={[this.CouponApplicatorUIStateKey]:e};this.platformSpecific.WriteToStorage(t)}}(vn.GetPlatformInstance())),(0,i.Z)(vn,"logService",new class extends eo{constructor(e,t){super(e),(0,i.Z)(this,"applicatorService",void 0),(0,i.Z)(this,"buildVersion",void 0),this.applicatorService=t,this.buildVersion=Yt.Z.GetBuildVersion()}async LogClientEventV2(e,o,a,i,r){let n="";if(r)n=r;else{const e=await this.applicatorService.LoadCouponApplicatorState();e?.ImpressionId&&(n=e.ImpressionId)}const s=new Qt.Z(this.platformSpecific.GetAppInfoClientName(),this.platformSpecific.GetVersion(),this.buildVersion,Yt.Z.enabledServiceFlights,jt.R.GetServiceExperiments()),c=new Jt(e,o,i.ToString(),a,n,s);if((0,zt.st)(c,i,Xt.Z.GetLocalDataService().GetLogBlockConfig()))return;const l=[c.ToString()];t.a.postMessageToHost(d.Pd.LogScriptTelemetry,l)}async Flush(){}}(vn.GetPlatformInstance(),vn.GetApplicatorStateService())),(0,i.Z)(vn,"overlayService",new class extends Tt{constructor(e,t,o,a){super(e),(0,i.Z)(this,"logService",void 0),(0,i.Z)(this,"uxDataService",void 0),(0,i.Z)(this,"entryPointService",void 0),this.logService=t,this.uxDataService=o,this.entryPointService=a}async OpenExpressCheckoutOverlay(t,o,a){if(this.EntryPointIsWallet())return this.WalletDrawerCreateOverlay(t);const i=await this.GetUXData(e.k2.ECOverlay);if(i){const r=this.uxDataService.GetUXStyles(e.k2.ECOverlay);await this.CloseOverlay(t),await this.SendDomMessage(t,new Qr(t,r||"",i,o,a),"ECCreateOverlay",!0)}}async OpenExpressCheckoutUpdatePaymentOverlay(t){if(this.EntryPointIsWallet())return this.WalletDrawerCreateOverlay(t);const o=await this.GetUXData(e.k2.ECOverlay);if(o){const a=this.uxDataService.GetUXStyles(e.k2.ECOverlay);await this.CloseOverlay(t),await this.SendDomMessage(t,new Yr(t,a||"",o),"ECCreateUpdatePaymentOverlay",!0)}}async OpenPrintableGroceryCouponsOverlay(e,t){await this.SendDomMessage(e,new sn(e,t),"Printable Grocery Coupons",!0)}async OpenInstantAddToCartOverlay(e,t){await this.SendDomMessage(e,new rn(e,t),"InstantAddToCart",!0)}async OpenSuccessInstantAddToCartOverlay(e,t){await this.SendDomMessage(e,new ln(e,t),"InstantAddToCart",!0)}async ShowExpressCheckoutResult(e,t,o,a,i,r,n){await this.SendDomMessage(e,new qr(t,o,a,i,r,n),"ECShowResults",!0)}async OpenOverlay(t,o,a,i,r,n,s){if(this.EntryPointIsWallet())return this.WalletDrawerCreateOverlay(t);const c=await this.GetUXData(e.k2.Overlay);c&&(await this.CloseOverlay(t),await this.CreateOverlay(t,o,a,c,i,r,n,s))}async MoveProgressBar(e,t,o){if(o>0){const a=this.GetPositions(t,o);await this.SendDomMessage(e,new dt(a[0],a[1]),"Progress Bar Update",!0)}}async ShowResult(t,o,a,i,r,n,s,c,l,d,u,h,p,m,g){const C=this.platformSpecific.GetAppInfoClientName(),S=r.BestCoupon?.couponCode,f=r.BestCoupon?.isStackable??!1,v=r.InitialPrice,A=r.MaxDiscount;let y=r?.Metadata,P=[];r.CouponResults&&(P=r.CouponResults),at.IS.includes(C)||C===e.BN.Sapphire?await this.SendDomMessage(t,new on(o,A,v,S,n,f,c,d,m),"Show Result Page",!0):await this.SendDomMessage(t,new tn(o,A,v,S,f),"Show Result Page",!0);const b=r.StartTime?Date.now()-r.StartTime:-1,E=new ct(a,this.entryPointService.GetEntryPoint());g&&(g.AutoApplyEnd=b,y||(y=new fn),y.AutoApplyTimeline=g);let T=o,I=A??0;if(o===e.ps.Error&&d){const t=c[0];(t?.discountValue||v&&t?.discountPercent)&&(T=e.ps.Positive,I=t?.discountValue??t?.discountPercent*v/100??0)}let O=i;u&&(O+=ho.AutoTriggered),E.SetResultData(T,b,S,P,I,v??0,f,s,At.Q.NavigationGuid??"",l,h,p,y,r?.TrueInitialPrice,r?.InitiallyAppliedCoupons),E.SetCurrencyInfo(r.Currency,r.PageCurrency);const D=e.R.AutoApply,k=e.in.Information;this.logService.LogClientEventV2(k,D,O,E)}async SendAutoApplyResultTelemetry(t,o,a,i,r,n,s,c,l,d,u,h){const p=i.BestCoupon?.couponCode,m=i.BestCoupon?.isStackable??!1,g=i.InitialPrice,C=i.MaxDiscount;let S=i?.Metadata,f=[];i.CouponResults&&(f=i.CouponResults);const v=i.StartTime?Date.now()-i.StartTime:-1,A=new ct(o,this.entryPointService.GetEntryPoint());h&&(h.AutoApplyEnd=v,S||(S=new fn),S.AutoApplyTimeline=h);let y=t,P=C??0;if(t===e.ps.Error&&c){const t=n[0];(t?.discountValue||g&&t?.discountPercent)&&(y=e.ps.Positive,P=t?.discountValue??t?.discountPercent*g/100??0)}let b=a;l&&(b+=ho.AutoTriggered),A.SetResultData(y,v,p,f,P,g??0,m,r,At.Q.NavigationGuid??"",s,d,u,S,i?.TrueInitialPrice,i?.InitiallyAppliedCoupons),A.SetCurrencyInfo(i.Currency,i.PageCurrency);const E=e.R.AutoApply,T=e.in.Information;this.logService.LogClientEventV2(T,E,b,A)}async UpdateCurrentCoupon(e,t,o,a,i,r){await this.SendDomMessage(e,new ht(t,o,a,i,r),"Update Current Coupon",!0)}async UpdateCurrency(e,t){await this.SendDomMessage(e,new un(t),"Update Currency",!0)}async OverlayVisible(e){return await this.IsFieldVisible(e,"#divOverlayWrapper","Check overlay visible")}async UpdateCheckoutProgress(e,t){await this.SendDomMessage(e,new Hr(t),"AutoapplyDone",!1)}async CloseOverlay(e){await this.SendDomMessage(e,new Wr,"Close Coupons Overlay",!1)}GetPositions(e,t){const o=100/t;return[o*e,o*(e+1)]}async CloseWalletDrawer(e,t){await this.SendDomMessage(e,new pn(t),"Stop Wallet Drawer Auto Apply and Autofill",!1)}async SkipCouponAutoApply(e){await this.SendDomMessage(e,new Sn,"Stop Wallet Drawer Auto Apply and Autofill",!1)}async WalletDrawerCreateOverlay(e){return this.SendDomMessage(e,new gn(e),"Wallet Drawer Create Overlay",!0)}async SendDomMessage(t,o,a,i){const r=[e.Vm.WalletDrawerCreateOverlayMessage,e.Vm.CloseOverlayMessage,e.Vm.WalletDrawerCloseMessage,e.Vm.WalletDrawerSkipCouponMessage,e.Vm.AutoApplyCancelledMessage,e.Vm.MoveProgressBarMessage];return this.EntryPointIsWallet()&&!r.includes(o.Type)?new Y.Z:super.SendDomMessage(t,o,a,i)}EntryPointIsWallet(){return this.entryPointService.GetEntryPoint()===e.N9.Wallet}async CreateOverlay(t,o,a,i,r,n,s,c){const l=this.GetPositions(s,a),d=this.platformSpecific.GetAppInfoClientName();if(at.IS.includes(d)||d===e.BN.Sapphire){const d=this.uxDataService.GetUXStyles(e.k2.Overlay);await this.SendDomMessage(t,new $r(t,o,s+1,a,l[0],l[0],i,r,d||"",n,c),"Edge Create Overlay",!0)}else await this.SendDomMessage(t,new zr(t,o,s+1,a,l[0],l[0],r,i),"Create Overlay",!0)}async GetUXData(e,t){return this.uxDataService.GetUX(e,t)}}(vn.GetPlatformInstance(),vn.GetLogService(),vn.GetUXDataService(),vn.GetEntryPointService())),(0,i.Z)(vn,"backgroundMessagingService",new class extends Fr{constructor(e,t){super(e),(0,i.Z)(this,"entryPointService",void 0),this.entryPointService=t}async HandleMessage(t){const o=t,a=o.Type,i=new Y.Z;if(a===e.Vm.EdgeApplyCouponsMessage){const t=o,a=t.checkoutPageData,i=await Lr.GetInstance().GetUIState(t.ContextID,t.Hostname,t.checkoutPageData);let r=!1;if(i&&i.HasState(gt.AutoApplyCancelled)&&(r=!0),t.startNew){const o=new ct(t.checkoutPageData.retailerData.domainName,this.entryPointService.GetEntryPoint(),t.metadata);o.AutoApplyScenario=bn.GetBackgroundAutoApplyService().GetAutoApplyScenario(),this.logService.LogClientEventV2(e.in.Information,e.R.AutoApply,"Auto Apply Initiated",o,a.impressionId)}Lr.GetInstance().ApplyCoupons(t.ContextID,a,t.startNew,r,void 0,t.metadata)}else if(a===e.Vm.UpdateRewardsData){const e=o,t=e.rewardsData;Lr.GetInstance().UpdateRewardsData(e.ContextID,t)}else{if(a!==e.Vm.BackgroundAutoApplyCancelledMessage)return super.HandleMessage(o);{const e=bn.GetBackgroundAutoApplyService();bn.GetBroadcastChannelService().setOnMessageEventHandler((t=>{e.BackgroundAutoApplyCancelHandler(t)})),e.SendCancelMesssageToBgAutoApply();const t=o;super.HandleMessage(new je(t.ContextID,t.Hostname,t.Pathname))}}return i}}(vn.GetLogService(),vn.GetEntryPointService())),(0,i.Z)(vn,"walletDrawerService",new class extends Tt{constructor(t,o,a){super(t),(0,i.Z)(this,"contextID",void 0),(0,i.Z)(this,"overlayService",void 0),(0,i.Z)(this,"localDataService",void 0),this.contextID=e.og.FromBackground,this.overlayService=o,this.localDataService=a}async HandleMessageFromHost(e,t){if(e===d.nz.CloseWalletCheckoutPane&&this.StopWalletDrawer(),e===d.nz.SkipCouponAutoApply&&this.SkipCouponAutoApply(),e===d.nz.RemoveAppliedCoupon){const e=this.localDataService.GetLocalData(Fe.Q.ApiResponse),t=x.Create(e);t?.retailerData?.UpdateCurrentCheckoutPage(location.pathname);const o=t?.retailerData?.GetCurrentCheckoutPage();let a=o?.removeCouponButtonSelector;if(a){let e="";const t=a.split(";");2===t.length&&(e=t[0],a=t[1]),await this.IsFieldVisible(this.contextID,e,"Click before remove visible")&&(await this.IsFieldVisible(this.contextID,a,"Remove coupon")||await this.SendDomMessage(this.contextID,new tt(le.Click,e,""),"click before remove",!1)),await this.IsFieldVisible(this.contextID,a,"Remove coupon")&&await this.SendDomMessage(this.contextID,new tt(le.Click,a,""),"remove coupon",!1)}}if(e===d.nz.PassDynamicSelectors){const e=t&&JSON.parse(t);this.localDataService.SaveLocalData(Fe.Q.DynamicSelectors,e)}}async ShowWalletOverlay(){this.overlayService.WalletDrawerCreateOverlay(this.contextID)}async StopWalletDrawer(){return this.overlayService.CloseWalletDrawer(this.contextID,!0)}async SkipCouponAutoApply(){return this.overlayService.SkipCouponAutoApply(this.contextID)}}(vn.GetPlatformInstance(),vn.GetOverlayService(),vn.GetLocalDataService())),(0,i.Z)(vn,"checkoutService",new class extends Tt{constructor(t,o,a,r,n,s){super(t),(0,i.Z)(this,"localDataService",void 0),(0,i.Z)(this,"overlayService",void 0),(0,i.Z)(this,"edgeMessageService",void 0),(0,i.Z)(this,"logService",void 0),(0,i.Z)(this,"entryPointService",void 0),(0,i.Z)(this,"contextId",void 0),(0,i.Z)(this,"expressCheckoutState",void 0),(0,i.Z)(this,"startTime",void 0),(0,i.Z)(this,"domainName",void 0),(0,i.Z)(this,"ccResponseMap",void 0),(0,i.Z)(this,"ccwaitingguids",void 0),(0,i.Z)(this,"allowedIfameOrigins",void 0),(0,i.Z)(this,"iframeEventHandler",void 0),(0,i.Z)(this,"selectorsNotFound",void 0),this.localDataService=o,this.overlayService=a,this.edgeMessageService=r,this.logService=n,this.entryPointService=s,this.contextId=e.og.FromBackground,this.expressCheckoutState=new Lt,this.ccResponseMap=new Map,this.ccwaitingguids=new Set,this.allowedIfameOrigins=new Set,this.iframeEventHandler=this.IframeEventHandler.bind(this),this.selectorsNotFound=[]}async StartExpressCheckout(){await this.StartExpressCheckoutAsync().catch((async e=>{e&&e.ErrorName===Ie.ECCancelled?(this.LogECEvent(Nt.Cancelled),this.edgeMessageService.SendExpressCheckoutClosedMessage()):e&&(e.ErrorName===Ie.Refresh&&await h.ZP.WaitForCondition((async()=>"true"===(0,Bt.Mw)(`${Fe._.StopRefreshTimeout}_${e.ErrorPageType}`)),8e3,1e3)?(0,Bt.TJ)(`${Fe._.StopRefreshTimeout}_${e.ErrorPageType}`):await this.HandleError(e))}))}async HandleError(t){if(this.expressCheckoutState.CheckoutProgress=F.FieldError,this.LogECEvent(Nt.Error,JSON.stringify(t)),this.edgeMessageService.SendExpressCheckoutErrorMessage(),this.EntryPointIsWallet()){const o=JSON.stringify({ErrorMsg:t.ErrorMsg,ErrorName:t.ErrorName,ErrorPageType:t.ErrorPageType,ErrorSource:e.N9.Wallet,SelectorsNotFound:this.selectorsNotFound});this.edgeMessageService.SendEdgeDriverStateChangeMessage(Ie.AutofillFail,JSON.stringify({reason:o})),await this.overlayService.CloseWalletDrawer(this.contextId)}await this.overlayService.ShowExpressCheckoutResult(this.contextId,!0,this.expressCheckoutState.IsAutoApplyIncluded,this.expressCheckoutState.CouponApplicatorState?.BestCoupon,this.expressCheckoutState.CouponApplicatorState?.InitialPrice,this.expressCheckoutState.CouponApplicatorState?.MaxDiscount,this.expressCheckoutState.CheckoutProgress)}async StartExpressCheckoutAsync(){this.startTime=Date.now();const t=this.localDataService.GetLocalData(Fe.Q.CheckoutElementsData);this.domainName=t.DomainName;const o=this.localDataService.GetLocalData(Fe.Q.ExpressCheckoutState);o?this.expressCheckoutState=o:(this.LogECEvent(Nt.Start),this.expressCheckoutState.IsAutoApplyIncluded=!1,this.expressCheckoutState.CouponApplicatorState=null,this.expressCheckoutState.CheckoutProgress=void 0),await this.overlayService.OpenExpressCheckoutOverlay(this.contextId,this.expressCheckoutState.IsAutoApplyIncluded,this.expressCheckoutState.CheckoutProgress),this.edgeMessageService.SendExpressCheckoutStartMessage(),await this.ApplyCheckoutUserData(e.og.FromBackground,t),this.edgeMessageService.SendExpressCheckoutCompletedMessage(),this.LogECEvent(Nt.Success),this.overlayService.ShowExpressCheckoutResult(this.contextId,!0,this.expressCheckoutState.IsAutoApplyIncluded,this.expressCheckoutState.CouponApplicatorState?.BestCoupon,this.expressCheckoutState.CouponApplicatorState?.InitialPrice,this.expressCheckoutState.CouponApplicatorState?.MaxDiscount,this.expressCheckoutState.CheckoutProgress)}async ApplyCheckoutUserData(t,o){const a=this.localDataService.GetLocalData(Fe.Q.CheckoutUserData),{IsSkipPayment:i,IsSkipProfile:r}=a,n=o?.AllPageTypeArr,s=this.getPagesObj(t,o,a),c=n?.map((e=>s[e]?.Category));let l=0;if(this.expressCheckoutState.CheckoutProgress){const t=n.find((e=>s[e]?.checkoutProgress===this.expressCheckoutState.CheckoutProgress));t&&((0,Bt.Xo)(`${Fe._.StopRefreshTimeout}_${t}`,"true"),l=n.indexOf(t),l===c.lastIndexOf("Shipping")&&i&&(await this.overlayService.UpdateCheckoutProgress(e.og.FromBackground,F.AddressDone),this.EntryPointIsWallet()&&this.edgeMessageService.SendEdgeDriverStateChangeMessage(F.AddressDone)),l++)}for(;l<n.length;l++){const o=n[l];if(!s[o])continue;const{Category:a,UpdatePage:d}=s[o];"Shipping"===a&&r||"Payment"===a&&i||(l===c.lastIndexOf("Shipping")?await d((async t=>{t&&"true"===t.Value?.toString()&&i||(await this.overlayService.UpdateCheckoutProgress(e.og.FromBackground,F.AddressDone),this.EntryPointIsWallet()&&this.edgeMessageService.SendEdgeDriverStateChangeMessage(F.AddressDone))})):l===c.lastIndexOf("Payment")?await d((async()=>{await this.overlayService.UpdateCheckoutProgress(t,F.PaymentDone),this.EntryPointIsWallet()&&this.edgeMessageService.SendEdgeDriverStateChangeMessage(F.PaymentDone)})):await d())}this.EntryPointIsWallet()&&await this.overlayService.CloseWalletDrawer(t)}async UpdatePaymentDetails(e,t,o){const a=t.AllcheckoutCompletionPages.get(Zt.PaymentIframe);t.AllcheckoutCompletionPages.get(Zt.Payment)&&await this.UpdatePaymentCardDetails(e,t,o),a&&await this.UpdatePaymentIframeDetails(e,t,o)}async UpdatePaymentCardDetails(e,t,o,a){const i=t.AllcheckoutCompletionPages.get(Zt.Payment),r=o.Profile,n=r?.Email??"";if(i?.CheckoutElements&&o.Payment){const t=o.Payment,r=i.CheckoutElements.get("WaitBeforePayment");r&&await h.ZP.Sleep(Number(r.Value));const s=i.CheckoutElements.get("clickBefore");s&&await this.ClickButtonWithWaiting(e,s,"Payment",void 0,void 0,void 0,2e3);const c=i.CheckoutElements.get("fillClickBefore");c&&await this.ClickButtonWithWaiting(e,c,"Payment");const l=i.CheckoutElements.get("fillClickBefore2");l&&await this.ClickButtonWithWaiting(e,l,"Payment");const d=i.CheckoutElements.get("visible");d&&await this.SendCheckoutDomMessage(e,new tt(le.Display,d.Value,""),"Visible",!1);const u=i.CheckoutElements.get("cardNumber");if(u){if(await h.ZP.WaitForCondition((async()=>await this.IsFieldVisible(e,u.Value,"cardNumber FieldVisible")),u.WaitForVisible||8e3),!await this.IsFieldVisible(e,u.Value,"cardNumber FieldVisible"))throw this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(u,"Payment")),new xt.Z("cardNumber field is not visible",Ie.ExecutionError,Zt.Payment);await this.SendCheckoutDomMessage(e,new tt(le.SetBoxValue,u.Value,t.CardNumber),"cardNumber",!1)}const p=i.CheckoutElements.get(Ft.CardType);p&&(await this.GetElementAndSetValue(i,Ft.CardType,t.CardType,"CardType","Payment"),await this.GetFieldValue(p?.Value)!==t.CardType&&await this.AgainFillSpecifiedFields(p,t.CardType)),await this.GetElementAndSetValue(i,Ft.Name,t.FullName,"Card Name","Payment"),await this.GetElementAndSetValue(i,Ft.FirstName,t.FirstName,"Card First Name","Payment"),await this.GetElementAndSetValue(i,Ft.MiddleName,t.MiddleName,"Card Middle Name","Payment"),await this.GetElementAndSetValue(i,Ft.LastName,t.LastName,"Card Last Name","Payment");const m=i.CheckoutElements.get(Ft.ExpiryMonth);if(m){const e=m.Format||"MM",o=this.GetFormattedExpiryDate(t,Gt.Month,e),a=i.CheckoutElements.get("expiryMonthConfirm");a?await this.OtherTagNameExpiryField(m?.Value,o,a?.Value):(await this.SetValue(m,o,"expiryMonth","Payment"),await this.GetFieldValue(m?.Value)!==o&&await this.AgainFillSpecifiedFields(m,o))}const g=i.CheckoutElements.get(Ft.ExpiryYear);if(g){const e=g.Format||"YYYY",o=this.GetFormattedExpiryDate(t,Gt.Year,e),a=i.CheckoutElements.get("expiryYearConfirm");a?await this.OtherTagNameExpiryField(g?.Value,o,a?.Value):(await this.SetValue(g,o,"expiryYear","Payment"),await this.GetFieldValue(g?.Value)!==o&&await this.AgainFillSpecifiedFields(g,o))}const C=i.CheckoutElements.get(Ft.ExpiryDate);if(C){let e="MM/YYYY";C.Format&&(e="1"===C.Format?"MM/YY":C.Format);const o=this.GetFormattedExpiryDate(t,Gt.MonthYear,e);await this.SetValue(C,o,"expiryDate","Payment")}await this.GetElementAndSetValue(i,Ft.Email,n,"Email update","Payment"),await this.GetElementAndSetValue(i,Ft.ConfirmEmail,n,"Confirm Email","Payment");const S=i.CheckoutElements.get("securityCode"),f=t.CardCVC;S&&f&&await this.SetValue(S,f,"securityCode","Payment");const v=i?.CheckoutElements.get(Ft.Continue);v&&await this.ClickButtonWithWaiting(e,v,"Payment",1e3,1e3);const A=i.CheckoutElements.get(Ft.FieldError);A&&A.Value&&await this.IsFieldVisible(e,A.Value,"Update payment details")&&await this.CheckAndThrowError(A,"updating payment",K.FieldError,Ie.ECFieldError,Zt.ContactInfo),a&&a()}}async UpdateBillingAddressDetails(e,t,o,a){const i=o?.Profile;this.EntryPointIsWallet()&&i&&this.edgeMessageService.SendEdgeDriverStateChangeMessage(F.BillingAddressStart);try{const o=t.AllcheckoutCompletionPages.get(Zt.BillingAddress);if(o?.CheckoutElements){const t=o?.CheckoutElements.get("WaitBeforeBillingAddress");t&&await h.ZP.Sleep(Number(t.Value));const r=o.CheckoutElements.get(Ft.RefreshAfterContinue);r&&"true"===r.Value?.toString()&&(0,Bt.Xo)(`${Fe._.StopRefreshTimeout}_${Zt.BillingAddress}`,"false");const n=o?.CheckoutElements.get("clickBefore");n&&await this.ClickButtonWithWaiting(e,n,"BillingAddress");const s=o?.CheckoutElements.get("useDifferentAddress"),c=o?.CheckoutElements.get("useShippingAddress"),l=o?.CheckoutElements.get("useDifferentAddressLabel"),d=o?.CheckoutElements.get("useShippingAddressLabel");"inputRadio"===s?.Type&&"inputRadio"===c?.Type&&l&&d?await this.ChangeUseDifferentAddrUseShippingAddr(s,l,c,d,i):(s&&await this.ChangeUseDifferentAddressCheckedStatus(s,l,i,e),c&&await this.ChangeUseShippingAddressCheckedStatus(c,d,i,e));const u=o?.CheckoutElements.get("fillClickBefore");u&&await this.ClickButtonWithWaiting(e,u,"BillingAddress");const p=o?.CheckoutElements.get("fillClickBefore2");if(p&&await this.ClickButtonWithWaiting(e,p,"BillingAddress"),i){const t=o.CheckoutElements.get(Ft.Address1);if(t){const a=t.WaitBefore;if(a&&await h.ZP.Sleep(a),await h.ZP.WaitForCondition((async()=>await this.IsFieldVisible(e,t.Value,"IsAddress FieldVisible")),t.WaitForVisible||8e3),!await this.IsFieldVisible(e,t.Value,"IsAddress FieldVisible")&&(this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(t,"BillingAddress")),!t.NotAlwaysShown))throw new xt.Z("Address1 field is not visible",Ie.ExecutionError,Zt.BillingAddress);const r=this.GetProfileData(i,Ft.Address1);r&&await this.TypeCheckoutFieldData(t.Value,r);const n=o.CheckoutElements.get("address1Confirm");n&&await this.ClickButtonWithWaiting(e,n,"BillingAddress",2e3,2e3,void 0,2e3)}await this.FillCheckoutElements(e,o,i,Ht.First,Zt.BillingAddress),await this.FillCheckoutElements(e,o,i,Ht.Second,Zt.BillingAddress);const a=o?.CheckoutElements.get("sameShippingAddress"),r=o?.CheckoutElements.get("sameShippingAddressLabel");if(a&&"checkBox"===a.Type&&r){const e=await this.SendDomMessage(this.contextId,new tt(le.GetCheckedValue,a.Value,"",K.CheckedValue),"get sameShippingAddress checked value",!1);e?.CheckedValue&&await this.Click(r.Value,K.Continue)}const n=o?.CheckoutElements.get("differentShippingAddress"),s=o?.CheckoutElements.get("differentShippingAddressLabel");if(n)if("checkBox"===n.Type&&s){const e=await this.SendDomMessage(this.contextId,new tt(le.GetCheckedValue,n.Value,"",K.CheckedValue),"get differentShippingAddress checked value",!1);e?.CheckedValue||await this.Click(s.Value,K.Continue)}else await this.Click(n.Value,K.Continue)}this.expressCheckoutState.CheckoutProgress=F.BillingAddressDone,this.edgeMessageService.SaveExpressCheckoutStatus(this.expressCheckoutState);const m=o?.CheckoutElements.get("continue");m&&await this.ClickButtonWithWaiting(e,m,"BillingAddress",3e3,3e3);const g=o.CheckoutElements.get("confirm");g&&g.Value&&await this.ClickButtonWithWaiting(e,g,"BillingAddress",2e3,2e3,void 0,2e3);const C=o?.CheckoutElements.get(Ft.Continue2);C&&await this.ClickButtonWithWaiting(e,C,"ShippingAddress",8e3,3e3,void 0,1e3);const S=o?.CheckoutElements.get(Ft.FieldError);if(S&&S.Value&&await this.IsFieldVisible(e,S.Value,"Update Billing Address")&&await this.CheckAndThrowError(S,"updating billing address",K.FieldError,Ie.ECFieldError,Zt.ContactInfo),this.EntryPointIsWallet()&&i&&this.edgeMessageService.SendEdgeDriverStateChangeMessage(F.BillingAddressSuccess),a&&a(),r&&"true"===r.Value?.toString())throw new xt.Z("error at updating billing adrress",Ie.Refresh,Zt.BillingAddress)}}catch(e){if(!this.EntryPointIsWallet()||!i||e.ErrorName===Ie.Refresh)throw e;this.edgeMessageService.SendEdgeDriverStateChangeMessage(F.BillingAddressFail),a&&a()}}getPagesObj(e,t,o){return{[Zt.ContactInfo]:{Category:"Shipping",UpdatePage:async a=>{await this.UpdateContactDetails(e,t,o,a)},checkoutProgress:F.ContactInfoDone},[Zt.ShippingAddress]:{Category:"Shipping",UpdatePage:async a=>{await this.UpdateShippingAddressDetails(e,t,o,a)},checkoutProgress:F.ShippingAddressDone},[Zt.ShippingOptions]:{Category:"Shipping",UpdatePage:async o=>{await this.UpdateShippingOptions(e,t,o)},checkoutProgress:F.ShippingOptionsDone},[Zt.Payment]:{Category:"Payment",UpdatePage:async a=>{await this.UpdatePaymentCardDetails(e,t,o,a)}},[Zt.PaymentIframe]:{Category:"Payment",UpdatePage:async a=>{await this.UpdatePaymentIframeDetails(e,t,o,a)}},[Zt.BillingAddress]:{Category:"Payment",UpdatePage:async a=>{if(this.EntryPointIsWallet()){const i=o?.Payment?.Address;let r;i&&(r=new Z,r.Profile=i),await this.UpdateBillingAddressDetails(e,t,r,a)}},checkoutProgress:F.BillingAddressDone}}}async ChangeUseDifferentAddrUseShippingAddr(e,t,o,a,i){if(i){const o=await this.SendDomMessage(this.contextId,new tt(le.GetCheckedValue,e.Value,"",K.CheckedValue),"get useDifferentAddress checked value",!1);o?.CheckedValue||await this.Click(t.Value,K.Continue)}else{const e=await this.SendDomMessage(this.contextId,new tt(le.GetCheckedValue,o.Value,"",K.CheckedValue),"get useShippingAddress checked value",!1);e?.CheckedValue||await this.Click(a.Value,K.Continue)}}async ChangeUseDifferentAddressCheckedStatus(e,t,o,a){if("checkBox"===e.Type&&t){const i=await this.SendDomMessage(this.contextId,new tt(le.GetCheckedValue,e.Value,"",K.CheckedValue),"get useDifferentAddress checked value",!1),r=i?.CheckedValue??"";(r&&!o||!r&&o)&&await this.IsFieldVisible(a,t.Value,`is ${t.Name} visible`)&&await this.Click(t.Value,K.Continue)}else o&&await this.IsFieldVisible(a,e.Value,`is ${e.Name} visible`)&&await this.Click(e.Value,K.Continue)}async ChangeUseShippingAddressCheckedStatus(e,t,o,a){if("checkBox"!==e.Type&&"input"!==e.Type||!t)o||await this.IsFieldVisible(a,e.Value,`is ${e.Name} visible`)&&await this.Click(e.Value,K.Continue);else{let i;if("checkBox"===e.Type){const t=await this.SendDomMessage(this.contextId,new tt(le.GetCheckedValue,e.Value,"",K.CheckedValue),"get useShippingAddress checked value",!1);i=t?.CheckedValue??""}else i="true"===await this.GetFieldValue(e.Value);(i&&o||!i&&!o)&&await this.IsFieldVisible(a,t.Value,`is ${t.Name} visible`)&&await this.Click(t.Value,K.Continue)}}async ChangeUseDifferFromBillingAddrUseBillingAddr(e,t){const o=await this.SendDomMessage(this.contextId,new tt(le.GetCheckedValue,e.Value,"",K.CheckedValue),"get useDifferentFromBillingAddress checked value",!1);o?.CheckedValue||await this.Click(t.Value,K.Continue)}async ChangeUseDifferentFromBillingAddressCheckedStatus(e,t,o){if("checkBox"===e.Type&&t){const a=await this.SendDomMessage(this.contextId,new tt(le.GetCheckedValue,e.Value,"",K.CheckedValue),"get useDifferentFromBillingAddress checked value",!1);a?.CheckedValue||await this.IsFieldVisible(o,t.Value,`is ${t.Name} visible`)&&await this.Click(t.Value,K.Continue)}else await this.IsFieldVisible(o,e.Value,`is ${e.Name} visible`)&&await this.Click(e.Value,K.Continue)}async ChangeUseBillingAddressCheckedStatus(e,t,o){if("checkBox"===e.Type&&t){const a=await this.SendDomMessage(this.contextId,new tt(le.GetCheckedValue,e.Value,"",K.CheckedValue),"get useBillingAddress checked value",!1);a?.CheckedValue&&await this.IsFieldVisible(o,t.Value,`is ${t.Name} visible`)&&await this.Click(t.Value,K.Continue)}}EntryPointIsWallet(){return this.entryPointService.GetEntryPoint()===e.N9.Wallet}async GetElementAndSetValue(e,t,o,a,i){const r=e.CheckoutElements.get(t);r&&this.SetValue(r,o,a,i)}async SetValue(e,t,o,a){e.WaitForVisible&&await h.ZP.WaitForCondition((async()=>await this.IsFieldVisible(this.contextId,e.Value,`is ${e.Name} visible`)),e.WaitForVisible),await this.IsFieldVisible(this.contextId,e.Value,`is ${e.Name} visible`)?await this.SendCheckoutDomMessage(this.contextId,new tt(le.SetBoxValue,e.Value,t),o,!1):this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(e,a))}getECTypeMetrics(){const{BNPLProvider:t,IsSkipPayment:o}=this.localDataService.GetLocalData(Fe.Q.CheckoutUserData),a=o&&!t;return t?e.qR.ECWithBNPL:a?e.qR.ECWithoutPayment:e.qR.ExpressCheckout}LogECEvent(t,o){const a=new wt(t,this.entryPointService.GetEntryPoint()),i=void 0!==this.startTime?Date.now()-this.startTime:0;a.ECProcessTime=i,a.Domain=this.domainName,a.ECType=this.getECTypeMetrics(),this.logService.LogClientEventV2(e.in.Information,e.R.ExpressCheckout,o??"",a)}async UpdateContactDetails(e,t,o,a){const i=t.AllcheckoutCompletionPages.get(Zt.ContactInfo),r=i?.CheckoutElements.get("WaitBeforeContactInfo");r&&await h.ZP.Sleep(Number(r.Value));const n=i?.CheckoutElements.get(Ft.ClickBefore);n&&await this.ClickButtonWithWaiting(e,n,"ContactInfo");const s=i?.CheckoutElements.get(Ft.Email);if(s&&s.Value&&(await h.ZP.WaitForCondition((async()=>await this.IsFieldVisible(e,s.Value,`is ${s.Name} visible`)),s.WaitForVisible||8e3),await this.IsFieldVisible(e,s.Value,"is Shipping Visible"))){const t=i?.CheckoutElements.get(Ft.RefreshAfterContinue);if(t&&"true"===t.Value?.toString()&&(0,Bt.Xo)(`${Fe._.StopRefreshTimeout}_${Zt.ContactInfo}`,"false"),i?.CheckoutElements&&o.Profile){const r=o.Profile;for(const t of i.CheckoutElements.keys()){const o=i.CheckoutElements.get(t);if(o){const t=this.GetProfileData(r,o.Name,o.Format);"input"!==o.Type&&"dropdown"!==o.Type||!t||(o.WaitForVisible&&await h.ZP.WaitForCondition((async()=>await this.IsFieldVisible(e,o.Value,`is ${o.Name} Visible`)),o.WaitForVisible),await this.IsFieldVisible(e,o.Value,`is ${o.Name} Visible`)?await this.TypeCheckoutFieldData(o.Value,t):this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(o,"ContactInfo")))}}const n=i.CheckoutElements.get(Ft.Signup);n&&n.Value&&"disableCheckBox"===n.Type&&await this.SendDomMessage(e,new tt(le.SetCheckBox,n.Value,"false"),"disable signup",!1),this.expressCheckoutState.CheckoutProgress=F.ContactInfoDone,this.edgeMessageService.SaveExpressCheckoutStatus(this.expressCheckoutState);const s=i?.CheckoutElements.get(Ft.Continue);s&&await this.ClickButtonWithWaiting(e,s,"ContactInfo",8e3,3e3,void 0,2e3);const c=i.CheckoutElements.get(Ft.FieldError);c&&c.Value&&await this.IsFieldVisible(e,c.Value,"Update Contact Details")&&await this.CheckAndThrowError(c,"updating contact details",K.FieldError,Ie.ECFieldError,Zt.ContactInfo);const l=i.CheckoutElements.get(Ft.FormError);if(l&&await this.IsFieldVisible(e,l.Value,"Update Contact Details")&&await this.CheckAndThrowError(l,"updating contact details",K.FormError,Ie.ECFormError,Zt.ContactInfo),a&&await a(t),t&&"true"===t.Value?.toString())throw new xt.Z("error at updating contact info",Ie.Refresh,Zt.ContactInfo)}}}async GetFieldValue(e){const t=await this.SendDomMessage(this.contextId,new tt(le.GetFieldValue,e,"",K.FieldValue),"",!1);return t?.FieldValue??void 0}async AgainFillSpecifiedFields(e,t){const o=Se.Z.GetFirstVisibleElement(e.Value);if("SELECT"===o?.tagName){const a=o.children,i=new Map;for(const e of a){const t=e?.innerHTML?.toUpperCase()?.trim(),o=e?.attributes?.getNamedItem("value");i.set(t,o?.value)}if([Ft.ExpiryMonth,Ft.ExpiryYear,Ft.CardType].includes(e.Name)){const o=i.get(t.toUpperCase());o&&await this.SetValue(e,o,e.Name,"Payment")}if(e.Name===Ft.State){const o=Ut();let a="";for(const e of o.keys())o.get(e)===t&&(a=i.get(e)||i.get(t));a&&await this.TypeCheckoutFieldData(e.Value,a)}if("country"===e.Name){const o=this.GetCountriesMap();let a="";const r=new Map;r.set("UNITED STATES","UNITED STATES OF AMERICA");for(const e of o.keys())if(e===t){const n=o.get(e);if(n){const e=n.get("1");e&&(a=i.get(e?.toUpperCase()?.trim())||i.get(t)||i.get(r.get(e?.toUpperCase()?.trim())))}}a&&await this.TypeCheckoutFieldData(e.Value,a)}}}async FillPhoneMultiInputs(e,t){const o=t.Value?.split(";"),a=new Map;let i=0;if(3!==o?.length)return!1;{const t=e.slice(0,3),i=e.slice(3,6),r=e.slice(6);a.set(o[0],t),a.set(o[1],i),a.set(o[2],r)}for(const e of a.keys()){await this.TypeCheckoutFieldData(e,a.get(e));const t=await this.SendDomMessage(this.contextId,new tt(le.GetFieldValue,e,"",K.FieldValue),"",!1),o=t?.FieldValue;o&&(i+=1)}return i===o?.length}async FillDateOfBirthField(e,t){const o=t?.Value?.split(";"),a=e.split("-");for(let e=0;e<o.length;e++)if(a[e])if(0===e)await this.TypeCheckoutFieldData(o[e],a[e]);else if(await this.TypeCheckoutFieldData(o[e],a[e]),!await this.GetFieldValue(o[e])){let t=a[e];Number(t)<10&&(t=a[e].slice(1)),await this.TypeCheckoutFieldData(o[e],t)}}async OtherTagNameExpiryField(e,t,o){await this.Click(e,K.FieldValue);const a=Se.Z.RunQuerySelectorAll(o);for(const e of a)e?.innerText?.includes(t)&&e.click()}async OtherTagNameCountryOrStateField(e,t,o){await this.Click(e?.Value,K.FieldValue);const a=Se.Z.RunQuerySelectorAll(o);if("country"===e?.Name){const e=this.GetCountriesMap(),o=[t],i=new Map;i.set("UNITED STATES","UNITED STATES OF AMERICA");for(const a of e.keys())t===a&&o.push(e.get(a)?.get("1")?.toUpperCase()),e.get(a)?.get("1")===t&&o.push(a);for(const e of o)i.get(e)&&o.push(i.get(e));for(const e of a)o?.includes(e?.innerText?.toUpperCase()?.trim())&&e.click()}if("state"===e?.Name){const e=Ut(),o=[t];for(const a of e.keys())e.get(a)===t&&o.push(a);for(const e of a)o?.includes(e?.innerText?.toUpperCase()?.trim())&&e.click()}}async FillCheckoutElements(e,t,o,a,i){const r=this.GetCountriesMap();for(const n of t.CheckoutElements.keys()){const s=["state","country"],c=t.CheckoutElements.get(n);if(c){const l=await this.GetFieldValue(c?.Value),d=this.GetProfileData(o,c.Name,c.Format);if("phone"===c?.Name&&c?.Value?.includes?.(";")&&d&&await this.FillPhoneMultiInputs(d,c))continue;if("dateOfBirth"===c?.Name&&d){await this.FillDateOfBirthField(d,c);continue}const u=s.includes(c.Name);if(a===Ht.First&&n===Ft.Address1||a===Ht.Second&&((u||"address1"===c.Name)&&l||!u&&"address1"!==c.Name&&l===d))continue;if(("input"===c.Type||"dropdown"===c.Type)&&d)if(c.WaitForVisible&&await h.ZP.WaitForCondition((async()=>await this.IsFieldVisible(e,c.Value,`is ${c.Name} Visible`)),c.WaitForVisible),await this.IsFieldVisible(e,c.Value,`is ${c.Name} Visible`)){if(await this.TypeCheckoutFieldData(c.Value,d),u){const e=await this.GetFieldValue(c?.Value),o=t.CheckoutElements.get(`${c?.Name}Confirm`);if(o){await this.OtherTagNameCountryOrStateField(c,d,o?.Value);continue}e&&r.get(e)||await this.AgainFillSpecifiedFields(c,d)}}else this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(c,i))}}}async UpdateShippingAddressDetails(e,t,o,a){const i=t.AllcheckoutCompletionPages.get(Zt.ShippingAddress);if(i?.CheckoutElements&&o.Profile){const t=o.Profile,r=i?.CheckoutElements.get("WaitBeforeShippingAddress");r&&await h.ZP.Sleep(Number(r.Value));const n=i.CheckoutElements.get(Ft.RefreshAfterContinue);n&&"true"===n.Value?.toString()&&(0,Bt.Xo)(`${Fe._.StopRefreshTimeout}_${Zt.ShippingAddress}`,"false");const s=i?.CheckoutElements.get("clickBefore");s&&await this.ClickButtonWithWaiting(e,s,"ShippingAddress",void 0,void 0,void 0,2e3);const c=i?.CheckoutElements.get("useDifferentFromBillingAddress"),l=i?.CheckoutElements.get("useBillingAddress"),d=i?.CheckoutElements.get("useDifferentFromBillingAddressLabel"),u=i?.CheckoutElements.get("useBillingAddressLabel");"inputRadio"===c?.Type&&"inputRadio"===l?.Type&&d&&u?await this.ChangeUseDifferFromBillingAddrUseBillingAddr(c,d):(c&&await this.ChangeUseDifferentFromBillingAddressCheckedStatus(c,d,e),l&&await this.ChangeUseBillingAddressCheckedStatus(l,u,e));const p=i?.CheckoutElements.get("fillClickBefore");p&&await this.ClickButtonWithWaiting(e,p,"ShippingAddress");const m=i?.CheckoutElements.get("fillClickBefore2");m&&await this.ClickButtonWithWaiting(e,m,"ShippingAddress");const g=i.CheckoutElements.get(Ft.Address1);if(g){if(await h.ZP.WaitForCondition((async()=>await this.IsFieldVisible(e,g.Value,"IsAddress FieldVisible")),g.WaitForVisible||8e3),!await this.IsFieldVisible(e,g.Value,"IsAddress FieldVisible"))throw this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(g,"ShippingAddress")),new xt.Z("Address1 field is not visible",Ie.ExecutionError,Zt.ShippingAddress);const o=this.GetProfileData(t,Ft.Address1);o&&await this.TypeCheckoutFieldData(g.Value,o);const a=i.CheckoutElements.get("address1Confirm");a&&await this.ClickButtonWithWaiting(e,a,"ShippingAddress",2e3,2e3,void 0,2e3)}await this.FillCheckoutElements(e,i,t,Ht.First,Zt.ShippingAddress),await this.FillCheckoutElements(e,i,t,Ht.Second,Zt.ShippingAddress);const C=i.CheckoutElements.get(Ft.Signup);C&&C.Value&&"disableCheckBox"===C.Type&&await this.SendDomMessage(e,new tt(le.SetCheckBox,C.Value,"false"),"disable signup",!1);const S=i?.CheckoutElements.get("sameBillingAddress"),f=i?.CheckoutElements.get("sameBillingAddressLabel");if(S&&"checkBox"===S.Type&&f){const e=await this.SendDomMessage(this.contextId,new tt(le.GetCheckedValue,S.Value,"",K.CheckedValue),"get sameBillingAddress checked value",!1),t=e?.CheckedValue??"";void 0!==S.ShouldValue?t!==S.ShouldValue&&await this.Click(f.Value,K.Continue):t||await this.Click(f.Value,K.Continue)}const v=i?.CheckoutElements.get("differentBillingAddress"),A=i?.CheckoutElements.get("differentBillingAddressLabel");if(v)if("checkBox"===v.Type&&A){const e=await this.SendDomMessage(this.contextId,new tt(le.GetCheckedValue,v.Value,"",K.CheckedValue),"get differentBillingAddress checked value",!1);e?.CheckedValue||await this.Click(A.Value,K.Continue)}else await this.Click(v.Value,K.Continue);this.EntryPointIsWallet()||await h.ZP.Sleep(1e3),this.expressCheckoutState.CheckoutProgress=F.ShippingAddressDone,this.edgeMessageService.SaveExpressCheckoutStatus(this.expressCheckoutState);const y=i?.CheckoutElements.get("continue");y&&await this.ClickButtonWithWaiting(e,y,"ShippingAddress",8e3,3e3,void 0,1e3);const P=i.CheckoutElements.get(Ft.FieldError);P&&P.Value&&await this.CheckAndThrowError(P,"Updating Shipping Address",K.FieldError,Ie.ECFieldError,Zt.ShippingAddress);const b=i.CheckoutElements.get(Ft.FormError);b&&b.Value&&await this.CheckAndThrowError(b,"Udpating Shipping Address",K.FormError,Ie.ECFormError,Zt.ShippingAddress);const E=i.CheckoutElements.get("confirm");E&&(E.DynamicFetch&&(y&&await h.ZP.WaitForCondition((async()=>await this.IsFieldNotDisabled(e,y.Value,`is ${y.Name} not disabled`)),1e4,1e3),this.edgeMessageService.SendEdgeDriverStateChangeMessage(F.DynamicSelectorFetch,JSON.stringify({PageType:"ShippingAddress",ElementName:"confirm"})),await h.ZP.WaitForCondition((async()=>{const e=this.localDataService.GetLocalData(Fe.Q.DynamicSelectors),t=e?.find((e=>"ShippingAddress"===e.PageType&&"confirm"===e.ElementName));return E.Value=t?.ElementValue,Boolean(t)}),1e4,1e3)),E.Value&&await this.ClickButtonWithWaiting(e,E,"ShippingAddress",2e3,2e3,void 0,2e3,E.DynamicFetch?8e3:void 0));const T=i?.CheckoutElements.get(Ft.Continue2);if(T&&await this.ClickButtonWithWaiting(e,T,"ShippingAddress",8e3,3e3,void 0,1e3),a&&await a(n),n&&"true"===n.Value?.toString())throw new xt.Z("error at updating shipping adrress",Ie.Refresh,Zt.ShippingAddress)}}async CheckAndThrowError(e,t,o,a,i){if(e&&e.Value&&await this.IsFieldVisible(this.contextId,e.Value,t)){const r=await this.SendDomMessage(this.contextId,new tt(le.GetInnerText,e.Value,"",o),o+" error",!1),n=r?.TextValue??"";throw new xt.Z("Error in "+t+":"+n,a,i)}}async UpdateShippingOptions(e,t,o){const a=t.AllcheckoutCompletionPages.get(Zt.ShippingOptions),i=a?.CheckoutElements;if(i){const t=i.get("WaitBeforeShippingOptions");t&&await h.ZP.Sleep(Number(t.Value));const a=i.get(Ft.Check);if(a&&a.Value){await h.ZP.WaitForCondition((async()=>await this.IsFieldVisible(e,a.Value,`is ${a.Name} visible`)),a.WaitForVisible||8e3);const t=await this.IsFieldVisible(e,a.Value,"is Shipping Visible"),r=i.get(Ft.RefreshAfterContinue);if(t){r&&"true"===r.Value?.toString()&&(0,Bt.Xo)(`${Fe._.StopRefreshTimeout}_${Zt.ShippingOptions}`,"false"),this.expressCheckoutState.CheckoutProgress=F.ShippingOptionsDone,this.edgeMessageService.SaveExpressCheckoutStatus(this.expressCheckoutState);const t=i.get(Ft.Continue);t&&await this.ClickButtonWithWaiting(e,t,"ShippingOptions",8e3,5e3,void 0,void 0);const a=i.get(Ft.Continue2);if(a&&await this.ClickButtonWithWaiting(e,a,"ShippingOptions",8e3,5e3,void 0,void 0),o&&await o(r),r&&"true"===r.Value?.toString())throw new xt.Z("error at updating Shipping Options",Ie.Refresh,Zt.ShippingOptions)}else o&&await o(r),this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(a,"ShippingOptions"))}}}IframeEventHandler(e){if(this.allowedIfameOrigins.add(location.origin),e.data){const t=e.data,o=t.guid;if(o&&this.ccwaitingguids.has(o)){const e=t.status;this.ccResponseMap.set(o,e),this.ccwaitingguids.delete(o)}}}async UpdatePaymentIframeDetails(e,t,o,a){const i=o.Payment,r=t.AllcheckoutCompletionPages.get(Zt.PaymentIframe);if(r&&i){const n=r?.CheckoutElements.get("WaitBeforePaymentIframe");n&&await h.ZP.Sleep(Number(n.Value));const s=r.CheckoutElements.get("WaitForIframeResponse")?.Value,c=r?.CheckoutElements.get("clickBefore");c&&await this.ClickButtonWithWaiting(e,c,"PaymentIframe",void 0,void 0,void 0,2e3);const l=r.CheckoutElements.get("fillClickBefore");l&&await this.ClickButtonWithWaiting(e,l,"Payment");const d=r.CheckoutElements.get("fillClickBefore2");d&&await this.ClickButtonWithWaiting(e,d,"Payment"),window.addEventListener("message",this.iframeEventHandler);const u=t.AllCheckoutCompletionPagesStr,p=r.CheckoutElements.get("cardNumberIframe");if(!p)throw new xt.Z("card number iframe undefined.",Ie.IframeSelectorNotFound,Zt.PaymentIframe);if(await h.ZP.WaitForCondition((async()=>await this.IsFieldVisible(e,p.Value,"Iframe FieldVisible")),p.WaitForVisible||1e4),!await this.IsFieldVisible(e,p.Value,"card number Iframe FieldVisible"))throw this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(p,"PaymentIframe")),new xt.Z("card number iframe undefined.",Ie.IframeSelectorNotFound,Zt.PaymentIframe);const m=r.CheckoutElements.get("cardNumberIframeOrigin"),g=r.CheckoutElements.get("cardNumber");p&&g&&(await h.ZP.Sleep(p.WaitBefore||1e3),await this.UpdateIframePaymentField(e,_t.CCNUpdate,u,p,m?.Value||"",o.Payment.CardNumber,s,g));const C=r.CheckoutElements.get("nameOnCardIframe"),S=r.CheckoutElements.get("nameOnCardIframeOrigin"),f=r.CheckoutElements.get("nameOnCard"),v=o.Payment.FullName??o.Profile.FullName;C&&f&&(await h.ZP.WaitForCondition((async()=>await this.IsFieldVisible(e,C.Value,"card name FieldVisible")),C.WaitForVisible||1e4),await this.IsFieldVisible(e,C.Value,"card name FieldVisible")||this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(C,"PaymentIframe")),C.WaitBefore&&await h.ZP.Sleep(C.WaitBefore),await this.UpdateIframePaymentField(e,_t.CCName,u,C,S?.Value||"",v,s,f));const A=r.CheckoutElements.get("firstNameIframe"),y=r.CheckoutElements.get("firstNameIframeOrigin"),P=r.CheckoutElements.get("firstName"),b=o.Payment.FirstName??o.Profile.FirstName;A&&y&&P&&(await h.ZP.WaitForCondition((async()=>await this.IsFieldVisible(e,A.Value,"card firstName FieldVisible")),A.WaitForVisible||1e4),await this.IsFieldVisible(e,A.Value,"card firstName FieldVisible")||this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(A,"PaymentIframe")),A.WaitBefore&&await h.ZP.Sleep(A.WaitBefore),await this.UpdateIframePaymentField(e,_t.CCFirstName,u,A,y.Value,b,s,P));const E=r.CheckoutElements.get("middleNameIframe"),T=r.CheckoutElements.get("middleNameIframeOrigin"),I=r.CheckoutElements.get("middleName"),O=o.Payment.MiddleName??o.Profile.MiddleName;E&&T&&I&&(await h.ZP.WaitForCondition((async()=>await this.IsFieldVisible(e,E.Value,"card middleName FieldVisible")),E.WaitForVisible||1e4),await this.IsFieldVisible(e,E.Value,"card middleName FieldVisible")||this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(E,"PaymentIframe")),E.WaitBefore&&await h.ZP.Sleep(E.WaitBefore),await this.UpdateIframePaymentField(e,_t.CCMiddleName,u,E,T.Value,O,s,I));const D=r.CheckoutElements.get("lastNameIframe"),k=r.CheckoutElements.get("lastNameIframeOrigin"),R=r.CheckoutElements.get("lastName"),w=o.Payment.LastName??o.Profile.LastName;D&&k&&R&&(await h.ZP.WaitForCondition((async()=>await this.IsFieldVisible(e,D.Value,"card lastName FieldVisible")),D.WaitForVisible||1e4),await this.IsFieldVisible(e,D.Value,"card lastName FieldVisible")||this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(D,"PaymentIframe")),D.WaitBefore&&await h.ZP.Sleep(D.WaitBefore),await this.UpdateIframePaymentField(e,_t.CCLastName,u,D,k.Value,w,s,R));const N=r.CheckoutElements.get("expiryIframe"),x=r.CheckoutElements.get("expiryIframeOrigin"),_=r.CheckoutElements.get("expiry");N&&x&&_&&(await h.ZP.WaitForCondition((async()=>await this.IsFieldVisible(e,N.Value,"expiry FieldVisible")),N.WaitForVisible||1e4),await this.IsFieldVisible(e,N.Value,"expiry FieldVisible")||this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(N,"PaymentIframe")),N.WaitBefore&&await h.ZP.Sleep(N.WaitBefore),await this.UpdateIframePaymentField(e,_t.CCExpiry,u,N,x.Value,this.GetFormattedExpiryDate(i,Gt.MonthYear,_?.Format||"MM/YY"),s,_));const U=r.CheckoutElements.get("expiryMonthIframe"),B=r.CheckoutElements.get("expiryMonthIframeOrigin"),M=r.CheckoutElements.get("expiryMonth");U&&M&&(await h.ZP.WaitForCondition((async()=>await this.IsFieldVisible(e,U.Value,"expiry month FieldVisible")),U.WaitForVisible||1e4),await this.IsFieldVisible(e,U.Value,"expiry month FieldVisible")||this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(U,"PaymentIframe")),U.WaitBefore&&await h.ZP.Sleep(U.WaitBefore),await this.UpdateIframePaymentField(e,_t.CCExpiryMonth,u,U,B?.Value||"",this.GetFormattedExpiryDate(i,Gt.Month,M?.Format||"MM"),s,M));const L=r.CheckoutElements.get("expiryYearIframe"),F=r.CheckoutElements.get("expiryYearIframeOrigin"),Z=r.CheckoutElements.get("expiryYear");L&&Z&&(await h.ZP.WaitForCondition((async()=>await this.IsFieldVisible(e,L.Value,"expiry year FieldVisible")),L.WaitForVisible||1e4),await this.IsFieldVisible(e,L.Value,"expiry year FieldVisible")||this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(L,"PaymentIframe")),L.WaitBefore&&await h.ZP.Sleep(L.WaitBefore),await this.UpdateIframePaymentField(e,_t.CCExpiryYear,u,L,F?.Value||"",this.GetFormattedExpiryDate(i,Gt.Year,Z?.Format||"YYYY"),s,Z));const G=r.CheckoutElements.get("securityCodeIframe"),H=r.CheckoutElements.get("securityCodeIframeOrigin"),V=r.CheckoutElements.get("securityCode"),W=i.CardCVC;G&&W&&V&&(await h.ZP.WaitForCondition((async()=>await this.IsFieldVisible(e,G.Value,"securityCode FieldVisible")),G.WaitForVisible||1e4),await this.IsFieldVisible(e,G.Value,"securityCode FieldVisible")||this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(G,"PaymentIframe")),await h.ZP.Sleep(G.WaitBefore||1e3),await this.UpdateIframePaymentField(e,_t.CCSecurityCode,u,G,H?.Value||"",W,s,V)),window.removeEventListener("message",this.iframeEventHandler),a&&a()}}async UpdateIframePaymentField(e,t,o,a,i,r,n,s){const c=this.localDataService.GetLocalData(Fe.Q.ExpressCheckoutState);if(this.EntryPointIsWallet()&&c===F.CancelEC)throw new xt.Z("ExpressCheckout cancelled",Ie.ECCancelled,Zt.PaymentIframe);const l=await this.SendDomMessage(e,new tt(le.IframeOrigin,a.Value,"",K.IframeOrigin),"Calling iframe origin",!1);if(i&&l.TextValue!==i){const e=new he(this.domainName,se.ECFrameOriginMisMatch,{EntryPoint:this.entryPointService.GetEntryPoint(),frameOrigin:l.TextValue},void 0);throw this.logService.LogClientErrorV2("wrong iframe origin",e),new xt.Z("wrong iframe origin",Ie.IframeOriginInvalid,Zt.PaymentIframe)}this.allowedIfameOrigins.add(i);const d=(await this.SendDomMessage(e,new tt(le.SelectorName,a.Value,"",K.IframeName),"Calling iframe name",!1)).TextValue;d||new he(this.domainName,se.ECFrameNameUndefined,{EntryPoint:this.entryPointService.GetEntryPoint(),frameOrigin:l.TextValue},void 0);const u=G.Z.uuidv4(),p={AllCheckoutCompletionPagesStr:o,CommandName:t,Guid:u,ParentOrigin:location.origin,Value:r},m=[u,d,JSON.stringify(p)];this.ccwaitingguids.add(u),this.edgeMessageService.SendIframeMessage(m),await h.ZP.WaitForCondition((async()=>this.ccResponseMap.has(u)),Number(n)||8e3);const g=this.ccResponseMap.get(u);if(!g){const e={EntryPoint:this.entryPointService.GetEntryPoint(),command:t,iframeName:d},o=new he(this.domainName,se.ECIframeResponseNotReceived,e,void 0);throw this.logService.LogClientErrorV2("iframe response not received.",o),this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(s,"PaymentIframe")),new xt.Z("iframe response not received",Ie.IframePaymentFail,Zt.PaymentIframe)}if("SUCCESS"!==g)throw this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(s,"PaymentIframe")),new xt.Z("iframe response is ERROR",Ie.IframePaymentFail,Zt.PaymentIframe)}GetFormattedExpiryDate(e,t,o){let a="";return t===Gt.MonthYear?a="MM/YY"===o?e.ExpMonth+"/"+e.ExpYear?.substr(e.ExpYear.length-2):e.ExpMonth+"/"+e.ExpYear:t===Gt.Month?a="M"===o?parseInt(e.ExpMonth,10)?.toString():e.ExpMonth:t===Gt.Year&&(a="YY"===o?e.ExpYear?.slice(-2):e.ExpYear),a}async SendCheckoutDomMessage(e,t,o,a){if(this.localDataService.GetLocalData(Fe.Q.ExpressCheckoutState)===F.CancelEC)throw new xt.Z("ExpressCheckout cancelled",Ie.ECCancelled);await this.SendDomMessage(e,t,o,a)}GetFormattedPhoneNumber(e,t){let o=e.replace(/\D/g,"");if(o&&o.length>=10&&(o=o.substr(o.length-10)),t&&"1"===t){const e=o.match(/^(\d{3})(\d{3})(\d{4})$/);if(e)return"("+e[1]+") "+e[2]+"-"+e[3]}return o}GetProfileData(e,t,o){if(e)switch(t){case"email":case"confirmEmail":return e.Email;case"name":return e.FullName;case"firstName":return e.FirstName;case"middleName":return e.MiddleName;case"lastName":return e.LastName;case"company":return e.Company;case"address1":return this.GetAddressLine1(e.AddressLines);case"address2":return this.GetAddressLine2(e.AddressLines);case"city":return e.City;case"state":return(e=>{const t=Ut(),o=new Set(t.values()),a=e.toUpperCase();if(o.has(a))return[a,!0];const i=t.get(a);return void 0!==i?[i,!0]:[a,!1]})(e.State)[0];case"country":return this.GetCountry(e.Country,o);case"zipCode":return this.GetZip(e.Zip,o);case"phone":return this.GetFormattedPhoneNumber(e.PhoneNumber,o);case"dateOfBirth":return e.DateOfBirth}}GetZip(e,t){return t&&"1"===t?e.substr(0,5):e}GetCountry(e,t){if(!t)return e;const o=this.GetCountriesMap().get(e);if(void 0!==o){const e=o.get(t);if(void 0!==e)return e}return e}GetAddressLine1(e){if(e){const t=e.split("\n");if(t.length>=1){const e=t[0];return e.endsWith(",")?e.substring(0,e.length-1):e}}return""}GetAddressLine2(e){if(e){const t=e.split("\n");if(t.length>=2)return t[1]??""}return""}async Click(t,o){await this.SendCheckoutDomMessage(e.og.FromBackground,new tt(le.Click,t,"",o),o,!0)}async TypeCheckoutFieldData(t,o){await this.SendCheckoutDomMessage(e.og.FromBackground,new tt(le.SetBoxValue,t,o),"Checkout field input box",!0)}GetCountriesMap(){const e=new Map,t=new Map,o=new Map,a=new Map,i=new Map,r=new Map,n=new Map,s=new Map,c=new Map,l=new Map;return t.set("1","United States"),o.set("1","Canada"),a.set("1","Australia"),i.set("1","France"),r.set("1","Japan"),n.set("1","Mexico"),s.set("1","Brazil"),c.set("1","United Kingdom"),l.set("1","India"),e.set("US",t),e.set("CA",o),e.set("AU",a),e.set("FR",i),e.set("JP",r),e.set("MX",n),e.set("BR",s),e.set("GB",c),e.set("IN",l),e}async ClickButtonWithWaiting(e,t,o,a,i,r,n,s){const c=t.WaitForVisible||a,l=t.WaitForNotDisabled||i,d=t.WaitBefore||r,u=t.WaitAfter||n,p=t.WaitForNotVisible||s;c&&await h.ZP.WaitForCondition((async()=>await this.IsFieldVisible(e,t.Value,`is ${t.Name} visible`)),c),await this.IsFieldVisible(e,t.Value,`is ${t.Name} visible`)?(l&&await h.ZP.WaitForCondition((async()=>await this.IsFieldNotDisabled(e,t.Value,`is ${t.Name} not disabled`)),l),d&&await h.ZP.Sleep(d),await this.Click(t.Value,K.Continue),u&&await h.ZP.Sleep(u),p&&await h.ZP.WaitForCondition((async()=>!await this.IsFieldVisible(e,t.Value,`is ${t.Name} visible`)),p,1e3)):this.selectorsNotFound.push(this.GetSelectorsNotFoundItem(t,o))}GetSelectorsNotFoundItem(e,t){return{Element:e,PageType:t}}}(vn.GetPlatformInstance(),vn.GetLocalDataService(),vn.GetOverlayService(),vn.GetEdgeMessageService(),vn.GetLogService(),vn.GetEntryPointService())),(0,i.Z)(vn,"otherSellersService",new class extends Tt{constructor(t,o,a,r){super(t),(0,i.Z)(this,"overlayService",void 0),(0,i.Z)(this,"edgeMessageService",void 0),(0,i.Z)(this,"logService",void 0),(0,i.Z)(this,"checkoutPageData",void 0),(0,i.Z)(this,"checkoutPageUrlData",void 0),(0,i.Z)(this,"otherSellerData",void 0),(0,i.Z)(this,"iframeID","OtherSellersIframe"),(0,i.Z)(this,"contextId",void 0),this.logService=o,this.overlayService=a,this.edgeMessageService=r,this.contextId=e.og.FromBackground}async AddToCart(t,o){if(this.edgeMessageService.SendOtherSellersStartMessage(),this.checkoutPageData=t,this.otherSellerData=o,!this.InitializeCheckoutPageUrlData(t))return;let a="";if(!o)return a="Called OtherSellerService with empty storage data",void this.FinalizeOtherSellersScenario(e.Kg.Error,0,0,"",a);this.AddOtherItemToCart().catch((t=>{a="Unknown OtherSellersService error: "+t,this.FinalizeOtherSellersScenario(e.Kg.Error,0,0,"",a)}))}GetOtherSellerDiscount(){const e=this.otherSellerData?.OtherSeller?.OriginalItemPrice,t=this.otherSellerData?.OtherSeller?.ItemPrice;if(e&&t){const o=e-t;return Math.round(100*o)/100}return-1}async AddOtherItemToCart(){const t=this.GetOtherSellerDiscount();let o="$";(0,Bo.TF)(this.otherSellerData?.OtherSeller?.Currency)||(o=this.otherSellerData.OtherSeller.Currency),await this.overlayService.UpdateCurrency(e.og.FromBackground,o),await this.overlayService.OpenOverlay(this.contextId,"OtherSeller",1,t,this.checkoutPageUrlData,0);const a=this.otherSellerData?.OtherSeller?.ItemIndex,i=this.otherSellerData?.OtherSeller?.OriginalItemPrice??-1;return await this.AddItemToCart(a,t,i,o)}async AddItemToCart(t,o,a,i){let r="";if(void 0===t)return await this.overlayService.MoveProgressBar(this.contextId,1,1),r="Unable to get item: ItemIndex was null",this.FinalizeOtherSellersScenario(e.Kg.Error,o,a,i,r),!1;const n=document.querySelectorAll("#"+this.iframeID)[0],s=n?.contentDocument?.body,c=s?.querySelectorAll(this.checkoutPageUrlData.otherSellerSelectors.otherSellerOfferElementSelector);if(!c||c.length<=t)return await this.overlayService.MoveProgressBar(this.contextId,1,1),r="Unable to find list of sellers element",this.FinalizeOtherSellersScenario(e.Kg.Error,o,a,i,r),!1;const l=c[t];return this.checkoutPageData.retailerData.domainName.includes("amazon")?this.AddItemToAmazonCart(n,l,o,a,i):"walmart.com"===this.checkoutPageData.retailerData.domainName?this.AddItemToWalmartCart(n,l,o,a,i):void 0}async AddItemToAmazonCart(t,o,a,i,r){const n=this.checkoutPageUrlData.otherSellerSelectors.otherSellerAddButtonSelector,s=this.checkoutPageUrlData.otherSellerSelectors.otherSellerAddedConfirmationSelector,c=o.querySelector(n),l=o.querySelector(s);let d;if(l&&(d=l.children),c&&d){c.click();let t=-1;await h.ZP.WaitForCondition((async()=>{if(d){for(let e=0;e<d.length;e++)d[e].className.includes("hidden")||(t=e);return-1!==t}return!1}),7e3);let o=!1;-1!==t&&(o=d[t].className.includes("success")),await this.overlayService.MoveProgressBar(this.contextId,1,1),o?this.FinalizeOtherSellersScenario(e.Kg.Positive,a,i,r):this.FinalizeOtherSellersScenario(e.Kg.Negative,a,i,r)}else if(c){const o="gp/huc";if(c.click(),await h.ZP.WaitForCondition((async()=>!0===t?.contentDocument?.location?.href?.includes(o)),5e3),await this.overlayService.MoveProgressBar(this.contextId,1,1),t?.contentDocument?.location?.href?.includes(o)){t=document.querySelectorAll("#"+this.iframeID)[0];const o=t?.contentDocument?.body,n=o?.querySelector("[id*='order-row-confirm-text']");n&&n.className?.includes("success")?this.FinalizeOtherSellersScenario(e.Kg.Positive,a,i,r):this.FinalizeOtherSellersScenario(e.Kg.Negative,a,i,r)}else this.FinalizeOtherSellersScenario(e.Kg.Negative,a,i,r)}else{await this.overlayService.MoveProgressBar(this.contextId,1,1);const t="Unable to find add button";this.FinalizeOtherSellersScenario(e.Kg.Negative,a,i,r,t)}return!0}async AddItemToWalmartCart(t,o,a,i,r){const n=this.checkoutPageUrlData.otherSellerSelectors.otherSellerAddButtonSelector,s=this.checkoutPageUrlData.otherSellerSelectors.otherSellerAddedConfirmationSelector,c=o.querySelector(n);let l=0,d=0,u=!1;if(c){if(c.getAttribute("aria-label")?.includes("in cart")){c.click(),l=this.GetItemQuantity(o,s);const e=o.querySelector(n);e&&e?.click(),d=this.GetItemQuantity(o,s),d===l+1&&(u=!0)}else c.getAttribute("aria-label")?.includes("Add to cart")&&(c.click(),d=this.GetItemQuantity(o,s),d===l+1&&(u=!0));let p;await h.ZP.WaitForCondition((async()=>(p=t?.contentDocument?.body.querySelector(this.checkoutPageUrlData.errorMessageSelector),null!=p)),3e3),p=t?.contentDocument?.body.querySelector(this.checkoutPageUrlData.errorMessageSelector),p&&(u=!1),await this.overlayService.MoveProgressBar(this.contextId,1,1),u?this.FinalizeOtherSellersScenario(e.Kg.Positive,a,i,r):this.FinalizeOtherSellersScenario(e.Kg.Negative,a,i,r)}else{await this.overlayService.MoveProgressBar(this.contextId,1,1);const t="Unable to find add button";this.FinalizeOtherSellersScenario(e.Kg.Negative,a,i,r,t)}return!0}GetItemQuantity(e,t){const o=e.querySelector(t),a=o?.innerText.match(/[0-9]+/);return a&&a.length>0?parseFloat(a[0]):0}FinalizeOtherSellersScenario(t,o,a,i,r){let n="";if(t===e.Kg.Positive){const e=(0,Ee.Vv)(i)??"USD";this.edgeMessageService.SendOtherSellersCompleteMessage(a,o,e),n="Finished Adding item to cart"}else this.edgeMessageService.SendOtherSellersErrorMessage(),n="Unable to add item to cart";const s=new Zr.Z;s.SetResultData(this.checkoutPageData.retailerData.domainName,o,a,i,i,t),this.logService.LogClientEventV2(e.in.Information,e.R.OtherSellers,r??n,s,this.checkoutPageData?.impressionId);const c={ProductAddedNotification:!0,Url:location.pathname};this.edgeMessageService.SetStorageValue("OtherSellersNotificationData_"+location.pathname,JSON.stringify({value:JSON.stringify(c)})),location.reload()}InitializeCheckoutPageUrlData(t){const o=t.retailerData.GetCurrentCheckoutPage();if(o)return this.checkoutPageUrlData=o,!0;{const t="Called OtherSellerService when not on a checkout page";return this.FinalizeOtherSellersScenario(e.Kg.Error,0,0,"",t),!1}}}(vn.GetPlatformInstance(),vn.GetLogService(),vn.GetOverlayService(),vn.GetEdgeMessageService())),(0,i.Z)(vn,"broadcastChannelService",kt.GetInstance()),(0,i.Z)(vn,"backgroundAutoApplyService",new Ot(vn.GetPlatformInstance(),vn.GetLogService(),vn.GetOverlayService(),vn.GetEdgeMessageService(),vn.GetApplicatorStateService(),vn.GetBroadcastChannelService(),vn.GetEntryPointService())),(0,i.Z)(vn,"checkoutPaymentUpdateService",new class{constructor(t,o,a,r,n,s){(0,i.Z)(this,"checkoutService",void 0),(0,i.Z)(this,"contextId",void 0),(0,i.Z)(this,"localDataService",void 0),(0,i.Z)(this,"edgeMessageService",void 0),(0,i.Z)(this,"overlayService",void 0),(0,i.Z)(this,"logService",void 0),(0,i.Z)(this,"entryPointService",void 0),this.checkoutService=t,this.contextId=e.og.FromBackground,this.localDataService=o,this.edgeMessageService=a,this.overlayService=r,this.logService=n,this.entryPointService=s}async UpdatePaymentDetails(e,t){this.localDataService.SaveLocalData(Fe.Q.ExpressCheckoutState,F.AddressDone);const o=new m.Z(e),a=this.GetUserData(t),i=Date.now();try{await this.overlayService.OpenExpressCheckoutUpdatePaymentOverlay(this.contextId),await this.checkoutService.UpdatePaymentDetails(this.contextId,o,a),await this.checkoutService.UpdateBillingAddressDetails(this.contextId,o,a),this.edgeMessageService.SendUpdatePaymentDetailsResultMessage(!0),this.LogUpdatePaymentDetailsStatus(!0,i,o.DomainName),this.EntryPointIsWallet()&&(this.edgeMessageService.SendEdgeDriverStateChangeMessage(F.BNPLPaymentSuccess),await this.overlayService.CloseWalletDrawer(this.contextId))}catch(e){this.edgeMessageService.SendUpdatePaymentDetailsResultMessage(!1),this.LogUpdatePaymentDetailsStatus(!1,i,o.DomainName,e),this.EntryPointIsWallet()&&(this.edgeMessageService.SendEdgeDriverStateChangeMessage(F.BNPLPaymentFail),await this.overlayService.CloseWalletDrawer(this.contextId))}await this.overlayService.CloseOverlay(this.contextId)}EntryPointIsWallet(){return this.entryPointService.GetEntryPoint()===e.N9.Wallet}GetUserData(e){const t=new Z;return t.Payment=L.CreateFromCheckoutData(e),t.Profile=U.CreateFromCheckoutData(e),t}LogUpdatePaymentDetailsStatus(t,o,a,i){const r=new wt(t?Nt.BNPLSuccess:Nt.BNPLFailed,this.entryPointService.GetEntryPoint());if(r.ECProcessTime=Date.now()-o,r.ECType=e.qR.ECWithBNPL,this.logService.LogClientEventV2(e.in.Information,e.R.ExpressCheckout,"UpdatePaymentDetails",r),!t&&i){const e=new he(a,se.ExpressCheckoutBNPLFailed,{EntryPoint:this.entryPointService.GetEntryPoint()},i.stack);this.logService.LogClientErrorV2("UpdatePaymentDetails failed",e)}}}(vn.GetCheckoutService(),vn.GetLocalDataService(),vn.GetEdgeMessageService(),vn.GetOverlayService(),vn.GetLogService(),vn.GetEntryPointService())),(0,i.Z)(vn,"instantAddToCartService",new class extends Tt{constructor(t,o,a,r){super(t),(0,i.Z)(this,"overlayService",void 0),(0,i.Z)(this,"contextId",void 0),(0,i.Z)(this,"logService",void 0),(0,i.Z)(this,"localDataService",void 0),this.overlayService=o,this.contextId=e.og.FromBackground,this.logService=a,this.localDataService=r}async LaunchInstantATCOverlay(e,t){yt.Z.CreateNew(this.contextId,e.impressionId);const o=e.retailerData.GetCurrentCheckoutPage();if(!o)return this.LogOverlayTelemetry(t,!1,!0),!1;if(!await bn.GetICDriverService().IsAddToCartEnabled(o,t))return this.LogOverlayTelemetry(t,!1,!0),!1;try{this.LogOverlayTelemetry(t,!1),await this.overlayService.OpenInstantAddToCartOverlay(this.contextId,t),setTimeout((async()=>{await this.overlayService.MoveProgressBar(this.contextId,1,1)}),2e3),setTimeout((async()=>{await this.overlayService.OpenSuccessInstantAddToCartOverlay(this.contextId,t)}),4e3),setTimeout((async()=>{await bn.GetICDriverService().HandleAddToCart(o,t)}),6e3),setTimeout((async()=>{await this.overlayService.CloseOverlay(this.contextId)}),7e3)}catch(e){this.LogOverlayTelemetry(t,!0)}}LogOverlayTelemetry(t,o,a){const r=a?e.xu.InstantATCOverlayNotShown:t.isSpbOverlay?e.xu.SpbInstantATCOverlayShown:e.xu.QuotientInstantATCOverlayShown,n=new it.Z(r),s=function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Kt(Object(o),!0).forEach((function(t){(0,i.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Kt(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({},t);n.Metadata=JSON.stringify(s);let c=e.in.Information;const l=a?"Instant ATC Overlay Not Shown":t.isSpbOverlay?"Spb Overlay Shown":"Quotient Overlay Shown";o&&(c=e.in.Error),this.logService.LogClientEventV2(c,e.R.EdgeFlyoutStatus,l,n,this.localDataService.GetLocalData(Fe.Q.ImpressionId))}}(vn.GetPlatformInstance(),vn.GetOverlayService(),vn.GetLogService(),vn.GetLocalDataService())),(0,i.Z)(vn,"icDriverService",new class{constructor(e,t){(0,i.Z)(this,"localDataService",void 0),(0,i.Z)(this,"logService",void 0),this.localDataService=e,this.logService=t}async HandleAddToCart(e,t){try{let o=!1;const a=e?.productAddToCartSelector.split(";");a.forEach((async e=>{let a=document.querySelector(e);if("bestbuy.com"===t.domain&&(a.scrollIntoView(),await h.ZP.WaitForCondition((async()=>void 0!==Se.Z.GetFirstVisibleElement("[class='item c-carousel-item '] [class='priceView-hero-price priceView-customer-price']")),3e3,100)),a=document.querySelector(e),a)return a.click(),o=!0,void this.LogAddToCartTelemetry(!0,t,!1)})),o||this.LogAddToCartTelemetry(!1,t,!1)}catch(e){return void this.LogAddToCartTelemetry(!1,t,!0)}}async IsAddToCartEnabled(e,t){try{let t=!1;const o=e?.productAddToCartSelector.split(";");return o.forEach((async e=>{const o=document.querySelector(e),a=window.getComputedStyle(o);!o||o.disabled||"not-allowed"===a.cursor||(t=!0)})),t}catch(e){return void this.LogAddToCartTelemetry(!1,t,!0)}}LogAddToCartTelemetry(t,o,a){const r=t?e.xu.ICAddToCartProductAdded:e.xu.ICAddToCartProductNotAdded,n=new it.Z(r),s=function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Wt(Object(o),!0).forEach((function(t){(0,i.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Wt(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({},o);n.Metadata=JSON.stringify(s);let c=e.in.Information;a&&(c=e.in.Error),this.logService.LogClientEventV2(c,e.R.EdgeFlyoutStatus,t?"ICAddToCart Product Can be Added to Cart":"ICAddToCart Product Not Added to Cart",n,this.localDataService.GetLocalData(Fe.Q.ImpressionId))}}(vn.GetLocalDataService(),vn.GetLogService()));var An,yn,Pn,bn=vn,En=class{constructor(e,t,o,a){(0,i.Z)(this,"divIDOverlay",void 0),(0,i.Z)(this,"divIDContextID",void 0),(0,i.Z)(this,"platformInstance",void 0),(0,i.Z)(this,"utilities",void 0),this.utilities=e,this.divIDOverlay=t,this.divIDContextID=o,this.platformInstance=a}async CreateInstantAddToCartOverlay(t,o,a){const i=document.getElementById(this.divIDOverlay);i&&i.remove();const n=this.utilities.CreateOverlayBackground();n.id=this.divIDOverlay;const s=Re.Z.getTrustedHTML`
        :root {
            --fill: #FFFFFF;
            --text-normal: #1A1A1A;
            --text-grey: #616161;
        }
        p, div, a, button, label {
            font-family: 'Segoe UI', sans-serif;
            font-size: 16px;
            font-weight: 400;
            line-height: 20px;
            color: var(--text-normal);
            margin: 0px;
        }
        #divOverlayWrapper {
            width: 350px;
            height: 227px;
            background: var(--fill);
            font-family: 'Segoe UI', sans-serif;
            border-radius: 4px;
            position: relative;
        }
        #OverlayProgressCheckout {
            width: 200px;
            align-self: center;
            margin-top: 12px;
            margin-bottom: 12px;
            background-color: rgba(0, 0, 0, 0.07);
            border-radius: 8px;
        }
        #divOverlayBar {
            width: 1%;
            height: 8px;
            background: linear-gradient(90deg, #CB5CFF 0%, #35CFFF 50%, #64E816 100%);
            border-radius: 8px;
        }
        .divCommissionValue {
            display: inline-block;
            margin: 0px;
            vertical-align: text-bottom;
        }
        .spanCommissionValue {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 28px;
            line-height: 22px;
            font-size: 20px;
            background: #3267FA;
            border-radius: 6px 0px 0px 6px;
            color: #fff;
            font-weight: 500;
            float: left;
            padding: 0px 1px 0px 6px;
            margin-right: -1px;
        }
        .spanCommissionValueSmall {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 20px;
            line-height: 16px;
            font-size: 12px;
            background: #3267FA;
            border-radius: 4px 0px 0px 4px;
            color: #fff;
            font-weight: 400;
            float: left;
            padding: 0px 2px 0px 4px;
            margin-right: -1px;
        }
        #countdown-wrapper
        {
            width: 30px;
            height: 30px;
            top: 6px;
            right: 6px;
            position: absolute;
        }
        #countdown-container {
            fill: rgb(255, 255, 255);
            left: 50%;
            display: inline;
            top: 50%;
            background: transparent;
            border: unset;
            cursor: pointer;
            transform: translate(-50%, -50%);
            padding:0;
            position: absolute;
        }
        #countdown-svg {
            width: 30px;
            height: 30px;
            display:block;
            margin:auto;
            transform: rotateY(-180deg) rotateZ(-90deg) scale(1,-1);
        }
        #countdown-circle {
            stroke-dasharray: 81.6px;
            stroke-dashoffset: 0px;
            stroke-linecap: round;
            stroke-width: 1.3px;
            stroke: #4F94D3;
            fill: none;
            animation: countdown 10s linear 1 forwards;
        }
        #back-countdown-circle {
            stroke-dasharray: 81.6px;
            stroke-dashoffset: 0px;
            stroke-linecap: round;
            stroke-width: 1px;
            stroke: #afacac;
            fill: none;
        }
        @keyframes countdown {
            from {
                stroke-dashoffset: 81.6px;
            }
            to {
                stroke-dashoffset: 0px;
            }
        }
        @media (-ms-high-contrast: active) {
            #flyoutClose {
                fill: ButtonText;
            }
            #shopping-tag-icon path {
                d: path("M12 5C12.5523 5 13 4.55228 13 4C13 3.44772 12.5523 3 12 3C11.4477 3 11 3.44772 11 4C11 4.55228 11.4477 5 12 5ZM9.12922 \
                4.30281e-05C8.59514 -0.00345791 8.08184 0.206807 7.7037 0.583987L1.02216 7.24852C0.239412 8.02928 0.238604 9.297 1.02036 \
                10.0788L5.96875 15.0271C6.7498 15.8082 8.01613 15.8082 8.79718 15.0271L15.428 8.39633C15.8038 8.02054 16.0146 7.51063 16.0138 \
                6.97917L16.0065 2.02911C16.0049 0.930807 15.1179 0.0393006 14.0196 0.032101L9.12922 4.30281e-05ZM8.4099 1.29199C8.59897 1.1034\
                8.85562 0.998271 9.12266 1.00002L14.013 1.03208C14.5622 1.03568 15.0057 1.48143 15.0065 2.03058L15.0138 6.98065C15.0142 7.24637\
                14.9088 7.50133 14.7209 7.68923L8.09007 14.32C7.69955 14.7106 7.06638 14.7106 6.67586 14.32L1.72746 9.37164C1.33659 8.98077 1.33699 \
                8.34691 1.72836 7.95653L8.4099 1.29199Z");
                fill: ButtonText;
                transform: scale(0.85);
            }
            #countdown-circle{
                stroke: Text;
            }
            #back-countdown-circle {
                display: none;
            }
        }
        #instantATCContent {
            display: flex;
            flex-direction: column;
            row-gap: 10px;
            padding-top: 10px;
            border-radius: 4px;
        }
        #close {
            margin-right: 0px;
            margin-left: auto;
            margin-bottom: -10px;
            background: var(--fill);
            border: none;
            width: fit-content;
            cursor: pointer;
        }
        #instantATCTitle {
            font-weight: 600;
            font-size: 20px;
            line-height: 27px;
        }
        #couponWrapper {
            border: 1px solid #EBEBEB;
            border-radius: 8px;
            background: #FFFFFF;
        }
    `,c=(0,qo.Ux)("style",{type:"text/css",rel:"stylesheet"},s);n.append(c);const l=document.createElement("div");l.id=this.divIDContextID,l.hidden=!0,l.innerText=t.toString(),n.appendChild(l);const d=(0,qo.Ux)("div",{id:"divOverlayWrapper"}),u=(0,qo.Ux)("div",{id:"divOverlayBar"}),h=(0,qo.Ux)("div",{id:"OverlayProgressCheckout"});h.appendChild(u),a&&(d.style.backgroundColor="rgba(80,80,80,0.8)"),this.SetInitialProgressBar(1,"divOverlayBar");const p=this.CreateCashbackRewardTitle(o,De.instantAddToCartDialogueTitle);p.id="instantATCProgressTitle",a&&(p.style.color="#FFFFFF");const m=(0,qo.Ux)("IMG");m.id="cartIcon",m.src="https://www.bing.com/api/shopping/v1/ux/images/instantATC/inprogress_Cart.svg",m.style.marginLeft="auto",m.style.marginRight="auto",m.style.marginTop="20px";const g=(0,qo.Ux)("div",{id:"instantATCContent"});g.append(m,h,p),d.append(this.timerCloseButton(),g),n.append(d);const C=document.getElementsByTagName("html")[0];C&&C.appendChild(n),document.body&&document.body.setAttribute("aria-hidden","true"),this.utilities.SendViewedTelemetry(ta.r.INSTANT_ADD_TO_CART_OVERLAY),await this.platformInstance.SendMessage(new me(e.R.EdgeFlyoutStatus,e.in.Information,"Instant ATC Creation Overlay Shown",new it.Z(e.xu.InstantATCCreationOverlay,void 0,void 0,(0,r.S8)())))}CreateSuccessInstantATCOverlay(t,o){const a=document.querySelector("#divOverlayWrapper");if(a){const i=a.querySelector("#successTitle"),n=a.querySelector("#cancelButton");if(i)return;const s=a.querySelector("#cartIcon"),c=a.querySelector("#instantATCContent");a.querySelector("#instantATCProgressTitle").style.display="none",s.src="https://www.bing.com/api/shopping/v1/ux/images/instantATC/success_Cart.svg",a.querySelector("#OverlayProgressCheckout").style.display="none";const l=this.CreateCashbackRewardTitle(t,De.instantAddToCartSuccessTitle);l.id="successTitle",l.style.width="292px",l.style.height="53px",o&&(l.style.color="#FFFFFF"),i||c.appendChild(l);const d=document.createElement("button");d.id="cancelButton",d.style.borderRadius="4px",d.style.height="32px",d.style.width="155px",d.style.marginLeft="auto",d.style.marginRight="auto",d.textContent="OK",d.style.backgroundColor="rgba(33, 105, 235, 1)",d.style.color="white",d.style.fontFamily="Segoe UI",d.style.fontWeight="600",d.style.fontSize="14px",d.style.lineHeight="20px",d.style.borderColor="transparent",d.style.padding="5px 12px 5px 12px",d.addEventListener("click",(()=>{this.CloseOverlay()})),n||c.appendChild(d),this.platformInstance.SendMessage(new me(e.R.EdgeFlyoutStatus,e.in.Information,"Instant ATC Success Overlay Shown",new it.Z(e.xu.InstantATCSuccessOverlay,void 0,void 0,(0,r.S8)())))}}timerCloseButton(e=6){const t=(0,qo.Ux)("button");t.id="countdown-container",t.innerHTML=Re.Z.getTrustedHTML`
        <svg id="countdown-svg" aria-hidden="true">
            <circle r="13" cx="15" cy="15" id="back-countdown-circle"></circle>
            <circle r="13" cx="15" cy="15" id="countdown-circle"></circle>
        </svg>
    `,t.title="Close",t.setAttribute("aria-label","Close"),t.addEventListener("click",(()=>{this.CloseOverlay()}));const o=(0,qo.Ux)("div");o.id="countdown-wrapper",o.appendChild(t),o.setAttribute("aria-labelledby","countdown-container");const a=o.querySelector("#countdown-circle");a.style.animationDuration=`${e}s`,a.setAttribute("aria-hidden","true");const i=(0,qo.Ux)("span");i.innerHTML=Re.Z.getTrustedHTML`<svg id="flyoutClose" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12">
    <path d="M0.0885911 0.215694L0.146447 0.146447C0.320013 -0.0271197 0.589437 -0.046405 0.784306 0.0885911L0.853553 0.146447L6 5.293L11.1464 0.146447C11.32 -0.0271197 11.5894 -0.046405 11.7843 0.0885911L11.8536 0.146447C12.0271 0.320013 12.0464 0.589437 11.9114 0.784306L11.8536 0.853553L6.707 6L11.8536 11.1464C12.0271 11.32 12.0464 11.5894 11.9114 11.7843L11.8536 11.8536C11.68 12.0271 11.4106 12.0464 11.2157 11.9114L11.1464 11.8536L6 6.707L0.853553 11.8536C0.679987 12.0271 0.410563 12.0464 0.215694 11.9114L0.146447 11.8536C-0.0271197 11.68 -0.046405 11.4106 0.0885911 11.2157L0.146447 11.1464L5.293 6L0.146447 0.853553C-0.0271197 0.679987 -0.046405 0.410563 0.0885911 0.215694L0.146447 0.146447L0.0885911 0.215694Z"/>
    </svg>`,i.style.fill="#808080",i.setAttribute("aria-hidden","true");const r=i.querySelector("#flyoutClose");r.style.position="absolute",r.style.top="50%",r.style.left="50%",r.style.transform="translate(-50%,-50%)",t.appendChild(i);const n=document.querySelector("html");return n&&(n.style.overflow="hidden"),o}CloseOverlay(){const e=document.querySelector("#"+this.divIDOverlay);e&&e.remove()}CreateCashbackRewardTitle(e,t){const o={commissionType:"$",commissionValue:`${e}`,category:void 0,isRebatesSupportedDomain:null,isRebatesUser:!0,merchantName:void 0,highestCashbackCategory:void 0},a=document.createElement("DIV"),i=this.platformInstance.GetResourceString(t),n=this.createCommissionArrow(o,!0);return n.style.verticalAlign="middle",(0,r.B7)(a,i,n),a.style.fontSize="18px",a.style.fontWeight="600",a.style.lineHeight="26px",a.style.alignContent="center",a.style.width="224px",a.style.fontFamily="Segoe UI",a.style.marginLeft="auto",a.style.marginRight="auto",a.style.textAlign="center",a}SetInitialProgressBar(e,t){const o=document.querySelector(t);o&&(o.style.width=e+"%")}createCommissionArrow(e,t,o){const a=(0,qo.Ux)("div",{className:"imgCBTag"});a.innerHTML=o?Me():Le(),a.setAttribute("aria-hidden","true"),a.style.float="left",a.style.display="block";const i=(0,qo.Ux)("span",{role:"group"});i.className=o?"spanCommissionValueSmall":"spanCommissionValue";const r=(0,qo.Ux)("div",{className:"divCommissionValue"});if(r.append(i,a),e.commissionValue&&e.commissionType)if(t){const t=(0,qo.Ux)("span");t.textContent=(0,Ee.Jl)("$"),t.style.fontSize=o?"8px":"10px",t.style.position="relative",t.style.bottom="0.3ex";const a=`${e.commissionValue}`.split(".");1===a.length&&a.push("00");const r=(0,qo.Ux)("span");r.style.fontSize=o?"12px":"16px",r.textContent=a[0];const n=(0,qo.Ux)("span");n.textContent=a[1],n.style.fontSize=o?"8px":"10px",n.style.position="relative",n.style.bottom="0.3ex",i.append(t,r,n),i.setAttribute("aria-label",`${t.textContent}${a[0]}.${a[1]}`)}else{const t="%";e.commissionType===t?i.textContent=e.commissionValue+t:i.textContent=e.commissionType+e.commissionValue}return r}},Tn=o(1908),In=class{constructor(e){(0,i.Z)(this,"divIDOverlay","divOverlayWrapper"),(0,i.Z)(this,"divIDContextID","contextID"),(0,i.Z)(this,"platformInstance",void 0),(0,i.Z)(this,"darkThemeQuery",window&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)"):null),this.platformInstance=e}IsDarkTheme(){return this.darkThemeQuery?.matches??!1}OnDarkThemeChange(e){this.darkThemeQuery?.addEventListener?.("change",(t=>{e(t.matches)}))}async SendClickTelemetry(o,a,i,n,s){const c=new me(e.R.ButtonClick,s?e.in.Error:e.in.Information,o,new jo.Z(a,ta.r.EDGE_OVERLAY,(0,r.S8)()));await this.platformInstance.SendMessage(c),i&&t.a.postMessageToHost("recordAsUserAction",[i]),n&&t.a.postMessageToHost("recordAsUserEngagement",[n])}async SendViewedTelemetry(t){const o=(0,r.S8)();await this.platformInstance.SendMessage(new me(e.R.EdgeFlyoutStatus,e.in.Information,t,new it.Z(e.xu.ModuleViewed,void 0,void 0,o)))}TrapFocus(e,t=document){const o=[...t.querySelectorAll("\n        a, button, input, select, textarea, svg, area, details, summary,\n        iframe, object, embed,\n        [tabindex], [contenteditable]\n        ")].filter((t=>!e.contains(t)&&"-1"!==t.getAttribute("tabindex")&&t.offsetHeight>0));return o.forEach((e=>e.setAttribute("tabindex","-1"))),Tn.Z.getInstance().initialize(e,!0),{release(){o.forEach((e=>e.removeAttribute("tabindex"))),Tn.Z.getInstance().removeListeners()}}}AddFavIconSrc(e,t,o){const a=this.GetFavIconSrc(o);e.style.maxWidth="16px",e.slot="icon",e.setAttribute("aria-hidden","true"),e.addEventListener("error",(()=>{e.remove()})),a&&(e.src=a)}GetFavIconSrc(t,o=16){return t?(t=(t=t.replace("http://","")).replace("https://",""),this.platformInstance.GetAppInfoClientName()===e.BN.Edge?`https://edge.microsoft.com/favicon/v1/?client=chrome_desktop&nfrp=2&check_seen=true&size=${o}&fallback_opts=TYPE,SIZE,URL&url=http://${t}&origin=shoppingv2`:at.jb.includes(this.platformInstance.GetAppInfoClientName())?`https://${t}/favicon.ico`:`edge://favicon2/?size=16&scale_factor=1x&page_url=http://${t}&allow_google_server_fallback=1`):""}GetLocalizedText(e){return this.platformInstance.GetResourceString(e)}UpdateLocalizedText(e,t,o){const a=this.platformInstance.GetResourceString(o)||o,i=e.querySelector(t);i&&(i.innerText=a)}UpdateText(e,t,o){const a=e.querySelector(t);a&&(a.innerText=o)}CreateOverlayBackground(){return(0,qo.Ux)("div",{id:"divOverlayBackground",title:"Edge Shopping",style:"\n                width: 100%;\n                height: 100%;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                position: fixed;\n                display: flex;\n                justify-content: center;\n                align-items: center;\n                background-color: rgba(80,80,80,0.8);\n                z-index: 3000000000;\n            "})}CreateOverlayDiv(e){const t=document.getElementById(this.divIDOverlay);if(t){if(e){const o=t.shadowRoot,a=o?.getElementById(e);if(a)return}t.remove()}const o=document.createElement("div");return o.id=this.divIDOverlay,o}CreateOverlayID(e){return(0,qo.Ux)("div",{id:this.divIDContextID,hidden:!0,innerText:e.toString()})}OverlayPostProcessing(e){const t=document.getElementsByTagName("html")[0];t&&t.appendChild(e),document.body&&document.body.setAttribute("aria-hidden","true")}},On=class{constructor(e,t){(0,i.Z)(this,"focusTrap",void 0),(0,i.Z)(this,"utilities",void 0),(0,i.Z)(this,"edgeMessageService",void 0),this.utilities=e,this.edgeMessageService=t}CreatePrintableGroceryCouponsOverlay(e,t){const o=this.utilities.CreateOverlayDiv(),a=this.utilities.CreateOverlayBackground();if(!o)return;const i=o.attachShadow({mode:"open",delegatesFocus:!0}),r=document.createElement("div");r.setAttribute("style","width: 85%;\n            height: 65%;\n            max-width: 1000px;\n            max-height: 800px;\n            margin: auto;\n            ");const n=document.createElement("button");n.id="groceryCloseButton",n.textContent="X",n.setAttribute("aria-label","close"),n.setAttribute("style","content: 'x';\n            color: #fff;\n            cursor: pointer;\n            font-weight: 300;\n            font-size: 24px;\n            float: right;\n            font-family: Arial, sans-serif;\n        "),r.appendChild(n);const s=document.createElement("iframe");s.setAttribute("style","width: 100%;\n            height: 100%;\n            color: #fff;\n            background: #fff;\n            max-width: 1000px;\n            max-height: 800px;\n            margin: auto;\n            "),s.src=t,s.className="printDialogWrapper",r.appendChild(s),i.appendChild(r);const c=this.utilities.CreateOverlayID(e);o.appendChild(c),o.appendChild(a);const l=document.getElementsByTagName("html")[0];l&&l.appendChild(o),o.focus(),n.addEventListener("click",(e=>{o.remove(),this.focusTrap&&this.focusTrap.release()})),this.focusTrap=this.utilities.TrapFocus(r),document.body&&document.body.setAttribute("aria-hidden","true"),window.addEventListener("message",(e=>{if("https://www.coupons.com"===e.origin)switch(JSON.parse(e.data).action){case"securePrintCoupons":case"printCoupons":o.remove(),this.edgeMessageService.SendPrintCouponsCompleteMessage()}})),document.addEventListener("click",(e=>{e?.target&&e?.target===o&&(o.remove(),this.focusTrap&&this.focusTrap.release())})),window.addEventListener("keydown",(e=>{"Escape"===e.key&&e?.target&&e?.target===o&&(o.remove(),this.focusTrap&&this.focusTrap.release())}))}},Dn=Object.prototype,kn=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Dn)},Rn=(An=Object.keys,yn=Object,function(e){return An(yn(e))}),wn=Object.prototype.hasOwnProperty,Nn="object"==typeof global&&global&&global.Object===Object&&global,xn="object"==typeof self&&self&&self.Object===Object&&self,_n=Nn||xn||Function("return this")(),Un=_n.Symbol,Bn=Object.prototype,Mn=Bn.hasOwnProperty,Ln=Bn.toString,Fn=Un?Un.toStringTag:void 0,Zn=Object.prototype.toString,Gn=Un?Un.toStringTag:void 0,Hn=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Gn&&Gn in Object(e)?function(e){var t=Mn.call(e,Fn),o=e[Fn];try{e[Fn]=void 0;var a=!0}catch(e){}var i=Ln.call(e);return a&&(t?e[Fn]=o:delete e[Fn]),i}(e):function(e){return Zn.call(e)}(e)},Vn=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},Wn=function(e){if(!Vn(e))return!1;var t=Hn(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},Kn=_n["__core-js_shared__"],zn=(Pn=/[^.]+$/.exec(Kn&&Kn.keys&&Kn.keys.IE_PROTO||""))?"Symbol(src)_1."+Pn:"",jn=Function.prototype.toString,Qn=function(e){if(null!=e){try{return jn.call(e)}catch(e){}try{return e+""}catch(e){}}return""},Jn=/^\[object .+?Constructor\]$/,Yn=Function.prototype,Xn=Object.prototype,qn=Yn.toString,$n=Xn.hasOwnProperty,es=RegExp("^"+qn.call($n).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ts=function(e){return!(!Vn(e)||function(e){return!!zn&&zn in e}(e))&&(Wn(e)?es:Jn).test(Qn(e))},os=function(e,t){var o=function(e,t){return null==e?void 0:e[t]}(e,t);return ts(o)?o:void 0},as=os(_n,"DataView"),is=os(_n,"Map"),rs=os(_n,"Promise"),ns=os(_n,"Set"),ss=os(_n,"WeakMap"),cs="[object Map]",ls="[object Promise]",ds="[object Set]",us="[object WeakMap]",hs="[object DataView]",ps=Qn(as),ms=Qn(is),gs=Qn(rs),Cs=Qn(ns),Ss=Qn(ss),fs=Hn;(as&&fs(new as(new ArrayBuffer(1)))!=hs||is&&fs(new is)!=cs||rs&&fs(rs.resolve())!=ls||ns&&fs(new ns)!=ds||ss&&fs(new ss)!=us)&&(fs=function(e){var t=Hn(e),o="[object Object]"==t?e.constructor:void 0,a=o?Qn(o):"";if(a)switch(a){case ps:return hs;case ms:return cs;case gs:return ls;case Cs:return ds;case Ss:return us}return t});var vs=fs,As=function(e){return null!=e&&"object"==typeof e},ys=function(e){return As(e)&&"[object Arguments]"==Hn(e)},Ps=Object.prototype,bs=Ps.hasOwnProperty,Es=Ps.propertyIsEnumerable,Ts=ys(function(){return arguments}())?ys:function(e){return As(e)&&bs.call(e,"callee")&&!Es.call(e,"callee")},Is=Ts,Os=Array.isArray,Ds=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991},ks="object"==typeof exports&&exports&&!exports.nodeType&&exports,Rs=ks&&"object"==typeof module&&module&&!module.nodeType&&module,ws=Rs&&Rs.exports===ks?_n.Buffer:void 0,Ns=(ws?ws.isBuffer:void 0)||function(){return!1},xs={};xs["[object Float32Array]"]=xs["[object Float64Array]"]=xs["[object Int8Array]"]=xs["[object Int16Array]"]=xs["[object Int32Array]"]=xs["[object Uint8Array]"]=xs["[object Uint8ClampedArray]"]=xs["[object Uint16Array]"]=xs["[object Uint32Array]"]=!0,xs["[object Arguments]"]=xs["[object Array]"]=xs["[object ArrayBuffer]"]=xs["[object Boolean]"]=xs["[object DataView]"]=xs["[object Date]"]=xs["[object Error]"]=xs["[object Function]"]=xs["[object Map]"]=xs["[object Number]"]=xs["[object Object]"]=xs["[object RegExp]"]=xs["[object Set]"]=xs["[object String]"]=xs["[object WeakMap]"]=!1;var _s="object"==typeof exports&&exports&&!exports.nodeType&&exports,Us=_s&&"object"==typeof module&&module&&!module.nodeType&&module,Bs=Us&&Us.exports===_s&&Nn.process,Ms=function(){try{return Us&&Us.require&&Us.require("util").types||Bs&&Bs.binding&&Bs.binding("util")}catch(e){}}(),Ls=Ms&&Ms.isTypedArray,Fs=Ls?function(e){return function(t){return e(t)}}(Ls):function(e){return As(e)&&Ds(e.length)&&!!xs[Hn(e)]},Zs=Object.prototype.hasOwnProperty,Gs=function(e){if(null==e)return!0;if(function(e){return null!=e&&Ds(e.length)&&!Wn(e)}(e)&&(Os(e)||"string"==typeof e||"function"==typeof e.splice||Ns(e)||Fs(e)||Is(e)))return!e.length;var t=vs(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(kn(e))return!function(e){if(!kn(e))return Rn(e);var t=[];for(var o in Object(e))wn.call(e,o)&&"constructor"!=o&&t.push(o);return t}(e).length;for(var o in e)if(Zs.call(e,o))return!1;return!0},Hs=class{constructor(o,a,r,n,s,c,l,d){(0,i.Z)(this,"amount",void 0),(0,i.Z)(this,"lowerThreshold",void 0),(0,i.Z)(this,"upperThreshold",void 0),(0,i.Z)(this,"showTotalAmountDialogErrorMsg",void 0),(0,i.Z)(this,"setInputValue",void 0),(0,i.Z)(this,"handleTotalAmountDialogLoading",void 0),(0,i.Z)(this,"bnplContinueButton",void 0),(0,i.Z)(this,"continueToMessage",void 0),(0,i.Z)(this,"twoDecimalRegExp",/^$|^[0-9]+(\.[0-9]{0,2})?$/),(0,i.Z)(this,"hasValidationError",!1),(0,i.Z)(this,"onKeyUp",(e=>{"Enter"===e.key&&this.onBnplContinueButtonClick()})),(0,i.Z)(this,"onChange",(e=>{const t=e.target.value?.trim()??"";this.onInputChange(t)})),(0,i.Z)(this,"onBlur",(e=>{const t=e.target.value?.trim()??"";t.endsWith(".")&&this.onInputChange(t.slice(0,-1).trim())})),(0,i.Z)(this,"onInputChange",((t,o)=>{let a=t.slice(1);this.twoDecimalRegExp.test(a)||(a=o?"":this.amount),this.amount=a,t="$"+a,this.setInputValue(t),this.hasValidationError=!this.isTotalAmountValid(a,this.lowerThreshold,this.upperThreshold),this.bnplContinueButton.disabled=this.hasValidationError,o&&Gs(a)||this.showTotalAmountDialogErrorMsg(this.hasValidationError?e.aK.VALIDATION_ERROR:void 0,this.lowerThreshold,this.upperThreshold)})),(0,i.Z)(this,"onBnplContinueButtonClick",(()=>{this.hasValidationError||(t.a.postMessageToHost(this.continueToMessage,[this.amount]),this.handleTotalAmountDialogLoading(!0))})),(0,i.Z)(this,"isTotalAmountValid",((e,t,o)=>{if(!t||!o)return!0;const a=Number(e),i=Number(t),r=Number(o);return!isNaN(a)&&!(a>r||a<i)})),this.amount=o,this.lowerThreshold=a,this.upperThreshold=r,this.showTotalAmountDialogErrorMsg=n,this.setInputValue=s,this.handleTotalAmountDialogLoading=c,this.bnplContinueButton=l,this.continueToMessage=d}};class Vs{constructor(){(0,i.Z)(this,"progress",void 0),(0,i.Z)(this,"max",void 0),(0,i.Z)(this,"activityrewards",void 0)}static Create(e){const t=new Vs;return t.progress=e?.progress,t.max=e?.max,t.activityrewards=e?.activity_rewards,t}}var Ws=Vs;class Ks{constructor(){(0,i.Z)(this,"name",void 0),(0,i.Z)(this,"attributes",void 0)}static Create(e){const t=new Ks;return t.name=e?.name,t.attributes=Ws.Create(e?.attributes),t}}var zs=Ks;class js{constructor(){(0,i.Z)(this,"isRewardsUser",void 0),(0,i.Z)(this,"isAutoEnrolled",void 0),(0,i.Z)(this,"usedPoints",void 0),(0,i.Z)(this,"maxPoints",void 0),(0,i.Z)(this,"rewardPoints",void 0),(0,i.Z)(this,"promotions",[])}static Create(e){const t=new js;if(!e)return t;if(t.isRewardsUser=e.isRewardsUser,t.isAutoEnrolled=e.isAutoEnrolled,!e.promotions)return t;t.promotions=[];for(const o of e.promotions)t.promotions.push(zs.Create(o));for(const e of t.promotions)if(e.name===js.MsRewards){if(!(e.attributes?.progress&&e.attributes?.max&&e.attributes?.activityrewards))break;t.usedPoints=e.attributes.progress,t.maxPoints=e.attributes.max,t.rewardPoints=e.attributes.activityrewards}return t}isValidRewardsData(){return!!(this.usedPoints&&this.maxPoints&&this.rewardPoints&&this.isRewardsUser)}}(0,i.Z)(js,"MsRewards","coupons_50points_202403"),(0,i.Z)(js,"StorageKeyPrefix","IS_ELIGIBLE_FOR_REWARDS_");var Qs=js,Js=o(3765);class Ys{static ProcessMessage(e){const t=e,o=Ys.GetResponse(t,Ys.GetInterface(t));return o.ID=t.ID,o}static GetInterface(t){return Ys.overlayMessages.has(t.Type)?Ys.eoi:t.Type===e.Vm.SelectorExtractionMessage?Ys.sei:Ys.cpi}static GetResponse(e,t){try{return t.HandleMessage(e)}catch(e){return(0,r.Md)(e.message)}}}(0,i.Z)(Ys,"overlayMessages",new Set([e.Vm.CloseOverlayMessage,e.Vm.UpdateCurrentCouponMessage,e.Vm.MoveProgressBarMessage,e.Vm.EdgeCreateOverlayMessage,e.Vm.EdgeShowResultMessage,e.Vm.UpdateCurrencyMessage,e.Vm.CheckoutProgressMessage,e.Vm.ECCreateOverlayMessage,e.Vm.ECShowResultMessage,e.Vm.ECCreateUpdatePaymentOverlayMessage,e.Vm.PrintableGroceryCouponsMessage,e.Vm.WalletDrawerCreateOverlayMessage,e.Vm.WalletDrawerCloseMessage,e.Vm.WalletDrawerSkipCouponMessage,e.Vm.InstantAddToCartMessage,e.Vm.SuccessInstantAddToCartMessage])),(0,i.Z)(Ys,"cpi",new ve(Te.Z.GetPlatformInstance())),(0,i.Z)(Ys,"eoi",new class extends Xe{constructor(t,o,a){super(t),(0,i.Z)(this,"negativeTitlePath","#txtResultNegativeTitle"),(0,i.Z)(this,"negativeCashbackUpsellTitlePath","#txtResultNegativeCashbackUpsellTitle"),(0,i.Z)(this,"negativeDetailsPath","#txtResultNegativeDetails"),(0,i.Z)(this,"negativeCashbackHeader","#txtResultNegativeCashbackHeader"),(0,i.Z)(this,"negativeCashbackHeaderText","#txtResultNegativeCashbackHeaderText"),(0,i.Z)(this,"negativeCashbackOfferDetails","#txtResultNegativeCashbackOfferDetails"),(0,i.Z)(this,"negativeCashbackUpsellDetails","#txtResultNegativeCashbackUpsellDetails"),(0,i.Z)(this,"negativeCashbackUpsellPrivacyPath","#txtCashbackUpsellPrivacyTerms"),(0,i.Z)(this,"errorTitlePath","#txtResultErrorTitle"),(0,i.Z)(this,"errorDetailsPath","#txtResultErrorDetails"),(0,i.Z)(this,"resultCouponDetailsPath","#txtResultPositiveCouponDetails"),(0,i.Z)(this,"resultCashBackDetailsPath","#txtResultPositiveCashBackDetails"),(0,i.Z)(this,"shortcircuitTitlePath","#txtResultShortcircuitTitle"),(0,i.Z)(this,"shortcircuitDetailsPath","#txtResultShortcircuitDetails"),(0,i.Z)(this,"shortcircuitCouponCodePath","#txtResultShortcircuitCouponCode"),(0,i.Z)(this,"shortcircuitCouponDescPath","#txtResultShortcircuitCouponDesc"),(0,i.Z)(this,"shortcircuitCalltoActionPath","#txtResultShortcircuitCalltoAction"),(0,i.Z)(this,"shortcircuitCouponBtnPath","#btnResultShortcircuitCoupon"),(0,i.Z)(this,"iconImgPath",".imgOverlayExtensionIcon"),(0,i.Z)(this,"divImportCheckBox","divImportCheckbox"),(0,i.Z)(this,"divJoinRebates","#divJoinRebates"),(0,i.Z)(this,"useBingRebatesPath","#btnOverlayRebates"),(0,i.Z)(this,"cashbackUpsellJoinNowPath","#btnJoinAndActivate"),(0,i.Z)(this,"sharePath","#divOverlayShare"),(0,i.Z)(this,"shareFBPath","#btnOverlayShareFB"),(0,i.Z)(this,"shareTwitterPath","#btnOverlayShareTwitter"),(0,i.Z)(this,"storeNamePath","#txtStore"),(0,i.Z)(this,"divOverlayHide","divOverlayHide"),(0,i.Z)(this,"divOverlayInlineShow","divOverlayInlineShow"),(0,i.Z)(this,"divOverlayGridShow","divOverlayGridShow"),(0,i.Z)(this,"divOverlayFooterPath",".divOverlayFooter"),(0,i.Z)(this,"divOverlayResultCheckoutDetailsPath","#divOverlayResultCheckoutDetails"),(0,i.Z)(this,"divOverlayResultNegativePath","#divOverlayResultNegative"),(0,i.Z)(this,"divOverlayResultCheckoutTitle","#divOverlayResultCheckoutTitle"),(0,i.Z)(this,"bnplTotalAmountContainerPath","#bnplTotalAmountContainer"),(0,i.Z)(this,"bnplErrorTextPath","#bnplErrorText"),(0,i.Z)(this,"bnplLogo",".bnplLogo"),(0,i.Z)(this,"bnplLogoSvg",".bnplLogo svg"),(0,i.Z)(this,"bnplTitlePath",".bnplTitle"),(0,i.Z)(this,"bnplSubTitlePath",".bnplSubTitle"),(0,i.Z)(this,"bnplFeeDescriptionPath",".bnplFeeDescription"),(0,i.Z)(this,"bnplShoppingCartValuePath",".bnplShoppingCartValue"),(0,i.Z)(this,"bnplCartValueInputPath",".bnplCartValueInput"),(0,i.Z)(this,"bnplErrorMsgContainerPath",".bnplErrorMsgContainer"),(0,i.Z)(this,"bnplAmountReminderPath",".bnplAmountReminder"),(0,i.Z)(this,"bnplMsDescription",".bnplMsDescription"),(0,i.Z)(this,"bnplLicenseTextPath",".bnplLicenseText"),(0,i.Z)(this,"bnplContinueButtonPath","#bnplContinueButton"),(0,i.Z)(this,"bnplTotalAmountFooterPath",".bnplTotalAmountFooter"),(0,i.Z)(this,"bnplTopBannerSection",".bnpl-top-banner-section"),(0,i.Z)(this,"bnplTopBannerContent","#bnpl-top-banner-content"),(0,i.Z)(this,"attIconPromptPos","#iconPromptPos"),(0,i.Z)(this,"attIconPromptNeg","#iconPromptNeg"),(0,i.Z)(this,"infoIconPath","#infoIcon"),(0,i.Z)(this,"animationQuery",window&&window.matchMedia?window.matchMedia("(prefers-reduced-motion: reduce)"):null),(0,i.Z)(this,"overlay",void 0),(0,i.Z)(this,"focusTestingTrap",void 0),(0,i.Z)(this,"focusResultTrap",void 0),(0,i.Z)(this,"finalAmountWithAA",void 0),(0,i.Z)(this,"cashbackUpsellBlockedDomains",e.ZT),(0,i.Z)(this,"localDataService",void 0),(0,i.Z)(this,"edgeMessageService",void 0),(0,i.Z)(this,"utilities",void 0),(0,i.Z)(this,"checkoutPageUrlData",void 0),(0,i.Z)(this,"cancelListenerCallback",void 0),this.localDataService=o,this.edgeMessageService=a,this.utilities=new In(t)}HandleMessage(t){try{const o=t.Type;if(o!==e.Vm.EdgeCreateOverlayMessage&&o!==e.Vm.WalletDrawerCreateOverlayMessage&&o!==e.Vm.CloseOverlayMessage&&o!==e.Vm.WalletDrawerCloseMessage){if(Xe.isAutoApplyCancelled)return new xt.Z("Auto Apply cancelled",Ie.AutoApplyCancelled);if(Xe.isAutoApplySkipped)return new xt.Z("Auto Apply skipped",Ie.AutoApplySkipped);if(Xe.isAutoApplyPaused&&o!==e.Vm.EdgeShowResultMessage)return new xt.Z("Auto Apply paused",Ie.AutoApplyPaused)}if(o===e.Vm.EdgeCreateOverlayMessage){Xe.isAutoApplyCancelled=!1,Xe.isAutoApplyCompleted=!1,Xe.isAutoApplyPaused=!1,Xe.isAutoApplySkipped=!1;const e=t;this.checkoutPageUrlData=e.retailerData,this.CreateOverlay(e.InnerHTML,e.CurrentCoupon,e.CurrentCouponIndex,e.TotalCoupons,e.ProgBarStart,e.ProgBarEnd,e.ContextID,e.CurrentBestDiscount,e.inlineCSS,e.bgAAScenario)}else if(o===e.Vm.EdgeShowResultMessage){Xe.isAutoApplyCompleted=!0;const e=t;this.ShowResult(e.Result,e.Discount,e.OriginalPrice,e.BestCoupon,e.cashBackInfo,e.IsStackable,e.coupons,e.isShortcircuit,e.rewardsData)}else if(o===e.Vm.UpdateCurrentCouponMessage){const e=t;this.UpdateCurrentCoupon(e.CurrentCoupon,e.CurrentCouponIndex,e.TotalCoupons,e.CurrentBestDiscount,e.IsSuggestedCoupon)}else if(o===e.Vm.CheckoutProgressMessage){const e=t;this.HandleCheckoutProgress(e)}else if(t.Type===e.Vm.ECCreateOverlayMessage){const e=t;this.ECCreateOverlay(e.ContextID,e.InlineHtml,e.InlineCSS,e.IsAutoApplyIncluded,e.checkoutProgress)}else if(t.Type===e.Vm.ECShowResultMessage){const e=t;this.ECShowResult(e.BestCoupon,e.InitialPrice,e.MaxDiscount,e.IsAutoApplyIncluded,e.CheckoutProgress)}else if(t.Type===e.Vm.ECCreateUpdatePaymentOverlayMessage){const e=t;this.ECCreateUpdatePaymentOverlay(e.ContextID,e.InlineHtml,e.InlineCSS)}else if(t.Type===e.Vm.PrintableGroceryCouponsMessage){const e=t;new On(this.utilities,this.edgeMessageService).CreatePrintableGroceryCouponsOverlay(e.ContextID,e.IFrameSrc)}else if(t.Type===e.Vm.WalletDrawerCreateOverlayMessage){Xe.isAutoApplyCancelled=!1;const e=t;this.WalletDrawerCreateOverlay(e.ContextID)}else if(t.Type===e.Vm.WalletDrawerCloseMessage){const e=t;this.CloseWalletDrawer(e.IsStopProgress)}else if(t.Type===e.Vm.WalletDrawerSkipCouponMessage)this.WalletDrawerSkipCoupon();else if(t.Type===e.Vm.InstantAddToCartMessage){const e=t,o=e.GroceryAddToCartData,a=this.utilities.IsDarkTheme();new En(this.utilities,this.divIDOverlay,this.divIDContextID,this.platformInstance).CreateInstantAddToCartOverlay(e.ContextID,+o?.value,a)}else{if(t.Type!==e.Vm.SuccessInstantAddToCartMessage)return super.HandleMessage(t);{const e=t.GroceryAddToCartData,o=this.utilities.IsDarkTheme();new En(this.utilities,this.divIDOverlay,this.divIDContextID,this.platformInstance).CreateSuccessInstantATCOverlay(+e?.value,o)}}}catch(e){return(0,r.Md)(e.message)}return new Y.Z}addListenerCancelOverlay(e,t,o){e&&(this.cancelListenerCallback=async()=>{document.body&&(document.body.setAttribute("aria-hidden","false"),this.focusTestingTrap&&this.focusTestingTrap.release());const e=this.GetShadowOverlay();t&&e&&(this.localDataService.IsFeatureEnabled(ft.expressCheckout)&&this.localDataService.SaveLocalData(Fe.Q.ExpressCheckoutState,F.CancelEC),Xe.isAutoApplyCompleted||Xe.isAutoApplyCancelled?this.sendCompletionMessages(e):(Xe.isAutoApplyCancelled=!0,o?await this.platformInstance.SendMessage(new Je(this.getContextID(this.divIDContextID),location.hostname,location.pathname)):await this.platformInstance.SendMessage(new je(this.getContextID(this.divIDContextID),location.hostname,location.pathname))),this.setCouponTextToCancelling(e))},e.forEach((e=>{e.addEventListener("click",this.cancelListenerCallback)})))}addListenerCloseOverlay(e,t,o,a,i){if(o||(o=this.checkoutPageUrlData),t&&t.addEventListener("click",(i=>this.handleCloseOverlay(e,t,o,a)),!1),i){const e=t=>{const a=this.GetShadowOverlay();if(a){const e=this.selectElement(a,this.resultPath),i=t.composedPath();i&&i.indexOf(e)<0&&this.handleCloseOverlay(this.overlay,void 0,o,void 0,!0)}window.removeEventListener("click",e)};window.addEventListener("click",e)}}async handleCloseOverlay(o,a,i,r,n){if(document.body&&(document.body.setAttribute("aria-hidden","false"),this.focusResultTrap&&this.focusResultTrap.release(),this.focusTestingTrap&&this.focusTestingTrap.release()),o){const o=this.GetShadowOverlay();if(o){let s=n?e.$S.OutsideAAOverlayClick:e.$S.Unknown;if(a?.id===this.divIDCloseOverlay.replace("#","")){const a=this.selectElement(o,this.useBingRebatesPath),n=this.selectElement(o,"#"+this.divImportCheckBox);if(s=e.$S.ProceedToCheckout,r){const o=r.querySelector('input[name="savingsType"]:checked'),a=o?.value;"cashback"===a?(this.UseRebatesClickHandler(i),s=e.$S.UseRebates):(t.a.postMessageToHost(d.Pd.AutoApplyOptionsStatus,[d.my.UseCoupon]),s=e.$S.UseCoupon)}else n?n.checked?(t.a.postMessageToHost(d.Pd.ImportWhileCheckout,[]),s=e.$S.ProceedToCheckoutWithImport):s=e.$S.ProceedToCheckoutWithOutImport:a&&"none"!==a.style.display&&(t.a.postMessageToHost(d.Pd.AutoApplyOptionsStatus,[d.my.UseCoupon]),s=e.$S.UseCoupon)}else a?.id===this.useBingRebatesPath.replace("#","")&&(this.UseRebatesClickHandler(i),s=e.$S.UseRebates);await this.utilities.SendClickTelemetry("",s)}}await this.platformInstance.SendMessage(new Qe(this.getContextID(this.divIDContextID),location.hostname,location.pathname)),o.remove();const s=this.localDataService.GetLocalData(Fe.Q.ApiResponse);if(yi.Z.IsECPage(s)){const e={auto_apply_status:!0,express_checkout_status:!0,is_auto_apply_completed:!0};this.edgeMessageService.SendOpenFlyoutMessage(JSON.stringify(e)),this.edgeMessageService.SetStorageValue("ECInvalidDismiss",JSON.stringify({value:"true"}))}if(i){const e=document.querySelector(i.applyButtonSelector);if(e)e.focus();else{const e=document.querySelector(i.removeCouponButtonSelector);if(e)e.focus();else{const e=document.querySelector(i.inputBoxSelector);if(e)e.focus();else{const e=document.querySelector(i.orderTotalDataElementSelector);e&&e.focus()}}}}}async UseRebatesClickHandler(e){if(!e)return;let o=e.removeCouponButtonSelector;if(o){let e="";const t=o.split(";");2===t.length&&(e=t[0],o=t[1]);const a=new ve(bn.GetPlatformInstance());a&&(await this.isFieldVisible(a,e)&&(await this.isFieldVisible(a,o)||a.HandleMessage(new tt(le.Click,e,""))),await this.isFieldVisible(a,o)&&a.HandleMessage(new tt(le.Click,o,"")))}t.a.postMessageToHost(d.Pd.AutoApplyOptionsStatus,[d.my.UseRebates])}handleCashbackUpsellTelemetry(t){const o=this.localDataService.GetLocalData(Fe.Q.ApiResponse),a=o?.highestCashBackCategory??"",i=o?.affiliateNetwork??"";if(t){const o=new $e(a,t?.commissionType??"",t?.commissionValue??"",(0,r.S8)(),i,e.E_.Bing,t.isRebatesUser,t.isRebatesSupportedDomain?.toString()??"",!1,t.merchantName??"","overlay",!1,e.GV.CheckoutPage);this.platformInstance.SendMessage(new me(e.R.CashbackInfo,e.in.Information,"CashbackUpsell Overlay Shown",o))}}handleTotalAmountDialogLoading(e){const t=this.GetShadowOverlay();this.selectElement(t,this.bnplCartValueInputPath).disabled=e,this.selectElement(t,this.bnplContinueButtonPath).disabled=e}addListenerECCancelOverlay(e,t){e&&e.forEach((e=>{e.addEventListener("click",(async()=>{document.body&&(document.body.setAttribute("aria-hidden","false"),this.focusTestingTrap&&this.focusTestingTrap.release());const e=this.GetShadowOverlay();t&&e&&(this.localDataService.IsFeatureEnabled(ft.expressCheckout)&&this.localDataService.SaveLocalData(Fe.Q.ExpressCheckoutState,F.CancelEC),t.remove())}))}))}addListenerPauseOverlay(t,o){t&&t.addEventListener("click",(async()=>{document.body&&(document.body.setAttribute("aria-hidden","false"),this.focusTestingTrap&&this.focusTestingTrap.release());const t=this.GetShadowOverlay();o&&t&&(Xe.isAutoApplyCompleted||Xe.isAutoApplyPaused?this.sendCompletionMessages(t):(Xe.isAutoApplyPaused=!0,this.utilities.SendClickTelemetry("User clicked auto apply pause button",e.$S.AutoApplyPause)),this.setCouponTextToPausing(t))}))}addListenerShare(t,o){t&&t.addEventListener("click",(async()=>{let a;a="https://www.bing.com/edgesavings/share/scard";let i,r=this.platformInstance.GetResourceString(De.CouponShareSavingsMessage);if(o>5){r=this.platformInstance.GetResourceString(De.CouponShareSavingsMessageWithPrice);const e=(0,Ee.Jl)(this.currency);r=r.replace("$1",this.formatPrice(e,o))}if(t.id===this.shareTwitterPath.replace("#",""))i=e.$S.ShareTwitter,window.open("https://twitter.com/share?url="+a+"&text="+r,"twitterwindow","height=450, width=550, top=100, left=100, toolbar=0, location=0, menubar=0, directories=0, scrollbars=0");else{if(t.id!==this.shareFBPath.replace("#",""))return;i=e.$S.ShareFB,window.open("https://www.facebook.com/sharer/sharer.php?u="+a+"&quote="+r,"pop","width=450, height=550, scrollbars=no")}await this.utilities.SendClickTelemetry("User clicked share button",i)}))}addListenerECCloseOverlay(t,o){t&&t.addEventListener("click",(async()=>{if(document.body&&(document.body.setAttribute("aria-hidden","false"),this.focusResultTrap&&this.focusResultTrap.release(),this.focusTestingTrap&&this.focusTestingTrap.release()),o&&this.GetShadowOverlay()){let o=e.$S.Unknown;t.id===this.divIDCloseOverlay.replace("#","")&&(o=e.$S.ProceedToCheckout),await this.utilities.SendClickTelemetry("",o)}this.localDataService.SaveLocalData(Fe.Q.ExpressCheckoutState,F.CancelEC),o.remove()}),!1)}addListenerActivateCashback(o,a){o&&o.addEventListener("click",(async()=>{if(document.body&&(document.body.setAttribute("aria-hidden","false"),this.focusResultTrap&&this.focusResultTrap.release(),this.focusTestingTrap&&this.focusTestingTrap.release()),a){const a=this.GetShadowOverlay();if(a){let i=e.$S.Unknown;if(o.id===this.cashbackUpsellJoinNowPath.replace("#","")){i=e.$S.cashbackUpsellJoinNowPath;const o=this.selectElement(a,this.cashbackUpsellJoinNowPath);o&&"none"!==o.style.display&&t.a.postMessageToHost(d.Pd.ActivateCashback,[]),await this.utilities.SendClickTelemetry("",i,Jo.bS.ACTIVATE_CASHBACK),t.a.postMessageToHost("recordAsUserAction",[Jo.bS.ACTIVATE_CASHBACK_NEW])}}const i=this.selectElement(document,"#"+this.divIDOverlay);i&&i.remove()}}))}handleBNPLResult(t){const o=this.selectElement(document,"#"+this.divIDOverlay);this.handleTotalAmountDialogLoading(!1),"true"===t?(document.body&&(document.body.setAttribute("aria-hidden","false"),this.focusResultTrap&&this.focusResultTrap.release(),this.focusTestingTrap&&this.focusTestingTrap.release()),this.localDataService.SaveLocalData(Fe.Q.ExpressCheckoutState,F.CancelEC),o.remove()):this.showTotalAmountDialogErrorMsg(e.aK.SERVER_ERROR)}showTotalAmountDialogErrorMsg(t,o,a){const i=this.GetShadowOverlay(),r=this.selectElement(i,this.bnplErrorMsgContainerPath);let n="";switch(t){case e.aK.VALIDATION_ERROR:const t=[this.getBNPLProviderData()?.name,`$${o}`,`$${a}`,`$${o}`,`$${a}`];n=this.platformInstance.GetResourceString(De.EcWalletExtraDialogValidationError).replace(/\$[1-9]/g,(e=>t[e[1]-1]));break;case e.aK.SERVER_ERROR:n=this.replaceStrWithBNPLProvider(De.EcWalletExtraDialogConnectIssue)}const s=this.selectElement(r,this.bnplErrorTextPath);this.utilities.UpdateLocalizedText(r,this.bnplErrorTextPath,n),n?(this.ShowDiv(r),s.setAttribute("role","alert")):(this.HideDiv(r),s.removeAttribute("role"))}async isFieldVisible(e,t){if(h.ZP.IsValidDataField(t)){const o=await e.HandleMessage(new tt(le.CountMatchingElements,t,""));return!!o&&o.NumElements>0}return!1}GetShadowOverlay(){const e=this.selectElement(document,"#"+this.divIDOverlay);return e?.shadowRoot}AddShareHtml(e){const t=this.selectElement(e,"#txtOverlayShare");t&&(t.innerText=this.platformInstance.GetResourceString(De.CouponShareSavingsRefresh));const o=this.selectElement(e,this.shareFBPath);if(o){o.innerHTML=Re.Z.getTrustedHTML`<svg aria-hidden="true" width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">
    <mask id="mask0" mask-type="alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="25" height="25">
    <rect x="0.5" y="0.503906" width="24" height="24" fill="#C4C4C4"/>
    </mask>
    <g mask="url(#mask0)">
    <circle cx="12.5" cy="12.5039" r="12" fill="url(#paint0_linear)"/>
    <path d="M13.9562 20.4124V13.2965H16.4328L16.8035 10.5233H13.9562V8.75273C13.9562 7.94984 14.1874 7.40263 15.3813 7.40263L16.9039 7.40195V4.92166C16.6404 4.88798 15.7367 4.8125 14.6852 4.8125C12.4899 4.8125 10.9869 6.10482 10.9869 8.47822V10.5234H8.50391V13.2966H10.9868V20.4125L13.9562 20.4124Z" fill="white"/>
    </g>
    <defs>
    <linearGradient id="paint0_linear" x1="5.75" y1="2.00391" x2="19.25" y2="24.5039" gradientUnits="userSpaceOnUse">
    <stop stop-color="#17A6FB"/>
    <stop offset="1" stop-color="#0369E9"/>
    </linearGradient>
    </defs>
    </svg>`;const e=this.platformInstance.GetResourceString(De.FacebookShare);o.setAttribute("aria-label",e),o.classList.remove(this.divOverlayHide),o.classList.add(this.divOverlayInlineShow)}const a=this.selectElement(e,this.shareTwitterPath);if(a){a.innerHTML=Re.Z.getTrustedHTML`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 400 400" style="enable-background:new 0 0 400 400;" xml:space="preserve">
    <style type="text/css">
        .st0{fill:#1B9DF0;}
        .st1{fill:#FFFFFF;}
    </style>
    <g id="Dark_Blue">
        <circle class="st0" cx="200" cy="200" r="200"/>
    </g>
    <g id="Logo__x2014__FIXED">
        <path class="st1" d="M163.4,305.5c88.7,0,137.2-73.5,137.2-137.2c0-2.1,0-4.2-0.1-6.2c9.4-6.8,17.6-15.3,24.1-25   c-8.6,3.8-17.9,6.4-27.7,7.6c10-6,17.6-15.4,21.2-26.7c-9.3,5.5-19.6,9.5-30.6,11.7c-8.8-9.4-21.3-15.2-35.2-15.2   c-26.6,0-48.2,21.6-48.2,48.2c0,3.8,0.4,7.5,1.3,11c-40.1-2-75.6-21.2-99.4-50.4c-4.1,7.1-6.5,15.4-6.5,24.2   c0,16.7,8.5,31.5,21.5,40.1c-7.9-0.2-15.3-2.4-21.8-6c0,0.2,0,0.4,0,0.6c0,23.4,16.6,42.8,38.7,47.3c-4,1.1-8.3,1.7-12.7,1.7   c-3.1,0-6.1-0.3-9.1-0.9c6.1,19.2,23.9,33.1,45,33.5c-16.5,12.9-37.3,20.6-59.9,20.6c-3.9,0-7.7-0.2-11.5-0.7   C110.8,297.5,136.2,305.5,163.4,305.5"/>
    </g>
    </svg>`;const e=this.platformInstance.GetResourceString(De.TwitterShare);a.setAttribute("aria-label",e),a.classList.remove(this.divOverlayHide),a.classList.add(this.divOverlayInlineShow)}const i=this.selectElement(e,this.sharePath);i&&(i.classList.remove(this.divOverlayHide),i.classList.add(this.divOverlayGridShow))}AddImportFromBrowserHtml(e){const t=this.localDataService.GetLocalData(Fe.Q.ImportOptions);if(t&&t.shouldTriggerImportFeatures&&this.edgeMessageService.SendTriggerImportFeature(),t&&t.shouldTriggerImportFeatures&&t.shouldShowImportCheckBox&&t.primaryBrowserName){const o=this.selectElement(e,"#divImportBrowser");if(o){let a=this.platformInstance.GetResourceString(t.importCheckBoxText??De.ContinuousImportCheckBoxText);a||(a=this.platformInstance.GetResourceString(De.importFromPrimaryBrowser)),a=a.replace(/\$\d/,t.primaryBrowserName);const i=document.createElement("DIV");i.id="divImportBrowserWrapper";const r=document.createElement("input");r.type="checkbox",r.checked=!0,r.id=this.divImportCheckBox,r.style.transform="scale(1.4, 1.4)",r.checked?this.utilities.UpdateLocalizedText(e,this.divIDCloseOverlay,De.successImportExitButton):this.utilities.UpdateLocalizedText(e,this.divIDCloseOverlay,De.successExitButton),r.addEventListener("change",(()=>{r.checked?this.utilities.UpdateLocalizedText(e,this.divIDCloseOverlay,De.successImportExitButton):this.utilities.UpdateLocalizedText(e,this.divIDCloseOverlay,De.successExitButton)}));const n=document.createElement("label"),s=this.platformInstance.GetResourceString(t.privacyLabeltext??De.PrivacyStatement),c=document.createElement("A");c.target="_blank",c.style.color="#0078D7",c.style.display="inline-block",c.style.marginLeft="3px",c.href="https://privacy.microsoft.com/en-us/privacystatement",c.textContent=s,n.textContent=a,n.appendChild(c),n.className="txtMedium",n.style.textAlign="start";const l=e.querySelectorAll(".hrDivider");if(l){const e=this.utilities.IsDarkTheme();l.forEach((t=>{e?(n.style.color="#B9B9B9",t&&(t.style.color="#5F5F5F")):(n.style.color="rgba(0, 0, 0, 0.55)",t&&(t.style.color="#E8E8E8"))}))}n.style.marginLeft="10px",i.appendChild(r),i.appendChild(n),o.appendChild(i),o.classList.remove("divOverlayHide"),o.classList.add("divOverlayShow"),this.edgeMessageService.SendImportCheckboxShownMessage()}}}async HandleCheckoutProgress(e){if(this.localDataService.IsFeatureEnabled(ft.expressCheckout)){const t=this.GetShadowOverlay();if(this.HideDiv(this.selectElement(t,"#divOverlayProgress")),this.HideDiv(this.selectElement(t,this.titleProgressBar)),this.HideDiv(this.selectElement(t,this.txtCurrentCoupon)),t){const o=this.selectElement(t,"#txtBarCheckoutTitle");let a=this.platformInstance.GetResourceString(De.ECProgressAddress);if(e.Status===F.AutoApplyDone){a=this.platformInstance.GetResourceString(De.ECProgressAddress),window.trustedTypes&&(o.innerHTML=window.trustedTypes.emptyHTML);const e=document.createElement("SPAN");e.className="ecspan",e.textContent=`${this.platformInstance.GetResourceString(De.ECApplyCoupons)} > ${this.platformInstance.GetResourceString(De.ECAddress)}`;const t=document.createTextNode(`${this.getPaymentProcessStr()}`);e.appendChild(t),o.appendChild(e)}else if(e.Status===F.AddressDone){if(a=this.BNPLProvider()?"":this.platformInstance.GetResourceString(De.ECProgressPayment),o){const e=o.innerText;window.trustedTypes&&(o.innerHTML=window.trustedTypes.emptyHTML);const t=document.createElement("SPAN");if(t.className="ecspan",this.BNPLProvider()){t.textContent=e.replace(this.BNPLProcessStr(),""),o.appendChild(t);const a=document.createTextNode(this.BNPLProcessStr());o.appendChild(a)}else t.textContent=e,o.appendChild(t)}}else e.Status===F.PaymentDone&&(a=this.platformInstance.GetResourceString(De.ECProgressPayment));e.Status===F.AddressDone&&await this.MoveProgressBar(50,100,this.divIDProgressBar);const i=this.selectElement(t,"#txtECCurrentProgressTitle");i&&(i.textContent=a),this.ShowDiv(this.selectElement(t,"#txtECCurrentProgressTitle"))}}}GetProgressTitle(e){return e?`${this.platformInstance.GetResourceString(De.ECApplyCoupons)} >\n             ${this.platformInstance.GetResourceString(De.ECAddress)} ${this.getPaymentProcessStr()}`:this.isAutofillPaymentToggleOff()?"":`${this.platformInstance.GetResourceString(De.ECAddress)} ${this.getPaymentProcessStr()}`}async ShowECOnlyCheckoutProgress(e,t){const o=this.GetShadowOverlay();if(o){let a;if(this.HideDiv(this.selectElement(o,"#divOverlayProgress")),this.isAutofillPaymentToggleOff())a="";else{a=document.createElement("span");const e=document.createElement("span");e.className="ecspan",e.append(this.platformInstance.GetResourceString(De.ECAddress));const t=document.createElement("span");t.className="ecspangrey",t.append(this.getPaymentProcessStr()),a.append(e),a.append(t)}e&&(a=this.GetProgressTitle(e));const i=this.selectElement(o,"#txtBarCheckoutTitle");i&&(this.ShowDiv(i),i.append(a));let r=this.platformInstance.GetResourceString(De.ECProgressAddress);if(t===F.AutoApplyDone){if(e){const e=this.platformInstance.GetResourceString(De.ECApplyCoupons)+" > "+this.platformInstance.GetResourceString(De.ECAddress),t=document.createElement("SPAN");t.className="ecspan",t.textContent=e;const o=document.createTextNode(this.getPaymentProcessStr());t.appendChild(o),window.trustedTypes&&(i.innerHTML=window.trustedTypes.emptyHTML),i.appendChild(t)}r=this.platformInstance.GetResourceString(De.ECProgressAddress)}else if(t===F.AddressDone){if(r=this.BNPLProvider()?"":this.platformInstance.GetResourceString(De.ECProgressPayment),e){window.trustedTypes&&(i.innerHTML=window.trustedTypes.emptyHTML);const t=document.createElement("SPAN");t.className="ecspan",t.textContent=this.GetProgressTitle(e),i.appendChild(t)}}else t===F.PaymentDone&&(r=this.platformInstance.GetResourceString(De.ECProgressPayment));t===F.AddressDone&&await this.MoveProgressBar(50,100,this.divIDProgressBar);const n=this.selectElement(o,"#txtECCurrentProgressTitle");n&&(this.ShowDiv(n),n.textContent=r)}}ShowCheckoutProgress(){const e=this.GetShadowOverlay();if(e){const t=this.selectElement(e,"#txtBarCheckoutTitle");if(t){const e=document.createElement("span");e.className="ecspan",e.textContent=this.platformInstance.GetResourceString(De.ECApplyCoupons);const o=document.createTextNode(`> ${this.platformInstance.GetResourceString(De.ECAddress)} ${this.getPaymentProcessStr()}`);t.appendChild(e),t.appendChild(o),this.ShowDiv(t)}}}HideDiv(e){e&&e.classList.add(this.divOverlayHide)}ShowDiv(e){e&&e.classList.remove(this.divOverlayHide)}isAutofillPaymentToggleOff(){const{BNPLProvider:e,IsSkipPayment:t}=this.localDataService.GetLocalData(Fe.Q.CheckoutUserData);return t&&!e}BNPLProvider(){return this.localDataService.GetLocalData(Fe.Q.CheckoutUserData)?.BNPLProvider}getTotalAmountDialogData(){return this.localDataService.GetLocalData(Fe.Q.CheckoutUserData)?.TotalAmountDialogData}getBNPLProviderData(){return new Be(this.platformInstance,this.BNPLProvider()).getData()}replaceStrWithBNPLProvider(e){return this.platformInstance.GetResourceString(e).replace("$1",this.getBNPLProviderData()?.name)}BNPLProcessStr(){return this.replaceStrWithBNPLProvider(De.CheckoutWithNewPaymentOption)}getPaymentProcessStr(){return this.isAutofillPaymentToggleOff()?"":`> ${this.BNPLProvider()?this.BNPLProcessStr():this.platformInstance.GetResourceString(De.ECPayment)}`}UpdateCurrentCoupon(e,t,o,a,i){const r=this.GetShadowOverlay();if(r){const n=this.selectElement(r,this.titleProgressBar);if(n){const e=this.platformInstance.GetResourceString(De.inProgressLoaderTextTop);e&&(n.textContent=e.replace("$1",t.toString()).replace("$2",o.toString()))}const s=this.selectElement(r,"#spanTestingCoupons"),c=i?this.platformInstance.GetResourceString(De.SuggestedCouponsText):e,l=this.changeCouponText(r,c);if("OtherSeller"===e&&(l.textContent=this.platformInstance.GetResourceString(De.OS_InProgressLoaderTextBottom)),s&&s.innerText&&l&&l.innerText&&n&&n.innerText&&(s.innerText=l.textContent+" "+n.textContent),a>=.01){const e=this.selectElement(r,this.divIDTestingCoupon);if(e){let t=this.platformInstance.GetResourceString(De.currentBestDiscount);this.checkoutPageUrlData?.supportedNoOrderTotal&&(t=this.platformInstance.GetResourceString(De.currentBestDiscountNOT)),"you saved $1 so far"===t&&(t="You have saved $1 so far!");const o=(0,Ee.Jl)(this.currency),i=this.selectElement(e,"#txtProgressTitle");i&&(i.classList.add("txtOverlayResultPositive"),i.textContent=t.replace("$1",this.formatPrice(o,a)));const n=this.selectElement(r,this.shareFBPath);this.addListenerShare(n,a);const s=this.selectElement(r,this.shareTwitterPath);this.addListenerShare(s,a);const c=r.querySelector("#btnOverlayCancel");c&&(c.removeEventListener("click",this.cancelListenerCallback),c.textContent=this.platformInstance.GetResourceString(De.PauseButtonPauseAndApply),this.addListenerPauseOverlay(c,this.overlay))}}}}showResultMainDiv(e,t){e.setAttribute("aria-hidden","true");const o=e.querySelector("#txtBarTitle");o&&o.setAttribute("aria-hidden","true"),e.classList.remove("divOverlayShow"),e.classList.add("divOverlayHide"),this.focusTestingTrap&&this.focusTestingTrap.release(),this.UpdateIconImage(t),t.setAttribute("aria-hidden","false"),t.classList.remove("divOverlayHide"),t.classList.add("divOverlayShow"),t.classList.add("divOverlayContentWrapper"),t.focus()}UpdateIconImage(t){const o=t.querySelector(this.iconImgPath);if(o)if(this.platformInstance.GetAppInfoClientName()===e.BN.Sapphire)o.src=this.localDataService.GetLocalData(Fe.Q.Icon),o.style.height="24px",o.style.width="auto";else if(at.IS.includes(this.platformInstance.GetAppInfoClientName())){o.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDIwIDIwIiBmaWxsPSJub25lIj4KICAgICAgICA8cGF0aCBkPSJNMTguMDUwNyAxNC44ODU1QzE3Ljc4NzggMTUuMDIzMyAxNy41MTMyIDE1LjE0NjUgMTcuMjI3OCAxNS4yNTM3QzE2LjM2OTkgMTUuNTc2IDE1LjQyMjQgMTUuNzU4NyAxNC40MjMgMTUuNzU4N0MxMC43MjYxIDE1Ljc1ODcgNy41MDU1OSAxMy4yMTU2IDcuNTA1NTkgOS45NTIyMUM3LjUwNTU5IDkuMDM0NjIgOC4wMzY1MSA4LjIzOTIyIDguNzg4ODYgNy44MjAzMUM1LjQ0NTQzIDcuOTYwNDcgNC41ODU5NCAxMS40NDUzIDQuNTg1OTQgMTMuNDg2OEM0LjU4NTk0IDE5LjI1ODEgOS45MDU0MyAxOS44NDM5IDExLjA1MTcgMTkuODQzOUMxMS42Njk0IDE5Ljg0MzkgMTIuNjAxNyAxOS42NjM5IDEzLjE2MzQgMTkuNDg3OEMxMy4xOTc3IDE5LjQ3NjMgMTMuMjMxOCAxOS40NjQ5IDEzLjI2NTggMTkuNDUzMUMxNS40MzQ1IDE4LjcwNTIgMTcuMjY0OSAxNy4yMzM4IDE4LjQ2ODIgMTUuMzI2NUMxOC42NDA3IDE1LjA1MyAxOC4zMzcyIDE0LjczNTIgMTguMDUwNyAxNC44ODU1WiIgZmlsbD0idXJsKCNwYWludDBfbGluZWFyKSIvPgogICAgICAgIDxwYXRoIG9wYWNpdHk9IjAuMzUiIGQ9Ik0xOC4wNTA3IDE0Ljg4NTVDMTcuNzg3OCAxNS4wMjMzIDE3LjUxMzIgMTUuMTQ2NSAxNy4yMjc4IDE1LjI1MzdDMTYuMzY5OSAxNS41NzYgMTUuNDIyNCAxNS43NTg3IDE0LjQyMyAxNS43NTg3QzEwLjcyNjEgMTUuNzU4NyA3LjUwNTU5IDEzLjIxNTYgNy41MDU1OSA5Ljk1MjIxQzcuNTA1NTkgOS4wMzQ2MiA4LjAzNjUxIDguMjM5MjIgOC43ODg4NiA3LjgyMDMxQzUuNDQ1NDMgNy45NjA0NyA0LjU4NTk0IDExLjQ0NTMgNC41ODU5NCAxMy40ODY4QzQuNTg1OTQgMTkuMjU4MSA5LjkwNTQzIDE5Ljg0MzkgMTEuMDUxNyAxOS44NDM5QzExLjY2OTQgMTkuODQzOSAxMi42MDE3IDE5LjY2MzkgMTMuMTYzNCAxOS40ODc4QzEzLjE5NzcgMTkuNDc2MyAxMy4yMzE4IDE5LjQ2NDkgMTMuMjY1OCAxOS40NTMxQzE1LjQzNDUgMTguNzA1MiAxNy4yNjQ5IDE3LjIzMzggMTguNDY4MiAxNS4zMjY1QzE4LjY0MDcgMTUuMDUzIDE4LjMzNzIgMTQuNzM1MiAxOC4wNTA3IDE0Ljg4NTVaIiBmaWxsPSJ1cmwoI3BhaW50MV9yYWRpYWwpIi8+CiAgICAgICAgPHBhdGggZD0iTTguMjU4NzQgMTguODYwNUM3LjU2Mzg4IDE4LjQyOTggNi45NjA2NiAxNy44NjE4IDYuNDgyNTQgMTcuMTkwNUM1Ljc0MjY5IDE2LjE1MTggNS4zMDAzOCAxNC44NzQgNS4zMDAzOCAxMy40ODY3QzUuMzAwMzggMTEuNDQ1MyA2LjI1MDk4IDkuNjM3MSA3LjcxNjI4IDguNDkxNDdDOC4wNDkwNSA4LjIzMTMxIDguNDc1MTUgNy45Njg4OCA4Ljc4OTE0IDcuODIwMjlDOS4wMzI4OSA3LjcwNDg2IDkuNDQ5ODUgNy40OTcwNCAxMC4wMDM2IDcuNTA0ODlDMTAuOTIxNyA3LjUxNzkgMTEuNjE1NCA3Ljk4NTk5IDEyLjAxMDMgOC41MTc1NkMxMi4zMTM3IDguOTI2IDEyLjUwMDcgOS40MjkyMSAxMi41MDcgOS45NzU0NkMxMi41MDcyIDkuOTU5MDYgMTQuNDE4MyAzLjc1NjM1IDYuMjUzMTIgMy43NTYzNUMyLjgyMzk1IDMuNzU2MzUgMCA3LjAxMTggMCA5Ljg2Njk1QzAgMTEuNjc4MSAwLjQyMDI2NCAxMy4xMjQgMC45NDY0NjEgMTQuMjQ0NkMyLjExODM5IDE2Ljc0MDcgNC4yOTE2NCAxOC42NzI2IDYuOTUwMDggMTkuNTIzN0M3LjkxMjggMTkuODMyIDguOTM4NDQgMjAgMTAuMDAzNiAyMEMxMS4xMDg0IDIwIDEyLjE3MDEgMTkuODE4MyAxMy4xNjM3IDE5LjQ4NzdDMTIuNjAyIDE5LjY2MzkgMTIuMDA2NCAxOS43NjA0IDExLjM4ODggMTkuNzYwNEMxMC4yNDI2IDE5Ljc2MDQgOS4xNzQyMiAxOS40MjggOC4yNTg3NCAxOC44NjA1WiIgZmlsbD0idXJsKCNwYWludDJfbGluZWFyKSIvPgogICAgICAgIDxwYXRoIG9wYWNpdHk9IjAuNDEiIGQ9Ik04LjI1ODc0IDE4Ljg2MDVDNy41NjM4OCAxOC40Mjk4IDYuOTYwNjYgMTcuODYxOCA2LjQ4MjU0IDE3LjE5MDVDNS43NDI2OSAxNi4xNTE4IDUuMzAwMzggMTQuODc0IDUuMzAwMzggMTMuNDg2N0M1LjMwMDM4IDExLjQ0NTMgNi4yNTA5OCA5LjYzNzEgNy43MTYyOCA4LjQ5MTQ3QzguMDQ5MDUgOC4yMzEzMSA4LjQ3NTE1IDcuOTY4ODggOC43ODkxNCA3LjgyMDI5QzkuMDMyODkgNy43MDQ4NiA5LjQ0OTg1IDcuNDk3MDQgMTAuMDAzNiA3LjUwNDg5QzEwLjkyMTcgNy41MTc5IDExLjYxNTQgNy45ODU5OSAxMi4wMTAzIDguNTE3NTZDMTIuMzEzNyA4LjkyNiAxMi41MDA3IDkuNDI5MjEgMTIuNTA3IDkuOTc1NDZDMTIuNTA3MiA5Ljk1OTA2IDE0LjQxODMgMy43NTYzNSA2LjI1MzEyIDMuNzU2MzVDMi44MjM5NSAzLjc1NjM1IDAgNy4wMTE4IDAgOS44NjY5NUMwIDExLjY3ODEgMC40MjAyNjQgMTMuMTI0IDAuOTQ2NDYxIDE0LjI0NDZDMi4xMTgzOSAxNi43NDA3IDQuMjkxNjQgMTguNjcyNiA2Ljk1MDA4IDE5LjUyMzdDNy45MTI4IDE5LjgzMiA4LjkzODQ0IDIwIDEwLjAwMzYgMjBDMTEuMTA4NCAyMCAxMi4xNzAxIDE5LjgxODMgMTMuMTYzNyAxOS40ODc3QzEyLjYwMiAxOS42NjM5IDEyLjAwNjQgMTkuNzYwNCAxMS4zODg4IDE5Ljc2MDRDMTAuMjQyNiAxOS43NjA0IDkuMTc0MjIgMTkuNDI4IDguMjU4NzQgMTguODYwNVoiIGZpbGw9InVybCgjcGFpbnQzX3JhZGlhbCkiLz4KICAgICAgICA8cGF0aCBkPSJNMTEuODk5MiAxMS42Mjk2QzExLjgzNTkgMTEuNzExNiAxMS42NDExIDExLjgyNDcgMTEuNjQxMSAxMi4wNzIxQzExLjY0MTEgMTIuMjc1NiAxMS43NzM5IDEyLjQ3MTggMTIuMDEgMTIuNjM2NkMxMy4xMzM1IDEzLjQyMDcgMTUuMjUxMSAxMy4zMTUgMTUuMjU2OCAxMy4zMTVDMTYuMTMxIDEzLjMxMiAxNi45MTc0IDEzLjA3MTYgMTcuNjIxOSAxMi42NTk3QzE3Ljk0MjMgMTIuNDcyNCAxOC4yMzkgMTIuMjQ5OCAxOC41MDY0IDExLjk5NTZDMTkuNDI0MiAxMS4xMjM1IDE5Ljk4MzcgOS44OTQ1NCAxOS45OTkyIDguNTI4OThDMjAuMDE5MiA2Ljc3Nzc4IDE5LjM3NzQgNS42MTM1NCAxOS4xMTM1IDUuMDk4MDJDMTcuNDU3OSAxLjg2MjIgMTMuODgzOSAwIDkuOTk3OTEgMEM0LjUyMDE2IDAgMC4wNzM1MDY5IDQuNDAyMDggMCA5Ljg1OTQ2QzAuMDM3MTM0NyA3LjAwNDU0IDIuODc0NTMgNC42OTkxNSA2LjI0NzM5IDQuNjk5MTVDNi41MjA4NiA0LjY5OTE1IDguMDgwMzkgNC43MjU4MiA5LjUyOTA3IDUuNDg2MTVDMTAuODA1MiA2LjE1NTkgMTEuNDc0MiA2Ljk2NTE5IDExLjkzOTIgNy43NjgwMkMxMi40MjIxIDguNjAxNjQgMTIuNTA4IDkuNjU0NDYgMTIuNTA4IDEwLjA3NDJDMTIuNTA4IDEwLjQ5NCAxMi4yOTY0IDExLjExNTUgMTEuODk5MiAxMS42Mjk2WiIgZmlsbD0idXJsKCNwYWludDRfcmFkaWFsKSIvPgogICAgICAgIDxwYXRoIGQ9Ik0xMS44OTkyIDExLjYyOTZDMTEuODM1OSAxMS43MTE2IDExLjY0MTEgMTEuODI0NyAxMS42NDExIDEyLjA3MjFDMTEuNjQxMSAxMi4yNzU2IDExLjc3MzkgMTIuNDcxOCAxMi4wMSAxMi42MzY2QzEzLjEzMzUgMTMuNDIwNyAxNS4yNTExIDEzLjMxNSAxNS4yNTY4IDEzLjMxNUMxNi4xMzEgMTMuMzEyIDE2LjkxNzQgMTMuMDcxNiAxNy42MjE5IDEyLjY1OTdDMTcuOTQyMyAxMi40NzI0IDE4LjIzOSAxMi4yNDk4IDE4LjUwNjQgMTEuOTk1NkMxOS40MjQyIDExLjEyMzUgMTkuOTgzNyA5Ljg5NDU0IDE5Ljk5OTIgOC41Mjg5OEMyMC4wMTkyIDYuNzc3NzggMTkuMzc3NCA1LjYxMzU0IDE5LjExMzUgNS4wOTgwMkMxNy40NTc5IDEuODYyMiAxMy44ODM5IDAgOS45OTc5MSAwQzQuNTIwMTYgMCAwLjA3MzUwNjkgNC40MDIwOCAwIDkuODU5NDZDMC4wMzcxMzQ3IDcuMDA0NTQgMi44NzQ1MyA0LjY5OTE1IDYuMjQ3MzkgNC42OTkxNUM2LjUyMDg2IDQuNjk5MTUgOC4wODAzOSA0LjcyNTgyIDkuNTI5MDcgNS40ODYxNUMxMC44MDUyIDYuMTU1OSAxMS40NzQyIDYuOTY1MTkgMTEuOTM5MiA3Ljc2ODAyQzEyLjQyMjEgOC42MDE2NCAxMi41MDggOS42NTQ0NiAxMi41MDggMTAuMDc0MkMxMi41MDggMTAuNDk0IDEyLjI5NjQgMTEuMTE1NSAxMS44OTkyIDExLjYyOTZaIiBmaWxsPSJ1cmwoI3BhaW50NV9yYWRpYWwpIi8+CiAgICAgICAgPGRlZnM+CiAgICAgICAgPGxpbmVhckdyYWRpZW50IGlkPSJwYWludDBfbGluZWFyIiB4MT0iNC41ODU5NCIgeTE9IjEzLjgzMjEiIHgyPSIxOC41MTg1IiB5Mj0iMTMuODMyMSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPgogICAgICAgIDxzdG9wIHN0b3AtY29sb3I9IiMwQzU5QTQiLz4KICAgICAgICA8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiMxMTRBOEIiLz4KICAgICAgICA8L2xpbmVhckdyYWRpZW50PgogICAgICAgIDxyYWRpYWxHcmFkaWVudCBpZD0icGFpbnQxX3JhZGlhbCIgY3g9IjAiIGN5PSIwIiByPSIxIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSgxMi4yODE0IDEzLjkzNjEpIHNjYWxlKDcuNDUxOTMgNy4wODczMSkiPgogICAgICAgIDxzdG9wIG9mZnNldD0iMC43MTY1OSIgc3RvcC1vcGFjaXR5PSIwIi8+CiAgICAgICAgPHN0b3Agb2Zmc2V0PSIwLjk0NTkiIHN0b3Atb3BhY2l0eT0iMC41MyIvPgogICAgICAgIDxzdG9wIG9mZnNldD0iMSIvPgogICAgICAgIDwvcmFkaWFsR3JhZGllbnQ+CiAgICAgICAgPGxpbmVhckdyYWRpZW50IGlkPSJwYWludDJfbGluZWFyIiB4MT0iMTEuOTMxNiIgeTE9IjcuNzg3NzMiIHgyPSIzLjIyODc4IiB5Mj0iMTcuMjY3MiIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPgogICAgICAgIDxzdG9wIHN0b3AtY29sb3I9IiMxQjlERTIiLz4KICAgICAgICA8c3RvcCBvZmZzZXQ9IjAuMTYxNjQiIHN0b3AtY29sb3I9IiMxNTk1REYiLz4KICAgICAgICA8c3RvcCBvZmZzZXQ9IjAuNjY3NDkiIHN0b3AtY29sb3I9IiMwNjgwRDciLz4KICAgICAgICA8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiMwMDc4RDQiLz4KICAgICAgICA8L2xpbmVhckdyYWRpZW50PgogICAgICAgIDxyYWRpYWxHcmFkaWVudCBpZD0icGFpbnQzX3JhZGlhbCIgY3g9IjAiIGN5PSIwIiByPSIxIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSg1LjU3MDc0IDE1LjUyMDYpIHJvdGF0ZSgtODEuNDY0KSBzY2FsZSgxMS4xOTAzIDkuMDE3MjcpIj4KICAgICAgICA8c3RvcCBvZmZzZXQ9IjAuNzYyOTMiIHN0b3Atb3BhY2l0eT0iMCIvPgogICAgICAgIDxzdG9wIG9mZnNldD0iMC45NDU5IiBzdG9wLW9wYWNpdHk9IjAuNSIvPgogICAgICAgIDxzdG9wIG9mZnNldD0iMSIvPgogICAgICAgIDwvcmFkaWFsR3JhZGllbnQ+CiAgICAgICAgPHJhZGlhbEdyYWRpZW50IGlkPSJwYWludDRfcmFkaWFsIiBjeD0iMCIgY3k9IjAiIHI9IjEiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiBncmFkaWVudFRyYW5zZm9ybT0idHJhbnNsYXRlKDEuOTcwOTcgMy42NTY3KSByb3RhdGUoOTIuMTI5KSBzY2FsZSgxNS44MTUxIDMzLjY4MzUpIj4KICAgICAgICA8c3RvcCBzdG9wLWNvbG9yPSIjMzVDMUYxIi8+CiAgICAgICAgPHN0b3Agb2Zmc2V0PSIwLjExMDc5IiBzdG9wLWNvbG9yPSIjMzRDMUVEIi8+CiAgICAgICAgPHN0b3Agb2Zmc2V0PSIwLjIzMTY0IiBzdG9wLWNvbG9yPSIjMkZDMkRGIi8+CiAgICAgICAgPHN0b3Agb2Zmc2V0PSIwLjMxNDQ2IiBzdG9wLWNvbG9yPSIjMkJDM0QyIi8+CiAgICAgICAgPHN0b3Agb2Zmc2V0PSIwLjY3MzM4IiBzdG9wLWNvbG9yPSIjMzZDNzUyIi8+CiAgICAgICAgPC9yYWRpYWxHcmFkaWVudD4KICAgICAgICA8cmFkaWFsR3JhZGllbnQgaWQ9InBhaW50NV9yYWRpYWwiIGN4PSIwIiBjeT0iMCIgcj0iMSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIGdyYWRpZW50VHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTguOTQyNyA2LjA2MDU4KSByb3RhdGUoNzMuNjc0Nykgc2NhbGUoNy42MDQ1OCA2LjIwODc0KSI+CiAgICAgICAgPHN0b3Agc3RvcC1jb2xvcj0iIzY2RUI2RSIvPgogICAgICAgIDxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iIzY2RUI2RSIgc3RvcC1vcGFjaXR5PSIwIi8+CiAgICAgICAgPC9yYWRpYWxHcmFkaWVudD4KICAgICAgICA8L2RlZnM+CiAgICAgICAgPC9zdmc+";const e=t.querySelectorAll(".txtClientName"),a=this.platformInstance.GetResourceString(De.ShoppingInEdgeTextNew);e&&e.forEach((e=>{e.textContent=a}))}}async ECCreateOverlay(e,t,o,a,i){const r=document.createElement("DIV");r.id="divOverlayBackground";const n="\n            width: 100%;\n            height: 100%;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            position: fixed;\n            display: flex;\n            justify-content: center;\n            background-color: rgba(80,80,80,0.8);\n            z-index: 3000000000;";r.setAttribute("style",n);const s=document.createElement("DIV");s.setAttribute("style",n);const c=s.attachShadow({mode:"open",delegatesFocus:!0});c.innerHTML=t,s.id=this.divIDOverlay;const l=document.createElement("div");l.id=this.divIDContextID,l.hidden=!0,l.innerText=e.toString(),s.appendChild(l),s.appendChild(r);const d=document.getElementsByTagName("html")[0];if(o){const e=document.createElement("style");e.textContent=o,c.appendChild(e)}d&&d.appendChild(s),document.body&&document.body.setAttribute("aria-hidden","true");const u=c.querySelectorAll(this.divOverlayCancel);this.addListenerECCancelOverlay(u,s);const h=this.selectElement(c,this.divIDCheckoutOverlay);this.addListenerECCloseOverlay(h,s);const p=this.selectElement(c,this.divIDTestingCoupon);let m="";m=this.isAutofillPaymentToggleOff()?De.ECAddressInProgressTitle:this.BNPLProvider()?this.replaceStrWithBNPLProvider(De.ECWalletAddressAndOtherPaymentInProgressTitle):De.ECInProgressTitle,this.utilities.UpdateLocalizedText(p,"#txtProgressTitle",m),this.utilities.UpdateLocalizedText(p,"#btnOverlayCancel",De.inProgressExitButton),p&&(this.addCloseButton(p),this.UpdateIconImage(p),p.classList.remove("divOverlayHide"),p.classList.add("divOverlayShow"),p.classList.add("divOverlayContentWrapper"),p.setAttribute("aria-hidden","false"),h&&h.focus(),this.focusTestingTrap=this.utilities.TrapFocus(p)),document.addEventListener("keydown",(e=>{"Escape"===e.key&&(p.classList.contains("divOverlayShow")?u&&u.forEach((e=>{e.click()})):h&&h.click(),e.preventDefault())})),await this.MoveProgressBar(0,50,this.divIDProgressBar),this.ShowECOnlyCheckoutProgress(a),a&&i&&this.utilities.UpdateLocalizedText(p,"#txtProgressTitle",this.BNPLProvider()?this.replaceStrWithBNPLProvider(De.ECWalletAAAndOtherPaymentInProgressTitle):De.ECAutoApplyInProgressTitle)}async ECCreateUpdatePaymentOverlay(e,t,o){await this.ECCreateOverlay(e,t,o,!1);const a=this.GetShadowOverlay();if(a){a.querySelectorAll(this.divOverlayCancel).forEach((e=>{e.addEventListener("click",(()=>{this.edgeMessageService.SendUpdatePaymentDetailsResultMessage(null)}))}));const e=this.selectElement(a,this.divIDTestingCoupon);this.HideDiv(this.selectElement(a,"#divOverlayProgressCheckout")),this.utilities.UpdateLocalizedText(e,"#txtProgressTitle",this.replaceStrWithBNPLProvider(De.EcWalletFillingVirtualCardInfo)),this.utilities.UpdateLocalizedText(e,"#txtBarCheckoutTitle",""),this.utilities.UpdateLocalizedText(e,"#txtECCurrentProgressTitle",De.ECProgressPayment),this.ShowDiv(this.selectElement(a,"#txtECCurrentProgressTitle"))}}CreateOverlay(t,o,a,i,r,n,s,c,l,d){const u=document.createElement("DIV");u.id="divOverlayBackground";const h="\n            width: 100%;\n            height: 100%;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            position: fixed;\n            display: flex;\n            justify-content: center;\n            background-color: rgba(80,80,80,0.8);\n            z-index: 3000000000;";u.setAttribute("style",h),this.overlay=document.createElement("DIV"),this.overlay.setAttribute("style",h);const p=this.overlay.attachShadow({mode:"open",delegatesFocus:!0});p.innerHTML=t,this.overlay.id=this.divIDOverlay;const m=document.createElement("div");m.id=this.divIDContextID,m.hidden=!0,m.innerText=s.toString(),this.overlay.appendChild(m),this.overlay.appendChild(u);const g=document.getElementsByTagName("html")[0];if(l){const e=document.createElement("style");e.textContent=l,p.appendChild(e)}g&&g.appendChild(this.overlay),document.body&&document.body.setAttribute("aria-hidden","true");const C=p.querySelectorAll(this.divOverlayCancel);this.addListenerCancelOverlay(C,this.overlay,d);const S=this.selectElement(p,this.divIDCloseOverlay);this.addListenerCloseOverlay(this.overlay,S,this.checkoutPageUrlData);const f=this.selectElement(p,this.useBingRebatesPath);this.addListenerCloseOverlay(this.overlay,f,this.checkoutPageUrlData);const v=this.selectElement(p,this.shareFBPath);this.addListenerShare(v,c);const A=this.selectElement(p,this.shareTwitterPath);this.addListenerShare(A,c);const y=this.selectElement(p,this.divIDTestingCoupon);if(this.platformInstance.GetAppInfoClientName()===e.BN.Sapphire){let e=this.platformInstance.GetResourceString(De.inProgressSapphireTitle);e=e.replace(/\$\d/,this.localDataService.GetLocalData(Fe.Q.AppName)),this.utilities.UpdateText(y,"#txtProgressTitle",e)}else{let e="";e="OtherSeller"===o?De.OS_InProgressTitle:this.localDataService.IsFeatureEnabled(ft.expressCheckout)?this.BNPLProvider()?this.replaceStrWithBNPLProvider(De.ECWalletAAAndOtherPaymentInProgressTitle):De.ECAutoApplyInProgressTitle:jt.R.isExperimentActive(mo.H.inProgressTitleV1)?De.inProgressTitleV1:jt.R.isExperimentActive(mo.H.inProgressTitleV2)?De.inProgressTitleV2:De.inProgressTitle,this.utilities.UpdateLocalizedText(y,"#txtProgressTitle",e)}if(this.utilities.UpdateLocalizedText(y,"#btnOverlayCancel",De.inProgressExitButton),this.UpdateCurrentCoupon(o,a,i,c),this.SetInitialProgressBar(n,this.divIDProgressBar),y){this.addCloseButton(y),this.UpdateIconImage(y);const e=y.querySelector("#vdoTestingCoupons");if(e){e.src=this.utilities.IsDarkTheme()?"https://www.bing.com/api/shopping/v1/ux/images/autoApply/Shopping_Progress_Dark_01.mp4":"https://www.bing.com/api/shopping/v1/ux/images/autoApply/Shopping_Progress_01.mp4";const t=e.parentElement;t&&(t.muted=!0,t.load(),this.isAnimationReduce()||t.addEventListener("loadeddata",(()=>{t.play()})))}y.classList.remove("divOverlayHide"),y.classList.add("divOverlayShow"),y.classList.add("divOverlayContentWrapper"),y.setAttribute("aria-hidden","false"),S&&S.focus(),this.focusTestingTrap=this.utilities.TrapFocus(y)}document.addEventListener("keydown",(e=>{"Escape"===e.key&&(y.classList.contains("divOverlayShow")?C&&C.forEach((e=>{e.click()})):S&&S.click(),e.preventDefault())})),this.localDataService.IsFeatureEnabled(ft.expressCheckout)&&this.ShowCheckoutProgress()}async CloseWalletDrawer(e){e&&this.localDataService.SaveLocalData(Fe.Q.ExpressCheckoutState,F.CancelEC),this.HasWalletDrawerOverlay()&&this.selectElement(document,"#"+this.divIDOverlay).remove()}async WalletDrawerSkipCoupon(){Xe.isAutoApplySkipped=!0,this.localDataService.SaveLocalData(Fe.Q.WalletDrawerShouldSkipCoupon,!0)}WalletDrawerCreateOverlay(e){if(this.HasWalletDrawerOverlay())return;const t=document.createElement("DIV");t.id="divOverlayBackground";const o="\n            width: 100%;\n            height: 100%;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            position: fixed;\n            display: flex;\n            justify-content: center;\n            background-color: rgba(80,80,80,0.3);\n            z-index: 3000000000;";t.setAttribute("style",o);const a=document.createElement("DIV");a.setAttribute("style",o),a.id=this.divIDOverlay,a.className=this.divWalletDrawerOverlay;const i=document.createElement("div");i.id=this.divIDContextID,i.hidden=!0,i.innerText=e.toString(),a.appendChild(i),a.appendChild(t);const r=document.getElementsByTagName("html")[0];r&&r.appendChild(a),document.body&&document.body.setAttribute("aria-hidden","true")}HasWalletDrawerOverlay(){const e=this.selectElement(document,"#"+this.divIDOverlay);return e?.className===this.divWalletDrawerOverlay}ShowResult(t,o,a,i,n,s,c,l,d){const u=this.GetShadowOverlay();if(u){const h=this.selectElement(u,this.divIDProgressBar),p=this.selectElement(u,this.divIDTestingCoupon),m=this.selectElement(u,this.resultPath);if(h&&p&&m){if(window?.trustedTypes){const e=window.trustedTypes.emptyHTML;h.innerHTML=e}else h.innerHTML="";const g=u.querySelectorAll(this.resultWrapperPath);if(g){g.forEach((e=>{e.className="resultWrapper divOverlayHide"})),this.addCloseButton(m);const u=this.GetAttainableCoupon(c,a);let h=!1;if(t===e.ps.Negative&&this.isUnblockedForRewardsCampaign()&&d&&d.isValidRewardsData()){const t=jt.R.isExperimentActive(mo.H.autoApplyRewardsOverlay)?e.zy.RewardsEligibleTowerTreatment:e.zy.RewardsEligibleTowerControl,o=jt.R.isExperimentActive(mo.H.autoApplyRewardsOverlay)?"Shopping rewards Treatment tower":"Shopping rewards Control tower",a=new Js.Z((0,r.S8)(),e.oN.AARewards,location.pathname,t);this.platformInstance.SendMessage(new me(e.R.ShoppingRewards,e.in.Information,o,a))}if(t===e.ps.Negative&&this.isUnblockedForRewardsCampaign()&&d&&d.isValidRewardsData()&&jt.R.isExperimentActive(mo.H.autoApplyRewardsOverlay)&&"2"==jt.R.getServiceExperimentValue(mo.H.autoApplyRewardsOverlay)){const t=e.zy.RewardsEligibleTowerTreatment,o="AARewards hides Overlay Treatment",a=new it.Z(e.xu.AARewards,void 0,void 0,(0,r.S8)(),t);this.platformInstance.SendMessage(new me(e.R.EdgeFlyoutStatus,e.in.Information,o,a))}if(t===e.ps.Positive&&void 0!==o&&void 0!==a&&i){if(o>=.01||this.checkoutPageUrlData?.supportedNoOrderTotal){const t=c?.filter((e=>e.couponCode===i))?.[0]?.isPrivateCoupon??!1;this.SetPositiveResult(m,o,a,i,n,s,u,t),g[0].className="resultWrapper divOverlayShow",this.showResultMainDiv(p,m);try{const t=(0,Ee.Jl)(this.currency),i=this.formatPrice(t,a-o);if(i&&i){const t=new Ve;t.init(ot.g.EdgeImpressionId,(0,r.S8)(),location.pathname,e.G7.Driver,this.edgeMessageService,this.localDataService),t.updateTotalPriceInStorage(i)}}catch(e){(0,r.Md)("error in updating total price "+e)}}}else if(t===e.ps.Negative&&n&&this.shouldOfferCashBack(n))this.SetNegativeResultCashbackUpsell(m,n),this.handleCashbackUpsellTelemetry(n),g[2].className="resultWrapper divOverlayShow",this.showResultMainDiv(p,m);else if(t===e.ps.Negative&&this.isUnblockedForRewardsCampaign()&&d&&d.isValidRewardsData()&&"2"!=jt.R.getServiceExperimentValue(mo.H.autoApplyRewardsOverlay)){if(this.SetNegativeResultUpsellRewards(m,d),g[5].className="resultWrapper divOverlayShow",this.showResultMainDiv(p,m),h=!0,"1"==jt.R.getServiceExperimentValue(mo.H.autoApplyRewardsOverlay)){const t=e.zy.RewardsEligibleTowerControl,o="AARewards Overlay for Control",a=new it.Z(e.xu.AARewards,void 0,void 0,(0,r.S8)(),t);this.platformInstance.SendMessage(new me(e.R.EdgeFlyoutStatus,e.in.Information,o,a))}}else t===e.ps.Negative&&n&&!this.shouldOfferCashBack(n)?(this.SetNegativeResult(m,u,a,n),g[1].className="resultWrapper divOverlayShow",this.showResultMainDiv(p,m)):t===e.ps.Error&&(!0!==l?(this.SetErrorResult(m),g[3].className="resultWrapper divOverlayShow"):c&&c.length>=1&&(this.SetShortcircuitResult(m,c[0]),g[4].className="resultWrapper divOverlayShow"),this.showResultMainDiv(p,m));const C=m.querySelector(this.divIDCloseOverlay);C&&C.focus();const S=Qs.StorageKeyPrefix+(0,r.S8)();this.edgeMessageService.SetStorageValue(S,JSON.stringify({value:h.toString()})),this.addListenerCloseOverlay(this.overlay,void 0,this.checkoutPageUrlData,void 0,!0)}this.focusResultTrap=this.utilities.TrapFocus(m)}}}ECShowResult(e,t,o,a,i){const n=this.selectElement(document,"#"+this.divIDOverlay),s=n?.shadowRoot;if(s){const n=this.selectElement(s,this.divIDTestingCoupon),c=this.selectElement(s,this.resultPath);if(n&&c){const l=s.querySelectorAll(this.resultWrapperPath);if(l){if(l[0].className="resultWrapper divOverlayShow",a)if(l.forEach((e=>{e.className="resultWrapper divOverlayHide"})),o&&o>0&&t&&e){const a=this.selectElement(c,"#txtPositiveHeader");let i=this.platformInstance.GetResourceString(De.successTitle);const n="@TEMP@",d=this.formatPrice(n,o);i=i.replace("$1",d);const u=(0,Ee.Jl)(this.currency);i=i.replace(n,u),a&&(a.textContent=i);const h=this.selectElement(c,this.resultCouponDetailsPath);if(h){const t=this.platformInstance.GetResourceString(De.successSubTitle);if(t){const o=document.createElement("P");o.className="txtMedium",o.id="txtResultPositiveCoupon",o.textContent=e.couponCode,(0,r.B7)(h,t,o),window.trustedTypes&&(h.innerHTML=window.trustedTypes.emptyHTML),h.appendChild(o)}}const p=c.querySelector("#divPositiveCouponDetails");if(p){const e=document.createElement("P");e.className="txtSmall";let a=this.platformInstance.GetResourceString(De.SavingsWithoutCoupon);a=a.replace("$1",`${u}${t}`),e.textContent=a;const i=document.createElement("P");i.className="txtSmall";const r=t-o;let n=this.platformInstance.GetResourceString(De.SavingsWithCoupon);n=a.replace("$1",this.formatPrice(u,r)),i.textContent=n,p.appendChild(e),p.appendChild(i)}this.ShowDiv(this.selectElement(s,"#divOverlayResultSavings")),this.ShowDiv(this.selectElement(s,"#divOverlayResultCoupon"));const m=this.selectElement(c,"#txtECPositiveHeader");m.className="txtSmall txtOverlayResultPositive",m.style.color="rgba(0, 0, 0, 0.83)",m.style.margin="16px 0 0",l[0].className="resultWrapper divOverlayShow"}else{c.querySelector("#txtECResultNegativeTitle").textContent=this.platformInstance.GetResourceString(De.BestDealTitle),this.utilities.UpdateLocalizedText(c,"#txtECNegativeHeader",De.ECsuccessTitle);const e=this.selectElement(c,"#txtECNegativeHeader");e.className="txtMedium txtOverlayResultPositive",e.style.color="rgba(0, 0, 0, 0.83)",e.style.margin="16px 0 0",this.utilities.UpdateLocalizedText(c,"#txtResultNegativeCheckoutCvv",De.ECsuccessSubTitle),l[1].className="resultWrapper divOverlayShow"}this.addCloseButton(c),this.showResultMainDiv(n,c);const d=c.querySelector(this.divIDCheckoutOverlay);if(this.utilities.UpdateLocalizedText(c,this.divIDCheckoutOverlay,De.expressCheckoutButton),i===F.FieldError?(c.querySelectorAll("#divCVVSVG").forEach((e=>{this.HideDiv(e)})),this.utilities.UpdateLocalizedText(c,"#txtECPositiveHeader",De.ECErrorTitle),this.utilities.UpdateLocalizedText(c,"#txtECNegativeHeader",De.ECErrorTitle),this.utilities.UpdateLocalizedText(c,"#txtResultPositiveCheckoutCvv",De.ECErrorSubTitle),this.utilities.UpdateLocalizedText(c,"#txtResultNegativeCheckoutCvv",De.ECErrorSubTitle)):(this.utilities.UpdateLocalizedText(c,"#txtECPositiveHeader",De.ECsuccessTitle),this.utilities.UpdateLocalizedText(c,"#txtResultPositiveCheckoutCvv",De.ECsuccessSubTitle)),this.isAutofillPaymentToggleOff()){const e=c.querySelectorAll(this.divOverlayResultCheckoutDetailsPath);e&&e.forEach((e=>{this.HideDiv(e)}))}this.BNPLProvider()&&this.showBNPLTotalAmountDialog(s,c,i),d&&d.focus()}this.focusResultTrap=this.utilities.TrapFocus(c)}}}showBNPLTotalAmountDialog(t,o,a){const i=this.selectElement(o,this.divOverlayResultNegativePath);i&&(i.style.margin="44px 0",i.style.textAlign="center"),a!==F.FieldError&&(this.utilities.UpdateLocalizedText(o,"#txtECPositiveHeader",De.ECAddressSuccessTitle),this.utilities.UpdateLocalizedText(o,"#txtECNegativeHeader",De.ECAddressSuccessTitle),o.querySelectorAll(this.divOverlayResultCheckoutDetailsPath).forEach((e=>{this.HideDiv(e)})));const n=this.selectElement(o,this.divOverlayResultCheckoutTitle);n&&(n.style.marginLeft="16px",n.style.marginRight="16px");const s=this.selectElement(o,this.divOverlayFooterPath);this.HideDiv(s);const c=this.selectElement(o,this.bnplTotalAmountFooterPath);c.className="bnplTotalAmountFooter divOverlayShow";const l=this.selectElement(o,this.bnplContinueButtonPath);this.utilities.UpdateLocalizedText(o,this.bnplContinueButtonPath,this.replaceStrWithBNPLProvider(De.EcWalletExtraDialogContinueButton)),l.addEventListener("click",(()=>{E.onBnplContinueButtonClick()})),this.UpdateIconImage(c),this.utilities.UpdateLocalizedText(o,"#bnplFooterCancel",De.inProgressExitButton);const{lowerThreshold:d,period:u,upperThreshold:h}=this.getTotalAmountDialogData();let{amount:p}=this.getTotalAmountDialogData();this.finalAmountWithAA&&(p=this.finalAmountWithAA);const m=this.selectElement(t,this.bnplTotalAmountContainerPath);m.querySelector(this.bnplTopBannerSection).classList.add("bnpl-top-banner-section-exp3");const g=document.createElement("STRONG");g.textContent=this.platformInstance.GetResourceString(De.EcWalletTopBannerBoldText);const C=m.querySelector(this.bnplTopBannerContent);C&&(window.trustedTypes&&(C.innerHTML=window.trustedTypes.emptyHTML),(0,r.B7)(C,this.platformInstance.GetResourceString(De.EcWalletTopBanner),g));const S=m.querySelector(this.bnplLogo),f=this.utilities.IsDarkTheme();S.innerHTML=this.getBNPLProviderData()?.getLogoFunc?.(f),this.utilities.OnDarkThemeChange((e=>{S.innerHTML=this.getBNPLProviderData()?.getLogoFunc?.(e)})),m.querySelector(this.bnplLogoSvg).setAttribute("aria-label",this.platformInstance.GetResourceString(De.EcWalletInstallmentZipLogoDesc)),this.utilities.UpdateLocalizedText(m,this.bnplTitlePath,De.ECWalletExtraDialogTitle);const v=this.selectElement(m,this.bnplSubTitlePath);u&&(v.className="bnplSubTitle txtSmall divOverlayInlineShow"),this.utilities.UpdateLocalizedText(m,this.bnplSubTitlePath,this.platformInstance.GetResourceString(De.ECWalletExtraDialogSubTitle).replace("$1",u));const A=this.selectElement(m,this.bnplFeeDescriptionPath);if(u&&A&&(A.className="bnplFeeDescription divOverlayInlineShow"),A){window.trustedTypes&&(A.innerHTML=window.trustedTypes.emptyHTML);const e=this.platformInstance.GetResourceString(De.ECWalletExtraDialogFeeDescription).replace("$1",this.platformInstance.GetResourceString(De.ZipPayment)),t=document.createElement("A");t.target="_blank",t.href="https://zip.co/us/quadpay-terms-of-service",t.textContent=this.platformInstance.GetResourceString(De.EcWalletExtraDialogFeePrivacy),(0,r.B7)(A,e,t)}const y=this.selectElement(m,this.bnplShoppingCartValuePath),P=this.selectElement(m,this.bnplCartValueInputPath),b=this.getBNPLProviderData()?.continueToMessage,E=new Hs(p,d,h,this.showTotalAmountDialogErrorMsg,(e=>{P.value=e}),this.handleTotalAmountDialogLoading,l,b);E.onInputChange("$"+p,!0);const T=window[e.zS];T&&T().then((e=>{e&&e>0&&E.onInputChange("$"+e,!0)})),P.oninput=E.onChange,P.onblur=E.onBlur,P.onkeyup=E.onKeyUp,h&&(P.maxLength=Number(h).toFixed(2)?.length+1),P.title=this.platformInstance.GetResourceString(De.EcWalletExtraDialogTotalOrderAmount),y.appendChild(P),this.utilities.UpdateLocalizedText(m,this.bnplAmountReminderPath,De.EcWalletAmountTaxShippingReminder);const I=this.selectElement(m,this.bnplLicenseTextPath);if(I){window.trustedTypes&&(I.innerHTML=window.trustedTypes.emptyHTML);const e=this.platformInstance.GetResourceString(De.EcWalletExtraDialogLicense).replace("$2",this.getBNPLProviderData()?.name),t=document.createElement("A");t.target="_blank",t.href="https://webxtsvc.microsoft.com/Terms",t.textContent=this.platformInstance.GetResourceString(De.EcWalletExtraDialogTermsOfUse);const o=document.createElement("A");o.target="_blank",o.href="https://privacy.microsoft.com/en-us/privacystatement",o.textContent=this.platformInstance.GetResourceString(De.EcWalletExtraDialogPrivacy),(0,r.B7)(I,e,t,o)}this.utilities.UpdateLocalizedText(m,this.bnplMsDescription,De.EcWalletMicrosoftDescription),window[e.X4]=this.handleBNPLResult,m.className="divOverlayShow",this.selectElement(document,"#"+this.divIDOverlay).focus(),l.disabled?P.focus():l.focus()}SetInitialProgressBar(e,t){const o=this.selectElement(document,t);o&&(o.style.width=e+"%")}isAnimationReduce(){return this.animationQuery?.matches??!1}SetPositiveResult(t,o,a,i,n,s,c,l){if(!t||!i||!(o&&a||this.checkoutPageUrlData?.supportedNoOrderTotal))return;const d=this.localDataService.GetLocalData(Fe.Q.CashBackActive);let u=-1;if(d)try{const e=bn.GetLocalDataService().GetLocalData(Fe.Q.EstimatedCashback);if(e?.cashbackValue){const t=parseFloat(e.cashbackValue);t&&(u=t)}bn.GetLocalDataService().SaveLocalData(Fe.Q.EstimatedCashback,null)}catch(e){}const h=this.platformInstance.GetAppInfoClientName()===e.BN.Sapphire,p=this.isVali